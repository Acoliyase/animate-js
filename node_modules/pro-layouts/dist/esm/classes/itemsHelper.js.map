{"version":3,"file":"itemsHelper.js","sourceRoot":"","sources":["../../../src/classes/itemsHelper.js"],"names":[],"mappings":"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","sourcesContent":["import GalleryItem from './galleryItem.js';\nimport GalleryGroup from './galleryGroup.js';\nimport { utils } from 'pro-gallery-lib';\n\nexport class ItemsHelper {\n  static convertDtoToLayoutItem(dto) {\n    const isLayoutItem = !!(dto.id && dto.width > 0 && dto.height > 0);\n    if (isLayoutItem) {\n      return dto;\n    } else {\n      const dtoMetadata = dto.metadata || dto.metaData;\n      const metadata = typeof dtoMetadata === 'object' ? dtoMetadata : utils.parseStringObject(dtoMetadata) || {};\n      return {\n        id: dto.itemId || dto.photoId,\n        width: metadata.width,\n        height: metadata.height,\n        ...dto,\n      };\n    }\n  }\n\n  static convertToGalleryItems(galleryStructure, itemConfig = {}, existingItems = []) {\n    galleryStructure.galleryItems = [];\n    for (let c = 0; c < galleryStructure.columns.length; c++) {\n      const column = galleryStructure.columns[c];\n      column.galleryGroups = [];\n      const groups = column.groups || column;\n      for (let g = 0; g < groups.length; g++) {\n        const group = groups[g];\n        const groupItems = [];\n        for (let i = 0; i < group.items.length; i++) {\n          const item = group.items[i];\n          const _itemConfig = {\n            scheme: item,\n            dto: item.dto,\n            ...itemConfig,\n          };\n          const existingItem = existingItems[item.idx];\n          let newItem;\n          if (existingItem && existingItem.id && existingItem.id === item.id) {\n            newItem = existingItem;\n            newItem.update(_itemConfig);\n          } else {\n            newItem = new GalleryItem(_itemConfig);\n          }\n          groupItems[i] = newItem;\n          galleryStructure.galleryItems[item.idx] = groupItems[i];\n        }\n        column.galleryGroups[g] = new GalleryGroup({\n          scheme: group,\n          dto: group.dto,\n          items: groupItems,\n        });\n      }\n    }\n\n    return galleryStructure;\n  }\n\n  static convertExistingStructureToGalleryItems(existingStructure, galleryStructure, itemConfig = {}) {\n    // console.log('convertToGalleryItems', existingStructure.galleryItems);\n    // console.count('convertToGalleryItems');\n    if (utils.isVerbose()) {\n      console.time('convertToGalleryItems');\n    }\n    if (!existingStructure.galleryItems) {\n      existingStructure.galleryItems = [];\n    }\n    // remove last group so it will be rebuilt in case of dummy item\n    const lastColumn = existingStructure.columns.slice(-1)[0];\n    const lastGroup = lastColumn.galleryGroups.pop();\n    lastGroup && existingStructure.galleryItems.splice(-lastGroup.items.length);\n\n    for (let c = 0; c < galleryStructure.columns.length; c++) {\n      const column = galleryStructure.columns[c];\n      const existingColumn = existingStructure.columns[c] || column;\n      if (!existingColumn.galleryGroups) {\n        existingColumn.galleryGroups = [];\n      }\n      const groups = column.groups || column;\n      for (let g = 0; g < groups.length; g++) {\n        const group = groups[g];\n        const groupItems = [];\n        for (let i = 0; i < group.items.length; i++) {\n          const item = group.items[i];\n          if (!existingStructure.galleryItems[item.idx]) {\n            // console.count(`convertToGalleryItems - item [${item.idx}]`);\n            groupItems[i] = new GalleryItem(\n              Object.assign(\n                {\n                  scheme: item,\n                  dto: item.dto,\n                },\n                itemConfig\n              )\n            );\n            existingStructure.galleryItems[item.idx] = groupItems[i];\n          } else {\n            existingStructure.galleryItems[item.idx].processScheme(item);\n          }\n        }\n        if (!existingColumn.galleryGroups[g]) {\n          // console.count(`convertToGalleryItems - group [${g}]`);\n          existingColumn.galleryGroups[g] = new GalleryGroup({\n            scheme: group,\n            dto: group.dto,\n            items: groupItems,\n          });\n        } else {\n          existingColumn.galleryGroups[g].processScheme(group);\n        }\n      }\n      column.galleryGroups = existingColumn.galleryGroups;\n    }\n    galleryStructure.galleryItems = existingStructure.galleryItems;\n    if (utils.isVerbose()) {\n      console.timeEnd('convertToGalleryItems');\n    }\n    return galleryStructure;\n  }\n}\n"]}