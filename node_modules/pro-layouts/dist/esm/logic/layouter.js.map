{"version":3,"file":"layouter.js","sourceRoot":"","sources":["../../../src/logic/layouter.js"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable prettier/prettier */\nimport { utils } from './utils.js';\nimport { Item } from './item.js';\nimport { Group } from './group.js';\nimport { Strip } from './strip.js';\nimport { Column } from './column.js';\nimport layoutsStore from './layoutsStore.js';\nimport { optionsMap } from 'pro-gallery-lib';\n\nexport default class Layouter {\n  constructor(layoutParams) {\n    //dummy commit\n    this.ready = false;\n    this.pointer = 0;\n    this.layoutItems = [];\n\n    this.findNeighborItem = this.findNeighborItem.bind(this);\n\n    this.updateParams(layoutParams);\n\n    if (this.createLayoutOnInit !== false) {\n      this.createLayout(layoutParams);\n    }\n  }\n\n  updateParams(layoutParams) {\n    this.srcItems = layoutParams.items;\n    this.styleParams = utils.addDefaultStyleParams(layoutParams.styleParams);\n    this.container = utils.convertContainer(\n      layoutParams.container,\n      this.styleParams\n    );\n\n    const options = layoutParams.options || {};\n    this.useExistingLayout = !!options.useExistingLayout;\n    this.createLayoutOnInit = options.createLayoutOnInit;\n    this.showAllItems = !!options.showAllItems || !!layoutParams.showAllItems;\n    this.useLayoutStore = !!options.useLayoutStore;\n  }\n\n  verifyGalleryState() {\n    if (!this.container.galleryWidth) {\n      this.ready = false;\n      throw new Error(\n        'Layouter: cannot create layout, galleryWidth is undefined or 0'\n      );\n    }\n\n    if (!this.styleParams.targetItemSize) {\n      this.ready = false;\n      throw new Error(\n        'Layouter: cannot create layout, targetItemSize is undefined or 0'\n      );\n    }\n  }\n\n  calcNumberOfColumns(galleryWidth, targetItemSize) {\n    let numOfCols = 1;\n    if (this.styleParams[optionsMap.layoutParams.structure.layoutOrientation] === 'VERTICAL') {\n      if (this.styleParams.fixedColumns > 0) {\n        numOfCols = this.styleParams.fixedColumns;\n      \n      } else {\n        // find the number of columns that makes each column width the closet to the targetItemSize\n        const numOfColsFloat = galleryWidth / targetItemSize;\n        const roundFuncs = [Math.floor, Math.ceil];\n        const diffs = roundFuncs\n          .map((func) => func(numOfColsFloat)) //round to top, round to bottom\n          .map((n) => Math.round(galleryWidth / n)) //width of each col\n          .map((w) => Math.abs(targetItemSize - w)); //diff from targetItemSize\n        const roundFunc = roundFuncs[diffs.indexOf(Math.min(...diffs))]; //choose the round function that has the lowest diff from the targetItemSize\n        numOfCols = roundFunc(numOfColsFloat) || 1;\n      }\n    } else {\n      numOfCols = 1;\n    }\n    return numOfCols;\n  }\n\n  findShortestColumn(columns, groupIdx) {\n    let minCol = columns[0];\n    if (this.styleParams[optionsMap.layoutParams.structure.groupsOrder] === 'LEFT_TO_RIGHT') {\n      minCol = columns[groupIdx % columns.length];\n    } else {\n      let minColH = -1;\n      for (const column of columns) {\n        const colH = column.height;\n        if (colH < minColH || minColH < 0) {\n          minColH = colH;\n          minCol = column;\n        }\n      }\n    }\n    return minCol;\n  }\n\n  saveExistingLayout() {\n    if (this.useLayoutStore) {\n      layoutsStore.layout = {\n        pointer: this.pointer,\n        layoutItems: this.layoutItems,\n        groups: this.groups,\n        strips: this.strips,\n        groupIdx: this.groupIdx,\n        groupItems: this.groupItems,\n        group: this.group,\n        strip: this.strip,\n        targetItemSize: this.targetItemSize,\n        galleryHeight: this.galleryHeight,\n        columns: this.columns,\n      };\n    }\n  }\n\n  prepareLayoutParams() {\n    if (this.useExistingLayout && this.pointer > 0) {\n      if (this.useLayoutStore) {\n        Object.assign(this, layoutsStore.layout);\n      } else {\n        if (this.styleParams[optionsMap.layoutParams.structure.layoutOrientation] === 'VERTICAL') {\n          //---------------------| COLUMNS GALLERY |----------------------//\n          //remove items from the last 3 groups;\n          const lastGroups = this.groups.slice(-3);\n          lastGroups.forEach((group) => {\n            const column = this.columns[group.columnIdx];\n            if (column) {\n              column.height -= group.totalHeight;\n              column.groups.splice(-1, 1);\n            }\n            this.groups.splice(-1, 1);\n            group.realItems.forEach(() => {\n              this.layoutItems.splice(-1, 1);\n              this.pointer--;\n            });\n            this.groupIdx--;\n          });\n        } else {\n          //---------------------| STRIPS GALLERY |----------------------//\n          if (this.scrollDirection === 'HORIZONTAL') {\n            //remove items from the last group:\n            const lastGroups = this.groups.slice(-1);\n            lastGroups.forEach((group) => {\n              const column = this.columns[0];\n              if (column) {\n                column.groups.splice(-1, 1);\n              }\n              const strip = this.strips[0];\n              if (strip) {\n                strip.setWidth(strip.width - group.width);\n                strip.ratio = strip.width / strip.height;\n                strip.groups.splice(-1, 1);\n                this.strip = strip;\n              }\n              this.strips = [];\n\n              this.groups.splice(-1, 1);\n              group.realItems.forEach(() => {\n                this.layoutItems.splice(-1, 1);\n                this.pointer--;\n              });\n              this.groupIdx--;\n            });\n            this.galleryHeight = 0;\n          } else {\n            //remove items from the last 2 strips;\n            const lastStrips = this.strips.slice(-2);\n            if (lastStrips) {\n              lastStrips.forEach((lastStrip) => {\n                if (lastStrip) {\n                  this.strips.splice(-1, 1);\n                  const groups = lastStrip.groups;\n                  groups.forEach((group) => {\n                    this.groups.splice(-1, 1);\n                    group.items.forEach(() => {\n                      this.layoutItems.splice(-1, 1);\n                      this.pointer--;\n                    });\n                    this.groupIdx--;\n                  });\n                }\n              });\n              this.galleryHeight = this.strips.reduce(\n                (totalHeight, strip) => (totalHeight += strip.height),\n                0\n              );\n              // this.strip = this.strips[this.strips.length - 1];\n              this.strip = new Strip({\n                idx: this.strips.length + 1,\n                container: this.container,\n                groupsPerStrip: this.styleParams[optionsMap.layoutParams.groups.numberOfGroupsPerRow],\n                scrollDirection: this.styleParams[optionsMap.layoutParams.structure.scrollDirection],\n                targetItemSize: this.targetItemSize,\n              });\n            }\n          }\n\n          this.groupItems = [];\n        }\n      }\n\n      this.item = {};\n      this.pointer = Math.max(0, this.pointer);\n      this.maxLoops = this.srcItems.length * 10;\n    } else {\n      this.pointer = 0;\n      this.firstGroup = false;\n      this.layoutItems = [];\n      this.groups = [];\n      this.strips = [];\n\n      if (this.styleParams.forceFullHeight) { //v5 TODO check and remove this API\n        this.targetItemSize = Math.sqrt(\n          (this.container.galleryHeight * this.container.galleryWidth) /\n            this.srcItems.length\n        );\n      } else {\n        let gallerySizeVal;\n        if (typeof this.styleParams.targetItemSize === 'function') {\n          gallerySizeVal = this.styleParams.targetItemSize();\n        } else {\n          gallerySizeVal = this.styleParams.targetItemSize;\n        }\n        this.targetItemSize =\n          Math.floor(gallerySizeVal) +\n          Math.ceil(\n            2 *\n              (this.styleParams[optionsMap.layoutParams.structure.itemSpacing] / 2 -\n                this.styleParams[optionsMap.layoutParams.structure.gallerySpacing])\n          );\n      }\n\n      this.galleryWidth = Math.floor(this.container.galleryWidth);\n      this.maxGroupSize = this.getMaxGroupSize();\n\n      this.groupIdx = 0;\n      this.item = {};\n\n      this.groupItems = [];\n      this.group = {};\n      this.bounds = this.container.bounds || {};\n\n      this.strip = new Strip({\n        idx: 1,\n        container: this.container,\n        groupsPerStrip: this.styleParams[optionsMap.layoutParams.groups.numberOfGroupsPerRow],\n        scrollDirection: this.styleParams[optionsMap.layoutParams.structure.scrollDirection],\n        targetItemSize: this.targetItemSize,\n      });\n\n      this.galleryHeight = 0;\n\n      this.numOfCols = this.calcNumberOfColumns(\n        this.galleryWidth,\n        this.targetItemSize\n      );\n      this.targetItemSize = this.styleParams[optionsMap.layoutParams.structure.layoutOrientation] === 'VERTICAL'\n        ? Math.floor(this.galleryWidth / this.numOfCols)\n        : this.targetItemSize;\n\n      const { externalInfoWidth } =\n        this.styleParams;\n        const columnWidths = this.styleParams[optionsMap.layoutParams.structure.columnRatios]\n        const imageMargin = this.styleParams[optionsMap.layoutParams.structure.itemSpacing]\n      const cropRatio = this.styleParams[optionsMap.layoutParams.crop.ratios];\n      let columnWidthsArr = false;\n      if (columnWidths && columnWidths.length > 0) {\n        columnWidthsArr = columnWidths.map(Number);\n        while (columnWidthsArr.length < this.numOfCols) {\n          columnWidthsArr.push(...columnWidthsArr);\n        }\n        columnWidthsArr = columnWidthsArr.slice(0, this.numOfCols);\n        const columnMultiplier =\n          this.galleryWidth / columnWidthsArr.reduce((a, b) => a + b, 0);\n        columnWidthsArr = columnWidthsArr.map((col) =>\n          Math.round((col *= columnMultiplier))\n        );\n      }\n\n      let totalLeft = 0;\n      let remainderWidth = this.galleryWidth;\n      let fixedCubeHeight;\n      this.columns = Array(this.numOfCols)\n        .fill(0)\n        .map((column, idx) => {\n          //round group widths to fit an even number of pixels\n          let colWidth = columnWidthsArr\n            ? columnWidthsArr[idx]\n            : Math.round(remainderWidth / (this.numOfCols - idx));\n          const curLeft = totalLeft;\n          totalLeft += colWidth;\n          remainderWidth -= colWidth;\n          //fix cropRatio of rounded columns\n          const infoWidth =\n            Math.round(\n              externalInfoWidth > 1 // integer represent size in pixels, floats size in percentage\n                ? externalInfoWidth\n                : externalInfoWidth * colWidth\n            ) || 0;\n          colWidth -= infoWidth;\n          fixedCubeHeight =\n            fixedCubeHeight ||\n            (this.targetItemSize - infoWidth - imageMargin) / cropRatio[0] + //v5 check how this works if there are multiple ratios or if this is a function......wtf\n              imageMargin; //calc the cube height only once\n          //add space for info on the side\n          return new Column(idx, colWidth, curLeft, fixedCubeHeight, infoWidth);\n        });\n      this.maxLoops = this.srcItems.length * 10;\n    }\n  }\n\n  createLayout(layoutParams) {\n    if (typeof layoutParams !== 'undefined') {\n      this.updateParams(layoutParams);\n    }\n\n    this.verifyGalleryState();\n\n    this.prepareLayoutParams();\n\n    while (this.srcItems[this.pointer]) {\n      if (this.imagesLeft === 6) {\n        this.saveExistingLayout();\n      }\n\n      this.maxLoops--;\n      if (this.maxLoops <= 0) {\n        console.error('Cannot create layout, maxLoops reached!!!');\n        return false;\n      }\n\n      this.item = new Item({\n        idx: this.pointer,\n        inGroupIdx: this.groupItems.length + 1,\n        scrollTop: this.galleryHeight,\n        dto: this.srcItems[this.pointer],\n        container: this.container,\n        styleParams: this.styleParams,\n      });\n\n      this.layoutItems[this.pointer] = this.item;\n\n      //push the image to a group - until its full\n      this.groupItems.push(this.item);\n      if (\n        this.groupItems.length < this.maxGroupSize &&\n        this.srcItems[this.pointer + 1]\n      ) {\n        this.pointer++;\n        continue;\n      }\n\n      this.group = new Group({\n        idx: this.groupIdx,\n        stripIdx: this.strip.idx,\n        inStripIdx: this.strip.groups.length + 1,\n        top: this.galleryHeight,\n        items: this.groupItems,\n        isLastItems: this.isLastImages,\n        targetItemSize: this.targetItemSize,\n        showAllItems: this.showAllItems,\n        container: this.container,\n        styleParams: this.styleParams,\n      });\n      this.groups[this.groupIdx] = this.group;\n\n      //take back the pointer in case the group was created with less items\n      this.pointer += this.group.realItems.length - this.groupItems.length;\n\n      this.groupIdx++;\n      this.groupItems = [];\n\n      //resize and fit the group in the strip / column\n      if (this.styleParams[optionsMap.layoutParams.structure.layoutOrientation] === 'HORIZONTAL') {\n        //---------------------| STRIPS GALLERY |----------------------//\n\n        if (this.strip.isFull(this.group, this.isLastImage)) {\n          //close the current strip\n          this.strip.resizeToHeight(this.galleryWidth / this.strip.ratio);\n          this.strip.setWidth(this.galleryWidth);\n          this.galleryHeight += this.strip.height;\n          this.columns[0].addGroups(this.strip.groups);\n          this.strips.push(this.strip);\n\n          //open a new strip\n          this.strip = new Strip({\n            idx: this.strip.idx + 1,\n            container: this.container,\n            groupsPerStrip: this.styleParams[optionsMap.layoutParams.groups.numberOfGroupsPerRow],\n            scrollDirection: this.styleParams[optionsMap.layoutParams.structure.scrollDirection],\n            targetItemSize: this.targetItemSize,\n          });\n\n          //reset the group (this group will be rebuilt)\n          this.pointer -= this.group.realItems.length - 1;\n          this.groupIdx--;\n          continue;\n        }\n\n        //add the group to the (current/new) strip\n        this.group.setTop(this.galleryHeight);\n        this.strip.ratio += this.group.ratio;\n        // this.strip.height = Math.min(targetItemSize, (galleryWidth / this.strip.ratio));\n        this.strip.height = this.galleryWidth / this.strip.ratio;\n        this.strip.setWidth(this.galleryWidth);\n        this.strip.addGroup(this.group);\n\n        if (this.isLastImage && this.strip.hasGroups) {\n          if (this.styleParams[optionsMap.layoutParams.structure.scrollDirection] === 'HORIZONTAL') {\n            this.strip.height =\n              this.container.galleryHeight +\n              (this.styleParams[optionsMap.layoutParams.structure.itemSpacing] / 2 -\n                this.styleParams[optionsMap.layoutParams.structure.gallerySpacing]);\n          } else if (this.strip.canRemainIncomplete()) {\n            //stretching the this.strip to the full width will make it too high - so make it as high as the targetItemSize and not stretch\n            this.strip.height = this.targetItemSize;\n            this.strip.markAsIncomplete();\n          }\n\n          this.strip.resizeToHeight(this.strip.height);\n          this.galleryHeight += this.strip.height;\n          this.columns[0].addGroups(this.strip.groups);\n          this.strips.push(this.strip);\n        }\n      } else {\n        //---------------------| COLUMNS GALLERY |----------------------//\n\n        //find the shortest column\n        const minCol = this.findShortestColumn(\n          this.columns,\n          this.groups.length - 1\n        );\n\n        //resize the group and images\n        this.group.setCubedHeight(minCol.cubedHeight); //fix last column's items ratio (caused by stretching it to fill the screen)\n        this.group.resizeToWidth(minCol.width);\n        this.group.round();\n\n        //update the group's position\n        this.group.setTop(minCol.height);\n        this.group.setLeft(minCol.left);\n\n        //add the image to the column\n        minCol.addGroup(this.group);\n\n        //add the image height to the column\n        minCol.height += this.group.totalHeight;\n\n        if (this.galleryHeight < minCol.height) {\n          this.galleryHeight = minCol.height;\n        }\n      }\n\n      if (!this.firstGroup) {\n        this.firstGroup = this.group;\n      }\n\n      this.pointer++;\n    }\n\n    if (this.styleParams.forceFullHeight) { //v5 TODO check and remove this API\n      const stretchRatio = this.container.galleryHeight / this.galleryHeight;\n      this.items.map((item) => {\n        item.cubeImages = true;\n        item.cropRatio = item.ratio = item.width / (item.height * stretchRatio);\n        item.height *= stretchRatio;\n        return item;\n      });\n      this.groups.map((group) => {\n        group.height *= stretchRatio;\n        group.setTop(group.top * stretchRatio);\n        group.resizeItems();\n        return group;\n      });\n    }\n\n    //results\n    this.lastGroup = this.group;\n    this.colWidth = Math.floor(this.galleryWidth / this.numOfCols);\n    this.height =\n      this.galleryHeight -\n      (this.styleParams[optionsMap.layoutParams.structure.itemSpacing] / 2 - this.styleParams[optionsMap.layoutParams.structure.gallerySpacing]) * 2;\n\n    this.width = this.lastGroup.left + this.lastGroup.width;\n\n    this.ready = true;\n\n    return this.scheme;\n  }\n\n  lastVisibleItemIdxInHeight(height) {\n    for (let i = this.items.length - 1; i >= 0; i--) {\n      const item = this.items[i];\n      const isVisible = item.offset.top < height;\n      if (isVisible) {\n        return i;\n      }\n    }\n    return this.items.length - 1;\n  }\n\n  lastVisibleItemIdx() {\n    //the item must be visible and about the show more button\n    return this.lastVisibleItemIdxInHeight(this.container.galleryHeight - 100);\n  }\n\n  findNeighborItem(itemIdx, dir) {\n    const currentItem = this.layoutItems[itemIdx];\n\n    let neighborItem;\n\n    const findClosestItem = (currentItemX, currentItemY, condition) => {\n      let minDistance = null;\n      let minDistanceItem = {};\n\n      let itemY;\n      let itemX;\n      let distance;\n\n      // each(slice(this.layoutItems, itemIdx - 50, itemIdx + 50), (item) => {\n      this.layoutItems.forEach((item) => {\n        itemY = item.offset.top + item.height / 2;\n        itemX = item.offset.left + item.width / 2;\n        distance = Math.sqrt(\n          Math.pow(itemY - currentItemY, 2) + Math.pow(itemX - currentItemX, 2)\n        );\n        if (\n          (minDistance === null || (distance > 0 && distance < minDistance)) &&\n          condition(currentItemX, currentItemY, itemX, itemY)\n        ) {\n          minDistance = distance;\n          minDistanceItem = item;\n        }\n      });\n      return minDistanceItem;\n    };\n\n    switch (dir) {\n      case 'up':\n        neighborItem = findClosestItem(\n          currentItem.offset.left + currentItem.width / 2,\n          currentItem.offset.top,\n          (curX, curY, itmX, itmY) => itmY < curY\n        );\n        break;\n\n      case 'left':\n        neighborItem = findClosestItem(\n          currentItem.offset.left,\n          currentItem.offset.top + currentItem.height / 2,\n          (curX, curY, itmX) => itmX < curX\n        );\n        break;\n\n      case 'down':\n        neighborItem = findClosestItem(\n          currentItem.offset.left + currentItem.width / 2,\n          currentItem.offset.bottom,\n          (curX, curY, itmX, itmY) => itmY > curY\n        );\n        break;\n\n      default:\n      case 'right':\n        neighborItem = findClosestItem(\n          currentItem.offset.right,\n          currentItem.offset.top + currentItem.height / 2,\n          (curX, curY, itmX) => itmX > curX\n        );\n        break;\n    }\n\n    if (neighborItem.idx >= 0) {\n      return neighborItem.idx;\n    } else {\n      console.warn('Could not find offset for itemIdx', itemIdx, dir);\n      return itemIdx; //stay on the same item\n    }\n  }\n\n  getMaxGroupSize() {\n    let _maxGroupSize = 1;\n    try {\n      const groupTypes =\n        typeof this.styleParams[optionsMap.layoutParams.groups.allowedGroupTypes] === 'string' &&\n        this.styleParams[optionsMap.layoutParams.groups.allowedGroupTypes].length > 0\n          ? this.styleParams[optionsMap.layoutParams.groups.allowedGroupTypes].split(',')\n          : this.styleParams[optionsMap.layoutParams.groups.allowedGroupTypes];\n      _maxGroupSize =\n        groupTypes.length > 0\n          ? groupTypes.reduce(\n              (curSize, groupType) => Math.max(curSize, parseInt(groupType)),\n              1\n            )\n          : Number(groupTypes);\n      _maxGroupSize = Math.min(_maxGroupSize, this.styleParams[optionsMap.layoutParams.groups.groupSize]);\n    } catch (e) {\n      console.error(\"couldn't calculate max group size - returing 3 (?)\", e);\n      _maxGroupSize = 3;\n    }\n    return _maxGroupSize;\n  }\n\n  get isLastImage() {\n    return !this.srcItems[this.pointer + 1];\n  }\n\n  get isLastImages() {\n    return !this.srcItems[this.pointer + 1];\n  }\n\n  get imagesLeft() {\n    return this.srcItems.length - this.pointer - 1;\n  }\n\n  get items() {\n    return this.layoutItems;\n  }\n\n  get scheme() {\n    return {\n      items: this.items.map((item) => item.scheme),\n      groups: this.groups.map((group) => group.scheme),\n      strips: this.strips.map((strip) => strip.scheme),\n      columns: this.columns.map((column) => column.scheme),\n      height: this.height,\n      width: this.width,\n    };\n  }\n}\n/* eslint-enable prettier/prettier */\n"]}