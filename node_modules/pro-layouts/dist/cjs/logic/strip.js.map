{"version":3,"file":"strip.js","sourceRoot":"","sources":["../../../src/logic/strip.js"],"names":[],"mappings":"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","sourcesContent":["export class Strip {\n  constructor(config) {\n    this.ratio = 0;\n    this.groups = [];\n    this.width = 0;\n    this.height = 0;\n    this.isFullWidth = true;\n\n    this.idx = config.idx;\n    this.groupsPerStrip = config.groupsPerStrip;\n    this.scrollDirection = config.scrollDirection;\n    this.targetItemSize = config.targetItemSize;\n    this.container = config.container;\n  }\n\n  addGroup(group) {\n    if (this.hasGroups) {\n      this.lastGroup.isLastGroup = false;\n    }\n    this.groups.push(group);\n    group.stripIdx = this.idx;\n    group.Strip = this;\n    this.lastGroup.isLastGroup = true;\n    this.lastGroup.stripWidth = this.height * this.ratio;\n  }\n\n  markAsIncomplete() {\n    //prevent from the last group to be streched\n    this.isFullWidth = false;\n    this.lastGroup.isLastGroup = false;\n  }\n\n  canRemainIncomplete() {\n    if (this.groupsPerStrip > 0) {\n      return false;\n    } else {\n      return this.targetItemSize * 1.5 < this.height;\n    }\n  }\n\n  setWidth(width) {\n    this.width = width;\n    if (this.hasGroups) {\n      this.lastGroup.stripWidth = width;\n    }\n  }\n\n  resizeToHeight(height) {\n    this.height = height;\n    let left = 0;\n    let remainder = 0;\n    for (const group of this.groups) {\n      group.setLeft(left);\n      // group.left = (left);\n      group.width += remainder; //add the remainder from the last group round\n      group.resizeToHeight(height);\n      remainder = group.width;\n      group.round();\n      remainder -= group.width;\n      left += group.width;\n    }\n  }\n\n  isFull(newGroup, isLastImage) {\n    if (!this.hasGroups) {\n      return false;\n    }\n\n    const { groupsPerStrip, scrollDirection, targetItemSize } = this;\n\n    if (groupsPerStrip > 0) {\n      return this.groups.length >= groupsPerStrip;\n    }\n\n    const { galleryWidth } = this.container;\n\n    let isStripSmallEnough;\n    if (scrollDirection === 'HORIZONTAL') {\n      isStripSmallEnough = false; //horizontal layout is one long strip\n    } else {\n      const withNewGroup = galleryWidth / (this.ratio + newGroup.ratio) - targetItemSize; //start a new strip BEFORE adding the current group\n      const withoutNewGroup = galleryWidth / this.ratio - targetItemSize; //start a new strip AFTER adding the current group\n      if (isNaN(withNewGroup) || isNaN(withoutNewGroup)) {\n        isStripSmallEnough = false;\n      } else if (withoutNewGroup < 0) {\n        //the strip is already too small\n        isStripSmallEnough = true;\n      } else if (withNewGroup < 0) {\n        //adding the new group makes is small enough\n        // check if adding the new group makes the strip TOO small\n        //so - without the new group, the strip is larger than the required size - but adding the new group might make it too small\n        isStripSmallEnough = Math.abs(withoutNewGroup) < Math.abs(withNewGroup);\n      } else {\n        isStripSmallEnough = false;\n      }\n\n      if (isStripSmallEnough && isLastImage) {\n        //if it is the last image - prefer adding it to the last strip rather putting it on a new strip\n        isStripSmallEnough = Number(Math.abs(withoutNewGroup)) < Math.abs(withNewGroup);\n      }\n    }\n\n    return isStripSmallEnough;\n  }\n\n  get hasGroups() {\n    return this.groups.length > 0;\n  }\n\n  get lastGroup() {\n    return this.groups[this.groups.length - 1];\n  }\n\n  get scheme() {\n    return {\n      idx: this.idx,\n      groups: this.groups.map((group) => group.scheme),\n      width: this.width,\n      height: this.height,\n      ratio: this.ratio,\n      isFullWidth: this.isFullWidth,\n    };\n  }\n}\n"]}