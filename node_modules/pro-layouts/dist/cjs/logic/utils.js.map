{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../../src/logic/utils.js"],"names":[],"mappings":"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","sourcesContent":["import { optionsMap } from 'pro-gallery-lib';\n\nclass Utils {\n  constructor() {\n    this._hash2int = {};\n  }\n\n  stripSlashes(str) {\n    let newStr = '';\n    if (typeof str === 'string') {\n      newStr = str\n        .replace(/\\\\\\//g, '/')\n        .replace(/\\\\'/g, \"'\")\n        .replace(/\\\\\"/g, '\"')\n        .replace(/\\\\0/g, '\\0')\n        .replace(/\\\\\\\\/g, '\\\\');\n    }\n    return newStr;\n  }\n\n  parseStringObject(sObj) {\n    if (typeof sObj !== 'string') {\n      return sObj;\n    }\n\n    const stripedObj = this.stripSlashes(sObj);\n    //eslint-disable-next-line\n    if (typeof sObj === 'string' && (/^[\\],:{}\\s]*$/.test(stripedObj.replace(/\\\\[\"\\\\\\/bfnrtu]/g, '@').replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']').replace(/(?:^|:|,)(?:\\s*\\[)+/g, '')))) {\n      //this is a json\n      try {\n        return JSON.parse(stripedObj);\n      } catch (e) {\n        // console.error('Parse object error: Catched ', e);\n      }\n    }\n    return stripedObj;\n  }\n\n  hashToInt(str, min, max) {\n    let int = 0;\n\n    if (typeof str === 'undefined' || str.length === 0) {\n      return int;\n    }\n\n    if (!this._hash2int[str]) {\n      for (let i = 0; i < str.length; i++) {\n        int += str.charCodeAt(i);\n      }\n      this._hash2int[str] = int;\n    }\n\n    if (typeof min === 'undefined' || typeof max === 'undefined') {\n      return this._hash2int[str];\n    } else {\n      return (this._hash2int[str] % (max - min + 1)) + min;\n    }\n  }\n\n  hashToRandomInt(str, min = 0, max = 100000) {\n    if (typeof str === 'undefined' || str.length === 0) {\n      return 0;\n    }\n\n    min = Math.round(min);\n    max = Math.round(max);\n    str += str.length + min + max;\n\n    if (!this._hash2int[str]) {\n      this._hash2int[str] = Math.round(Math.random() * (max - min) + min);\n    }\n    return this._hash2int[str];\n  }\n\n  addDefaultStyleParams(styleParams) {\n    function populateWithDefaultOptions(options) {\n      //This will override only undefined values with default values\n      const mergedOptions = Object.assign({}, defaultLayouterSP, options);\n      Object.keys(mergedOptions).forEach((key) => {\n        if (typeof mergedOptions[key] === 'undefined') {\n          mergedOptions[key] = defaultLayouterSP[key];\n        }\n      });\n      return mergedOptions;\n    }\n    //default styleParams\n    const defaultLayouterSP = {\n      [optionsMap.layoutParams.structure.gallerySpacing]: 0,\n      [optionsMap.layoutParams.groups.repeatingGroupTypes]: [],\n      [optionsMap.layoutParams.crop.enable]: false,\n      [optionsMap.layoutParams.crop.method]: 'FILL',\n      [optionsMap.layoutParams.crop.ratios]: [1],\n      [optionsMap.layoutParams.crop.enableSmartCrop]: false,\n      [optionsMap.layoutParams.structure.itemSpacing]: 10,\n      [optionsMap.layoutParams.structure.scatter.randomScatter]: 0,\n      [optionsMap.layoutParams.structure.scatter.manualScatter]: '',\n      [optionsMap.layoutParams.groups.groupByOrientation]: true,\n      [optionsMap.layoutParams.groups.groupSize]: 3,\n      [optionsMap.layoutParams.groups.allowedGroupTypes]: ['1', '2h', '2v', '3h', '3v', '3t', '3b', '3l', '3r'],\n      [optionsMap.layoutParams.structure.layoutOrientation]: 'VERTICAL',\n      [optionsMap.layoutParams.targetItemSize.minimum]: 120,\n      [optionsMap.layoutParams.structure.scrollDirection]: 'VERTICAL',\n      targetItemSize: 500,\n      [optionsMap.layoutParams.groups.density]: 50,\n      fixedColumns: 0,\n      [optionsMap.layoutParams.structure.columnRatios]: [],\n    };\n\n    return populateWithDefaultOptions(styleParams);\n  }\n\n  convertContainer(container, styleParams) {\n    const convertedContainer = {\n      bounds: {},\n      ...container,\n    };\n    // galleryWidth is a value calculated prior to the layouter. if it exists it is stronger than width. if galleryWidth doesnt exist width(the total container width) is used instead but it then requieres adding margin calculations. Same is true for the height.\n    // this is mostly true for \"galleries\" containing more than one \"gallery\" such as thumbnails where teh thumbnails are also a gallery and both are contained within container.width/height and have their own galleryWidth/Height\n    if (container.width >= 0 && !(container.galleryWidth >= 0)) {\n      convertedContainer.galleryWidth =\n        container.width +\n        ((styleParams[optionsMap.layoutParams.structure.itemSpacing] / 2 || 0) -\n          (styleParams[optionsMap.layoutParams.structure.gallerySpacing] || 0)) *\n          2;\n      delete convertedContainer.width;\n    }\n    if (container.height >= 0 && !(container.galleryHeight >= 0)) {\n      convertedContainer.galleryHeight =\n        container.height +\n        ((styleParams[optionsMap.layoutParams.structure.itemSpacing] / 2 || 0) -\n          (styleParams[optionsMap.layoutParams.structure.gallerySpacing] || 0));\n      delete convertedContainer.height;\n    }\n    if (\n      styleParams.externalInfoHeight >= 0 &&\n      styleParams[optionsMap.layoutParams.structure.scrollDirection] === 'HORIZONTAL'\n    ) {\n      convertedContainer.galleryHeight -= styleParams.externalInfoHeight;\n    }\n\n    return convertedContainer;\n  }\n}\nexport const utils = new Utils();\n"]}