{"version":3,"names":["React","CollectionToolbarFilters","useSchema","useSchemaRegistry","StaticCollectionFilter","DynamicCollectionFilter","createDateTimeFilter","createBooleanFilter","createNumberFilter","createEnumFilter","createReferenceFilter","useFilters","configuration","schema","schemaRegistry","filters","useMemo","currFilters","items","forEach","filter","id","fieldId","fieldDefinition","fields","label","displayName","openByDefault","tagLabel","sectionTitle","baseParams","commonFilterProps","initiallyOpen","accordionItemProps","toolbarItemProps","toolbarTagProps","type","push","config","dateConfig","booleanConfig","numberConfig","referencedCollectionId","referenceMetadata","referencedSchema","getSchema","dynamicOptionsConfig","additionalParams","enumConfig","filterFieldMapping","reduce","acc","collectionToolbarFiltersProps","inline","maxInlineFilters","panelTitle","filtersData","key","components","collectionData","createElement","_extends","component","props","collectionId","componentName","filtersObject","filterComponent","length","undefined"],"sources":["../../../src/hooks/useFilters.tsx"],"sourcesContent":["import React from 'react';\nimport {\n  CollectionToolbarFilters,\n  CollectionToolbarFiltersProps,\n  Filter,\n} from '@wix/patterns';\nimport { Filter as SchemaFilterType, FiltersConfig } from '../types';\nimport { useSchema } from '../providers/SchemaContext';\nimport { useSchemaRegistry } from '../providers';\nimport {\n  StaticCollectionFilter,\n  DynamicCollectionFilter,\n} from '../components/filters';\nimport {\n  createDateTimeFilter,\n  createBooleanFilter,\n  createNumberFilter,\n  createEnumFilter,\n  createReferenceFilter,\n} from '../utils/filterCreators';\n\nexport interface FilterOptions {\n  key: string;\n  fieldId: string;\n  filter: Filter<any>;\n  component: React.ElementType;\n  collectionData?: { id: string; name: string }[];\n  collectionId?: string;\n  componentName?: string;\n  props: Record<string, any>;\n}\n\nexport interface ReturnValue {\n  filters: { [key: string]: Filter<any> };\n  components: React.JSX.Element[];\n  collectionToolbarFiltersProps: Pick<\n    CollectionToolbarFiltersProps,\n    'inline' | 'panelTitle' | 'useNewFilters'\n  >;\n}\n\nexport const useFilters = (configuration?: FiltersConfig) => {\n  const schema = useSchema();\n  const schemaRegistry = useSchemaRegistry();\n  const filters = React.useMemo(() => {\n    const currFilters: FilterOptions[] = [];\n    configuration?.items.forEach((filter) => {\n      const { id, fieldId } = filter;\n      const fieldDefinition = schema.fields[fieldId];\n      if (!fieldDefinition) {\n        return;\n      }\n\n      const label = filter.displayName || fieldDefinition.displayName;\n      const { openByDefault, tagLabel, sectionTitle } = filter;\n\n      const baseParams = {\n        id,\n        fieldId,\n        commonFilterProps: {\n          sectionTitle,\n          initiallyOpen: openByDefault,\n          accordionItemProps: { label },\n          toolbarItemProps: { label },\n          toolbarTagProps: { label: tagLabel },\n        },\n      };\n\n      switch (fieldDefinition.type) {\n        case 'DATE':\n        case 'DATETIME':\n          currFilters.push(\n            createDateTimeFilter({\n              ...baseParams,\n              config: filter.dateConfig,\n            }),\n          );\n          break;\n\n        case 'BOOLEAN':\n          currFilters.push(\n            createBooleanFilter({\n              ...baseParams,\n              config: filter.booleanConfig,\n            }),\n          );\n          break;\n\n        case 'NUMBER':\n          currFilters.push(\n            createNumberFilter({\n              ...baseParams,\n              config: filter.numberConfig,\n            }),\n          );\n          break;\n\n        case 'REFERENCE': {\n          const { referencedCollectionId } = fieldDefinition.referenceMetadata;\n          const referencedSchema = schemaRegistry.getSchema(\n            referencedCollectionId,\n          );\n\n          if (referencedSchema) {\n            currFilters.push(\n              createReferenceFilter({\n                ...baseParams,\n                config: filter.dynamicOptionsConfig,\n                additionalParams: {\n                  referencedSchema,\n                },\n              }),\n            );\n          }\n          break;\n        }\n\n        default:\n          if (filter?.enumConfig) {\n            currFilters.push(\n              createEnumFilter({\n                ...baseParams,\n                config: filter.enumConfig,\n              }),\n            );\n          }\n          break;\n      }\n    });\n    return currFilters;\n  }, [configuration?.items, schema.fields, schemaRegistry]);\n\n  const filterFieldMapping = React.useMemo(() => {\n    return configuration?.items.reduce((acc, filter) => {\n      acc[filter.id] = filter;\n      return acc;\n    }, {} as Record<string, SchemaFilterType>);\n  }, [configuration?.items]);\n\n  const collectionToolbarFiltersProps = React.useMemo<\n    Pick<CollectionToolbarFiltersProps, 'inline' | 'panelTitle'>\n  >(\n    () => ({\n      inline: configuration?.maxInlineFilters || 0,\n      panelTitle: configuration?.panelTitle,\n    }),\n    [configuration],\n  );\n\n  const filtersData = filters.reduce<ReturnValue>(\n    (acc, filter) => {\n      acc.filters[filter.key] = filter.filter;\n      acc.components.push(\n        filter.collectionData ? (\n          <StaticCollectionFilter\n            filter={filter.filter}\n            key={filter.key}\n            component={filter.component}\n            collectionData={filter.collectionData}\n            {...filter.props}\n          />\n        ) : filter.collectionId ? (\n          <DynamicCollectionFilter\n            filter={filter.filter}\n            key={filter.key}\n            component={filter.component}\n            collectionId={filter.collectionId}\n            componentName={filter.props.componentName}\n            {...filter.props}\n          />\n        ) : (\n          <filter.component\n            key={filter.key}\n            filter={filter.filter}\n            {...filter.props}\n          />\n        ),\n      );\n\n      return acc;\n    },\n    { filters: {}, components: [], collectionToolbarFiltersProps },\n  );\n\n  return {\n    filterFieldMapping,\n    filtersObject: filtersData.filters,\n    filterComponent:\n      filtersData.components.length > 0 ? (\n        <CollectionToolbarFilters {...collectionToolbarFiltersProps}>\n          {filtersData.components}\n        </CollectionToolbarFilters>\n      ) : undefined,\n  };\n};\n"],"mappings":"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","ignoreList":[]}