{"version":3,"names":["React","usePatternsWizardOverridesContext","useSchema","useSchemaRegistry","camelCase","get","Avatar","Box","Image","getImageUrl","useColumns","columns","fields","getSchema","overrides","existingColumns","filter","column","_overrides$columns","id","createRenderer","fieldDefinition","itemValue","type","Date","toLocaleDateString","date","toLocaleString","join","referenceMetadata","referencedCollectionId","refSchema","nameValue","imageValue","displayField","imageField","imageUrl","createElement","gap","verticalAlign","size","name","imgProps","src","width","dataHook","map","_overrides$columns2","_fieldDefinition$capa","sortable","capabilities","baseColumnConfig","title","displayName","createSortConfiguration","createCustomColumnConfiguration","render","row","_overrides$columns3","_overrides$columns4","_overrides$columns4$c","call","value","Boolean","sortableColumnConfig","defaultSortOrder","sortMode","undefined","reorderDisabled","hiddenFromCustomColumnsSelection","hideable","defaultHidden"],"sources":["../../../src/hooks/useColumns.tsx"],"sourcesContent":["import React from 'react';\nimport { TableColumn } from '@wix/patterns';\nimport {\n  usePatternsWizardOverridesContext,\n  useSchema,\n  useSchemaRegistry,\n} from '../providers';\nimport { Column, Field } from '../types';\nimport { camelCase, get } from 'lodash';\nimport { Avatar, Box, Image } from '@wix/design-system';\nimport { getImageUrl } from '../utils/media/getImageUrl';\n\nexport const useColumns = (columns: Column[]) => {\n  const { fields } = useSchema();\n  const { getSchema } = useSchemaRegistry();\n  const overrides = usePatternsWizardOverridesContext();\n\n  const existingColumns = columns.filter((column) => {\n    return !!fields[column.id] || overrides?.columns?.[column.id];\n  });\n\n  const createRenderer = (fieldDefinition: Field, itemValue: any) => {\n    if (itemValue == null) {\n      return '';\n    }\n\n    switch (fieldDefinition.type) {\n      case 'BOOLEAN':\n        return itemValue ? '✔' : '✖';\n      case 'DATE':\n        if (itemValue instanceof Date) {\n          return itemValue.toLocaleDateString();\n        }\n        if (typeof itemValue === 'string') {\n          const date = new Date(itemValue);\n          return date.toLocaleDateString();\n        }\n        return itemValue;\n      case 'DATETIME':\n        if (itemValue instanceof Date) {\n          return itemValue.toLocaleString();\n        }\n        if (typeof itemValue === 'string') {\n          const date = new Date(itemValue);\n          return date.toLocaleString();\n        }\n        return itemValue;\n      case 'ARRAY':\n        // We assume that the array contains strings\n        // If the array contains objects, we need to handle it differently\n        return itemValue.join(', ');\n      case 'REFERENCE':\n        if (fieldDefinition.referenceMetadata && getSchema) {\n          const { referencedCollectionId } = fieldDefinition.referenceMetadata;\n          const refSchema = getSchema(referencedCollectionId);\n\n          if (refSchema) {\n            let nameValue: string | undefined;\n            let imageValue: string | undefined;\n            const displayField = refSchema.displayField;\n            if (typeof itemValue === 'object' && itemValue !== null) {\n              nameValue = itemValue[displayField] || '';\n              imageValue =\n                refSchema.imageField && itemValue[refSchema.imageField];\n            }\n\n            const imageUrl = imageValue && getImageUrl(imageValue);\n            return (\n              <Box gap=\"SP2\" verticalAlign=\"middle\">\n                {imageUrl && (\n                  <Avatar\n                    size=\"size24\"\n                    name={nameValue}\n                    imgProps={{ src: imageUrl }}\n                  />\n                )}\n                <div>{nameValue}</div>\n              </Box>\n            );\n          }\n        }\n\n        return itemValue;\n      case 'IMAGE':\n        const imageUrl = getImageUrl(itemValue);\n\n        return (\n          <Image src={imageUrl} width=\"48px\" dataHook=\"auto-patterns-image\" />\n        );\n      default:\n        return itemValue;\n    }\n  };\n\n  return existingColumns\n    .map((column) => {\n      const fieldDefinition = fields[column.id];\n      if (!fieldDefinition && !overrides?.columns?.[column.id]) {\n        return null;\n      }\n\n      const sortable =\n        column.sortable && fieldDefinition?.capabilities?.sortable;\n\n      const baseColumnConfig = {\n        id: column.id,\n        title: column.name || fieldDefinition?.displayName,\n        width: column.width,\n        ...createSortConfiguration(column, sortable),\n        ...createCustomColumnConfiguration(column),\n        render: (row: any) => {\n          const itemValue = get(row, column.id);\n\n          if (overrides?.columns?.[camelCase(column.id)]) {\n            return overrides?.columns?.[camelCase(column.id)]?.({\n              value: itemValue,\n              row,\n            });\n          }\n\n          if (fieldDefinition) {\n            return createRenderer(fieldDefinition, itemValue);\n          }\n\n          return null; // Shouldn't really happen\n        },\n      };\n\n      return baseColumnConfig;\n    })\n    .filter(Boolean) as TableColumn<any>[];\n};\n\nconst createSortConfiguration = (\n  column: Column,\n  sortable?: boolean,\n): Partial<TableColumn<any>> => {\n  if (!sortable) {\n    return {};\n  }\n  const sortableColumnConfig = {\n    sortable,\n    defaultSortOrder: column.defaultSortOrder,\n  };\n\n  // default sort mode is ['asc', 'desc', undefined]\n  // so if sort mode is 'desc' -> we want to override the default\n  // and set it to ['desc', 'asc', undefined]\n  if (column.sortMode && column.sortMode === 'desc') {\n    return {\n      ...sortableColumnConfig,\n      sortMode: ['desc', 'asc', undefined],\n    };\n  }\n  return {\n    ...sortableColumnConfig,\n  };\n};\n\nconst createCustomColumnConfiguration = (\n  column: Column,\n): Partial<TableColumn<any>> => {\n  const reorderDisabled = !!column.reorderDisabled;\n\n  if (column.hiddenFromCustomColumnsSelection) {\n    return { hiddenFromCustomColumnsSelection: true };\n  }\n  if (column.hideable === false) {\n    return {\n      hideable: false,\n      reorderDisabled,\n    };\n  }\n  return {\n    defaultHidden: !!column.defaultHidden,\n    reorderDisabled,\n  };\n};\n"],"mappings":"AAAA,OAAOA,KAAK,MAAM,OAAO;AAEzB,SACEC,iCAAiC,EACjCC,SAAS,EACTC,iBAAiB,QACZ,cAAc;AAErB,SAASC,SAAS,EAAEC,GAAG,QAAQ,QAAQ;AACvC,SAASC,MAAM,EAAEC,GAAG,EAAEC,KAAK,QAAQ,oBAAoB;AACvD,SAASC,WAAW,QAAQ,4BAA4B;AAExD,OAAO,MAAMC,UAAU,GAAIC,OAAiB,IAAK;EAC/C,MAAM;IAAEC;EAAO,CAAC,GAAGV,SAAS,CAAC,CAAC;EAC9B,MAAM;IAAEW;EAAU,CAAC,GAAGV,iBAAiB,CAAC,CAAC;EACzC,MAAMW,SAAS,GAAGb,iCAAiC,CAAC,CAAC;EAErD,MAAMc,eAAe,GAAGJ,OAAO,CAACK,MAAM,CAAEC,MAAM,IAAK;IAAA,IAAAC,kBAAA;IACjD,OAAO,CAAC,CAACN,MAAM,CAACK,MAAM,CAACE,EAAE,CAAC,KAAIL,SAAS,aAAAI,kBAAA,GAATJ,SAAS,CAAEH,OAAO,qBAAlBO,kBAAA,CAAqBD,MAAM,CAACE,EAAE,CAAC;EAC/D,CAAC,CAAC;EAEF,MAAMC,cAAc,GAAGA,CAACC,eAAsB,EAAEC,SAAc,KAAK;IACjE,IAAIA,SAAS,IAAI,IAAI,EAAE;MACrB,OAAO,EAAE;IACX;IAEA,QAAQD,eAAe,CAACE,IAAI;MAC1B,KAAK,SAAS;QACZ,OAAOD,SAAS,GAAG,GAAG,GAAG,GAAG;MAC9B,KAAK,MAAM;QACT,IAAIA,SAAS,YAAYE,IAAI,EAAE;UAC7B,OAAOF,SAAS,CAACG,kBAAkB,CAAC,CAAC;QACvC;QACA,IAAI,OAAOH,SAAS,KAAK,QAAQ,EAAE;UACjC,MAAMI,IAAI,GAAG,IAAIF,IAAI,CAACF,SAAS,CAAC;UAChC,OAAOI,IAAI,CAACD,kBAAkB,CAAC,CAAC;QAClC;QACA,OAAOH,SAAS;MAClB,KAAK,UAAU;QACb,IAAIA,SAAS,YAAYE,IAAI,EAAE;UAC7B,OAAOF,SAAS,CAACK,cAAc,CAAC,CAAC;QACnC;QACA,IAAI,OAAOL,SAAS,KAAK,QAAQ,EAAE;UACjC,MAAMI,IAAI,GAAG,IAAIF,IAAI,CAACF,SAAS,CAAC;UAChC,OAAOI,IAAI,CAACC,cAAc,CAAC,CAAC;QAC9B;QACA,OAAOL,SAAS;MAClB,KAAK,OAAO;QACV;QACA;QACA,OAAOA,SAAS,CAACM,IAAI,CAAC,IAAI,CAAC;MAC7B,KAAK,WAAW;QACd,IAAIP,eAAe,CAACQ,iBAAiB,IAAIhB,SAAS,EAAE;UAClD,MAAM;YAAEiB;UAAuB,CAAC,GAAGT,eAAe,CAACQ,iBAAiB;UACpE,MAAME,SAAS,GAAGlB,SAAS,CAACiB,sBAAsB,CAAC;UAEnD,IAAIC,SAAS,EAAE;YACb,IAAIC,SAA6B;YACjC,IAAIC,UAA8B;YAClC,MAAMC,YAAY,GAAGH,SAAS,CAACG,YAAY;YAC3C,IAAI,OAAOZ,SAAS,KAAK,QAAQ,IAAIA,SAAS,KAAK,IAAI,EAAE;cACvDU,SAAS,GAAGV,SAAS,CAACY,YAAY,CAAC,IAAI,EAAE;cACzCD,UAAU,GACRF,SAAS,CAACI,UAAU,IAAIb,SAAS,CAACS,SAAS,CAACI,UAAU,CAAC;YAC3D;YAEA,MAAMC,QAAQ,GAAGH,UAAU,IAAIxB,WAAW,CAACwB,UAAU,CAAC;YACtD,oBACEjC,KAAA,CAAAqC,aAAA,CAAC9B,GAAG;cAAC+B,GAAG,EAAC,KAAK;cAACC,aAAa,EAAC;YAAQ,GAClCH,QAAQ,iBACPpC,KAAA,CAAAqC,aAAA,CAAC/B,MAAM;cACLkC,IAAI,EAAC,QAAQ;cACbC,IAAI,EAAET,SAAU;cAChBU,QAAQ,EAAE;gBAAEC,GAAG,EAAEP;cAAS;YAAE,CAC7B,CACF,eACDpC,KAAA,CAAAqC,aAAA,cAAML,SAAe,CAClB,CAAC;UAEV;QACF;QAEA,OAAOV,SAAS;MAClB,KAAK,OAAO;QACV,MAAMc,QAAQ,GAAG3B,WAAW,CAACa,SAAS,CAAC;QAEvC,oBACEtB,KAAA,CAAAqC,aAAA,CAAC7B,KAAK;UAACmC,GAAG,EAAEP,QAAS;UAACQ,KAAK,EAAC,MAAM;UAACC,QAAQ,EAAC;QAAqB,CAAE,CAAC;MAExE;QACE,OAAOvB,SAAS;IACpB;EACF,CAAC;EAED,OAAOP,eAAe,CACnB+B,GAAG,CAAE7B,MAAM,IAAK;IAAA,IAAA8B,mBAAA,EAAAC,qBAAA;IACf,MAAM3B,eAAe,GAAGT,MAAM,CAACK,MAAM,CAACE,EAAE,CAAC;IACzC,IAAI,CAACE,eAAe,IAAI,EAACP,SAAS,aAAAiC,mBAAA,GAATjC,SAAS,CAAEH,OAAO,aAAlBoC,mBAAA,CAAqB9B,MAAM,CAACE,EAAE,CAAC,GAAE;MACxD,OAAO,IAAI;IACb;IAEA,MAAM8B,QAAQ,GACZhC,MAAM,CAACgC,QAAQ,KAAI5B,eAAe,aAAA2B,qBAAA,GAAf3B,eAAe,CAAE6B,YAAY,qBAA7BF,qBAAA,CAA+BC,QAAQ;IAE5D,MAAME,gBAAgB,GAAG;MACvBhC,EAAE,EAAEF,MAAM,CAACE,EAAE;MACbiC,KAAK,EAAEnC,MAAM,CAACwB,IAAI,KAAIpB,eAAe,oBAAfA,eAAe,CAAEgC,WAAW;MAClDT,KAAK,EAAE3B,MAAM,CAAC2B,KAAK;MACnB,GAAGU,uBAAuB,CAACrC,MAAM,EAAEgC,QAAQ,CAAC;MAC5C,GAAGM,+BAA+B,CAACtC,MAAM,CAAC;MAC1CuC,MAAM,EAAGC,GAAQ,IAAK;QAAA,IAAAC,mBAAA;QACpB,MAAMpC,SAAS,GAAGjB,GAAG,CAACoD,GAAG,EAAExC,MAAM,CAACE,EAAE,CAAC;QAErC,IAAIL,SAAS,aAAA4C,mBAAA,GAAT5C,SAAS,CAAEH,OAAO,aAAlB+C,mBAAA,CAAqBtD,SAAS,CAACa,MAAM,CAACE,EAAE,CAAC,CAAC,EAAE;UAAA,IAAAwC,mBAAA,EAAAC,qBAAA;UAC9C,OAAO9C,SAAS,aAAA6C,mBAAA,GAAT7C,SAAS,CAAEH,OAAO,cAAAiD,qBAAA,GAAlBD,mBAAA,CAAqBvD,SAAS,CAACa,MAAM,CAACE,EAAE,CAAC,CAAC,qBAA1CyC,qBAAA,CAAAC,IAAA,CAAAF,mBAAA,EAA6C;YAClDG,KAAK,EAAExC,SAAS;YAChBmC;UACF,CAAC,CAAC;QACJ;QAEA,IAAIpC,eAAe,EAAE;UACnB,OAAOD,cAAc,CAACC,eAAe,EAAEC,SAAS,CAAC;QACnD;QAEA,OAAO,IAAI,CAAC,CAAC;MACf;IACF,CAAC;IAED,OAAO6B,gBAAgB;EACzB,CAAC,CAAC,CACDnC,MAAM,CAAC+C,OAAO,CAAC;AACpB,CAAC;AAED,MAAMT,uBAAuB,GAAGA,CAC9BrC,MAAc,EACdgC,QAAkB,KACY;EAC9B,IAAI,CAACA,QAAQ,EAAE;IACb,OAAO,CAAC,CAAC;EACX;EACA,MAAMe,oBAAoB,GAAG;IAC3Bf,QAAQ;IACRgB,gBAAgB,EAAEhD,MAAM,CAACgD;EAC3B,CAAC;;EAED;EACA;EACA;EACA,IAAIhD,MAAM,CAACiD,QAAQ,IAAIjD,MAAM,CAACiD,QAAQ,KAAK,MAAM,EAAE;IACjD,OAAO;MACL,GAAGF,oBAAoB;MACvBE,QAAQ,EAAE,CAAC,MAAM,EAAE,KAAK,EAAEC,SAAS;IACrC,CAAC;EACH;EACA,OAAO;IACL,GAAGH;EACL,CAAC;AACH,CAAC;AAED,MAAMT,+BAA+B,GACnCtC,MAAc,IACgB;EAC9B,MAAMmD,eAAe,GAAG,CAAC,CAACnD,MAAM,CAACmD,eAAe;EAEhD,IAAInD,MAAM,CAACoD,gCAAgC,EAAE;IAC3C,OAAO;MAAEA,gCAAgC,EAAE;IAAK,CAAC;EACnD;EACA,IAAIpD,MAAM,CAACqD,QAAQ,KAAK,KAAK,EAAE;IAC7B,OAAO;MACLA,QAAQ,EAAE,KAAK;MACfF;IACF,CAAC;EACH;EACA,OAAO;IACLG,aAAa,EAAE,CAAC,CAACtD,MAAM,CAACsD,aAAa;IACrCH;EACF,CAAC;AACH,CAAC","ignoreList":[]}