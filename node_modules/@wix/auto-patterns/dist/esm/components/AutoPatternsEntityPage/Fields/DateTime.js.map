{"version":3,"names":["React","useRef","useMemo","useState","useEffect","Cell","DatePicker","FormField","Layout","TimeInput","useWixPatternsContainer","useSelector","useEntityPageContext","useController","DateTime","props","_pageState$entity","_field$validation2","field","dataHook","inputRef","translate","t","container","initTask","status","pageState","controller","name","id","control","form","defaultValue","entity","rules","validate","v","_field$validation","validation","required","undefined","date","value","d","Date","isNaN","getTime","dateStatusMessage","setDateStatusMessage","timeStatusMessage","setTimeStatusMessage","ref","dateRef","timeRef","dateValue","setDateValue","getDate","timeValue","setTimeValue","current","focus","invalid","createElement","label","displayName","span","internalRef","_internalRef$state","state","width","onChange","onValidate","_ref","validationType","newValue","format","dateWithNewDate","_value","setFullYear","getFullYear","setMonth","getMonth","setDate","toISOString","_field$validation3","dateFormat","fieldState","error","statusMessage","onInvalid","_ref2","dateWithNewTime","setHours","getHours","setMinutes","getMinutes","setSeconds","getSeconds","setMilliseconds","getMilliseconds","_field$validation4"],"sources":["../../../../../src/components/AutoPatternsEntityPage/Fields/DateTime.tsx"],"sourcesContent":["import React, { useRef, useMemo, useState, useEffect } from 'react';\nimport {\n  Cell,\n  DatePicker,\n  FormField,\n  Layout,\n  TimeInput,\n} from '@wix/design-system';\nimport { BaseInputProps, BaseInputRef } from './types';\nimport {\n  useWixPatternsContainer,\n  useSelector,\n  useEntityPageContext,\n} from '@wix/patterns';\nimport { useController } from '@wix/patterns/form';\n\nexport interface DateTimeProps extends BaseInputProps<string | null> {}\n\nexport const DateTime = (props: DateTimeProps) => {\n  const { field, dataHook, inputRef } = props;\n  const { translate: t, ...container } = useWixPatternsContainer();\n  useSelector(() => container.initTask.status);\n  const pageState = useEntityPageContext();\n\n  const controller = useController({\n    name: field?.id ?? '',\n    control: pageState.form.control,\n    defaultValue: (pageState.entity as any)?.[field?.id ?? ''],\n    rules: {\n      validate: (v) => {\n        if (\n          field?.validation?.required &&\n          (v === null || v === undefined || v === '')\n        ) {\n          return t('cairo.fieldValidation.requiredField');\n        }\n        return true;\n      },\n    },\n  });\n\n  const date = useMemo(() => {\n    if (!controller.field.value) {\n      return undefined;\n    }\n    const d = new Date(controller.field.value);\n    return isNaN(d.getTime()) ? undefined : d;\n  }, [controller.field.value]);\n\n  const [dateStatusMessage, setDateStatusMessage] = useState('');\n  const [timeStatusMessage, setTimeStatusMessage] = useState('');\n\n  const ref = useRef<BaseInputRef>({});\n  const dateRef = useRef<BaseInputRef>({});\n  const timeRef = useRef<BaseInputRef>({});\n  const [dateValue, setDateValue] = useState<number | string | undefined>(\n    date?.getDate(),\n  );\n  const [timeValue, setTimeValue] = useState<number | string | undefined>(\n    date?.getTime(),\n  );\n\n  useEffect(() => {\n    ref.current.focus = () => {\n      if (dateRef.current.invalid) {\n        return dateRef.current.focus?.();\n      }\n\n      return timeRef.current.focus?.();\n    };\n\n    inputRef?.(ref.current);\n  }, [inputRef]);\n\n  return (\n    <FormField\n      label={field.displayName}\n      required={field.validation?.required}\n      dataHook={dataHook}\n    >\n      <Layout>\n        <Cell span={6}>\n          <DatePicker\n            ref={(internalRef) => {\n              dateRef.current.focus = () =>\n                // TODO: PR to WSR needed to expose as public API\n                // @ts-expect-error\n                internalRef?.state?.inputRef?.focus?.();\n            }}\n            width=\"100%\"\n            value={date}\n            // onChange is triggered only when you have valid, non-empty value. and onValidate is triggered on every change so we use onValidate\n            onChange={() => {}}\n            onValidate={({ validationType, value: newValue, format }) => {\n              if (validationType === 'valid') {\n                const dateWithNewDate = date\n                  ? new Date(date)\n                  : new Date(newValue);\n                const _value = new Date(newValue);\n                dateWithNewDate.setFullYear(_value.getFullYear());\n                dateWithNewDate.setMonth(_value.getMonth());\n                dateWithNewDate.setDate(_value.getDate());\n                controller.field.onChange(dateWithNewDate.toISOString());\n                setDateValue(new Date(newValue).getDate());\n                setDateStatusMessage('');\n                dateRef.current.invalid = false;\n              } else if (validationType === 'formatError' && newValue === '') {\n                if (field.validation?.required) {\n                  setDateStatusMessage(\n                    t('cairo.fieldValidation.requiredField'),\n                  );\n                  dateRef.current.invalid = true;\n                } else {\n                  setDateStatusMessage('');\n                  dateRef.current.invalid = false;\n                }\n                setDateValue(newValue);\n                if (!timeValue) {\n                  controller.field.onChange(null);\n                }\n              } else {\n                setDateStatusMessage(\n                  t('cairo.customFields.fieldType.date.invalid.value', {\n                    dateFormat: format ?? '',\n                  }),\n                );\n                dateRef.current.invalid = true;\n              }\n\n              ref.current.invalid =\n                dateRef.current.invalid || timeRef.current.invalid;\n            }}\n            status={\n              controller.fieldState.error || dateStatusMessage\n                ? 'error'\n                : undefined\n            }\n            statusMessage={controller.fieldState.error || dateStatusMessage}\n            dataHook={`datetime-date-${field.id}`}\n          />\n        </Cell>\n        <Cell span={6}>\n          <TimeInput\n            ref={(internalRef) => {\n              timeRef.current.focus = () => internalRef?.focus();\n            }}\n            dataHook={`datetime-time-${field.id}`}\n            value={date ?? null}\n            status={\n              controller.fieldState.error || timeStatusMessage\n                ? 'error'\n                : undefined\n            }\n            statusMessage={controller.fieldState.error || timeStatusMessage}\n            onInvalid={() => {\n              timeRef.current.invalid = true;\n              setTimeStatusMessage(\n                t('cairo.customFields.fieldType.dateAndTime.invalid.value'),\n              );\n              ref.current.invalid =\n                dateRef.current.invalid || timeRef.current.invalid;\n            }}\n            onChange={({ date: newValue }) => {\n              timeRef.current.invalid = false;\n              ref.current.invalid =\n                dateRef.current.invalid || timeRef.current.invalid;\n\n              if (newValue) {\n                const dateWithNewTime = date ? new Date(date) : newValue;\n                dateWithNewTime.setHours(newValue.getHours());\n                dateWithNewTime.setMinutes(newValue.getMinutes());\n                dateWithNewTime.setSeconds(newValue.getSeconds());\n                dateWithNewTime.setMilliseconds(newValue.getMilliseconds());\n                controller.field.onChange(dateWithNewTime.toISOString());\n                setTimeStatusMessage('');\n                setDateStatusMessage('');\n              } else {\n                if (!newValue) {\n                  setTimeValue('');\n                  if (field.validation?.required) {\n                    setTimeStatusMessage(\n                      t('cairo.fieldValidation.requiredField'),\n                    );\n                    timeRef.current.invalid = true;\n                  } else {\n                    setTimeStatusMessage('');\n                    timeRef.current.invalid = false;\n                  }\n                  if (!ref.current.invalid) {\n                    if (!dateValue) {\n                      controller.field.onChange(null);\n                    }\n                  }\n                }\n              }\n            }}\n          />\n        </Cell>\n      </Layout>\n    </FormField>\n  );\n};\n"],"mappings":"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","ignoreList":[]}