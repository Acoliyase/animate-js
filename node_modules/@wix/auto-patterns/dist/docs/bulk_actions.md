## Bulk Action Toolbar Configuration

The Bulk Action Toolbar feature enables users to perform operations on multiple selected entities simultaneously in collection tables or grids. When configured, it adds checkboxes to each row and displays a toolbar with bulk actions when items are selected.

### Placement and Structure

The Bulk Action Toolbar is configured within the table / grid / table-grid switch configuration using the `bulkActionToolbar` property. It has a two-level structure:
* `primaryActions`: Actions shown directly in the bulk action toolbar
* `secondaryActions`: Additional actions organized in sections, typically shown in a dropdown menu

Both properties are optional, but at least one should be provided for the bulk action toolbar to be functional.

### Bulk Action Types Reference

1. **Bulk Delete Action** (`type: "bulkDelete"`):
   - ✓ Use when: Removing multiple entities with confirmation
   - ✓ Common scenarios:
     - Mass deletion of records
     - Bulk cleanup operations
   - ✓ Built-in functionality: No custom implementation needed

2. **Custom Action** (`type: "custom"`):
   - ✓ Use when: Executing custom JavaScript for bulk operations
   - ✓ Common scenarios:
     - Bulk API calls
     - Bulk exports/downloads
     - Complex bulk operations without UI
   - ⚠️ Requires implementation: Must register action in overrides

### Type Selection Decision Tree

When choosing a bulk action type, follow this decision process:

1. IF removing multiple entities:
   → Use `type: "bulkDelete"`

2. IF executing custom logic for bulk operations without UI:
   → Use `type: "custom"`
   - MUST implement action handler
   - MUST register with `actions` override

### Bulk Delete Action Configuration

Bulk delete actions remove multiple entities with a confirmation modal.

#### Validation Rules:

1. `bulkDelete.mode` must be `"modal"` (currently only modal is supported)
2. `bulkDelete.modal` object must exist
3. The modal properties (title, description, actions, feedback) are all optional

### Custom Bulk Action Configuration

Custom bulk actions execute JavaScript code that you define for bulk operations. These actions receive parameters that give them access to selected entities data and utilities. Here's how to implement a custom bulk action:

1. First, create the actions folder structure in your page folder:
   ```
   your-page/
   ├── page.tsx
   └── components/
       └── actions/
           ├── index.tsx                    // Exports all actions
           └── bulkExportPets.tsx          // Your custom bulk action
   ```

2. Create your bulk action handler in `bulkExportPets.tsx`:
   ```typescript
   import { CustomBulkActionsActionResolver } from '@wix/auto-patterns';
   import { Download } from '@wix/wix-ui-icons-common';
   import React from 'react';

   // IMPORTANT: Function name MUST match the action id in your configuration
   export const bulkExportPets: CustomBulkActionsActionResolver = (params) => {
     const { actionParams, sdk } = params;
     const { selectedValues, total } = actionParams;

     return {
       label: 'Export Selected',
       icon: <Download />,
       onClick: () => {
         // sdk is provided to custom action resolvers (see SDK Utilities section)
         const optimisticActions = sdk.getOptimisticActions(sdk.collectionId);
         const schema = sdk.getSchema(sdk.collectionId);

         // Example: Mark pets as exported
         const updatedItems = selectedValues.map(item => ({
           ...item,
           lastExported: new Date()
         }));
         optimisticActions.updateMany(updatedItems, {
           submit: async (items) => {
             // Your export logic here + update server
             const exportData = items.map(pet => ({
               name: pet.name,
               age: pet.age,
               owner: pet.owner
             }));

             // Create and download CSV
             const csv = exportData.map(row => Object.values(row).join(',')).join('\n');
             const blob = new Blob([csv], { type: 'text/csv' });
             const url = URL.createObjectURL(blob);
             const a = document.createElement('a');
             a.href = url;
             a.download = 'pets-export.csv';
             a.click();

             // Update server with export timestamp
             return await schema.actions.update(items);
           },
           successToast: `${selectedValues.length} pets exported`,
           errorToast: (err, {retry}) => ({
             text: 'Export failed',
             action: { text: 'Retry', onClick: retry }
           })
         });
       },
     };
   };
   ```

3. Export your action in `actions/index.tsx`:
   ```typescript
   export * from './bulkExportPets';
   ```

4. Configure the action in your JSON configuration:
   ```json
   {
     "id": "bulkExportPets",        // MUST match the function name exactly
     "type": "custom",              // REQUIRED: Must be exactly "custom"
     "label": "Export Selected",    // Optional: Displayed text
   }
   ```

5. Register your action in the `PatternsWizardOverridesProvider`:
   ```typescript
   import * as actions from './components/actions';

   <PatternsWizardOverridesProvider value={{ actions }}>
     <AutoPatternsApp configuration={config as AppConfig} />
   </PatternsWizardOverridesProvider>
   ```

### Key Points for Custom Bulk Actions:
- The action `id` in the configuration MUST exactly match the function name exported from your actions folder
- The function name and file name should follow a consistent naming convention (e.g., camelCase)
- The implementation must be exported as a named export (not default export)
- The implementation must use the `CustomBulkActionsActionResolver` type
- Access selected entities through `actionParams.selectedValues`
- Access total count through `actionParams.total`

#### Validation Rules for Custom Bulk Actions:

1. `id` must:
   - Match exactly the function name of the custom bulk action implementation
   - Be registered in the `actions` property of your `PatternsWizardOverridesProvider`
   - Follow JavaScript identifier naming rules (camelCase recommended)

2. The implementation must return an object with:
   - `label`: Text displayed for the action
   - `icon`: An Icon component from "@wix/wix-ui-icons-common"
   - `onClick`: Handler function for the bulk action

3. The implementation must:
   - Use the correct type: `CustomBulkActionsActionResolver`
   - Be exported as a named export
   - Have a filename matching the function name

### Bulk Action Toolbar Structure

The bulk action toolbar uses a specific structure for organizing actions:

#### Primary Actions Structure:
```json
"bulkActionToolbar": {
  "primaryActions": [
    {
      "type": "action",
      "action": {
        "item": {
          "id": "bulkCustom",
          "type": "custom",
          "label": "Custom Bulk",
          "custom": {
            "id": "MyCustomBulk"
          }
        }
      }
    },
    {
      "type": "menu",
      "menu": {
        "label": "More actions",
        "items": [
          {
            "id": "exportItems",
            "type": "custom",
            "label": "Export Items"
          },
          { "type": "divider" },
          {
            "id": "downloadItems",
            "type": "custom",
            "label": "Download Items"
          }
        ]
      }
    }
  ]
}
```

#### Secondary Actions Structure:
```json
"bulkActionToolbar": {
  "secondaryActions": [
      {
        "id": "bulkDeleteWithModal",
        "label": "Bulk Delete",
        "type": "bulkDelete",
        "bulkDelete": {
          "mode": "modal",
          "modal": {
            "title": { "text": "Delete items" },
            "description": { "text": "Are you sure?" }
          }
        }
      },
      {
        "id": "bulkExportPets",
        "type": "custom",
        "label": "Export Selected"
      }
  ]
}
```

### Key Implementation Decisions

Follow this decision process when implementing Bulk Action Toolbar:

1. **Basic Decision**: Decide which bulk operations users need to perform:
   - Delete multiple entities? → Use `bulkDelete` actions
   - Custom bulk operations? → Use `custom` actions

2. **Primary vs Secondary**: Choose the most common/important bulk action as primary:
   - Most common bulk operation → Place in `primaryActions.items` array
   - Less common bulk operations → Place in `secondaryActions` array

3. **Custom Implementation**:
   - For `custom` bulk actions, you must provide implementations in your code and register them with `PatternsWizardOverridesProvider`

### Bulk Action Toolbar Validation Checklist

AI agents should verify these requirements before generating Bulk Action Toolbar configurations:

✓ Bulk Action Toolbar is placed directly inside `table` or `grid` configuration as `bulkActionToolbar`
✓ Each bulk action has a unique `id` and correct `type` value
✓ Each action type only includes its required field(s)
✓ Bulk delete actions have modal configuration
✓ Custom bulk actions match implementations in overrides
✓ At least one of `primaryActions` or `secondaryActions` is provided
✓ Primary actions use `action`/`menu` structure with proper `action` or `menu` properties
✓ Secondary actions are an array that can include dividers
✓ Menu items within primary actions is array that can include dividers
