{"version":3,"names":["_react","_interopRequireDefault","require","_providers","_lodash","_designSystem","_getImageUrl","_jsxFileName","useColumns","columns","fields","useSchema","getSchema","useSchemaRegistry","overrides","usePatternsWizardOverridesContext","existingColumns","filter","column","_overrides$columns","id","createRenderer","fieldDefinition","itemValue","type","Date","toLocaleDateString","date","toLocaleString","join","referenceMetadata","referencedCollectionId","refSchema","nameValue","imageValue","displayField","imageField","imageUrl","getImageUrl","default","createElement","Box","gap","verticalAlign","__self","__source","fileName","lineNumber","columnNumber","Avatar","size","name","imgProps","src","Image","width","dataHook","map","_overrides$columns2","_fieldDefinition$capa","sortable","capabilities","baseColumnConfig","title","displayName","createSortConfiguration","createCustomColumnConfiguration","render","row","_overrides$columns3","get","camelCase","_overrides$columns4","_overrides$columns4$c","call","value","Boolean","exports","sortableColumnConfig","defaultSortOrder","sortMode","undefined","reorderDisabled","hiddenFromCustomColumnsSelection","hideable","defaultHidden"],"sources":["../../../src/hooks/useColumns.tsx"],"sourcesContent":["import React from 'react';\nimport { TableColumn } from '@wix/patterns';\nimport {\n  usePatternsWizardOverridesContext,\n  useSchema,\n  useSchemaRegistry,\n} from '../providers';\nimport { Column, Field } from '../types';\nimport { camelCase, get } from 'lodash';\nimport { Avatar, Box, Image } from '@wix/design-system';\nimport { getImageUrl } from '../utils/media/getImageUrl';\n\nexport const useColumns = (columns: Column[]) => {\n  const { fields } = useSchema();\n  const { getSchema } = useSchemaRegistry();\n  const overrides = usePatternsWizardOverridesContext();\n\n  const existingColumns = columns.filter((column) => {\n    return !!fields[column.id] || overrides?.columns?.[column.id];\n  });\n\n  const createRenderer = (fieldDefinition: Field, itemValue: any) => {\n    if (itemValue == null) {\n      return '';\n    }\n\n    switch (fieldDefinition.type) {\n      case 'BOOLEAN':\n        return itemValue ? '✔' : '✖';\n      case 'DATE':\n        if (itemValue instanceof Date) {\n          return itemValue.toLocaleDateString();\n        }\n        if (typeof itemValue === 'string') {\n          const date = new Date(itemValue);\n          return date.toLocaleDateString();\n        }\n        return itemValue;\n      case 'DATETIME':\n        if (itemValue instanceof Date) {\n          return itemValue.toLocaleString();\n        }\n        if (typeof itemValue === 'string') {\n          const date = new Date(itemValue);\n          return date.toLocaleString();\n        }\n        return itemValue;\n      case 'ARRAY':\n        // We assume that the array contains strings\n        // If the array contains objects, we need to handle it differently\n        return itemValue.join(', ');\n      case 'REFERENCE':\n        if (fieldDefinition.referenceMetadata && getSchema) {\n          const { referencedCollectionId } = fieldDefinition.referenceMetadata;\n          const refSchema = getSchema(referencedCollectionId);\n\n          if (refSchema) {\n            let nameValue: string | undefined;\n            let imageValue: string | undefined;\n            const displayField = refSchema.displayField;\n            if (typeof itemValue === 'object' && itemValue !== null) {\n              nameValue = itemValue[displayField] || '';\n              imageValue =\n                refSchema.imageField && itemValue[refSchema.imageField];\n            }\n\n            const imageUrl = imageValue && getImageUrl(imageValue);\n            return (\n              <Box gap=\"SP2\" verticalAlign=\"middle\">\n                {imageUrl && (\n                  <Avatar\n                    size=\"size24\"\n                    name={nameValue}\n                    imgProps={{ src: imageUrl }}\n                  />\n                )}\n                <div>{nameValue}</div>\n              </Box>\n            );\n          }\n        }\n\n        return itemValue;\n      case 'IMAGE':\n        const imageUrl = getImageUrl(itemValue);\n\n        return (\n          <Image src={imageUrl} width=\"48px\" dataHook=\"auto-patterns-image\" />\n        );\n      default:\n        return itemValue;\n    }\n  };\n\n  return existingColumns\n    .map((column) => {\n      const fieldDefinition = fields[column.id];\n      if (!fieldDefinition && !overrides?.columns?.[column.id]) {\n        return null;\n      }\n\n      const sortable =\n        column.sortable && fieldDefinition?.capabilities?.sortable;\n\n      const baseColumnConfig = {\n        id: column.id,\n        title: column.name || fieldDefinition?.displayName,\n        width: column.width,\n        ...createSortConfiguration(column, sortable),\n        ...createCustomColumnConfiguration(column),\n        render: (row: any) => {\n          const itemValue = get(row, column.id);\n\n          if (overrides?.columns?.[camelCase(column.id)]) {\n            return overrides?.columns?.[camelCase(column.id)]?.({\n              value: itemValue,\n              row,\n            });\n          }\n\n          if (fieldDefinition) {\n            return createRenderer(fieldDefinition, itemValue);\n          }\n\n          return null; // Shouldn't really happen\n        },\n      };\n\n      return baseColumnConfig;\n    })\n    .filter(Boolean) as TableColumn<any>[];\n};\n\nconst createSortConfiguration = (\n  column: Column,\n  sortable?: boolean,\n): Partial<TableColumn<any>> => {\n  if (!sortable) {\n    return {};\n  }\n  const sortableColumnConfig = {\n    sortable,\n    defaultSortOrder: column.defaultSortOrder,\n  };\n\n  // default sort mode is ['asc', 'desc', undefined]\n  // so if sort mode is 'desc' -> we want to override the default\n  // and set it to ['desc', 'asc', undefined]\n  if (column.sortMode && column.sortMode === 'desc') {\n    return {\n      ...sortableColumnConfig,\n      sortMode: ['desc', 'asc', undefined],\n    };\n  }\n  return {\n    ...sortableColumnConfig,\n  };\n};\n\nconst createCustomColumnConfiguration = (\n  column: Column,\n): Partial<TableColumn<any>> => {\n  const reorderDisabled = !!column.reorderDisabled;\n\n  if (column.hiddenFromCustomColumnsSelection) {\n    return { hiddenFromCustomColumnsSelection: true };\n  }\n  if (column.hideable === false) {\n    return {\n      hideable: false,\n      reorderDisabled,\n    };\n  }\n  return {\n    defaultHidden: !!column.defaultHidden,\n    reorderDisabled,\n  };\n};\n"],"mappings":"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","ignoreList":[]}