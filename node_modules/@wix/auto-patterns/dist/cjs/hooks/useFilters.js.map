{"version":3,"names":["_react","_interopRequireDefault","require","_patterns","_SchemaContext","_providers","_filters","_filterCreators","_jsxFileName","useFilters","configuration","schema","useSchema","schemaRegistry","useSchemaRegistry","filters","React","useMemo","currFilters","items","forEach","filter","id","fieldId","fieldDefinition","fields","label","displayName","openByDefault","tagLabel","sectionTitle","baseParams","commonFilterProps","initiallyOpen","accordionItemProps","toolbarItemProps","toolbarTagProps","type","push","createDateTimeFilter","config","dateConfig","createBooleanFilter","booleanConfig","createNumberFilter","numberConfig","referencedCollectionId","referenceMetadata","referencedSchema","getSchema","createReferenceFilter","dynamicOptionsConfig","additionalParams","enumConfig","createEnumFilter","filterFieldMapping","reduce","acc","collectionToolbarFiltersProps","inline","maxInlineFilters","panelTitle","filtersData","key","components","collectionData","default","createElement","StaticCollectionFilter","_extends2","component","props","__self","__source","fileName","lineNumber","columnNumber","collectionId","DynamicCollectionFilter","componentName","filtersObject","filterComponent","length","CollectionToolbarFilters","undefined","exports"],"sources":["../../../src/hooks/useFilters.tsx"],"sourcesContent":["import React from 'react';\nimport {\n  CollectionToolbarFilters,\n  CollectionToolbarFiltersProps,\n  Filter,\n} from '@wix/patterns';\nimport { Filter as SchemaFilterType, FiltersConfig } from '../types';\nimport { useSchema } from '../providers/SchemaContext';\nimport { useSchemaRegistry } from '../providers';\nimport {\n  StaticCollectionFilter,\n  DynamicCollectionFilter,\n} from '../components/filters';\nimport {\n  createDateTimeFilter,\n  createBooleanFilter,\n  createNumberFilter,\n  createEnumFilter,\n  createReferenceFilter,\n} from '../utils/filterCreators';\n\nexport interface FilterOptions {\n  key: string;\n  fieldId: string;\n  filter: Filter<any>;\n  component: React.ElementType;\n  collectionData?: { id: string; name: string }[];\n  collectionId?: string;\n  componentName?: string;\n  props: Record<string, any>;\n}\n\nexport interface ReturnValue {\n  filters: { [key: string]: Filter<any> };\n  components: React.JSX.Element[];\n  collectionToolbarFiltersProps: Pick<\n    CollectionToolbarFiltersProps,\n    'inline' | 'panelTitle' | 'useNewFilters'\n  >;\n}\n\nexport const useFilters = (configuration?: FiltersConfig) => {\n  const schema = useSchema();\n  const schemaRegistry = useSchemaRegistry();\n  const filters = React.useMemo(() => {\n    const currFilters: FilterOptions[] = [];\n    configuration?.items.forEach((filter) => {\n      const { id, fieldId } = filter;\n      const fieldDefinition = schema.fields[fieldId];\n      if (!fieldDefinition) {\n        return;\n      }\n\n      const label = filter.displayName || fieldDefinition.displayName;\n      const { openByDefault, tagLabel, sectionTitle } = filter;\n\n      const baseParams = {\n        id,\n        fieldId,\n        commonFilterProps: {\n          sectionTitle,\n          initiallyOpen: openByDefault,\n          accordionItemProps: { label },\n          toolbarItemProps: { label },\n          toolbarTagProps: { label: tagLabel },\n        },\n      };\n\n      switch (fieldDefinition.type) {\n        case 'DATE':\n        case 'DATETIME':\n          currFilters.push(\n            createDateTimeFilter({\n              ...baseParams,\n              config: filter.dateConfig,\n            }),\n          );\n          break;\n\n        case 'BOOLEAN':\n          currFilters.push(\n            createBooleanFilter({\n              ...baseParams,\n              config: filter.booleanConfig,\n            }),\n          );\n          break;\n\n        case 'NUMBER':\n          currFilters.push(\n            createNumberFilter({\n              ...baseParams,\n              config: filter.numberConfig,\n            }),\n          );\n          break;\n\n        case 'REFERENCE': {\n          const { referencedCollectionId } = fieldDefinition.referenceMetadata;\n          const referencedSchema = schemaRegistry.getSchema(\n            referencedCollectionId,\n          );\n\n          if (referencedSchema) {\n            currFilters.push(\n              createReferenceFilter({\n                ...baseParams,\n                config: filter.dynamicOptionsConfig,\n                additionalParams: {\n                  referencedSchema,\n                },\n              }),\n            );\n          }\n          break;\n        }\n\n        default:\n          if (filter?.enumConfig) {\n            currFilters.push(\n              createEnumFilter({\n                ...baseParams,\n                config: filter.enumConfig,\n              }),\n            );\n          }\n          break;\n      }\n    });\n    return currFilters;\n  }, [configuration?.items, schema.fields, schemaRegistry]);\n\n  const filterFieldMapping = React.useMemo(() => {\n    return configuration?.items.reduce((acc, filter) => {\n      acc[filter.id] = filter;\n      return acc;\n    }, {} as Record<string, SchemaFilterType>);\n  }, [configuration?.items]);\n\n  const collectionToolbarFiltersProps = React.useMemo<\n    Pick<CollectionToolbarFiltersProps, 'inline' | 'panelTitle'>\n  >(\n    () => ({\n      inline: configuration?.maxInlineFilters || 0,\n      panelTitle: configuration?.panelTitle,\n    }),\n    [configuration],\n  );\n\n  const filtersData = filters.reduce<ReturnValue>(\n    (acc, filter) => {\n      acc.filters[filter.key] = filter.filter;\n      acc.components.push(\n        filter.collectionData ? (\n          <StaticCollectionFilter\n            filter={filter.filter}\n            key={filter.key}\n            component={filter.component}\n            collectionData={filter.collectionData}\n            {...filter.props}\n          />\n        ) : filter.collectionId ? (\n          <DynamicCollectionFilter\n            filter={filter.filter}\n            key={filter.key}\n            component={filter.component}\n            collectionId={filter.collectionId}\n            componentName={filter.props.componentName}\n            {...filter.props}\n          />\n        ) : (\n          <filter.component\n            key={filter.key}\n            filter={filter.filter}\n            {...filter.props}\n          />\n        ),\n      );\n\n      return acc;\n    },\n    { filters: {}, components: [], collectionToolbarFiltersProps },\n  );\n\n  return {\n    filterFieldMapping,\n    filtersObject: filtersData.filters,\n    filterComponent:\n      filtersData.components.length > 0 ? (\n        <CollectionToolbarFilters {...collectionToolbarFiltersProps}>\n          {filtersData.components}\n        </CollectionToolbarFilters>\n      ) : undefined,\n  };\n};\n"],"mappings":"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","ignoreList":[]}