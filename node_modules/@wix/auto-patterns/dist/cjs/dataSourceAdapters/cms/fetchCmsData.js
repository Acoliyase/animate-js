"use strict";

exports.__esModule = true;
exports.fetchCmsData = fetchCmsData;
var _data = require("@wix/data");
var _filterUtils = require("./filterUtils");
var _sortUtils = require("./sortUtils");
async function fetchCmsData(collectionId, query, fields, options = {}) {
  const {
    searchableFieldIds = [],
    filterFieldMapping
  } = options;
  let dataQuery = _data.items.query(collectionId);
  dataQuery = (0, _filterUtils.addSearchToDataQuery)({
    dataQuery,
    query,
    fields,
    searchableFieldIds
  });
  dataQuery = (0, _filterUtils.addFiltersToDataQuery)({
    dataQuery,
    query,
    fields,
    filterFieldMapping
  });
  dataQuery = (0, _sortUtils.addSortToDataQuery)({
    dataQuery,
    query,
    fields
  });
  const referenceFieldIds = Object.values(fields).filter(field => !!field && field.type === 'REFERENCE' && searchableFieldIds.includes(field.id)).map(field => field.id);
  if (referenceFieldIds.length > 0) {
    dataQuery = dataQuery.include(...referenceFieldIds);
  }
  const res = await dataQuery.skip(query.offset).limit(query.limit).find({
    returnTotalCount: true
  });
  return {
    items: res.items,
    total: res.totalCount ?? 0
  };
}
//# sourceMappingURL=fetchCmsData.js.map