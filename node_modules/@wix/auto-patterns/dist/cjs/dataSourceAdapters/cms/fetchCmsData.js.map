{"version":3,"names":["_data","require","_filterUtils","_sortUtils","fetchCmsData","collectionId","query","fields","options","searchableFieldIds","filterFieldMapping","dataQuery","items","addSearchToDataQuery","addFiltersToDataQuery","addSortToDataQuery","referenceFieldIds","Object","values","filter","field","type","includes","id","map","length","include","res","skip","offset","limit","find","returnTotalCount","total","totalCount"],"sources":["../../../../src/dataSourceAdapters/cms/fetchCmsData.ts"],"sourcesContent":["import { ComputedQuery } from '@wix/patterns';\nimport { items } from '@wix/data';\nimport { Field } from '../../types';\nimport { addFiltersToDataQuery, addSearchToDataQuery } from './filterUtils';\nimport { addSortToDataQuery } from './sortUtils';\n\nexport async function fetchCmsData(\n  collectionId: string,\n  query: ComputedQuery<any>,\n  fields: Record<string, Field | undefined>,\n  options: {\n    searchableFieldIds?: string[];\n    filterFieldMapping?: Record<string, { fieldId: string }>;\n  } = {},\n) {\n  const { searchableFieldIds = [], filterFieldMapping } = options;\n\n  let dataQuery = items.query(collectionId);\n  dataQuery = addSearchToDataQuery({\n    dataQuery,\n    query,\n    fields,\n    searchableFieldIds,\n  });\n  dataQuery = addFiltersToDataQuery({\n    dataQuery,\n    query,\n    fields,\n    filterFieldMapping,\n  });\n  dataQuery = addSortToDataQuery({\n    dataQuery,\n    query,\n    fields,\n  });\n\n  const referenceFieldIds = Object.values(fields)\n    .filter(\n      (field): field is Field =>\n        !!field &&\n        field.type === 'REFERENCE' &&\n        searchableFieldIds.includes(field.id),\n    )\n    .map((field) => field.id);\n\n  if (referenceFieldIds.length > 0) {\n    dataQuery = dataQuery.include(...referenceFieldIds);\n  }\n\n  const res = await dataQuery\n    .skip(query.offset)\n    .limit(query.limit)\n    .find({ returnTotalCount: true });\n\n  return {\n    items: res.items,\n    total: res.totalCount ?? 0,\n  };\n}\n"],"mappings":";;;;AACA,IAAAA,KAAA,GAAAC,OAAA;AAEA,IAAAC,YAAA,GAAAD,OAAA;AACA,IAAAE,UAAA,GAAAF,OAAA;AAEO,eAAeG,YAAYA,CAChCC,YAAoB,EACpBC,KAAyB,EACzBC,MAAyC,EACzCC,OAGC,GAAG,CAAC,CAAC,EACN;EACA,MAAM;IAAEC,kBAAkB,GAAG,EAAE;IAAEC;EAAmB,CAAC,GAAGF,OAAO;EAE/D,IAAIG,SAAS,GAAGC,WAAK,CAACN,KAAK,CAACD,YAAY,CAAC;EACzCM,SAAS,GAAG,IAAAE,iCAAoB,EAAC;IAC/BF,SAAS;IACTL,KAAK;IACLC,MAAM;IACNE;EACF,CAAC,CAAC;EACFE,SAAS,GAAG,IAAAG,kCAAqB,EAAC;IAChCH,SAAS;IACTL,KAAK;IACLC,MAAM;IACNG;EACF,CAAC,CAAC;EACFC,SAAS,GAAG,IAAAI,6BAAkB,EAAC;IAC7BJ,SAAS;IACTL,KAAK;IACLC;EACF,CAAC,CAAC;EAEF,MAAMS,iBAAiB,GAAGC,MAAM,CAACC,MAAM,CAACX,MAAM,CAAC,CAC5CY,MAAM,CACJC,KAAK,IACJ,CAAC,CAACA,KAAK,IACPA,KAAK,CAACC,IAAI,KAAK,WAAW,IAC1BZ,kBAAkB,CAACa,QAAQ,CAACF,KAAK,CAACG,EAAE,CACxC,CAAC,CACAC,GAAG,CAAEJ,KAAK,IAAKA,KAAK,CAACG,EAAE,CAAC;EAE3B,IAAIP,iBAAiB,CAACS,MAAM,GAAG,CAAC,EAAE;IAChCd,SAAS,GAAGA,SAAS,CAACe,OAAO,CAAC,GAAGV,iBAAiB,CAAC;EACrD;EAEA,MAAMW,GAAG,GAAG,MAAMhB,SAAS,CACxBiB,IAAI,CAACtB,KAAK,CAACuB,MAAM,CAAC,CAClBC,KAAK,CAACxB,KAAK,CAACwB,KAAK,CAAC,CAClBC,IAAI,CAAC;IAAEC,gBAAgB,EAAE;EAAK,CAAC,CAAC;EAEnC,OAAO;IACLpB,KAAK,EAAEe,GAAG,CAACf,KAAK;IAChBqB,KAAK,EAAEN,GAAG,CAACO,UAAU,IAAI;EAC3B,CAAC;AACH","ignoreList":[]}