{"version":3,"names":["React","_interopRequireWildcard","require","_reactHelpers","_unidriverJsdomReactLegacy","e","t","WeakMap","r","n","__esModule","o","i","f","__proto__","default","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","enzymeTestkitFactoryCreator","driverFactory","obj","eventTrigger","reactEventTrigger","regexp","RegExp","dataHook","component","wrapper","findWhere","length","type","test","html","element","first","getDOMNode","undefined","enzymeUniTestkitFactoryCreator","base","jsdomReactUniDriver","body","document","isEnzymeTestkitExists","Element","testkitFactory","mount","options","isEnzymeTestkitExistsInternal","isUniEnzymeTestkitExists","withoutDataHook","dataHookPropName","extraProps","elementToRender","cloneElement","testkit","exists"],"sources":["../../../src/enzyme/enzyme.ts"],"sourcesContent":["import * as React from 'react';\nimport { reactEventTrigger } from '../react-helpers';\nimport { BaseDriver } from '../driver-factory';\nimport { MountRendererProps, ReactWrapper } from 'enzyme';\nimport { UniDriver } from '@wix/unidriver-core';\nimport { jsdomReactUniDriver } from '@wix/unidriver-jsdom-react-legacy';\nimport { BaseUniDriver } from '../base-driver';\n\nexport interface WrapperData {\n  wrapper: ReactWrapper;\n  dataHook: string;\n}\n\nexport type MountFunctionType = (\n  node: React.ReactElement<any>,\n  options?: MountRendererProps,\n) => ReactWrapper;\n\nexport type EnzymeDriverFactory<T extends BaseDriver> = (data: {\n  element: Element | undefined;\n  wrapper: ReactWrapper;\n  eventTrigger: any;\n  dataHook: string;\n}) => T;\n\nexport function enzymeTestkitFactoryCreator<T extends BaseDriver>(\n  driverFactory: EnzymeDriverFactory<T>,\n) {\n  return (obj: WrapperData) => {\n    const eventTrigger = reactEventTrigger();\n    const regexp = new RegExp(`^<[^>]+data-hook=\"${obj.dataHook}\"`);\n    const component = obj.wrapper.findWhere(\n      (n) =>\n        n.length > 0 && typeof n.type() === 'string' && regexp.test(n.html()),\n    );\n    const element =\n      component.length > 0 ? component.first().getDOMNode() : undefined;\n    return driverFactory({\n      element,\n      wrapper: obj.wrapper,\n      eventTrigger,\n      dataHook: obj.dataHook,\n    });\n  };\n}\n\nexport function enzymeUniTestkitFactoryCreator<T extends BaseUniDriver>(\n  driverFactory: (\n    base: UniDriver,\n    body: UniDriver,\n    data: { dataHook: string },\n  ) => T,\n) {\n  return (obj: WrapperData) => {\n    const regexp = new RegExp(`^<[^>]+data-hook=\"${obj.dataHook}\"`);\n    const component = obj.wrapper.findWhere(\n      (n) =>\n        n.length > 0 && typeof n.type() === 'string' && regexp.test(n.html()),\n    );\n    const element =\n      component.length > 0 ? component.first().getDOMNode() : undefined;\n    const base = jsdomReactUniDriver(element as Element);\n    const body = jsdomReactUniDriver(document.body);\n    return driverFactory(base, body, { dataHook: obj.dataHook });\n  };\n}\n\nexport interface Options {\n  withoutDataHook?: boolean;\n  /** The dataHookPropName exists in order to support legacy CamelCase `dataHook`\n   *  which is used in Wix-Style-React, while the current prop name used in\n   * `wix-ui-core` is snake-case `data-hook`.\n   * */\n  dataHookPropName?: 'data-hook' | 'dataHook';\n}\n\n/**\n * Checks if the given Element accepts a data hook, and that the testkit factory finds the component's root element using that data hook.\n *\n * This method supports both new snake-case and legacy camelCase data hook prop name (e.g `data-hook` and `dataHook`).\n * The default is to check by both prop name options.\n */\nexport function isEnzymeTestkitExists<T extends BaseDriver>(\n  Element: React.ReactElement<any>,\n  testkitFactory: (obj: WrapperData) => T,\n  mount: MountFunctionType,\n  options: Options = {},\n) {\n  return isEnzymeTestkitExistsInternal({\n    Element,\n    testkitFactory,\n    mount,\n    ...options,\n  });\n}\n\nexport async function isUniEnzymeTestkitExists<T extends BaseUniDriver>(\n  Element: React.ReactElement<any>,\n  testkitFactory: (obj: WrapperData) => T,\n  mount: MountFunctionType,\n  { withoutDataHook, dataHookPropName }: Options = {},\n) {\n  const dataHook = withoutDataHook ? '' : 'myDataHook';\n  const extraProps = dataHookPropName\n    ? { [dataHookPropName]: dataHook }\n    : { dataHook, 'data-hook': dataHook };\n  const elementToRender = React.cloneElement(Element, extraProps);\n  const wrapper = mount(elementToRender);\n  const testkit = testkitFactory({ wrapper, dataHook });\n  return testkit.exists();\n}\n\n/**\n * This internal function is only in order to allow separate defaults to each options.\n */\nfunction isEnzymeTestkitExistsInternal<T extends BaseDriver>({\n  Element,\n  testkitFactory,\n  mount,\n  withoutDataHook = false,\n  dataHookPropName,\n}: FlatOptions<T>) {\n  const dataHook = withoutDataHook ? '' : 'myDataHook';\n  const extraProps = dataHookPropName\n    ? { [dataHookPropName]: dataHook }\n    : { dataHook, 'data-hook': dataHook };\n  const elementToRender = React.cloneElement(Element, extraProps);\n  const wrapper = mount(elementToRender);\n  const testkit = testkitFactory({ wrapper, dataHook });\n  return testkit.exists();\n}\n\ninterface FlatOptions<T extends BaseDriver> {\n  Element: React.ReactElement<any>;\n  testkitFactory: (obj: WrapperData) => T;\n  mount: MountFunctionType;\n  withoutDataHook?: boolean;\n  /** The dataHookPropName exists in order to support legacy CamelCase `dataHook`\n   *  which is used in Wix-Style-React, while the current prop name used in\n   * `wix-ui-core` is snake-case `data-hook`.\n   * */\n  dataHookPropName?: 'data-hook' | 'dataHook';\n}\n"],"mappings":"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","ignoreList":[]}