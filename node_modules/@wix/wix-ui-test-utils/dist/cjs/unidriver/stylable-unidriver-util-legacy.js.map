{"version":3,"names":["_uniDriver","require","StylableUnidriverUtilLegacy","constructor","style","hasStyleState","base","stateName","param","stateKey","styleState","getStateDataAttrKey","actual","attr","String","getStyleState","state","$cssStates","Object","keys","exports","stateMiddleDelimiter","StylableUnidriverUtilCompat","stateClass","className","hasClass","includes","classList","trim","split","booleanState","baseState","getBaseStateWithParam","paramValue","forEach","cls","getStateValueFromClassName","startsWith","slice","length","paramIndex","indexOf","singleCharState","StylableCompatUniDriver","_defineProperty2","default","mode","getStylesheetMode","internal","StylableUnidriverUtilV2","sheet","res","hasOwnProperty"],"sources":["../../../src/unidriver/stylable-unidriver-util-legacy.ts"],"sourcesContent":["import { UniDriver } from '@wix/unidriver-core';\nimport {\n  StylableUnidriverUtil as StylableUnidriverUtilV2,\n  MinimalStylesheet,\n} from '@stylable/uni-driver';\n\ntype StateValue = boolean | number | string;\n\ninterface StateMap {\n  [stateName: string]: StateValue;\n}\n\ninterface CompatStylesheet {\n  $cssStates(states?: StateMap | null): { className: string };\n}\ninterface LegacyStylesheet {\n  $cssStates(states?: StateMap | null): StateMap;\n}\n\ninterface StylesheetV2 {\n  cssStates(states?: StateMap | null): string;\n}\n\ntype CommonStylesheet = LegacyStylesheet | CompatStylesheet | StylesheetV2;\n\n/**\n * LEGACY SUPPORT\n */\nexport class StylableUnidriverUtilLegacy {\n  constructor(private style: LegacyStylesheet) {}\n  public async hasStyleState(\n    base: UniDriver,\n    stateName: string,\n    param: StateValue = true,\n  ): Promise<boolean> {\n    const { stateKey, styleState } = this.getStateDataAttrKey(stateName, param);\n    const actual = await base.attr(stateKey);\n    return String(styleState[stateKey]) === actual;\n  }\n  /**\n   * Get style state value\n   *\n   * @returns state or null if not found\n   */\n  public async getStyleState(base: UniDriver, stateName: string) {\n    const { stateKey } = this.getStateDataAttrKey(stateName);\n    return base.attr(stateKey);\n  }\n  private getStateDataAttrKey(state: string, param: StateValue = true) {\n    const styleState = this.style.$cssStates({ [state]: param });\n    return { stateKey: Object.keys(styleState)[0], styleState };\n  }\n}\n\nconst stateMiddleDelimiter = '-';\n\nexport class StylableUnidriverUtilCompat {\n  constructor(private style: CompatStylesheet) {}\n  public async hasStyleState(\n    base: UniDriver,\n    stateName: string,\n    param: StateValue = true,\n  ): Promise<boolean> {\n    const stateClass = this.style.$cssStates({ [stateName]: param }).className;\n    return base.hasClass(stateClass);\n  }\n  /**\n   * Get style state value\n   *\n   * @returns state or null if not found\n   */\n  public async getStyleState(base: UniDriver, stateName: string) {\n    const className: string = (await base.attr('class')) || '';\n    if (!className.includes(stateName)) {\n      return null;\n    }\n    const classList = className.trim().split(/\\s+/);\n\n    const booleanState = this.style.$cssStates({ [stateName]: true }).className;\n    if (classList.includes(booleanState)) {\n      return true;\n    }\n\n    const baseState = this.getBaseStateWithParam(stateName);\n\n    let paramValue = '';\n    classList.forEach((cls) => {\n      if (!paramValue) {\n        paramValue = this.getStateValueFromClassName(cls, baseState);\n      }\n    });\n\n    return paramValue ? paramValue : null;\n  }\n  public getStateValueFromClassName(cls: string, baseState: string) {\n    if (cls.startsWith(baseState)) {\n      const param = cls.slice(baseState.length);\n      const paramIndex = param.indexOf(stateMiddleDelimiter);\n\n      if (paramIndex !== -1) {\n        return param.slice(paramIndex + 1);\n      }\n    }\n    return '';\n  }\n  private getBaseStateWithParam(stateName: string) {\n    const singleCharState = 'x';\n    return this.style\n      .$cssStates({ [stateName]: singleCharState })\n      .className.slice(0, -3);\n  }\n}\n\ntype TODO = any;\n\nexport class StylableCompatUniDriver {\n  private internal:\n    | StylableUnidriverUtilCompat\n    | StylableUnidriverUtilLegacy\n    | StylableUnidriverUtilV2\n    | TODO; // TODO - make sure to fix this - due to type mismatch....!\n  constructor(private style: CommonStylesheet) {\n    const mode = getStylesheetMode(\n      this.style || {\n        $cssStates() {\n          return {};\n        },\n      },\n    );\n    if (mode === 'v2') {\n      this.internal = new StylableUnidriverUtilV2(\n        this.style as MinimalStylesheet,\n      );\n    } else if (mode === 'compat') {\n      this.internal = new StylableUnidriverUtilCompat(\n        this.style as CompatStylesheet,\n      );\n    } else {\n      this.internal = new StylableUnidriverUtilLegacy(\n        this.style as LegacyStylesheet,\n      );\n    }\n  }\n  public async hasStyleState(\n    base: UniDriver,\n    stateName: string,\n    param: StateValue = true,\n  ): Promise<boolean> {\n    return this.internal.hasStyleState(base, stateName, param);\n  }\n  /**\n   * Get style state value\n   *\n   * @returns state or null if not found\n   */\n  public async getStyleState(base: UniDriver, stateName: string) {\n    return this.internal.getStyleState(base, stateName);\n  }\n}\n\nfunction getStylesheetMode(sheet: any) {\n  if (sheet.$cssStates) {\n    const res =\n      typeof sheet.$cssStates === 'function' ? sheet.$cssStates({}) : {};\n    if (res.hasOwnProperty('className')) {\n      return 'compat';\n    } else {\n      return 'legacy';\n    }\n  } else {\n    return 'v2';\n  }\n}\n"],"mappings":"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","ignoreList":[]}