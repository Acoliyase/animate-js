{"version":3,"names":["COMMON_CONFIG_HEADER_NAME","IGNORE_KEYS","Set","MAP_KEYS","Map","getCommonConfigValues","commonConfig","globalThis","entries","Object","reduce","res","_ref","key","value","has","push","get","length","fromEntries","getCommonConfigHeader","commonConfigValues","JSON","stringify","encodeURIComponent"],"sources":["../../../src/headers/common-config-header.ts"],"sourcesContent":["/**\n * Based on https://github.com/wix-private/metro/blob/master/packages/wix-headers/src/headers/common-config.ts\n */\n\nconst COMMON_CONFIG_HEADER_NAME = 'commonConfig';\nconst IGNORE_KEYS = new Set(['consentPolicy', 'consentPolicyHeader']);\nconst MAP_KEYS = new Map<string, string>([['bsi', 'BSI']]);\n\ndeclare global {\n  // eslint-disable-next-line no-var\n  var commonConfig: Record<string, any> | undefined;\n}\n\nconst getCommonConfigValues = () => {\n  const { commonConfig } = globalThis;\n\n  if (!commonConfig) {\n    return null;\n  }\n\n  const entries = Object.entries(commonConfig).reduce<[string, any][]>(\n    (res, [key, value]) => {\n      if (\n        typeof value !== 'undefined' && // This can happen if the value was explicitly set to undefined\n        typeof value !== 'function' &&\n        !IGNORE_KEYS.has(key)\n      ) {\n        res.push([MAP_KEYS.get(key) ?? key, value]);\n      }\n\n      return res;\n    },\n    [],\n  );\n\n  return entries.length > 0 ? Object.fromEntries(entries) : null;\n};\n\nexport const getCommonConfigHeader = () => {\n  const commonConfigValues = getCommonConfigValues();\n  const value = commonConfigValues ? JSON.stringify(commonConfigValues) : '';\n\n  return {\n    [COMMON_CONFIG_HEADER_NAME]: encodeURIComponent(value),\n  };\n};\n"],"mappings":"AAAA;AACA;AACA;;AAEA,MAAMA,yBAAyB,GAAG,cAAc;AAChD,MAAMC,WAAW,GAAG,IAAIC,GAAG,CAAC,CAAC,eAAe,EAAE,qBAAqB,CAAC,CAAC;AACrE,MAAMC,QAAQ,GAAG,IAAIC,GAAG,CAAiB,CAAC,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;AAO1D,MAAMC,qBAAqB,GAAGA,CAAA,KAAM;EAClC,MAAM;IAAEC;EAAa,CAAC,GAAGC,UAAU;EAEnC,IAAI,CAACD,YAAY,EAAE;IACjB,OAAO,IAAI;EACb;EAEA,MAAME,OAAO,GAAGC,MAAM,CAACD,OAAO,CAACF,YAAY,CAAC,CAACI,MAAM,CACjD,CAACC,GAAG,EAAAC,IAAA,KAAmB;IAAA,IAAjB,CAACC,GAAG,EAAEC,KAAK,CAAC,GAAAF,IAAA;IAChB,IACE,OAAOE,KAAK,KAAK,WAAW;IAAI;IAChC,OAAOA,KAAK,KAAK,UAAU,IAC3B,CAACb,WAAW,CAACc,GAAG,CAACF,GAAG,CAAC,EACrB;MACAF,GAAG,CAACK,IAAI,CAAC,CAACb,QAAQ,CAACc,GAAG,CAACJ,GAAG,CAAC,IAAIA,GAAG,EAAEC,KAAK,CAAC,CAAC;IAC7C;IAEA,OAAOH,GAAG;EACZ,CAAC,EACD,EACF,CAAC;EAED,OAAOH,OAAO,CAACU,MAAM,GAAG,CAAC,GAAGT,MAAM,CAACU,WAAW,CAACX,OAAO,CAAC,GAAG,IAAI;AAChE,CAAC;AAED,OAAO,MAAMY,qBAAqB,GAAGA,CAAA,KAAM;EACzC,MAAMC,kBAAkB,GAAGhB,qBAAqB,CAAC,CAAC;EAClD,MAAMS,KAAK,GAAGO,kBAAkB,GAAGC,IAAI,CAACC,SAAS,CAACF,kBAAkB,CAAC,GAAG,EAAE;EAE1E,OAAO;IACL,CAACrB,yBAAyB,GAAGwB,kBAAkB,CAACV,KAAK;EACvD,CAAC;AACH,CAAC","ignoreList":[]}