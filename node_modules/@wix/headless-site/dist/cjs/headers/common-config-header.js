"use strict";

exports.__esModule = true;
exports.getCommonConfigHeader = void 0;
/**
 * Based on https://github.com/wix-private/metro/blob/master/packages/wix-headers/src/headers/common-config.ts
 */

const COMMON_CONFIG_HEADER_NAME = 'commonConfig';
const IGNORE_KEYS = new Set(['consentPolicy', 'consentPolicyHeader']);
const MAP_KEYS = new Map([['bsi', 'BSI']]);
const getCommonConfigValues = () => {
  const {
    commonConfig
  } = globalThis;
  if (!commonConfig) {
    return null;
  }
  const entries = Object.entries(commonConfig).reduce((res, [key, value]) => {
    if (typeof value !== 'undefined' &&
    // This can happen if the value was explicitly set to undefined
    typeof value !== 'function' && !IGNORE_KEYS.has(key)) {
      res.push([MAP_KEYS.get(key) ?? key, value]);
    }
    return res;
  }, []);
  return entries.length > 0 ? Object.fromEntries(entries) : null;
};
const getCommonConfigHeader = () => {
  const commonConfigValues = getCommonConfigValues();
  const value = commonConfigValues ? JSON.stringify(commonConfigValues) : '';
  return {
    [COMMON_CONFIG_HEADER_NAME]: encodeURIComponent(value)
  };
};
exports.getCommonConfigHeader = getCommonConfigHeader;
//# sourceMappingURL=common-config-header.js.map