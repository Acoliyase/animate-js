{"version":3,"names":["_monitoringVelo","require","_headers","_authUtils","createHostModule","__type","create","host","req","waitUntil","essentials","passThroughHeaders","getPassThroughHeaders","language","locale","timezone","getMonitoringClient","createVeloMonitoringClient","namespace","producer","getAuthToken","resolveAuthToken","onBatchQueueCreated","batchFlushPromise","exports"],"sources":["../../src/host-module.ts"],"sourcesContent":["import type { HostModule, Host } from '@wix/sdk-types';\nimport { createVeloMonitoringClient } from '@wix/monitoring-velo';\nimport type { SDK, SDKOptions } from './types';\nimport { getPassThroughHeaders } from './headers';\nimport { resolveAuthToken } from './utils/auth-utils';\n\nexport const createHostModule = (): HostModule<SDK, Host> & {\n  host: (options: SDKOptions) => Host;\n} => {\n  return {\n    __type: 'host',\n    create: () => {\n      return {};\n    },\n    host: ({ req, waitUntil, essentials }: SDKOptions = {}) => {\n      const passThroughHeaders = getPassThroughHeaders(req);\n\n      return {\n        essentials: {\n          passThroughHeaders,\n          language: essentials?.language ?? 'en',\n          locale: essentials?.locale ?? 'en-US',\n          timezone: essentials?.timezone ?? 'UTC',\n        },\n        getMonitoringClient: () => {\n          return createVeloMonitoringClient({\n            req: req as Request,\n            namespace: 'Headless',\n            producer: 'backend',\n            getAuthToken: async () => resolveAuthToken(),\n            onBatchQueueCreated: (batchFlushPromise) =>\n              waitUntil?.(batchFlushPromise),\n          });\n        },\n      };\n    },\n  };\n};\n"],"mappings":";;;;AACA,IAAAA,eAAA,GAAAC,OAAA;AAEA,IAAAC,QAAA,GAAAD,OAAA;AACA,IAAAE,UAAA,GAAAF,OAAA;AAEO,MAAMG,gBAAgB,GAAGA,CAAA,KAE3B;EACH,OAAO;IACLC,MAAM,EAAE,MAAM;IACdC,MAAM,EAAEA,CAAA,KAAM;MACZ,OAAO,CAAC,CAAC;IACX,CAAC;IACDC,IAAI,EAAEA,CAAC;MAAEC,GAAG;MAAEC,SAAS;MAAEC;IAAuB,CAAC,GAAG,CAAC,CAAC,KAAK;MACzD,MAAMC,kBAAkB,GAAG,IAAAC,8BAAqB,EAACJ,GAAG,CAAC;MAErD,OAAO;QACLE,UAAU,EAAE;UACVC,kBAAkB;UAClBE,QAAQ,EAAE,CAAAH,UAAU,oBAAVA,UAAU,CAAEG,QAAQ,KAAI,IAAI;UACtCC,MAAM,EAAE,CAAAJ,UAAU,oBAAVA,UAAU,CAAEI,MAAM,KAAI,OAAO;UACrCC,QAAQ,EAAE,CAAAL,UAAU,oBAAVA,UAAU,CAAEK,QAAQ,KAAI;QACpC,CAAC;QACDC,mBAAmB,EAAEA,CAAA,KAAM;UACzB,OAAO,IAAAC,0CAA0B,EAAC;YAChCT,GAAG,EAAEA,GAAc;YACnBU,SAAS,EAAE,UAAU;YACrBC,QAAQ,EAAE,SAAS;YACnBC,YAAY,EAAE,MAAAA,CAAA,KAAY,IAAAC,2BAAgB,EAAC,CAAC;YAC5CC,mBAAmB,EAAGC,iBAAiB,IACrCd,SAAS,oBAATA,SAAS,CAAGc,iBAAiB;UACjC,CAAC,CAAC;QACJ;MACF,CAAC;IACH;EACF,CAAC;AACH,CAAC;AAACC,OAAA,CAAApB,gBAAA,GAAAA,gBAAA","ignoreList":[]}