{"version":3,"names":["createVeloMonitoringClient","getPassThroughHeaders","resolveAuthToken","createHostModule","__type","create","host","_temp","req","waitUntil","essentials","passThroughHeaders","language","locale","timezone","getMonitoringClient","namespace","producer","getAuthToken","onBatchQueueCreated","batchFlushPromise"],"sources":["../../src/host-module.ts"],"sourcesContent":["import type { HostModule, Host } from '@wix/sdk-types';\nimport { createVeloMonitoringClient } from '@wix/monitoring-velo';\nimport type { SDK, SDKOptions } from './types';\nimport { getPassThroughHeaders } from './headers';\nimport { resolveAuthToken } from './utils/auth-utils';\n\nexport const createHostModule = (): HostModule<SDK, Host> & {\n  host: (options: SDKOptions) => Host;\n} => {\n  return {\n    __type: 'host',\n    create: () => {\n      return {};\n    },\n    host: ({ req, waitUntil, essentials }: SDKOptions = {}) => {\n      const passThroughHeaders = getPassThroughHeaders(req);\n\n      return {\n        essentials: {\n          passThroughHeaders,\n          language: essentials?.language ?? 'en',\n          locale: essentials?.locale ?? 'en-US',\n          timezone: essentials?.timezone ?? 'UTC',\n        },\n        getMonitoringClient: () => {\n          return createVeloMonitoringClient({\n            req: req as Request,\n            namespace: 'Headless',\n            producer: 'backend',\n            getAuthToken: async () => resolveAuthToken(),\n            onBatchQueueCreated: (batchFlushPromise) =>\n              waitUntil?.(batchFlushPromise),\n          });\n        },\n      };\n    },\n  };\n};\n"],"mappings":"AACA,SAASA,0BAA0B,QAAQ,sBAAsB;AAEjE,SAASC,qBAAqB,QAAQ,WAAW;AACjD,SAASC,gBAAgB,QAAQ,oBAAoB;AAErD,OAAO,MAAMC,gBAAgB,GAAGA,CAAA,KAE3B;EACH,OAAO;IACLC,MAAM,EAAE,MAAM;IACdC,MAAM,EAAEA,CAAA,KAAM;MACZ,OAAO,CAAC,CAAC;IACX,CAAC;IACDC,IAAI,EAAE,SAAAA,CAAAC,KAAA,EAAqD;MAAA,IAApD;QAAEC,GAAG;QAAEC,SAAS;QAAEC;MAAuB,CAAC,GAAAH,KAAA,cAAG,CAAC,CAAC,GAAAA,KAAA;MACpD,MAAMI,kBAAkB,GAAGV,qBAAqB,CAACO,GAAG,CAAC;MAErD,OAAO;QACLE,UAAU,EAAE;UACVC,kBAAkB;UAClBC,QAAQ,EAAE,CAAAF,UAAU,oBAAVA,UAAU,CAAEE,QAAQ,KAAI,IAAI;UACtCC,MAAM,EAAE,CAAAH,UAAU,oBAAVA,UAAU,CAAEG,MAAM,KAAI,OAAO;UACrCC,QAAQ,EAAE,CAAAJ,UAAU,oBAAVA,UAAU,CAAEI,QAAQ,KAAI;QACpC,CAAC;QACDC,mBAAmB,EAAEA,CAAA,KAAM;UACzB,OAAOf,0BAA0B,CAAC;YAChCQ,GAAG,EAAEA,GAAc;YACnBQ,SAAS,EAAE,UAAU;YACrBC,QAAQ,EAAE,SAAS;YACnBC,YAAY,EAAE,MAAAA,CAAA,KAAYhB,gBAAgB,CAAC,CAAC;YAC5CiB,mBAAmB,EAAGC,iBAAiB,IACrCX,SAAS,oBAATA,SAAS,CAAGW,iBAAiB;UACjC,CAAC,CAAC;QACJ;MACF,CAAC;IACH;EACF,CAAC;AACH,CAAC","ignoreList":[]}