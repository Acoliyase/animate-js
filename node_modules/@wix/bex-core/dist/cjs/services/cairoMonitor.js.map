{"version":3,"names":["_WixPatternsError","require","WixPatternsMonitor","constructor","internalErrorMonitor","errorMonitor","internalFedops","environment","csid","_defineProperty2","default","_internalErrorMonitor","_errorMonitor","_internalFedops","_environment","_csid","reportError","error","propagate","category","options","tags","extraInteractionParams","captureException","originalException","isWixPatternsError","cairoVersion","uiLibVersion","componentId","interactionStarted","interactionName","_this$_internalFedops","customParams","interactionEnded","_this$_internalFedops2","reportInteractionStart","componentName","event","interaction","toLowerCase","reportKey","_reports","_this$_internalFedops3","reportInteractionEnd","_this$_internalFedops4","reportErrorThrownOncePerFlow","_this$_internalFedops5","exports"],"sources":["../../../src/services/cairoMonitor.ts"],"sourcesContent":["import { WixPatternsError, isWixPatternsError } from './WixPatternsError';\nimport { Environment } from './environment';\nimport type { MonitorLogger } from './MonitorLogger';\n\ntype CaptureExceptionOptions = { tags?: Record<string, unknown> };\n\nexport interface ErrorMonitor {\n  captureException(exception: unknown): string;\n}\n\nexport interface InternalErrorMonitor {\n  captureException(\n    exception: unknown,\n    options?: CaptureExceptionOptions,\n  ): string;\n}\n\nexport type MonitoredEvent =\n  | 'initial-load'\n  | 'initial-fetch-data'\n  | 'initial-full-render'\n  | 'e2e';\n\nexport class WixPatternsMonitor {\n  private _internalErrorMonitor: InternalErrorMonitor;\n  private _errorMonitor: ErrorMonitor;\n  private _internalFedops: MonitorLogger | undefined;\n  private _reports: Record<string, boolean> = {};\n  private _environment: Environment;\n  private _csid: string;\n\n  constructor({\n    internalErrorMonitor,\n    errorMonitor,\n    internalFedops,\n    environment,\n    csid,\n  }: {\n    internalErrorMonitor: InternalErrorMonitor;\n    errorMonitor: ErrorMonitor;\n    internalFedops: MonitorLogger | undefined;\n    environment: Environment;\n    csid: string;\n  }) {\n    this._internalErrorMonitor = internalErrorMonitor;\n    this._errorMonitor = errorMonitor;\n    this._internalFedops = internalFedops;\n    this._environment = environment;\n    this._csid = csid;\n  }\n\n  /**\n   * This method is used to report errors that occur within the application. It takes in an error object with the following properties:\n   * @param errorCode A WixPatternsErrorCode enum value representing the error that occurred.\n   * @param exception The exception that was thrown.\n   * @param extraData (optional) Additional data related to the error.\n   * @param propagate (optional) Propagates report to vertical error monitor.\n   * @default propagate true\n   */\n  reportError({\n    error,\n    propagate = true,\n    category,\n  }: {\n    error: unknown;\n    propagate?: boolean;\n    category?: string;\n  }) {\n    const options: {\n      tags?: Record<string, string | boolean | number | undefined | null>;\n    } = { tags: { ...this.extraInteractionParams } };\n\n    if (category) {\n      options.tags!.category = category;\n    }\n\n    this._internalErrorMonitor.captureException(error, options);\n\n    if (this._errorMonitor && propagate) {\n      const originalException = isWixPatternsError(error)\n        ? (error as WixPatternsError).originalException\n        : error;\n      this._errorMonitor.captureException(originalException);\n    }\n  }\n\n  get extraInteractionParams() {\n    return {\n      cairoVersion: this._environment.uiLibVersion,\n      componentId: this._environment.componentId,\n      csid: this._csid,\n    };\n  }\n\n  interactionStarted(interactionName: string) {\n    this._internalFedops?.interactionStarted(interactionName, {\n      customParams: this.extraInteractionParams,\n    });\n  }\n\n  interactionEnded(interactionName: string) {\n    this._internalFedops?.interactionEnded(interactionName, {\n      customParams: this.extraInteractionParams,\n    });\n  }\n\n  reportInteractionStart(\n    componentName: string,\n    event: MonitoredEvent,\n    customParams?: Record<string, string | boolean>,\n  ) {\n    const interaction = `${componentName.toLowerCase()}-${event}`;\n    const reportKey = `${interaction}-start`;\n\n    if (!this._reports[reportKey]) {\n      this._reports[reportKey] = true;\n      this._internalFedops?.interactionStarted(interaction, {\n        customParams: {\n          ...this.extraInteractionParams,\n          ...customParams,\n        },\n      });\n    }\n  }\n\n  reportInteractionEnd(\n    componentName: string,\n    event: MonitoredEvent,\n    customParams?: Record<string, string | boolean>,\n  ) {\n    const interaction = `${componentName.toLowerCase()}-${event}`;\n    const reportKey = `${interaction}-end`;\n\n    if (!this._reports[reportKey]) {\n      this._reports[reportKey] = true;\n      this._internalFedops?.interactionEnded(interaction, {\n        customParams: {\n          ...this.extraInteractionParams,\n          ...customParams,\n        },\n      });\n    }\n  }\n\n  reportErrorThrownOncePerFlow() {\n    this._internalFedops?.reportErrorThrownOncePerFlow();\n  }\n}\n"],"mappings":"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","ignoreList":[]}