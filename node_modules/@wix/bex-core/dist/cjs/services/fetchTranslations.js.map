{"version":3,"names":["_translationsImportsMap","require","resolveMessages","messages","default","importLocale","locale","process","env","STORYBOOK_VISUAL_E2E","translationsImportsMap","visuale2e","factory","Error","messagesEnImportGlobal","exports","fetchTranslations","errorMonitor","messagesEn","e","message","test","captureException","NODE_ENV","console","error","prefetchTranslationsWithoutBundling","params"],"sources":["../../../src/services/fetchTranslations.ts"],"sourcesContent":["import type { Messages } from '@wix/yoshi-flow-bm';\nimport type { ErrorMonitor } from './cairoMonitor';\nimport { CairoTranslationsOrDefault } from './cairoTranslations';\nimport { translationsImportsMap } from './translationsImportsMap';\n\nconst resolveMessages = (messages: CairoTranslationsOrDefault): Messages =>\n  typeof messages.default === 'object' ? messages.default : messages;\n\nconst importLocale = async (locale: string) => {\n  if (\n    typeof process !== 'undefined' &&\n    process.env.STORYBOOK_VISUAL_E2E === 'true' &&\n    locale === 'en'\n  ) {\n    return resolveMessages(await translationsImportsMap.visuale2e());\n  }\n\n  const factory =\n    translationsImportsMap[locale as keyof typeof translationsImportsMap];\n\n  if (factory == null) {\n    throw new Error(\n      `@wix/cairo: Failed to find translations for locale '${locale}'`,\n    );\n  }\n\n  return resolveMessages(await factory());\n};\n\nexport const messagesEnImportGlobal = () => importLocale('en');\nmessagesEnImportGlobal(); // prefetch en translations\n\nexport const fetchTranslations =\n  ({ errorMonitor }: { readonly errorMonitor: ErrorMonitor }) =>\n  async (\n    locale: string,\n    { messagesEn }: { messagesEn?: Messages } = {},\n  ): Promise<Messages> => {\n    try {\n      if (messagesEn != null && locale === 'en') {\n        return messagesEn;\n      }\n      return await importLocale(locale);\n    } catch (e) {\n      const message = (e as { message?: unknown } | null | undefined)?.message;\n      // ignore missing translation files\n      if (message === 'string' && /Cannot find module/.test(message)) {\n        throw e;\n      }\n\n      errorMonitor.captureException(e);\n\n      if (process.env.NODE_ENV === 'development') {\n        console.error(\n          `@wix/cairo: Failed to fetch translation for locale '${locale}', caused by:`,\n        );\n        console.error(e);\n      }\n      throw e; // i18n will catch & fallback to default locale\n    }\n  };\n\nexport const prefetchTranslationsWithoutBundling =\n  (params: { readonly errorMonitor: ErrorMonitor }) => (locale: string) => {\n    return fetchTranslations(params)(locale);\n  };\n"],"mappings":";;;;AAGA,IAAAA,uBAAA,GAAAC,OAAA;AAEA,MAAMC,eAAe,GAAIC,QAAoC,IAC3D,OAAOA,QAAQ,CAACC,OAAO,KAAK,QAAQ,GAAGD,QAAQ,CAACC,OAAO,GAAGD,QAAQ;AAEpE,MAAME,YAAY,GAAG,MAAOC,MAAc,IAAK;EAC7C,IACE,OAAOC,OAAO,KAAK,WAAW,IAC9BA,OAAO,CAACC,GAAG,CAACC,oBAAoB,KAAK,MAAM,IAC3CH,MAAM,KAAK,IAAI,EACf;IACA,OAAOJ,eAAe,CAAC,MAAMQ,8CAAsB,CAACC,SAAS,CAAC,CAAC,CAAC;EAClE;EAEA,MAAMC,OAAO,GACXF,8CAAsB,CAACJ,MAAM,CAAwC;EAEvE,IAAIM,OAAO,IAAI,IAAI,EAAE;IACnB,MAAM,IAAIC,KAAK,CACb,uDAAuDP,MAAM,GAC/D,CAAC;EACH;EAEA,OAAOJ,eAAe,CAAC,MAAMU,OAAO,CAAC,CAAC,CAAC;AACzC,CAAC;AAEM,MAAME,sBAAsB,GAAGA,CAAA,KAAMT,YAAY,CAAC,IAAI,CAAC;AAACU,OAAA,CAAAD,sBAAA,GAAAA,sBAAA;AAC/DA,sBAAsB,CAAC,CAAC,CAAC,CAAC;;AAEnB,MAAME,iBAAiB,GAC5BA,CAAC;EAAEC;AAAsD,CAAC,KAC1D,OACEX,MAAc,EACd;EAAEY;AAAsC,CAAC,GAAG,CAAC,CAAC,KACxB;EACtB,IAAI;IACF,IAAIA,UAAU,IAAI,IAAI,IAAIZ,MAAM,KAAK,IAAI,EAAE;MACzC,OAAOY,UAAU;IACnB;IACA,OAAO,MAAMb,YAAY,CAACC,MAAM,CAAC;EACnC,CAAC,CAAC,OAAOa,CAAC,EAAE;IACV,MAAMC,OAAO,GAAID,CAAC,oBAADA,CAAC,CAA+CC,OAAO;IACxE;IACA,IAAIA,OAAO,KAAK,QAAQ,IAAI,oBAAoB,CAACC,IAAI,CAACD,OAAO,CAAC,EAAE;MAC9D,MAAMD,CAAC;IACT;IAEAF,YAAY,CAACK,gBAAgB,CAACH,CAAC,CAAC;IAEhC,IAAIZ,OAAO,CAACC,GAAG,CAACe,QAAQ,KAAK,aAAa,EAAE;MAC1CC,OAAO,CAACC,KAAK,CACX,uDAAuDnB,MAAM,eAC/D,CAAC;MACDkB,OAAO,CAACC,KAAK,CAACN,CAAC,CAAC;IAClB;IACA,MAAMA,CAAC,CAAC,CAAC;EACX;AACF,CAAC;AAACJ,OAAA,CAAAC,iBAAA,GAAAA,iBAAA;AAEG,MAAMU,mCAAmC,GAC7CC,MAA+C,IAAMrB,MAAc,IAAK;EACvE,OAAOU,iBAAiB,CAACW,MAAM,CAAC,CAACrB,MAAM,CAAC;AAC1C,CAAC;AAACS,OAAA,CAAAW,mCAAA,GAAAA,mCAAA","ignoreList":[]}