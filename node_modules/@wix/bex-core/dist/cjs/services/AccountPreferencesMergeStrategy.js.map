{"version":3,"names":["_merge","_interopRequireDefault","require","AccountPreferencesMergeStrategy","constructor","params","_defineProperty2","default","storage","extendScope","scope","setItem","key","value","options","_data$views","_partialData$views","data","getItem","catch","undefined","partialData","views","list","Object","entries","merge","removeItem","getAllItems","exports"],"sources":["../../../src/services/AccountPreferencesMergeStrategy.ts"],"sourcesContent":["import type {\n  BaseStorage,\n  BaseStorageOptions,\n} from '@wix/fe-essentials/data-capsule';\nimport { Scope } from '@wix/data-capsule/dist/types/base-storage';\nimport merge from 'lodash/merge';\n\nexport interface AccountPreferencesMergeStrategyParams {\n  readonly storage: BaseStorage<BaseStorageOptions>;\n}\n\nexport interface AppSettingsViewsSchema {\n  views?: {\n    list?: Record<string, {} | null | undefined>;\n  };\n}\n\nexport class AccountPreferencesMergeStrategy\n  implements BaseStorage<BaseStorageOptions>\n{\n  private readonly storage;\n\n  constructor(params: AccountPreferencesMergeStrategyParams) {\n    this.storage = params.storage;\n  }\n\n  extendScope(scope: Scope) {\n    return scope;\n  }\n\n  async setItem<T>(\n    key: string,\n    value: T,\n    options: BaseStorageOptions,\n  ): Promise<void> {\n    const { storage } = this;\n    const data = (await this.getItem(key, options).catch(() => undefined)) as\n      | AppSettingsViewsSchema\n      | null\n      | undefined;\n    const partialData = value as AppSettingsViewsSchema | null | undefined;\n\n    if (data?.views?.list && partialData?.views?.list) {\n      for (const [key, value] of Object.entries(partialData.views.list)) {\n        if (value === null) {\n          // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n          delete data.views.list[key];\n          // eslint-disable-next-line @typescript-eslint/no-dynamic-delete\n          delete partialData.views.list[key];\n        }\n      }\n    }\n\n    return storage.setItem(key, merge(data, value), options);\n  }\n\n  async removeItem(key: string, options: BaseStorageOptions) {\n    const { storage } = this;\n    const data = await this.getItem(key, options).catch(() => undefined);\n    return storage.setItem(key, merge(data, { [key]: null }), options);\n  }\n\n  async getItem<T = any>(key: string, options: BaseStorageOptions): Promise<T> {\n    return this.storage.getItem(key, options);\n  }\n\n  async getAllItems<T = any>(options: BaseStorageOptions): Promise<T> {\n    return this.storage.getAllItems(options);\n  }\n}\n"],"mappings":";;;;;;AAKA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AAYO,MAAMC,+BAA+B,CAE5C;EAGEC,WAAWA,CAACC,MAA6C,EAAE;IAAA,IAAAC,gBAAA,CAAAC,OAAA;IACzD,IAAI,CAACC,OAAO,GAAGH,MAAM,CAACG,OAAO;EAC/B;EAEAC,WAAWA,CAACC,KAAY,EAAE;IACxB,OAAOA,KAAK;EACd;EAEA,MAAMC,OAAOA,CACXC,GAAW,EACXC,KAAQ,EACRC,OAA2B,EACZ;IAAA,IAAAC,WAAA,EAAAC,kBAAA;IACf,MAAM;MAAER;IAAQ,CAAC,GAAG,IAAI;IACxB,MAAMS,IAAI,GAAI,MAAM,IAAI,CAACC,OAAO,CAACN,GAAG,EAAEE,OAAO,CAAC,CAACK,KAAK,CAAC,MAAMC,SAAS,CAGvD;IACb,MAAMC,WAAW,GAAGR,KAAkD;IAEtE,IAAII,IAAI,aAAAF,WAAA,GAAJE,IAAI,CAAEK,KAAK,aAAXP,WAAA,CAAaQ,IAAI,IAAIF,WAAW,aAAAL,kBAAA,GAAXK,WAAW,CAAEC,KAAK,aAAlBN,kBAAA,CAAoBO,IAAI,EAAE;MACjD,KAAK,MAAM,CAACX,GAAG,EAAEC,KAAK,CAAC,IAAIW,MAAM,CAACC,OAAO,CAACJ,WAAW,CAACC,KAAK,CAACC,IAAI,CAAC,EAAE;QACjE,IAAIV,KAAK,KAAK,IAAI,EAAE;UAClB;UACA,OAAOI,IAAI,CAACK,KAAK,CAACC,IAAI,CAACX,GAAG,CAAC;UAC3B;UACA,OAAOS,WAAW,CAACC,KAAK,CAACC,IAAI,CAACX,GAAG,CAAC;QACpC;MACF;IACF;IAEA,OAAOJ,OAAO,CAACG,OAAO,CAACC,GAAG,EAAE,IAAAc,cAAK,EAACT,IAAI,EAAEJ,KAAK,CAAC,EAAEC,OAAO,CAAC;EAC1D;EAEA,MAAMa,UAAUA,CAACf,GAAW,EAAEE,OAA2B,EAAE;IACzD,MAAM;MAAEN;IAAQ,CAAC,GAAG,IAAI;IACxB,MAAMS,IAAI,GAAG,MAAM,IAAI,CAACC,OAAO,CAACN,GAAG,EAAEE,OAAO,CAAC,CAACK,KAAK,CAAC,MAAMC,SAAS,CAAC;IACpE,OAAOZ,OAAO,CAACG,OAAO,CAACC,GAAG,EAAE,IAAAc,cAAK,EAACT,IAAI,EAAE;MAAE,CAACL,GAAG,GAAG;IAAK,CAAC,CAAC,EAAEE,OAAO,CAAC;EACpE;EAEA,MAAMI,OAAOA,CAAUN,GAAW,EAAEE,OAA2B,EAAc;IAC3E,OAAO,IAAI,CAACN,OAAO,CAACU,OAAO,CAACN,GAAG,EAAEE,OAAO,CAAC;EAC3C;EAEA,MAAMc,WAAWA,CAAUd,OAA2B,EAAc;IAClE,OAAO,IAAI,CAACN,OAAO,CAACoB,WAAW,CAACd,OAAO,CAAC;EAC1C;AACF;AAACe,OAAA,CAAA1B,+BAAA,GAAAA,+BAAA","ignoreList":[]}