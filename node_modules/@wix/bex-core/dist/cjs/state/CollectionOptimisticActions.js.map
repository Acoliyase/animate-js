{"version":3,"names":["_mobx","require","_CollectionOptimisticActionsState","_CollectionOptimisticProcessor","_CollectionOptimisticPatch","_CollectionOptimisticExecutor","_events","_util","_QueryResultSimulationDefault","_CollectionOptimisticSequenceExecutor","CollectionOptimisticActions","constructor","params","_defineProperty2","default","EventEmitter","action","patch","state","collection","collections","noInvalidate","processors","_commitMode","patches","remove","length","forEach","processorHelpers","commit","invalidate","p","refreshAllPages","events","clearPatch","off","_clearPatch","onRefresh","isStale","once","emit","on","query","sequences","Map","CollectionOptimisticActionsState","source","patchesCache","container","cacheNamespace","resultSimulationDefault","QueryResultSimulationDefault","predicate","orderBy","createdAt","executor","CollectionOptimisticExecutor","batchWait","errorMonitor","showToast","translate","lodash","push","CollectionOptimisticProcessor","optimistic","_optimisticActions","makeObservable","pushPatchAndReprocess","replacePatchAndReprocess","rollback","bound","clear","move","pendingMovePatches","computed","_queryNames","queryName","map","c","hasRunningSequence","Array","from","values","some","s","seq","running","filter","isArray","newPatch","oldPatch","oldPatchIndex","findIndex","createOne","item","createMany","items","itemKey","result","submit","updateServerAfter","onUndo","onTryAgain","onError","optimisticPatchParams","queryCache","queryNames","actionType","patchedItems","originalItems","originalTotal","total","get","selector","has","optimisticPatch","OptimisticPatch","_clearPatchOnNextResultOrUnmount","execute","actions","submitResult","reduce","patchedItemsEntries","key","set","updatedOptimisticPatch","onRollback","eventuallyUpdated","onEventuallyUpdated","updateMany","keepPosition","_result$get","originalItem","enqueueMovePatch","event","filtersKeyHash","_initSequence","CollectionOptimisticSequenceExecutor","err","pendingPatches","_p$move","Error","message","reorderModeCanceledMessage","requestId","isHttpError","undefined","biName","details","onClick","sequence","collectionSnapshot","updateOne","updateAll","patchOrFn","originQuery","itemPredicate","updatedAt","Date","deleteMany","deleteOne","deleteAll","initCollection","i","indexOf","splice","init","_patchesBeforeUnmount","emitRefresh","emitBeforeResultUpdated","emitter","disposers","reaction","checkUnprocessedFilteredOut","_pages","_pagesAtom","reportObserved","unprocessed","processed","checkIsEmptyAndHasUnprocessed","isEmpty","flatMap","page","listeners","_filteredOut","process","env","NODE_ENV","window","__CAIRO_TEST_TRIGGER_REACH_BOTTOM_LISTENER__","fetchNextPageIfNeeded","disposer","toJSON","remaining","exports"],"sources":["../../../src/state/CollectionOptimisticActions.ts"],"sourcesContent":["import { ActionMove, ComputedQuery, FiltersMap } from '../model';\nimport {\n  action,\n  computed,\n  IObservableArray,\n  makeObservable,\n  reaction,\n} from 'mobx';\nimport { CollectionState } from './CollectionState';\nimport { Order } from './QueryResultSimulation';\nimport { CollectionOptimisticActionsState } from './CollectionOptimisticActionsState';\nimport { CollectionOptimisticProcessor } from './CollectionOptimisticProcessor';\nimport {\n  OptimisticPatch,\n  OptimisticPatchParams,\n} from './CollectionOptimisticPatch';\nimport { CollectionOptimisticExecutor } from './CollectionOptimisticExecutor';\nimport { EventEmitter } from 'events';\nimport { isHttpError, TypedEmitter } from '../util';\nimport { QueryResultSimulationDefault } from './QueryResultSimulationDefault';\nimport { CollectionOptimisticSequenceExecutor } from './CollectionOptimisticSequenceExecutor';\nimport { ModalLayoutProps } from '../services';\nimport { QueryState } from './QueryState';\nimport {\n  CreateManyParams,\n  DeleteManyParams,\n  OptimisticActionBasis,\n  UpdateAllParams,\n  UpdateManyParams,\n} from './OptimisticActions';\n\nexport interface MoveParams<T, R> extends OptimisticActionBasis {\n  /**\n   * Function to submit the move operation.\n   * @param params - The parameters for the move action.\n   */\n  submit?: (params: ActionMove<T>) => Promise<R>;\n  /**\n   * Snapshot of the collection before the move operation.\n   */\n  collectionSnapshot: { [key: string]: string | number | undefined };\n}\n\nexport interface CollectionOptimisticActionsBaseParams<\n  T,\n  F extends FiltersMap,\n> {\n  /**\n   * A function that simulates the filtering in the server.\n   * The function should return another function that accepts an item, and return a boolean that indicates whether the item passes the query filters or not.\n   * @param computedQuery - The computed query object.\n   * @external\n   */\n  readonly predicate?: (\n    computedQuery: ComputedQuery<F>,\n  ) => (item: T) => boolean;\n  /**\n   * A function that simulates the ordering of the items in the server.<br>\n   * The function should return a list of rules in the form of `{fieldName: string; order: 'asc' | 'desc';}` to order the items by\n   * @param computedQuery - The computed query object.\n   * @external\n   */\n  readonly orderBy?: (computedQuery: ComputedQuery<F>) => Order<T>[];\n  /**\n   * A function to retrieve the creation date of an item.\n   * @param item - The item.\n   * @external\n   */\n  readonly createdAt?: (item: T) => Date;\n  /**\n   * Time to wait before batching multiple `updateMany` calls into a single server call.\n   * @default 0\n   * @external\n   */\n  readonly batchWait?: number;\n  /**\n   * Indicates whether to refresh the current page without invalidating the cache.\n   * @external\n   */\n  readonly noInvalidate?: boolean;\n  /**\n   * Adds a namespace to the cache key.\n   * @external\n   */\n  readonly cacheNamespace?: string;\n  readonly sequences?: Map<string, CollectionOptimisticSequenceExecutor>;\n  readonly query?: QueryState<F>;\n}\n\nexport interface CollectionOptimisticActionsParams<T, F extends FiltersMap>\n  extends CollectionOptimisticActionsBaseParams<T, F> {\n  /**\n   * The main collection to reflect changes into.\n   * @external\n   */\n  readonly collection: CollectionState<T, F>;\n  /**\n   * Additional collections to reflect changes into.\n   * @default undefined\n   * @external\n   */\n  readonly collections?: CollectionState<T, F>[];\n  /**\n   * Container holding patches cache and events emitter.\n   * @external\n   */\n  readonly container: {\n    patchesCache: Map<string, IObservableArray<OptimisticPatch<T>>>;\n    events: TypedEmitter<{\n      navigation: () => ModalLayoutProps | null | undefined;\n    }>;\n  };\n}\n\nexport class CollectionOptimisticActions<T, F extends FiltersMap> {\n  readonly collection;\n  readonly query;\n  readonly collections;\n  readonly predicate: (computedQuery: ComputedQuery<F>) => (item: T) => boolean;\n  readonly orderBy: (computedQuery: ComputedQuery<F>) => Order<T>[];\n  readonly createdAt?: (item: T) => Date;\n  readonly events = new EventEmitter() as TypedEmitter<{\n    reprocess: () => void;\n    updated: () => void;\n    refresh: (params: { isStale: boolean }) => void;\n    unmount: () => void;\n    beforeResultUpdated: () => void;\n    dragAndDropSequenceError: (params: {\n      patches: OptimisticPatch<T>[];\n    }) => void;\n    dragAndDropSequenceRetry: (params: {\n      patches: OptimisticPatch<T>[];\n    }) => void;\n  }>;\n  readonly noInvalidate;\n  readonly state;\n  readonly processors: CollectionOptimisticProcessor<T, F>[] = [];\n  readonly executor: CollectionOptimisticExecutor<OptimisticPatch<T>>;\n  readonly sequences;\n  readonly resultSimulationDefault;\n  readonly reorderModeCanceledMessage = 'REORDER_MODE_CANCELED';\n\n  _resumeNavigation: (() => void) | null = null;\n\n  _orderByMode: 'orders' | 'moves' = 'orders';\n\n  _commitMode = false;\n\n  constructor(params: CollectionOptimisticActionsParams<T, F>) {\n    this.collection = params.collection;\n    this.query = params.query ?? this.collection.query;\n    this.collections = params.collections ?? [];\n\n    this.sequences =\n      params.sequences ??\n      new Map<string, CollectionOptimisticSequenceExecutor>();\n\n    this.state = new CollectionOptimisticActionsState<T>({\n      source: this.collection,\n      patchesCache: params.container.patchesCache,\n      cacheNamespace: params.cacheNamespace,\n    });\n\n    this.resultSimulationDefault = new QueryResultSimulationDefault({\n      collection: this.collection,\n    });\n\n    this.predicate = params.predicate ?? this.resultSimulationDefault.predicate;\n    this.orderBy = params.orderBy ?? this.resultSimulationDefault.orderBy;\n    this.createdAt = params.createdAt;\n    this.noInvalidate = params.noInvalidate;\n\n    this.executor = new CollectionOptimisticExecutor({\n      batchWait: params.batchWait ?? 0,\n      errorMonitor: this.collection.errorMonitor,\n      showToast: this.collection.showToast,\n      translate: this.collection.translate,\n      lodash: this.collection.lodash,\n      container: params.container,\n    });\n\n    this.processors.push(\n      new CollectionOptimisticProcessor({\n        ...params,\n        optimistic: this,\n      }),\n    );\n\n    if (params.collections != null) {\n      params.collections.forEach((collection) => {\n        this.processors.push(\n          new CollectionOptimisticProcessor({\n            ...params,\n            collection,\n            optimistic: this,\n          }),\n        );\n      });\n    }\n\n    this.collection._optimisticActions = this;\n\n    makeObservable(this, {\n      pushPatchAndReprocess: action,\n      replacePatchAndReprocess: action,\n      rollback: action.bound,\n      clear: action,\n      move: action,\n      pendingMovePatches: computed,\n    });\n  }\n\n  get _queryNames() {\n    return [\n      this.collection.queryName,\n      ...this.collections.map((c) => c.queryName),\n    ];\n  }\n\n  get hasRunningSequence() {\n    return Array.from(this.sequences.values()).some((s) => s.seq.state.running);\n  }\n\n  get pendingMovePatches() {\n    return this.state.patches.filter((p) => p.move);\n  }\n\n  rollback(patch: OptimisticPatch<T> | OptimisticPatch<T>[]) {\n    const { events, state } = this;\n    const patches = Array.isArray(patch) ? patch : [patch];\n\n    for (const p of patches) {\n      state.patches.remove(p);\n    }\n\n    events.emit('reprocess');\n  }\n\n  private _clearPatch = action((patch: OptimisticPatch<T>) => {\n    const {\n      state,\n      collection,\n      collections,\n      noInvalidate,\n      processors,\n      _commitMode,\n    } = this;\n\n    if (noInvalidate) {\n      return;\n    }\n\n    state.patches.remove(patch);\n    if (_commitMode && !state.patches.length) {\n      processors.forEach(({ processorHelpers }) => processorHelpers.commit());\n    }\n    collection.invalidate();\n    collections.forEach((p) => p.refreshAllPages());\n  });\n\n  _clearPatchOnNextResultOrUnmount = (patch: OptimisticPatch<T>) => {\n    const { events } = this;\n\n    const clearPatch = () => {\n      events.off('unmount', clearPatch);\n      this._clearPatch(patch);\n    };\n\n    const onRefresh = ({ isStale }: { isStale: boolean }) => {\n      events.off('refresh', onRefresh);\n\n      // clear only when results are not going to come from cache\n      if (isStale) {\n        events.once('beforeResultUpdated', clearPatch);\n      }\n    };\n\n    events.emit('updated');\n\n    if (this._commitMode) {\n      this._clearPatch(patch);\n    } else {\n      // Clear the patch on the next collection result update to eliminate inconsistencies between server state and local patches\n      events.on('refresh', onRefresh);\n      // since not clearing the patch immediately, clear it on unmount if was not cleared yet\n      events.on('unmount', clearPatch);\n    }\n  };\n\n  pushPatchAndReprocess(patch: OptimisticPatch<T> | OptimisticPatch<T>[]) {\n    const { state, events } = this;\n    const patches = Array.isArray(patch) ? patch : [patch];\n    state.patches.push(...patches);\n    events.emit('reprocess');\n  }\n\n  replacePatchAndReprocess(\n    newPatch: OptimisticPatch<T>,\n    oldPatch: OptimisticPatch<T>,\n  ) {\n    const { state, events } = this;\n\n    const oldPatchIndex = state.patches.findIndex(\n      (patch) => patch === oldPatch,\n    );\n    state.patches[oldPatchIndex] = newPatch;\n    events.emit('reprocess');\n  }\n\n  /**\n   * Creates a single item in the collection.\n   * @param item - The item to create.\n   * @param params - Additional parameters for the operation.\n   * @external\n   */\n  createOne(item: T, params: CreateManyParams<T>) {\n    return this.createMany([item], params);\n  }\n\n  /**\n   * Creates multiple items in the collection.\n   * @param items - The items to create.\n   * @param params - Additional parameters for the operation.\n   * @external\n   */\n  createMany(items: T[], params: CreateManyParams<T>) {\n    const { collection, executor } = this;\n    const { itemKey, result } = collection;\n    const { submit, updateServerAfter, onUndo, onTryAgain, onError } = params;\n\n    const optimisticPatchParams: OptimisticPatchParams<T> = {\n      queryCache: collection.queryCache,\n      queryNames: this._queryNames,\n      patches: this.state.patches,\n      actionType: 'createMany',\n      patchedItems: new Map(items.map((item) => [itemKey(item), item])),\n      originalItems: new Map(),\n      originalTotal: result.total,\n      patch: (item, { patchedItems }) => patchedItems.get(itemKey(item)),\n      selector: (item, { patchedItems }) => patchedItems.has(itemKey(item)),\n    };\n\n    const optimisticPatch = new OptimisticPatch<T>(optimisticPatchParams);\n\n    this.pushPatchAndReprocess(optimisticPatch);\n\n    optimisticPatch.events.on(\n      'scheduleRemoval',\n      this._clearPatchOnNextResultOrUnmount,\n    );\n\n    return executor.execute([optimisticPatch], {\n      ...params,\n      submit: action(async (actions) => {\n        const submitResult = await submit(\n          Array.from(\n            actions\n              .filter(({ actionType }) => actionType === 'createMany')\n              .reduce((map, { patchedItemsEntries }) => {\n                for (const [key, item] of patchedItemsEntries) {\n                  map.set(key, item);\n                }\n                return map;\n              }, new Map<string, T>())\n              .values(),\n          ),\n        );\n\n        if (!submitResult) {\n          return;\n        }\n\n        const updatedOptimisticPatch = new OptimisticPatch({\n          ...optimisticPatchParams,\n          patchedItems: new Map(\n            submitResult.map((item) => [itemKey(item), item]),\n          ),\n        });\n\n        this.replacePatchAndReprocess(updatedOptimisticPatch, optimisticPatch);\n        this._clearPatchOnNextResultOrUnmount(updatedOptimisticPatch);\n        return submitResult;\n      }),\n      onRollback: () => {\n        this.rollback(optimisticPatch);\n      },\n      eventuallyUpdated: updateServerAfter,\n      onEventuallyUpdated: optimisticPatch.onEventuallyUpdated,\n      onTryAgain: async () => {\n        this.pushPatchAndReprocess(optimisticPatch);\n        await onTryAgain?.();\n      },\n      onError,\n      onUndo,\n    });\n  }\n\n  /**\n   * Updates multiple items in the collection.\n   * @param items - The items to update.\n   * @param params - Additional parameters for the update operation.\n   * @external\n   */\n  updateMany<R>(items: T[], params: UpdateManyParams<T, R>) {\n    const { executor, collection } = this;\n    const { itemKey, result } = collection;\n    const {\n      submit,\n      updateServerAfter,\n      keepPosition,\n      onUndo,\n      onTryAgain,\n      onError,\n    } = params;\n\n    const optimisticPatch = new OptimisticPatch({\n      queryCache: collection.queryCache,\n      queryNames: this._queryNames,\n      patches: this.state.patches,\n      actionType: 'updateMany',\n      keepPosition,\n      patchedItems: new Map(items.map((item) => [itemKey(item), item])),\n      originalItems: new Map(\n        items.map((item) => {\n          const key = itemKey(item);\n          const originalItem = result.get(itemKey(item))?.item ?? item;\n          return [key, originalItem];\n        }),\n      ),\n      originalTotal: result.total,\n      patch: (item, { patchedItems }) => patchedItems.get(itemKey(item)),\n      selector: (item, { patchedItems }) => patchedItems.has(itemKey(item)),\n    });\n\n    this.pushPatchAndReprocess(optimisticPatch);\n\n    optimisticPatch.events.on(\n      'scheduleRemoval',\n      this._clearPatchOnNextResultOrUnmount,\n    );\n\n    return executor.execute([optimisticPatch], {\n      ...params,\n      submit: action((actions) =>\n        submit(\n          Array.from(\n            actions\n              .filter(({ actionType }) => actionType === 'updateMany')\n              .reduce((map, { patchedItemsEntries }) => {\n                for (const [key, item] of patchedItemsEntries) {\n                  map.set(key, item);\n                }\n                return map;\n              }, new Map<string, T>())\n              .values(),\n          ),\n        ),\n      ),\n      onRollback: () => {\n        this.rollback(optimisticPatch);\n      },\n      eventuallyUpdated: updateServerAfter,\n      onEventuallyUpdated: optimisticPatch.onEventuallyUpdated,\n      onTryAgain: async () => {\n        this.pushPatchAndReprocess(optimisticPatch);\n        await onTryAgain?.();\n      },\n      onError,\n      onUndo,\n    });\n  }\n\n  enqueueMovePatch<R>(\n    optimisticPatch: OptimisticPatch<T>,\n    params: MoveParams<T, R>,\n  ) {\n    const { submit, onTryAgain } = params;\n    const { collection, state, events } = this;\n    const { patches } = state;\n\n    const event = optimisticPatch.move;\n\n    if (event == null) {\n      return;\n    }\n\n    const { filtersKeyHash } = event;\n\n    const _initSequence = () => {\n      const { sequences } = this;\n      const seq =\n        sequences.get(filtersKeyHash) ??\n        new CollectionOptimisticSequenceExecutor({\n          showToast: collection.showToast,\n          translate: collection.translate,\n          errorMonitor: collection.errorMonitor,\n          onRollback: (err) => {\n            const pendingPatches = patches.filter(\n              (p) => p.move?.filtersKeyHash === filtersKeyHash,\n            );\n            this.rollback(pendingPatches);\n\n            if (\n              err instanceof Error &&\n              err.message === this.reorderModeCanceledMessage\n            ) {\n              executor.seq.clear();\n              return;\n            }\n\n            events.emit('dragAndDropSequenceError', {\n              patches: pendingPatches,\n            });\n            executor.seq.clear();\n\n            const requestId = isHttpError(err) ? err.requestId : undefined;\n\n            return {\n              message: collection.translate('cairo.dragAndDrop.error.toast'),\n              biName: 'cairo-drag-and-drop-submit-error',\n              details: requestId\n                ? {\n                    requestId,\n                  }\n                : undefined,\n              action: {\n                onClick: async () => {\n                  this.pushPatchAndReprocess(pendingPatches);\n                  for (const p of pendingPatches) {\n                    this.enqueueMovePatch(p, params);\n                  }\n                  events.emit('dragAndDropSequenceRetry', {\n                    patches: pendingPatches,\n                  });\n\n                  await onTryAgain?.();\n                },\n              },\n            };\n          },\n        });\n\n      if (!sequences.has(filtersKeyHash)) {\n        sequences.set(filtersKeyHash, seq);\n      }\n\n      return seq;\n    };\n\n    const executor = _initSequence();\n\n    executor.sequence({\n      submit: () => submit?.(event),\n      onEventuallyUpdated: optimisticPatch.onEventuallyUpdated,\n    });\n  }\n\n  async move<R>(event: ActionMove<T>, params: MoveParams<T, R>) {\n    const { collection, state } = this;\n    const { itemKey, result } = collection;\n    const { patches } = state;\n\n    const optimisticPatch = new OptimisticPatch({\n      queryCache: collection.queryCache,\n      queryNames: this._queryNames,\n      patches,\n      actionType: 'move',\n      patchedItems: new Map(),\n      originalItems: new Map(),\n      originalTotal: result.total,\n      selector: (item, { patchedItems }) => patchedItems.has(itemKey(item)),\n      move: event,\n      collectionSnapshot: params.collectionSnapshot,\n    });\n\n    this.pushPatchAndReprocess(optimisticPatch);\n\n    optimisticPatch.events.on(\n      'scheduleRemoval',\n      this._clearPatchOnNextResultOrUnmount,\n    );\n\n    this.enqueueMovePatch(optimisticPatch, params);\n  }\n\n  /**\n   * Updates a single item in the collection.\n   * @param item - The item to update.\n   * @param params - Additional parameters for the operation.\n   * @external\n   */\n  updateOne<R>(item: T, params: UpdateManyParams<T, R>) {\n    return this.updateMany([item], params);\n  }\n\n  /**\n   * > `updateAll(fn)` API is not recommended as it's not possible to calculate \"optimistic total\", prefer updateAll(patchObject) API if possible.\n   * Updates all items in the collection based on a function or a patch object.\n   * @param patchOrFn - A function or a patch object to apply to each item.\n   * @param params - Additional parameters for the operation.\n   */\n  updateAll<R>(\n    patchOrFn: (item: T) => Partial<T>,\n    params: UpdateAllParams<R>,\n  ): void;\n\n  /**\n   * Updates all items in the collection based on a patch object.\n   * @param patch - A patch object to apply to each item.\n   * @param params - Additional parameters for the operation.\n   * @external\n   */\n  updateAll<R>(patch: Partial<T>, params: UpdateAllParams<R>): void;\n\n  updateAll<R>(\n    patchOrFn: ((item: T) => Partial<T>) | Partial<T>,\n    params: UpdateAllParams<R>,\n  ) {\n    const { executor, collection, predicate, createdAt } = this;\n    const {\n      submit,\n      updateServerAfter,\n      keepPosition,\n      onUndo,\n      onTryAgain,\n      onError,\n    } = params;\n    const {\n      itemKey,\n      result: { originQuery, items, total },\n    } = collection;\n\n    const itemPredicate = predicate(originQuery);\n\n    const updatedAt = new Date();\n\n    const { patch, actionType } =\n      typeof patchOrFn === 'function'\n        ? { actionType: 'updateAll' as const, patch: patchOrFn }\n        : {\n            actionType: 'updateAllConst' as const,\n            patch: (item: T) => ({ ...item, ...patchOrFn }),\n          };\n\n    const optimisticPatch = new OptimisticPatch({\n      queryCache: collection.queryCache,\n      patches: this.state.patches,\n      actionType,\n      keepPosition,\n      queryNames: this._queryNames,\n      patchedItems: new Map(\n        items.map((item) => [itemKey(item), { ...item, ...patch(item) }]),\n      ),\n      originalItems: new Map(items.map((item) => [itemKey(item), item])),\n      originalTotal: total,\n      selector: (item) =>\n        itemPredicate(item) &&\n        (createdAt == null || createdAt(item) <= updatedAt),\n      patch,\n    });\n\n    this.pushPatchAndReprocess(optimisticPatch);\n\n    optimisticPatch.events.on(\n      'scheduleRemoval',\n      this._clearPatchOnNextResultOrUnmount,\n    );\n\n    executor.execute([optimisticPatch], {\n      ...params,\n      submit,\n      onRollback: () => {\n        this.rollback(optimisticPatch);\n      },\n      eventuallyUpdated: updateServerAfter,\n      onEventuallyUpdated: optimisticPatch.onEventuallyUpdated,\n      onTryAgain: async () => {\n        this.pushPatchAndReprocess(optimisticPatch);\n        await onTryAgain?.();\n      },\n      onError,\n      onUndo,\n    });\n  }\n\n  /**\n   * Deletes multiple items from the collection.\n   * @param items - An array of items to delete.\n   * @param params - Additional parameters for the delete operation.\n   * @external\n   */\n  deleteMany<R>(items: T[], params: DeleteManyParams<T, R>) {\n    const { executor, collection } = this;\n    const {\n      itemKey,\n      result: { total },\n    } = collection;\n    const { submit, updateServerAfter, onUndo, onTryAgain, onError } = params;\n\n    const patchedItems = new Map(items.map((item) => [itemKey(item), item]));\n\n    const optimisticPatch = new OptimisticPatch({\n      queryCache: collection.queryCache,\n      patches: this.state.patches,\n      actionType: 'deleteMany',\n      patchedItems,\n      queryNames: this._queryNames,\n      originalItems: patchedItems,\n      originalTotal: total,\n      selector: (item, { patchedItems }) => patchedItems.has(itemKey(item)),\n    });\n\n    this.pushPatchAndReprocess(optimisticPatch);\n\n    optimisticPatch.events.on(\n      'scheduleRemoval',\n      this._clearPatchOnNextResultOrUnmount,\n    );\n\n    executor.execute([optimisticPatch], {\n      ...params,\n      submit: action((actions) =>\n        submit(\n          Array.from(\n            actions\n              .filter(({ actionType }) => actionType === 'deleteMany')\n              .reduce((map, { patchedItemsEntries }) => {\n                for (const [key, item] of patchedItemsEntries) {\n                  map.set(key, item);\n                }\n                return map;\n              }, new Map<string, T>())\n              .values(),\n          ),\n        ),\n      ),\n      onRollback: () => {\n        this.rollback(optimisticPatch);\n      },\n      eventuallyUpdated: updateServerAfter,\n      onEventuallyUpdated: optimisticPatch.onEventuallyUpdated,\n      onTryAgain: async () => {\n        this.pushPatchAndReprocess(optimisticPatch);\n        await onTryAgain?.();\n      },\n      onError,\n      onUndo,\n    });\n  }\n\n  /**\n   * Deletes a single item from the collection.\n   * @param item - The item to delete.\n   * @param params - Additional parameters for the operation.\n   * @external\n   */\n  deleteOne<R>(item: T, params: DeleteManyParams<T, R>) {\n    return this.deleteMany([item], params);\n  }\n\n  /**\n   * Deletes all items from the collection.\n   * @param params - Additional parameters for the operation.\n   * @external\n   */\n  deleteAll<R>(params: UpdateAllParams<R>) {\n    const { executor, collection, predicate, createdAt } = this;\n    const { submit, updateServerAfter, onUndo, onTryAgain, onError } = params;\n    const {\n      itemKey,\n      result: { originQuery, items, total },\n    } = collection;\n\n    const itemPredicate = predicate(originQuery);\n\n    const updatedAt = new Date();\n\n    const patchedItems = new Map(items.map((item) => [itemKey(item), item]));\n\n    const optimisticPatch = new OptimisticPatch({\n      patches: this.state.patches,\n      queryCache: collection.queryCache,\n      actionType: 'deleteAll',\n      patchedItems,\n      queryNames: this._queryNames,\n      originalItems: patchedItems,\n      originalTotal: total,\n      selector: (item) =>\n        itemPredicate(item) &&\n        (createdAt == null || createdAt(item) <= updatedAt),\n    });\n\n    optimisticPatch.events.on(\n      'scheduleRemoval',\n      this._clearPatchOnNextResultOrUnmount,\n    );\n\n    this.pushPatchAndReprocess(optimisticPatch);\n\n    executor.execute([optimisticPatch], {\n      ...params,\n      submit,\n      onRollback: () => {\n        this.rollback(optimisticPatch);\n      },\n      eventuallyUpdated: updateServerAfter,\n      onEventuallyUpdated: optimisticPatch.onEventuallyUpdated,\n      onTryAgain: async () => {\n        this.pushPatchAndReprocess(optimisticPatch);\n        await onTryAgain?.();\n      },\n      onError,\n      onUndo,\n    });\n  }\n\n  initCollection(collection: CollectionState<T, F>) {\n    this.collections.push(collection);\n    new CollectionOptimisticProcessor({\n      collection,\n      optimistic: this,\n      orderBy: this.orderBy,\n      predicate: this.predicate,\n    });\n\n    return () => {\n      const i = this.collections.indexOf(collection);\n      if (i !== -1) {\n        this.collections.splice(i, 1);\n      }\n    };\n  }\n\n  init() {\n    const { collection, events } = this;\n\n    // The only case when this.state._patchesBeforeUnmount won't be null -\n    // when the state was cached with patterns router, so we want to restore the patches that were existed before the unmount\n    if (this.state._patchesBeforeUnmount) {\n      this.state.patches.clear();\n      this.state.patches.push(...this.state._patchesBeforeUnmount);\n    }\n\n    const emitRefresh = (params: { isStale: boolean }) => {\n      events.emit('refresh', params);\n    };\n    const emitBeforeResultUpdated = () => events.emit('beforeResultUpdated');\n\n    collection.emitter.on('refresh', emitRefresh);\n    collection.emitter.on('beforeResultUpdated', emitBeforeResultUpdated);\n\n    const disposers = [\n      reaction(\n        () => {\n          const checkUnprocessedFilteredOut = (() => {\n            const {\n              result: { _pages, _pagesAtom },\n            } = collection;\n            _pagesAtom.reportObserved();\n            const unprocessed =\n              _pages.unprocessed[_pages.unprocessed.length - 1];\n            const processed = _pages.processed[_pages.processed.length - 1];\n\n            if (unprocessed == null || processed == null) {\n              return false;\n            }\n            // check if some items in unprocessed were filtered out\n            return unprocessed.length > processed.length;\n          })();\n\n          const checkIsEmptyAndHasUnprocessed = (() => {\n            const {\n              result: { isEmpty, _pages },\n            } = collection;\n            const unprocessed = _pages.unprocessed.flatMap((page) => page);\n            return isEmpty && unprocessed.length > 0;\n          })();\n\n          return collection.emitter.listeners('triggerReachBottomListener')\n            .length\n            ? checkUnprocessedFilteredOut\n            : checkIsEmptyAndHasUnprocessed;\n        },\n        (_filteredOut) => {\n          if (!_filteredOut) {\n            return;\n          }\n\n          if (\n            collection.emitter.listeners('triggerReachBottomListener').length\n          ) {\n            if (\n              process.env.NODE_ENV === 'test' &&\n              (window as any).__CAIRO_TEST_TRIGGER_REACH_BOTTOM_LISTENER__\n            ) {\n              collection.emitter.emit('triggerReachBottomListener');\n            }\n          } else {\n            collection.fetchNextPageIfNeeded();\n          }\n        },\n      ),\n    ];\n\n    return () => {\n      collection.emitter.off('refresh', emitRefresh);\n      collection.emitter.off('beforeResultUpdated', emitBeforeResultUpdated);\n      disposers.forEach((disposer) => disposer());\n      this.state._patchesBeforeUnmount = this.state.patches.toJSON();\n      events.emit('unmount');\n    };\n  }\n\n  clear() {\n    const { patches } = this.state;\n    const remaining = patches.clear();\n    for (const patch of remaining) {\n      if (!patch.isStale) {\n        patches.push(patch);\n      }\n    }\n  }\n}\n"],"mappings":";;;;;;AACA,IAAAA,KAAA,GAAAC,OAAA;AASA,IAAAC,iCAAA,GAAAD,OAAA;AACA,IAAAE,8BAAA,GAAAF,OAAA;AACA,IAAAG,0BAAA,GAAAH,OAAA;AAIA,IAAAI,6BAAA,GAAAJ,OAAA;AACA,IAAAK,OAAA,GAAAL,OAAA;AACA,IAAAM,KAAA,GAAAN,OAAA;AACA,IAAAO,6BAAA,GAAAP,OAAA;AACA,IAAAQ,qCAAA,GAAAR,OAAA;AA8FO,MAAMS,2BAA2B,CAA0B;EAkChEC,WAAWA,CAACC,MAA+C,EAAE;IAAA,IAAAC,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA,kBA3B3C,IAAIC,oBAAY,CAAC,CAAC;IAAA,IAAAF,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA,sBAeyB,EAAE;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA,sCAIzB,uBAAuB;IAAA,IAAAD,gBAAA,CAAAC,OAAA,6BAEpB,IAAI;IAAA,IAAAD,gBAAA,CAAAC,OAAA,wBAEV,QAAQ;IAAA,IAAAD,gBAAA,CAAAC,OAAA,uBAE7B,KAAK;IAAA,IAAAD,gBAAA,CAAAC,OAAA,uBA4FG,IAAAE,YAAM,EAAEC,KAAyB,IAAK;MAC1D,MAAM;QACJC,KAAK;QACLC,UAAU;QACVC,WAAW;QACXC,YAAY;QACZC,UAAU;QACVC;MACF,CAAC,GAAG,IAAI;MAER,IAAIF,YAAY,EAAE;QAChB;MACF;MAEAH,KAAK,CAACM,OAAO,CAACC,MAAM,CAACR,KAAK,CAAC;MAC3B,IAAIM,WAAW,IAAI,CAACL,KAAK,CAACM,OAAO,CAACE,MAAM,EAAE;QACxCJ,UAAU,CAACK,OAAO,CAAC,CAAC;UAAEC;QAAiB,CAAC,KAAKA,gBAAgB,CAACC,MAAM,CAAC,CAAC,CAAC;MACzE;MACAV,UAAU,CAACW,UAAU,CAAC,CAAC;MACvBV,WAAW,CAACO,OAAO,CAAEI,CAAC,IAAKA,CAAC,CAACC,eAAe,CAAC,CAAC,CAAC;IACjD,CAAC,CAAC;IAAA,IAAAnB,gBAAA,CAAAC,OAAA,4CAEkCG,KAAyB,IAAK;MAChE,MAAM;QAAEgB;MAAO,CAAC,GAAG,IAAI;MAEvB,MAAMC,UAAU,GAAGA,CAAA,KAAM;QACvBD,MAAM,CAACE,GAAG,CAAC,SAAS,EAAED,UAAU,CAAC;QACjC,IAAI,CAACE,WAAW,CAACnB,KAAK,CAAC;MACzB,CAAC;MAED,MAAMoB,SAAS,GAAGA,CAAC;QAAEC;MAA8B,CAAC,KAAK;QACvDL,MAAM,CAACE,GAAG,CAAC,SAAS,EAAEE,SAAS,CAAC;;QAEhC;QACA,IAAIC,OAAO,EAAE;UACXL,MAAM,CAACM,IAAI,CAAC,qBAAqB,EAAEL,UAAU,CAAC;QAChD;MACF,CAAC;MAEDD,MAAM,CAACO,IAAI,CAAC,SAAS,CAAC;MAEtB,IAAI,IAAI,CAACjB,WAAW,EAAE;QACpB,IAAI,CAACa,WAAW,CAACnB,KAAK,CAAC;MACzB,CAAC,MAAM;QACL;QACAgB,MAAM,CAACQ,EAAE,CAAC,SAAS,EAAEJ,SAAS,CAAC;QAC/B;QACAJ,MAAM,CAACQ,EAAE,CAAC,SAAS,EAAEP,UAAU,CAAC;MAClC;IACF,CAAC;IA1IC,IAAI,CAACf,UAAU,GAAGP,MAAM,CAACO,UAAU;IACnC,IAAI,CAACuB,KAAK,GAAG9B,MAAM,CAAC8B,KAAK,IAAI,IAAI,CAACvB,UAAU,CAACuB,KAAK;IAClD,IAAI,CAACtB,WAAW,GAAGR,MAAM,CAACQ,WAAW,IAAI,EAAE;IAE3C,IAAI,CAACuB,SAAS,GACZ/B,MAAM,CAAC+B,SAAS,IAChB,IAAIC,GAAG,CAA+C,CAAC;IAEzD,IAAI,CAAC1B,KAAK,GAAG,IAAI2B,kEAAgC,CAAI;MACnDC,MAAM,EAAE,IAAI,CAAC3B,UAAU;MACvB4B,YAAY,EAAEnC,MAAM,CAACoC,SAAS,CAACD,YAAY;MAC3CE,cAAc,EAAErC,MAAM,CAACqC;IACzB,CAAC,CAAC;IAEF,IAAI,CAACC,uBAAuB,GAAG,IAAIC,0DAA4B,CAAC;MAC9DhC,UAAU,EAAE,IAAI,CAACA;IACnB,CAAC,CAAC;IAEF,IAAI,CAACiC,SAAS,GAAGxC,MAAM,CAACwC,SAAS,IAAI,IAAI,CAACF,uBAAuB,CAACE,SAAS;IAC3E,IAAI,CAACC,OAAO,GAAGzC,MAAM,CAACyC,OAAO,IAAI,IAAI,CAACH,uBAAuB,CAACG,OAAO;IACrE,IAAI,CAACC,SAAS,GAAG1C,MAAM,CAAC0C,SAAS;IACjC,IAAI,CAACjC,YAAY,GAAGT,MAAM,CAACS,YAAY;IAEvC,IAAI,CAACkC,QAAQ,GAAG,IAAIC,0DAA4B,CAAC;MAC/CC,SAAS,EAAE7C,MAAM,CAAC6C,SAAS,IAAI,CAAC;MAChCC,YAAY,EAAE,IAAI,CAACvC,UAAU,CAACuC,YAAY;MAC1CC,SAAS,EAAE,IAAI,CAACxC,UAAU,CAACwC,SAAS;MACpCC,SAAS,EAAE,IAAI,CAACzC,UAAU,CAACyC,SAAS;MACpCC,MAAM,EAAE,IAAI,CAAC1C,UAAU,CAAC0C,MAAM;MAC9Bb,SAAS,EAAEpC,MAAM,CAACoC;IACpB,CAAC,CAAC;IAEF,IAAI,CAAC1B,UAAU,CAACwC,IAAI,CAClB,IAAIC,4DAA6B,CAAC;MAChC,GAAGnD,MAAM;MACToD,UAAU,EAAE;IACd,CAAC,CACH,CAAC;IAED,IAAIpD,MAAM,CAACQ,WAAW,IAAI,IAAI,EAAE;MAC9BR,MAAM,CAACQ,WAAW,CAACO,OAAO,CAAER,UAAU,IAAK;QACzC,IAAI,CAACG,UAAU,CAACwC,IAAI,CAClB,IAAIC,4DAA6B,CAAC;UAChC,GAAGnD,MAAM;UACTO,UAAU;UACV6C,UAAU,EAAE;QACd,CAAC,CACH,CAAC;MACH,CAAC,CAAC;IACJ;IAEA,IAAI,CAAC7C,UAAU,CAAC8C,kBAAkB,GAAG,IAAI;IAEzC,IAAAC,oBAAc,EAAC,IAAI,EAAE;MACnBC,qBAAqB,EAAEnD,YAAM;MAC7BoD,wBAAwB,EAAEpD,YAAM;MAChCqD,QAAQ,EAAErD,YAAM,CAACsD,KAAK;MACtBC,KAAK,EAAEvD,YAAM;MACbwD,IAAI,EAAExD,YAAM;MACZyD,kBAAkB,EAAEC;IACtB,CAAC,CAAC;EACJ;EAEA,IAAIC,WAAWA,CAAA,EAAG;IAChB,OAAO,CACL,IAAI,CAACxD,UAAU,CAACyD,SAAS,EACzB,GAAG,IAAI,CAACxD,WAAW,CAACyD,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACF,SAAS,CAAC,CAC5C;EACH;EAEA,IAAIG,kBAAkBA,CAAA,EAAG;IACvB,OAAOC,KAAK,CAACC,IAAI,CAAC,IAAI,CAACtC,SAAS,CAACuC,MAAM,CAAC,CAAC,CAAC,CAACC,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,GAAG,CAACnE,KAAK,CAACoE,OAAO,CAAC;EAC7E;EAEA,IAAIb,kBAAkBA,CAAA,EAAG;IACvB,OAAO,IAAI,CAACvD,KAAK,CAACM,OAAO,CAAC+D,MAAM,CAAExD,CAAC,IAAKA,CAAC,CAACyC,IAAI,CAAC;EACjD;EAEAH,QAAQA,CAACpD,KAAgD,EAAE;IACzD,MAAM;MAAEgB,MAAM;MAAEf;IAAM,CAAC,GAAG,IAAI;IAC9B,MAAMM,OAAO,GAAGwD,KAAK,CAACQ,OAAO,CAACvE,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC;IAEtD,KAAK,MAAMc,CAAC,IAAIP,OAAO,EAAE;MACvBN,KAAK,CAACM,OAAO,CAACC,MAAM,CAACM,CAAC,CAAC;IACzB;IAEAE,MAAM,CAACO,IAAI,CAAC,WAAW,CAAC;EAC1B;EAqDA2B,qBAAqBA,CAAClD,KAAgD,EAAE;IACtE,MAAM;MAAEC,KAAK;MAAEe;IAAO,CAAC,GAAG,IAAI;IAC9B,MAAMT,OAAO,GAAGwD,KAAK,CAACQ,OAAO,CAACvE,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC;IACtDC,KAAK,CAACM,OAAO,CAACsC,IAAI,CAAC,GAAGtC,OAAO,CAAC;IAC9BS,MAAM,CAACO,IAAI,CAAC,WAAW,CAAC;EAC1B;EAEA4B,wBAAwBA,CACtBqB,QAA4B,EAC5BC,QAA4B,EAC5B;IACA,MAAM;MAAExE,KAAK;MAAEe;IAAO,CAAC,GAAG,IAAI;IAE9B,MAAM0D,aAAa,GAAGzE,KAAK,CAACM,OAAO,CAACoE,SAAS,CAC1C3E,KAAK,IAAKA,KAAK,KAAKyE,QACvB,CAAC;IACDxE,KAAK,CAACM,OAAO,CAACmE,aAAa,CAAC,GAAGF,QAAQ;IACvCxD,MAAM,CAACO,IAAI,CAAC,WAAW,CAAC;EAC1B;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEqD,SAASA,CAACC,IAAO,EAAElF,MAA2B,EAAE;IAC9C,OAAO,IAAI,CAACmF,UAAU,CAAC,CAACD,IAAI,CAAC,EAAElF,MAAM,CAAC;EACxC;;EAEA;AACF;AACA;AACA;AACA;AACA;EACEmF,UAAUA,CAACC,KAAU,EAAEpF,MAA2B,EAAE;IAClD,MAAM;MAAEO,UAAU;MAAEoC;IAAS,CAAC,GAAG,IAAI;IACrC,MAAM;MAAE0C,OAAO;MAAEC;IAAO,CAAC,GAAG/E,UAAU;IACtC,MAAM;MAAEgF,MAAM;MAAEC,iBAAiB;MAAEC,MAAM;MAAEC,UAAU;MAAEC;IAAQ,CAAC,GAAG3F,MAAM;IAEzE,MAAM4F,qBAA+C,GAAG;MACtDC,UAAU,EAAEtF,UAAU,CAACsF,UAAU;MACjCC,UAAU,EAAE,IAAI,CAAC/B,WAAW;MAC5BnD,OAAO,EAAE,IAAI,CAACN,KAAK,CAACM,OAAO;MAC3BmF,UAAU,EAAE,YAAY;MACxBC,YAAY,EAAE,IAAIhE,GAAG,CAACoD,KAAK,CAACnB,GAAG,CAAEiB,IAAI,IAAK,CAACG,OAAO,CAACH,IAAI,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC;MACjEe,aAAa,EAAE,IAAIjE,GAAG,CAAC,CAAC;MACxBkE,aAAa,EAAEZ,MAAM,CAACa,KAAK;MAC3B9F,KAAK,EAAEA,CAAC6E,IAAI,EAAE;QAAEc;MAAa,CAAC,KAAKA,YAAY,CAACI,GAAG,CAACf,OAAO,CAACH,IAAI,CAAC,CAAC;MAClEmB,QAAQ,EAAEA,CAACnB,IAAI,EAAE;QAAEc;MAAa,CAAC,KAAKA,YAAY,CAACM,GAAG,CAACjB,OAAO,CAACH,IAAI,CAAC;IACtE,CAAC;IAED,MAAMqB,eAAe,GAAG,IAAIC,0CAAe,CAAIZ,qBAAqB,CAAC;IAErE,IAAI,CAACrC,qBAAqB,CAACgD,eAAe,CAAC;IAE3CA,eAAe,CAAClF,MAAM,CAACQ,EAAE,CACvB,iBAAiB,EACjB,IAAI,CAAC4E,gCACP,CAAC;IAED,OAAO9D,QAAQ,CAAC+D,OAAO,CAAC,CAACH,eAAe,CAAC,EAAE;MACzC,GAAGvG,MAAM;MACTuF,MAAM,EAAE,IAAAnF,YAAM,EAAC,MAAOuG,OAAO,IAAK;QAChC,MAAMC,YAAY,GAAG,MAAMrB,MAAM,CAC/BnB,KAAK,CAACC,IAAI,CACRsC,OAAO,CACJhC,MAAM,CAAC,CAAC;UAAEoB;QAAW,CAAC,KAAKA,UAAU,KAAK,YAAY,CAAC,CACvDc,MAAM,CAAC,CAAC5C,GAAG,EAAE;UAAE6C;QAAoB,CAAC,KAAK;UACxC,KAAK,MAAM,CAACC,GAAG,EAAE7B,IAAI,CAAC,IAAI4B,mBAAmB,EAAE;YAC7C7C,GAAG,CAAC+C,GAAG,CAACD,GAAG,EAAE7B,IAAI,CAAC;UACpB;UACA,OAAOjB,GAAG;QACZ,CAAC,EAAE,IAAIjC,GAAG,CAAY,CAAC,CAAC,CACvBsC,MAAM,CAAC,CACZ,CACF,CAAC;QAED,IAAI,CAACsC,YAAY,EAAE;UACjB;QACF;QAEA,MAAMK,sBAAsB,GAAG,IAAIT,0CAAe,CAAC;UACjD,GAAGZ,qBAAqB;UACxBI,YAAY,EAAE,IAAIhE,GAAG,CACnB4E,YAAY,CAAC3C,GAAG,CAAEiB,IAAI,IAAK,CAACG,OAAO,CAACH,IAAI,CAAC,EAAEA,IAAI,CAAC,CAClD;QACF,CAAC,CAAC;QAEF,IAAI,CAAC1B,wBAAwB,CAACyD,sBAAsB,EAAEV,eAAe,CAAC;QACtE,IAAI,CAACE,gCAAgC,CAACQ,sBAAsB,CAAC;QAC7D,OAAOL,YAAY;MACrB,CAAC,CAAC;MACFM,UAAU,EAAEA,CAAA,KAAM;QAChB,IAAI,CAACzD,QAAQ,CAAC8C,eAAe,CAAC;MAChC,CAAC;MACDY,iBAAiB,EAAE3B,iBAAiB;MACpC4B,mBAAmB,EAAEb,eAAe,CAACa,mBAAmB;MACxD1B,UAAU,EAAE,MAAAA,CAAA,KAAY;QACtB,IAAI,CAACnC,qBAAqB,CAACgD,eAAe,CAAC;QAC3C,OAAMb,UAAU,oBAAVA,UAAU,CAAG,CAAC;MACtB,CAAC;MACDC,OAAO;MACPF;IACF,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE4B,UAAUA,CAAIjC,KAAU,EAAEpF,MAA8B,EAAE;IACxD,MAAM;MAAE2C,QAAQ;MAAEpC;IAAW,CAAC,GAAG,IAAI;IACrC,MAAM;MAAE8E,OAAO;MAAEC;IAAO,CAAC,GAAG/E,UAAU;IACtC,MAAM;MACJgF,MAAM;MACNC,iBAAiB;MACjB8B,YAAY;MACZ7B,MAAM;MACNC,UAAU;MACVC;IACF,CAAC,GAAG3F,MAAM;IAEV,MAAMuG,eAAe,GAAG,IAAIC,0CAAe,CAAC;MAC1CX,UAAU,EAAEtF,UAAU,CAACsF,UAAU;MACjCC,UAAU,EAAE,IAAI,CAAC/B,WAAW;MAC5BnD,OAAO,EAAE,IAAI,CAACN,KAAK,CAACM,OAAO;MAC3BmF,UAAU,EAAE,YAAY;MACxBuB,YAAY;MACZtB,YAAY,EAAE,IAAIhE,GAAG,CAACoD,KAAK,CAACnB,GAAG,CAAEiB,IAAI,IAAK,CAACG,OAAO,CAACH,IAAI,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC;MACjEe,aAAa,EAAE,IAAIjE,GAAG,CACpBoD,KAAK,CAACnB,GAAG,CAAEiB,IAAI,IAAK;QAAA,IAAAqC,WAAA;QAClB,MAAMR,GAAG,GAAG1B,OAAO,CAACH,IAAI,CAAC;QACzB,MAAMsC,YAAY,GAAG,EAAAD,WAAA,GAAAjC,MAAM,CAACc,GAAG,CAACf,OAAO,CAACH,IAAI,CAAC,CAAC,qBAAzBqC,WAAA,CAA2BrC,IAAI,KAAIA,IAAI;QAC5D,OAAO,CAAC6B,GAAG,EAAES,YAAY,CAAC;MAC5B,CAAC,CACH,CAAC;MACDtB,aAAa,EAAEZ,MAAM,CAACa,KAAK;MAC3B9F,KAAK,EAAEA,CAAC6E,IAAI,EAAE;QAAEc;MAAa,CAAC,KAAKA,YAAY,CAACI,GAAG,CAACf,OAAO,CAACH,IAAI,CAAC,CAAC;MAClEmB,QAAQ,EAAEA,CAACnB,IAAI,EAAE;QAAEc;MAAa,CAAC,KAAKA,YAAY,CAACM,GAAG,CAACjB,OAAO,CAACH,IAAI,CAAC;IACtE,CAAC,CAAC;IAEF,IAAI,CAAC3B,qBAAqB,CAACgD,eAAe,CAAC;IAE3CA,eAAe,CAAClF,MAAM,CAACQ,EAAE,CACvB,iBAAiB,EACjB,IAAI,CAAC4E,gCACP,CAAC;IAED,OAAO9D,QAAQ,CAAC+D,OAAO,CAAC,CAACH,eAAe,CAAC,EAAE;MACzC,GAAGvG,MAAM;MACTuF,MAAM,EAAE,IAAAnF,YAAM,EAAEuG,OAAO,IACrBpB,MAAM,CACJnB,KAAK,CAACC,IAAI,CACRsC,OAAO,CACJhC,MAAM,CAAC,CAAC;QAAEoB;MAAW,CAAC,KAAKA,UAAU,KAAK,YAAY,CAAC,CACvDc,MAAM,CAAC,CAAC5C,GAAG,EAAE;QAAE6C;MAAoB,CAAC,KAAK;QACxC,KAAK,MAAM,CAACC,GAAG,EAAE7B,IAAI,CAAC,IAAI4B,mBAAmB,EAAE;UAC7C7C,GAAG,CAAC+C,GAAG,CAACD,GAAG,EAAE7B,IAAI,CAAC;QACpB;QACA,OAAOjB,GAAG;MACZ,CAAC,EAAE,IAAIjC,GAAG,CAAY,CAAC,CAAC,CACvBsC,MAAM,CAAC,CACZ,CACF,CACF,CAAC;MACD4C,UAAU,EAAEA,CAAA,KAAM;QAChB,IAAI,CAACzD,QAAQ,CAAC8C,eAAe,CAAC;MAChC,CAAC;MACDY,iBAAiB,EAAE3B,iBAAiB;MACpC4B,mBAAmB,EAAEb,eAAe,CAACa,mBAAmB;MACxD1B,UAAU,EAAE,MAAAA,CAAA,KAAY;QACtB,IAAI,CAACnC,qBAAqB,CAACgD,eAAe,CAAC;QAC3C,OAAMb,UAAU,oBAAVA,UAAU,CAAG,CAAC;MACtB,CAAC;MACDC,OAAO;MACPF;IACF,CAAC,CAAC;EACJ;EAEAgC,gBAAgBA,CACdlB,eAAmC,EACnCvG,MAAwB,EACxB;IACA,MAAM;MAAEuF,MAAM;MAAEG;IAAW,CAAC,GAAG1F,MAAM;IACrC,MAAM;MAAEO,UAAU;MAAED,KAAK;MAAEe;IAAO,CAAC,GAAG,IAAI;IAC1C,MAAM;MAAET;IAAQ,CAAC,GAAGN,KAAK;IAEzB,MAAMoH,KAAK,GAAGnB,eAAe,CAAC3C,IAAI;IAElC,IAAI8D,KAAK,IAAI,IAAI,EAAE;MACjB;IACF;IAEA,MAAM;MAAEC;IAAe,CAAC,GAAGD,KAAK;IAEhC,MAAME,aAAa,GAAGA,CAAA,KAAM;MAC1B,MAAM;QAAE7F;MAAU,CAAC,GAAG,IAAI;MAC1B,MAAM0C,GAAG,GACP1C,SAAS,CAACqE,GAAG,CAACuB,cAAc,CAAC,IAC7B,IAAIE,0EAAoC,CAAC;QACvC9E,SAAS,EAAExC,UAAU,CAACwC,SAAS;QAC/BC,SAAS,EAAEzC,UAAU,CAACyC,SAAS;QAC/BF,YAAY,EAAEvC,UAAU,CAACuC,YAAY;QACrCoE,UAAU,EAAGY,GAAG,IAAK;UACnB,MAAMC,cAAc,GAAGnH,OAAO,CAAC+D,MAAM,CAClCxD,CAAC;YAAA,IAAA6G,OAAA;YAAA,OAAK,EAAAA,OAAA,GAAA7G,CAAC,CAACyC,IAAI,qBAANoE,OAAA,CAAQL,cAAc,MAAKA,cAAc;UAAA,CAClD,CAAC;UACD,IAAI,CAAClE,QAAQ,CAACsE,cAAc,CAAC;UAE7B,IACED,GAAG,YAAYG,KAAK,IACpBH,GAAG,CAACI,OAAO,KAAK,IAAI,CAACC,0BAA0B,EAC/C;YACAxF,QAAQ,CAAC8B,GAAG,CAACd,KAAK,CAAC,CAAC;YACpB;UACF;UAEAtC,MAAM,CAACO,IAAI,CAAC,0BAA0B,EAAE;YACtChB,OAAO,EAAEmH;UACX,CAAC,CAAC;UACFpF,QAAQ,CAAC8B,GAAG,CAACd,KAAK,CAAC,CAAC;UAEpB,MAAMyE,SAAS,GAAG,IAAAC,iBAAW,EAACP,GAAG,CAAC,GAAGA,GAAG,CAACM,SAAS,GAAGE,SAAS;UAE9D,OAAO;YACLJ,OAAO,EAAE3H,UAAU,CAACyC,SAAS,CAAC,+BAA+B,CAAC;YAC9DuF,MAAM,EAAE,kCAAkC;YAC1CC,OAAO,EAAEJ,SAAS,GACd;cACEA;YACF,CAAC,GACDE,SAAS;YACblI,MAAM,EAAE;cACNqI,OAAO,EAAE,MAAAA,CAAA,KAAY;gBACnB,IAAI,CAAClF,qBAAqB,CAACwE,cAAc,CAAC;gBAC1C,KAAK,MAAM5G,CAAC,IAAI4G,cAAc,EAAE;kBAC9B,IAAI,CAACN,gBAAgB,CAACtG,CAAC,EAAEnB,MAAM,CAAC;gBAClC;gBACAqB,MAAM,CAACO,IAAI,CAAC,0BAA0B,EAAE;kBACtChB,OAAO,EAAEmH;gBACX,CAAC,CAAC;gBAEF,OAAMrC,UAAU,oBAAVA,UAAU,CAAG,CAAC;cACtB;YACF;UACF,CAAC;QACH;MACF,CAAC,CAAC;MAEJ,IAAI,CAAC3D,SAAS,CAACuE,GAAG,CAACqB,cAAc,CAAC,EAAE;QAClC5F,SAAS,CAACiF,GAAG,CAACW,cAAc,EAAElD,GAAG,CAAC;MACpC;MAEA,OAAOA,GAAG;IACZ,CAAC;IAED,MAAM9B,QAAQ,GAAGiF,aAAa,CAAC,CAAC;IAEhCjF,QAAQ,CAAC+F,QAAQ,CAAC;MAChBnD,MAAM,EAAEA,CAAA,KAAMA,MAAM,oBAANA,MAAM,CAAGmC,KAAK,CAAC;MAC7BN,mBAAmB,EAAEb,eAAe,CAACa;IACvC,CAAC,CAAC;EACJ;EAEA,MAAMxD,IAAIA,CAAI8D,KAAoB,EAAE1H,MAAwB,EAAE;IAC5D,MAAM;MAAEO,UAAU;MAAED;IAAM,CAAC,GAAG,IAAI;IAClC,MAAM;MAAE+E,OAAO;MAAEC;IAAO,CAAC,GAAG/E,UAAU;IACtC,MAAM;MAAEK;IAAQ,CAAC,GAAGN,KAAK;IAEzB,MAAMiG,eAAe,GAAG,IAAIC,0CAAe,CAAC;MAC1CX,UAAU,EAAEtF,UAAU,CAACsF,UAAU;MACjCC,UAAU,EAAE,IAAI,CAAC/B,WAAW;MAC5BnD,OAAO;MACPmF,UAAU,EAAE,MAAM;MAClBC,YAAY,EAAE,IAAIhE,GAAG,CAAC,CAAC;MACvBiE,aAAa,EAAE,IAAIjE,GAAG,CAAC,CAAC;MACxBkE,aAAa,EAAEZ,MAAM,CAACa,KAAK;MAC3BE,QAAQ,EAAEA,CAACnB,IAAI,EAAE;QAAEc;MAAa,CAAC,KAAKA,YAAY,CAACM,GAAG,CAACjB,OAAO,CAACH,IAAI,CAAC,CAAC;MACrEtB,IAAI,EAAE8D,KAAK;MACXiB,kBAAkB,EAAE3I,MAAM,CAAC2I;IAC7B,CAAC,CAAC;IAEF,IAAI,CAACpF,qBAAqB,CAACgD,eAAe,CAAC;IAE3CA,eAAe,CAAClF,MAAM,CAACQ,EAAE,CACvB,iBAAiB,EACjB,IAAI,CAAC4E,gCACP,CAAC;IAED,IAAI,CAACgB,gBAAgB,CAAClB,eAAe,EAAEvG,MAAM,CAAC;EAChD;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE4I,SAASA,CAAI1D,IAAO,EAAElF,MAA8B,EAAE;IACpD,OAAO,IAAI,CAACqH,UAAU,CAAC,CAACnC,IAAI,CAAC,EAAElF,MAAM,CAAC;EACxC;;EAEA;AACF;AACA;AACA;AACA;AACA;;EAME;AACF;AACA;AACA;AACA;AACA;;EAGE6I,SAASA,CACPC,SAAiD,EACjD9I,MAA0B,EAC1B;IACA,MAAM;MAAE2C,QAAQ;MAAEpC,UAAU;MAAEiC,SAAS;MAAEE;IAAU,CAAC,GAAG,IAAI;IAC3D,MAAM;MACJ6C,MAAM;MACNC,iBAAiB;MACjB8B,YAAY;MACZ7B,MAAM;MACNC,UAAU;MACVC;IACF,CAAC,GAAG3F,MAAM;IACV,MAAM;MACJqF,OAAO;MACPC,MAAM,EAAE;QAAEyD,WAAW;QAAE3D,KAAK;QAAEe;MAAM;IACtC,CAAC,GAAG5F,UAAU;IAEd,MAAMyI,aAAa,GAAGxG,SAAS,CAACuG,WAAW,CAAC;IAE5C,MAAME,SAAS,GAAG,IAAIC,IAAI,CAAC,CAAC;IAE5B,MAAM;MAAE7I,KAAK;MAAE0F;IAAW,CAAC,GACzB,OAAO+C,SAAS,KAAK,UAAU,GAC3B;MAAE/C,UAAU,EAAE,WAAoB;MAAE1F,KAAK,EAAEyI;IAAU,CAAC,GACtD;MACE/C,UAAU,EAAE,gBAAyB;MACrC1F,KAAK,EAAG6E,IAAO,KAAM;QAAE,GAAGA,IAAI;QAAE,GAAG4D;MAAU,CAAC;IAChD,CAAC;IAEP,MAAMvC,eAAe,GAAG,IAAIC,0CAAe,CAAC;MAC1CX,UAAU,EAAEtF,UAAU,CAACsF,UAAU;MACjCjF,OAAO,EAAE,IAAI,CAACN,KAAK,CAACM,OAAO;MAC3BmF,UAAU;MACVuB,YAAY;MACZxB,UAAU,EAAE,IAAI,CAAC/B,WAAW;MAC5BiC,YAAY,EAAE,IAAIhE,GAAG,CACnBoD,KAAK,CAACnB,GAAG,CAAEiB,IAAI,IAAK,CAACG,OAAO,CAACH,IAAI,CAAC,EAAE;QAAE,GAAGA,IAAI;QAAE,GAAG7E,KAAK,CAAC6E,IAAI;MAAE,CAAC,CAAC,CAClE,CAAC;MACDe,aAAa,EAAE,IAAIjE,GAAG,CAACoD,KAAK,CAACnB,GAAG,CAAEiB,IAAI,IAAK,CAACG,OAAO,CAACH,IAAI,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC;MAClEgB,aAAa,EAAEC,KAAK;MACpBE,QAAQ,EAAGnB,IAAI,IACb8D,aAAa,CAAC9D,IAAI,CAAC,KAClBxC,SAAS,IAAI,IAAI,IAAIA,SAAS,CAACwC,IAAI,CAAC,IAAI+D,SAAS,CAAC;MACrD5I;IACF,CAAC,CAAC;IAEF,IAAI,CAACkD,qBAAqB,CAACgD,eAAe,CAAC;IAE3CA,eAAe,CAAClF,MAAM,CAACQ,EAAE,CACvB,iBAAiB,EACjB,IAAI,CAAC4E,gCACP,CAAC;IAED9D,QAAQ,CAAC+D,OAAO,CAAC,CAACH,eAAe,CAAC,EAAE;MAClC,GAAGvG,MAAM;MACTuF,MAAM;MACN2B,UAAU,EAAEA,CAAA,KAAM;QAChB,IAAI,CAACzD,QAAQ,CAAC8C,eAAe,CAAC;MAChC,CAAC;MACDY,iBAAiB,EAAE3B,iBAAiB;MACpC4B,mBAAmB,EAAEb,eAAe,CAACa,mBAAmB;MACxD1B,UAAU,EAAE,MAAAA,CAAA,KAAY;QACtB,IAAI,CAACnC,qBAAqB,CAACgD,eAAe,CAAC;QAC3C,OAAMb,UAAU,oBAAVA,UAAU,CAAG,CAAC;MACtB,CAAC;MACDC,OAAO;MACPF;IACF,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE0D,UAAUA,CAAI/D,KAAU,EAAEpF,MAA8B,EAAE;IACxD,MAAM;MAAE2C,QAAQ;MAAEpC;IAAW,CAAC,GAAG,IAAI;IACrC,MAAM;MACJ8E,OAAO;MACPC,MAAM,EAAE;QAAEa;MAAM;IAClB,CAAC,GAAG5F,UAAU;IACd,MAAM;MAAEgF,MAAM;MAAEC,iBAAiB;MAAEC,MAAM;MAAEC,UAAU;MAAEC;IAAQ,CAAC,GAAG3F,MAAM;IAEzE,MAAMgG,YAAY,GAAG,IAAIhE,GAAG,CAACoD,KAAK,CAACnB,GAAG,CAAEiB,IAAI,IAAK,CAACG,OAAO,CAACH,IAAI,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC;IAExE,MAAMqB,eAAe,GAAG,IAAIC,0CAAe,CAAC;MAC1CX,UAAU,EAAEtF,UAAU,CAACsF,UAAU;MACjCjF,OAAO,EAAE,IAAI,CAACN,KAAK,CAACM,OAAO;MAC3BmF,UAAU,EAAE,YAAY;MACxBC,YAAY;MACZF,UAAU,EAAE,IAAI,CAAC/B,WAAW;MAC5BkC,aAAa,EAAED,YAAY;MAC3BE,aAAa,EAAEC,KAAK;MACpBE,QAAQ,EAAEA,CAACnB,IAAI,EAAE;QAAEc;MAAa,CAAC,KAAKA,YAAY,CAACM,GAAG,CAACjB,OAAO,CAACH,IAAI,CAAC;IACtE,CAAC,CAAC;IAEF,IAAI,CAAC3B,qBAAqB,CAACgD,eAAe,CAAC;IAE3CA,eAAe,CAAClF,MAAM,CAACQ,EAAE,CACvB,iBAAiB,EACjB,IAAI,CAAC4E,gCACP,CAAC;IAED9D,QAAQ,CAAC+D,OAAO,CAAC,CAACH,eAAe,CAAC,EAAE;MAClC,GAAGvG,MAAM;MACTuF,MAAM,EAAE,IAAAnF,YAAM,EAAEuG,OAAO,IACrBpB,MAAM,CACJnB,KAAK,CAACC,IAAI,CACRsC,OAAO,CACJhC,MAAM,CAAC,CAAC;QAAEoB;MAAW,CAAC,KAAKA,UAAU,KAAK,YAAY,CAAC,CACvDc,MAAM,CAAC,CAAC5C,GAAG,EAAE;QAAE6C;MAAoB,CAAC,KAAK;QACxC,KAAK,MAAM,CAACC,GAAG,EAAE7B,IAAI,CAAC,IAAI4B,mBAAmB,EAAE;UAC7C7C,GAAG,CAAC+C,GAAG,CAACD,GAAG,EAAE7B,IAAI,CAAC;QACpB;QACA,OAAOjB,GAAG;MACZ,CAAC,EAAE,IAAIjC,GAAG,CAAY,CAAC,CAAC,CACvBsC,MAAM,CAAC,CACZ,CACF,CACF,CAAC;MACD4C,UAAU,EAAEA,CAAA,KAAM;QAChB,IAAI,CAACzD,QAAQ,CAAC8C,eAAe,CAAC;MAChC,CAAC;MACDY,iBAAiB,EAAE3B,iBAAiB;MACpC4B,mBAAmB,EAAEb,eAAe,CAACa,mBAAmB;MACxD1B,UAAU,EAAE,MAAAA,CAAA,KAAY;QACtB,IAAI,CAACnC,qBAAqB,CAACgD,eAAe,CAAC;QAC3C,OAAMb,UAAU,oBAAVA,UAAU,CAAG,CAAC;MACtB,CAAC;MACDC,OAAO;MACPF;IACF,CAAC,CAAC;EACJ;;EAEA;AACF;AACA;AACA;AACA;AACA;EACE2D,SAASA,CAAIlE,IAAO,EAAElF,MAA8B,EAAE;IACpD,OAAO,IAAI,CAACmJ,UAAU,CAAC,CAACjE,IAAI,CAAC,EAAElF,MAAM,CAAC;EACxC;;EAEA;AACF;AACA;AACA;AACA;EACEqJ,SAASA,CAAIrJ,MAA0B,EAAE;IACvC,MAAM;MAAE2C,QAAQ;MAAEpC,UAAU;MAAEiC,SAAS;MAAEE;IAAU,CAAC,GAAG,IAAI;IAC3D,MAAM;MAAE6C,MAAM;MAAEC,iBAAiB;MAAEC,MAAM;MAAEC,UAAU;MAAEC;IAAQ,CAAC,GAAG3F,MAAM;IACzE,MAAM;MACJqF,OAAO;MACPC,MAAM,EAAE;QAAEyD,WAAW;QAAE3D,KAAK;QAAEe;MAAM;IACtC,CAAC,GAAG5F,UAAU;IAEd,MAAMyI,aAAa,GAAGxG,SAAS,CAACuG,WAAW,CAAC;IAE5C,MAAME,SAAS,GAAG,IAAIC,IAAI,CAAC,CAAC;IAE5B,MAAMlD,YAAY,GAAG,IAAIhE,GAAG,CAACoD,KAAK,CAACnB,GAAG,CAAEiB,IAAI,IAAK,CAACG,OAAO,CAACH,IAAI,CAAC,EAAEA,IAAI,CAAC,CAAC,CAAC;IAExE,MAAMqB,eAAe,GAAG,IAAIC,0CAAe,CAAC;MAC1C5F,OAAO,EAAE,IAAI,CAACN,KAAK,CAACM,OAAO;MAC3BiF,UAAU,EAAEtF,UAAU,CAACsF,UAAU;MACjCE,UAAU,EAAE,WAAW;MACvBC,YAAY;MACZF,UAAU,EAAE,IAAI,CAAC/B,WAAW;MAC5BkC,aAAa,EAAED,YAAY;MAC3BE,aAAa,EAAEC,KAAK;MACpBE,QAAQ,EAAGnB,IAAI,IACb8D,aAAa,CAAC9D,IAAI,CAAC,KAClBxC,SAAS,IAAI,IAAI,IAAIA,SAAS,CAACwC,IAAI,CAAC,IAAI+D,SAAS;IACtD,CAAC,CAAC;IAEF1C,eAAe,CAAClF,MAAM,CAACQ,EAAE,CACvB,iBAAiB,EACjB,IAAI,CAAC4E,gCACP,CAAC;IAED,IAAI,CAAClD,qBAAqB,CAACgD,eAAe,CAAC;IAE3C5D,QAAQ,CAAC+D,OAAO,CAAC,CAACH,eAAe,CAAC,EAAE;MAClC,GAAGvG,MAAM;MACTuF,MAAM;MACN2B,UAAU,EAAEA,CAAA,KAAM;QAChB,IAAI,CAACzD,QAAQ,CAAC8C,eAAe,CAAC;MAChC,CAAC;MACDY,iBAAiB,EAAE3B,iBAAiB;MACpC4B,mBAAmB,EAAEb,eAAe,CAACa,mBAAmB;MACxD1B,UAAU,EAAE,MAAAA,CAAA,KAAY;QACtB,IAAI,CAACnC,qBAAqB,CAACgD,eAAe,CAAC;QAC3C,OAAMb,UAAU,oBAAVA,UAAU,CAAG,CAAC;MACtB,CAAC;MACDC,OAAO;MACPF;IACF,CAAC,CAAC;EACJ;EAEA6D,cAAcA,CAAC/I,UAAiC,EAAE;IAChD,IAAI,CAACC,WAAW,CAAC0C,IAAI,CAAC3C,UAAU,CAAC;IACjC,IAAI4C,4DAA6B,CAAC;MAChC5C,UAAU;MACV6C,UAAU,EAAE,IAAI;MAChBX,OAAO,EAAE,IAAI,CAACA,OAAO;MACrBD,SAAS,EAAE,IAAI,CAACA;IAClB,CAAC,CAAC;IAEF,OAAO,MAAM;MACX,MAAM+G,CAAC,GAAG,IAAI,CAAC/I,WAAW,CAACgJ,OAAO,CAACjJ,UAAU,CAAC;MAC9C,IAAIgJ,CAAC,KAAK,CAAC,CAAC,EAAE;QACZ,IAAI,CAAC/I,WAAW,CAACiJ,MAAM,CAACF,CAAC,EAAE,CAAC,CAAC;MAC/B;IACF,CAAC;EACH;EAEAG,IAAIA,CAAA,EAAG;IACL,MAAM;MAAEnJ,UAAU;MAAEc;IAAO,CAAC,GAAG,IAAI;;IAEnC;IACA;IACA,IAAI,IAAI,CAACf,KAAK,CAACqJ,qBAAqB,EAAE;MACpC,IAAI,CAACrJ,KAAK,CAACM,OAAO,CAAC+C,KAAK,CAAC,CAAC;MAC1B,IAAI,CAACrD,KAAK,CAACM,OAAO,CAACsC,IAAI,CAAC,GAAG,IAAI,CAAC5C,KAAK,CAACqJ,qBAAqB,CAAC;IAC9D;IAEA,MAAMC,WAAW,GAAI5J,MAA4B,IAAK;MACpDqB,MAAM,CAACO,IAAI,CAAC,SAAS,EAAE5B,MAAM,CAAC;IAChC,CAAC;IACD,MAAM6J,uBAAuB,GAAGA,CAAA,KAAMxI,MAAM,CAACO,IAAI,CAAC,qBAAqB,CAAC;IAExErB,UAAU,CAACuJ,OAAO,CAACjI,EAAE,CAAC,SAAS,EAAE+H,WAAW,CAAC;IAC7CrJ,UAAU,CAACuJ,OAAO,CAACjI,EAAE,CAAC,qBAAqB,EAAEgI,uBAAuB,CAAC;IAErE,MAAME,SAAS,GAAG,CAChB,IAAAC,cAAQ,EACN,MAAM;MACJ,MAAMC,2BAA2B,GAAG,CAAC,MAAM;QACzC,MAAM;UACJ3E,MAAM,EAAE;YAAE4E,MAAM;YAAEC;UAAW;QAC/B,CAAC,GAAG5J,UAAU;QACd4J,UAAU,CAACC,cAAc,CAAC,CAAC;QAC3B,MAAMC,WAAW,GACfH,MAAM,CAACG,WAAW,CAACH,MAAM,CAACG,WAAW,CAACvJ,MAAM,GAAG,CAAC,CAAC;QACnD,MAAMwJ,SAAS,GAAGJ,MAAM,CAACI,SAAS,CAACJ,MAAM,CAACI,SAAS,CAACxJ,MAAM,GAAG,CAAC,CAAC;QAE/D,IAAIuJ,WAAW,IAAI,IAAI,IAAIC,SAAS,IAAI,IAAI,EAAE;UAC5C,OAAO,KAAK;QACd;QACA;QACA,OAAOD,WAAW,CAACvJ,MAAM,GAAGwJ,SAAS,CAACxJ,MAAM;MAC9C,CAAC,EAAE,CAAC;MAEJ,MAAMyJ,6BAA6B,GAAG,CAAC,MAAM;QAC3C,MAAM;UACJjF,MAAM,EAAE;YAAEkF,OAAO;YAAEN;UAAO;QAC5B,CAAC,GAAG3J,UAAU;QACd,MAAM8J,WAAW,GAAGH,MAAM,CAACG,WAAW,CAACI,OAAO,CAAEC,IAAI,IAAKA,IAAI,CAAC;QAC9D,OAAOF,OAAO,IAAIH,WAAW,CAACvJ,MAAM,GAAG,CAAC;MAC1C,CAAC,EAAE,CAAC;MAEJ,OAAOP,UAAU,CAACuJ,OAAO,CAACa,SAAS,CAAC,4BAA4B,CAAC,CAC9D7J,MAAM,GACLmJ,2BAA2B,GAC3BM,6BAA6B;IACnC,CAAC,EACAK,YAAY,IAAK;MAChB,IAAI,CAACA,YAAY,EAAE;QACjB;MACF;MAEA,IACErK,UAAU,CAACuJ,OAAO,CAACa,SAAS,CAAC,4BAA4B,CAAC,CAAC7J,MAAM,EACjE;QACA,IACE+J,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,MAAM,IAC9BC,MAAM,CAASC,4CAA4C,EAC5D;UACA1K,UAAU,CAACuJ,OAAO,CAAClI,IAAI,CAAC,4BAA4B,CAAC;QACvD;MACF,CAAC,MAAM;QACLrB,UAAU,CAAC2K,qBAAqB,CAAC,CAAC;MACpC;IACF,CACF,CAAC,CACF;IAED,OAAO,MAAM;MACX3K,UAAU,CAACuJ,OAAO,CAACvI,GAAG,CAAC,SAAS,EAAEqI,WAAW,CAAC;MAC9CrJ,UAAU,CAACuJ,OAAO,CAACvI,GAAG,CAAC,qBAAqB,EAAEsI,uBAAuB,CAAC;MACtEE,SAAS,CAAChJ,OAAO,CAAEoK,QAAQ,IAAKA,QAAQ,CAAC,CAAC,CAAC;MAC3C,IAAI,CAAC7K,KAAK,CAACqJ,qBAAqB,GAAG,IAAI,CAACrJ,KAAK,CAACM,OAAO,CAACwK,MAAM,CAAC,CAAC;MAC9D/J,MAAM,CAACO,IAAI,CAAC,SAAS,CAAC;IACxB,CAAC;EACH;EAEA+B,KAAKA,CAAA,EAAG;IACN,MAAM;MAAE/C;IAAQ,CAAC,GAAG,IAAI,CAACN,KAAK;IAC9B,MAAM+K,SAAS,GAAGzK,OAAO,CAAC+C,KAAK,CAAC,CAAC;IACjC,KAAK,MAAMtD,KAAK,IAAIgL,SAAS,EAAE;MAC7B,IAAI,CAAChL,KAAK,CAACqB,OAAO,EAAE;QAClBd,OAAO,CAACsC,IAAI,CAAC7C,KAAK,CAAC;MACrB;IACF;EACF;AACF;AAACiL,OAAA,CAAAxL,2BAAA,GAAAA,2BAAA","ignoreList":[]}