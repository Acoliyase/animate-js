{"version":3,"names":["_events","require","_mobx","_refreshFilter","CustomFilterState","constructor","params","_defineProperty2","default","EventEmitter","name","persistent","defaultValue","_value","initialValue","_isEmpty","isEmpty","_size","size","value","_toQueryString","toQueryString","_fromQueryString","fromQueryString","_toArray","toArray","_remove","remove","_hasDiff","hasDiff","data","itemKey","itemName","decode","encode","matches","equals","makeObservable","observable","ref","computed","reset","action","setValue","changeValue","scheduleRefresh","clone","emitEvents","options","event","events","emit","refresh","refreshFilter","JSON","stringify","applyFromQueryString","str","raw","parse","e","items","exports","customFilter"],"sources":["../../../../src/state/CustomFilterState/CustomFilterState.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { action, computed, makeObservable, observable } from 'mobx';\nimport {\n  ChangeValueOptions,\n  Filter,\n  FilterEvents,\n  FilterItem,\n  FilterStateBaseParams,\n} from '../../model';\nimport { refreshFilter } from '../Filter/refreshFilter';\n\nexport interface CustomFilterStateParams<T> extends FilterStateBaseParams<T> {\n  /**\n   * The value to set the value to, when clearing the filter.\n   * @external\n   */\n  defaultValue: T;\n  /**\n   * Indicates whether nothing is selected.<br>\n   * For example, when implementing a range filter, when both minimum and maximum inputs are empty\n   * @external\n   */\n  isEmpty: (value: T) => boolean;\n  /**\n   * Indicates the number of effective filters.<br>\n   * For example, when implementing a range filter, 1 when only minimum/maximum are entered, 2 - when both entered.\n   * @default A function that 0 when `isEmpty` returns true, and 1 otherwise.\n   * @external\n   */\n  size?: (value: T) => number;\n  /**\n   * Convert the filter value to a string, to be stored in a URL.\n   * @external\n   */\n  toQueryString?: (value: T) => string;\n  /**\n   * Convert the a string value to the filter value, to be retrieved from a URL.\n   * @external\n   */\n  fromQueryString?: (str: string) => T;\n\n  /**\n   * Convert a unknown object to a T.<br>\n   * If the function returns null, the item will be skipped when we try to deserializate it from an array.\n   * @param value\n   * @external\n   */\n  readonly decode: (value: unknown) => T;\n  /**\n   * Return a simplified form of an item for serialization.\n   * @param value\n   * @external\n   */\n  readonly encode: (value: T) => unknown;\n\n  /**\n   * Flatten the correct selection to an array, to be shown in the table sub-toolbar in a tag list.\n   * Usually this will return an array with a single item, but it gives control when we want to show more than a 1 tag in the tag list.\n   * @external\n   */\n  toArray: (value: T) => FilterItem<T>[];\n  /**\n   * Remove a tag from the tag list.\n   * @default A function that returns `defaultValue`.\n   * @external\n   */\n  remove?: (item: FilterItem<T>[], value: T) => T;\n  /**\n   * Indicates whether current filter value is different than `data`\n   * @external\n   */\n  hasDiff?: (data: T) => boolean;\n  /**\n   * Indicates whether an item matches the current value of the filter\n   * @external\n   */\n  matches?: (item: FilterItem<T>, value: T) => boolean;\n\n  equals?: (item1: FilterItem<T>, item2: FilterItem<T>) => boolean;\n}\n\nexport class CustomFilterState<T> implements Filter<T> {\n  name: string;\n  persistent;\n  defaultValue: T;\n  _value: T;\n  private readonly _isEmpty: CustomFilterStateParams<T>['isEmpty'];\n  private readonly _size: (value: T) => number;\n  private readonly _toQueryString?: CustomFilterStateParams<T>['toQueryString'];\n  private readonly _fromQueryString?: CustomFilterStateParams<T>['fromQueryString'];\n  readonly _toArray;\n  private readonly _remove;\n  private readonly _hasDiff;\n  readonly decode;\n  readonly encode;\n\n  readonly itemKey: (item: FilterItem<T>) => string;\n  readonly itemName: (item: FilterItem<T>) => string;\n  readonly matches: (item: FilterItem<T>, value: T) => boolean;\n  readonly equals?: (item1: FilterItem<T>, item2: FilterItem<T>) => boolean;\n\n  readonly events = new EventEmitter() as FilterEvents;\n\n  constructor(params: Readonly<CustomFilterStateParams<T>>) {\n    this.name = params.name ?? '';\n    this.persistent = params.persistent;\n    this.defaultValue = params.defaultValue;\n    this._value = params.initialValue ?? params.defaultValue;\n    this._isEmpty = params.isEmpty;\n    this._size = params.size ?? ((value) => (this._isEmpty(value) ? 0 : 1));\n    this._toQueryString = params.toQueryString;\n    this._fromQueryString = params.fromQueryString;\n    this._toArray = params.toArray;\n    this._remove = params.remove ?? (() => this.defaultValue);\n    this._hasDiff = params.hasDiff ?? ((data) => data !== this.value);\n    this.itemKey = params.itemKey;\n    this.itemName = params.itemName;\n    this.decode = params.decode;\n    this.encode = params.encode;\n    this.matches = params.matches ?? (() => false);\n    this.equals = params.equals;\n\n    makeObservable(this, {\n      _value: observable.ref,\n      persistent: observable.ref,\n      isEmpty: computed,\n      size: computed,\n      value: computed,\n      reset: action,\n      setValue: action,\n      changeValue: action,\n      scheduleRefresh: action,\n      clone: action,\n    });\n  }\n\n  get value() {\n    return this._value;\n  }\n\n  get toArray() {\n    return this._toArray(this._value);\n  }\n\n  get isEmpty() {\n    return this._isEmpty(this.value);\n  }\n\n  get size() {\n    return this._size(this.value);\n  }\n\n  setValue(value: T, { emitEvents, ...options }: ChangeValueOptions = {}) {\n    this._value = value;\n    if (emitEvents) {\n      for (const event of emitEvents) {\n        this.events.emit(event, options);\n      }\n    }\n  }\n\n  changeValue(\n    value: T,\n    { emitEvents = [], ...options }: ChangeValueOptions = {},\n  ) {\n    this.setValue(value, { ...options, emitEvents: ['change', ...emitEvents] });\n  }\n\n  refresh(value: T, options?: ChangeValueOptions) {\n    refreshFilter(this, value, options);\n  }\n\n  scheduleRefresh(value: T) {\n    this.changeValue(value, { emitEvents: ['scheduleRefresh'] });\n  }\n\n  get toQueryString() {\n    const { _toQueryString, encode, value } = this;\n    if (_toQueryString) {\n      return _toQueryString(value);\n    }\n\n    return JSON.stringify(encode(value));\n  }\n\n  applyFromQueryString(str: string) {\n    const { _fromQueryString, decode } = this;\n\n    if (_fromQueryString) {\n      this.setValue(_fromQueryString(str));\n    } else {\n      try {\n        const raw = JSON.parse(str) as unknown;\n        this.setValue(decode(raw));\n      } catch (e) {}\n    }\n  }\n\n  reset(options: ChangeValueOptions = {}) {\n    this.setValue(this.defaultValue, options);\n  }\n\n  remove(items: FilterItem<T>[], options: ChangeValueOptions = {}) {\n    this.setValue(this._remove(items, this.value), options);\n  }\n\n  hasDiff(data: T) {\n    return this._hasDiff(data);\n  }\n\n  clone(params: Partial<CustomFilterStateParams<T>>) {\n    const {\n      itemName,\n      itemKey,\n      encode,\n      decode,\n      _isEmpty: isEmpty,\n      _remove: remove,\n      _size: size,\n      _fromQueryString: fromQueryString,\n      _toArray: toArray,\n      _toQueryString: toQueryString,\n      defaultValue,\n      value: initialValue,\n      matches,\n      persistent,\n      name,\n    } = this;\n    return new CustomFilterState<T>({\n      itemName,\n      itemKey,\n      encode,\n      decode,\n      isEmpty,\n      remove,\n      size,\n      fromQueryString,\n      toArray,\n      toQueryString,\n      defaultValue,\n      initialValue,\n      matches,\n      persistent,\n      name,\n      ...params,\n    });\n  }\n}\n\nexport const customFilter = <T>(params: CustomFilterStateParams<T>) =>\n  new CustomFilterState(params);\n"],"mappings":"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","ignoreList":[]}