{"version":3,"names":["filterPageByPatches","patches","itemKey","itemPredicate","item","itemAfterAllPatches","reduce","acc","selector","patch","patchedItems","actionType","actionIsMatch","get","exports"],"sources":["../../../../src/state/optimistic-simulation/filterPageByPatches.ts"],"sourcesContent":["import { OptimisticPatch } from '../CollectionOptimisticPatch';\n\nexport const filterPageByPatches =\n  <T>(\n    patches: OptimisticPatch<T>[],\n    {\n      itemKey,\n      itemPredicate,\n    }: { itemKey: (item: T) => string; itemPredicate: (item: T) => boolean },\n  ) =>\n  (item: T) => {\n    const itemAfterAllPatches = patches.reduce<T | null | undefined>(\n      (acc, { selector, patch, patchedItems, actionType }) => {\n        if (!selector(item)) {\n          return acc;\n        }\n\n        if (actionType === 'createMany') {\n          return {\n            ...acc,\n            ...patch(item),\n          } as T;\n        }\n\n        if (actionType === 'deleteMany' || actionType === 'deleteAll') {\n          return null;\n        }\n\n        const actionIsMatch = (() => {\n          switch (actionType) {\n            case 'updateMany':\n              return patchedItems.get(itemKey(item));\n            case 'updateAll':\n            case 'updateAllConst':\n              return {\n                ...acc,\n                ...patch(item),\n              } as T;\n            default:\n              return null;\n          }\n        })();\n\n        return acc ? actionIsMatch : acc;\n      },\n      item,\n    );\n\n    return itemAfterAllPatches ? itemPredicate(itemAfterAllPatches) : false;\n  };\n"],"mappings":";;;;AAEO,MAAMA,mBAAmB,GAC9BA,CACEC,OAA6B,EAC7B;EACEC,OAAO;EACPC;AACqE,CAAC,KAEzEC,IAAO,IAAK;EACX,MAAMC,mBAAmB,GAAGJ,OAAO,CAACK,MAAM,CACxC,CAACC,GAAG,EAAE;IAAEC,QAAQ;IAAEC,KAAK;IAAEC,YAAY;IAAEC;EAAW,CAAC,KAAK;IACtD,IAAI,CAACH,QAAQ,CAACJ,IAAI,CAAC,EAAE;MACnB,OAAOG,GAAG;IACZ;IAEA,IAAII,UAAU,KAAK,YAAY,EAAE;MAC/B,OAAO;QACL,GAAGJ,GAAG;QACN,GAAGE,KAAK,CAACL,IAAI;MACf,CAAC;IACH;IAEA,IAAIO,UAAU,KAAK,YAAY,IAAIA,UAAU,KAAK,WAAW,EAAE;MAC7D,OAAO,IAAI;IACb;IAEA,MAAMC,aAAa,GAAG,CAAC,MAAM;MAC3B,QAAQD,UAAU;QAChB,KAAK,YAAY;UACf,OAAOD,YAAY,CAACG,GAAG,CAACX,OAAO,CAACE,IAAI,CAAC,CAAC;QACxC,KAAK,WAAW;QAChB,KAAK,gBAAgB;UACnB,OAAO;YACL,GAAGG,GAAG;YACN,GAAGE,KAAK,CAACL,IAAI;UACf,CAAC;QACH;UACE,OAAO,IAAI;MACf;IACF,CAAC,EAAE,CAAC;IAEJ,OAAOG,GAAG,GAAGK,aAAa,GAAGL,GAAG;EAClC,CAAC,EACDH,IACF,CAAC;EAED,OAAOC,mBAAmB,GAAGF,aAAa,CAACE,mBAAmB,CAAC,GAAG,KAAK;AACzE,CAAC;AAACS,OAAA,CAAAd,mBAAA,GAAAA,mBAAA","ignoreList":[]}