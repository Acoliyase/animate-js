{"version":3,"names":["_mobx","require","_TaskState","MultiCollectionSupport","constructor","params","_defineProperty2","default","TaskState","action","initTask","collections","status","isError","runOnce","forEach","c","retryErrorState","makeObservable","showInitialLoader","computed","showEmptyState","showErrorState","showRefreshLoader","errorStatus","hasAvailableItems","hasNonPersistentActiveFilters","hasNonPersistentCustomFilters","some","every","collection","showLoadingState","map","result","find","query","resultOriginQuerySearch","_this$collections$","originQuery","search","resultOriginQueryRawSearch","_this$collections$2","rawSearch","init","skipFilterListeners","disposers","Promise","all","promise","d","exports"],"sources":["../../../src/state/MultiCollectionSupport.ts"],"sourcesContent":["import { action, computed, makeObservable } from 'mobx';\nimport { CollectionState } from './CollectionState';\nimport { DataResultKeyed, FiltersMap, QueryResultStatusError } from '../model';\nimport { TaskState } from './TaskState';\n\nexport interface MultiCollectionSupportParams<F extends FiltersMap> {\n  readonly collections: CollectionState<any, F>[];\n}\n\nexport class MultiCollectionSupport<F extends FiltersMap> {\n  readonly collections: CollectionState<unknown, F>[];\n  readonly initTask = new TaskState();\n\n  constructor(params: MultiCollectionSupportParams<F>) {\n    this.collections = params.collections;\n\n    makeObservable(this, {\n      showInitialLoader: computed,\n      showEmptyState: computed,\n      showErrorState: computed,\n      showRefreshLoader: computed,\n      errorStatus: computed,\n      hasAvailableItems: computed,\n      hasNonPersistentActiveFilters: computed,\n      hasNonPersistentCustomFilters: computed,\n    });\n  }\n\n  get showInitialLoader() {\n    return this.collections.some((c) => c.showInitialLoader);\n  }\n\n  get showEmptyState() {\n    return this.collections.every((collection) => collection.showEmptyState);\n  }\n\n  get showErrorState() {\n    return this.collections.some((collection) => collection.showErrorState);\n  }\n\n  get showRefreshLoader() {\n    return this.collections.some((collection) => collection.showRefreshLoader);\n  }\n\n  get showLoadingState() {\n    return this.showInitialLoader || this.showRefreshLoader;\n  }\n\n  get errorStatus() {\n    return this.collections\n      .map((c) => c.result.status)\n      .find(\n        (\n          status,\n        ): status is QueryResultStatusError<DataResultKeyed<unknown>, F> =>\n          status.isError,\n      );\n  }\n\n  get hasAvailableItems() {\n    return this.collections.some((c) => c.result.hasAvailableItems);\n  }\n\n  get hasNonPersistentActiveFilters() {\n    return this.collections.some((c) => c.query.hasNonPersistentActiveFilters);\n  }\n\n  get hasNonPersistentCustomFilters() {\n    return this.collections.some((c) => c.query.hasNonPersistentCustomFilters);\n  }\n\n  get resultOriginQuerySearch() {\n    return this.collections[0]?.result.originQuery.search;\n  }\n\n  get resultOriginQueryRawSearch() {\n    return this.collections[0]?.result.originQuery.rawSearch;\n  }\n\n  retryErrorState = action(() => {\n    const { initTask, collections } = this;\n\n    if (initTask.status.isError) {\n      initTask.runOnce();\n    } else {\n      collections.forEach((c) => c.retryErrorState());\n    }\n  });\n\n  init({\n    skipFilterListeners = false,\n  }: { skipFilterListeners?: boolean } = {}) {\n    const { collections, initTask } = this;\n    const disposers = [\n      ...collections.map((c) => c.init({ skipFilterListeners })),\n    ];\n\n    initTask.runOnce(async () => {\n      collections.forEach((c) => c.initTask.runOnce());\n      await Promise.all(collections.map((c) => c.initTask.status.promise));\n    });\n\n    return () => {\n      disposers.forEach((d) => d());\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}