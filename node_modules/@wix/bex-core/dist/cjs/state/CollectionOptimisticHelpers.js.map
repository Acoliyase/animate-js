{"version":3,"names":["_mobx","require","CollectionOptimisticProcessorHelpers","constructor","collection","_defineProperty2","default","makeObservable","reprocess","action","bound","commit","result","_pages","unprocessed","unprocessedPages","_totals","unprocessedTotal","processedTotal","processedPages","_getProcessedResult","currentItemsMap","Map","setTotals","processed","setPages","exports"],"sources":["../../../src/state/CollectionOptimisticHelpers.ts"],"sourcesContent":["import { FiltersMap } from '../model';\nimport { CollectionState } from './CollectionState';\nimport { action, makeObservable } from 'mobx';\n\nexport class CollectionOptimisticProcessorHelpers<T, F extends FiltersMap> {\n  readonly collection: CollectionState<T, F>;\n  constructor(collection: CollectionState<T, F>) {\n    this.collection = collection;\n\n    makeObservable(this, {\n      reprocess: action.bound,\n      commit: action,\n    });\n  }\n\n  reprocess() {\n    const { collection } = this;\n    const { result } = collection;\n    const {\n      _pages: { unprocessed: unprocessedPages },\n      _totals: { unprocessed: unprocessedTotal },\n    } = result;\n\n    const { processedTotal, processedPages } = collection._getProcessedResult({\n      unprocessedPages,\n      unprocessedTotal,\n      currentItemsMap: new Map(),\n    });\n\n    result.setTotals({\n      unprocessed: unprocessedTotal,\n      processed: processedTotal,\n    });\n\n    result.setPages({\n      unprocessed: unprocessedPages,\n      processed: processedPages,\n    });\n  }\n\n  commit() {\n    const { collection } = this;\n    const { result } = collection;\n    const {\n      _pages: { processed: processedPages },\n      _totals: { processed: processedTotal },\n    } = result;\n\n    result._totals.unprocessed = processedTotal;\n    result._pages.unprocessed = processedPages;\n  }\n}\n"],"mappings":";;;;;;AAEA,IAAAA,KAAA,GAAAC,OAAA;AAEO,MAAMC,oCAAoC,CAA0B;EAEzEC,WAAWA,CAACC,UAAiC,EAAE;IAAA,IAAAC,gBAAA,CAAAC,OAAA;IAC7C,IAAI,CAACF,UAAU,GAAGA,UAAU;IAE5B,IAAAG,oBAAc,EAAC,IAAI,EAAE;MACnBC,SAAS,EAAEC,YAAM,CAACC,KAAK;MACvBC,MAAM,EAAEF;IACV,CAAC,CAAC;EACJ;EAEAD,SAASA,CAAA,EAAG;IACV,MAAM;MAAEJ;IAAW,CAAC,GAAG,IAAI;IAC3B,MAAM;MAAEQ;IAAO,CAAC,GAAGR,UAAU;IAC7B,MAAM;MACJS,MAAM,EAAE;QAAEC,WAAW,EAAEC;MAAiB,CAAC;MACzCC,OAAO,EAAE;QAAEF,WAAW,EAAEG;MAAiB;IAC3C,CAAC,GAAGL,MAAM;IAEV,MAAM;MAAEM,cAAc;MAAEC;IAAe,CAAC,GAAGf,UAAU,CAACgB,mBAAmB,CAAC;MACxEL,gBAAgB;MAChBE,gBAAgB;MAChBI,eAAe,EAAE,IAAIC,GAAG,CAAC;IAC3B,CAAC,CAAC;IAEFV,MAAM,CAACW,SAAS,CAAC;MACfT,WAAW,EAAEG,gBAAgB;MAC7BO,SAAS,EAAEN;IACb,CAAC,CAAC;IAEFN,MAAM,CAACa,QAAQ,CAAC;MACdX,WAAW,EAAEC,gBAAgB;MAC7BS,SAAS,EAAEL;IACb,CAAC,CAAC;EACJ;EAEAR,MAAMA,CAAA,EAAG;IACP,MAAM;MAAEP;IAAW,CAAC,GAAG,IAAI;IAC3B,MAAM;MAAEQ;IAAO,CAAC,GAAGR,UAAU;IAC7B,MAAM;MACJS,MAAM,EAAE;QAAEW,SAAS,EAAEL;MAAe,CAAC;MACrCH,OAAO,EAAE;QAAEQ,SAAS,EAAEN;MAAe;IACvC,CAAC,GAAGN,MAAM;IAEVA,MAAM,CAACI,OAAO,CAACF,WAAW,GAAGI,cAAc;IAC3CN,MAAM,CAACC,MAAM,CAACC,WAAW,GAAGK,cAAc;EAC5C;AACF;AAACO,OAAA,CAAAxB,oCAAA,GAAAA,oCAAA","ignoreList":[]}