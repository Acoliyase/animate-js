{"version":3,"names":["_mobx","require","CollectionOptimisticActionsState","constructor","params","_defineProperty2","default","source","queryName","patchesCache","cacheNamespace","cacheKey","filter","Boolean","join","patches","get","observable","array","deep","set","makeObservable","latestMap","computed","reduce","map","optimisticPatch","patchedItemsEntries","originalItems","key","item","originalItem","Map","exports"],"sources":["../../../src/state/CollectionOptimisticActionsState.ts"],"sourcesContent":["import { computed, IObservableArray, makeObservable, observable } from 'mobx';\nimport { OptimisticPatch } from './CollectionOptimisticPatch';\n\nexport interface CollectionOptimisticActionsStateParams<T> {\n  readonly patchesCache: Map<string, IObservableArray<OptimisticPatch<T>>>;\n  readonly source: { queryName: string };\n  readonly cacheNamespace?: string;\n}\n\nexport class CollectionOptimisticActionsState<T> {\n  readonly patches;\n\n  _patchesBeforeUnmount: OptimisticPatch<T>[] | null = null;\n\n  constructor(params: CollectionOptimisticActionsStateParams<T>) {\n    const {\n      source: { queryName },\n      patchesCache,\n      cacheNamespace,\n    } = params;\n\n    const cacheKey = [cacheNamespace, queryName].filter(Boolean).join(':');\n    let patches = patchesCache.get(cacheKey);\n\n    if (patches == null) {\n      patches = observable.array<OptimisticPatch<T>>([], {\n        deep: false,\n      });\n      patchesCache.set(cacheKey, patches);\n    }\n\n    this.patches = patches;\n\n    makeObservable(this, {\n      latestMap: computed,\n    });\n  }\n\n  get latestMap() {\n    return this.patches.reduce((map, optimisticPatch) => {\n      const { patchedItemsEntries, originalItems } = optimisticPatch;\n      for (const [key, item] of patchedItemsEntries) {\n        const originalItem = originalItems.get(key);\n        if (originalItem) {\n          map.set(key, { optimisticPatch, item, originalItem });\n        }\n      }\n      return map;\n    }, new Map<string, { item: T; originalItem: T; optimisticPatch: OptimisticPatch<T> }>());\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AASO,MAAMC,gCAAgC,CAAI;EAK/CC,WAAWA,CAACC,MAAiD,EAAE;IAAA,IAAAC,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA,iCAFV,IAAI;IAGvD,MAAM;MACJC,MAAM,EAAE;QAAEC;MAAU,CAAC;MACrBC,YAAY;MACZC;IACF,CAAC,GAAGN,MAAM;IAEV,MAAMO,QAAQ,GAAG,CAACD,cAAc,EAAEF,SAAS,CAAC,CAACI,MAAM,CAACC,OAAO,CAAC,CAACC,IAAI,CAAC,GAAG,CAAC;IACtE,IAAIC,OAAO,GAAGN,YAAY,CAACO,GAAG,CAACL,QAAQ,CAAC;IAExC,IAAII,OAAO,IAAI,IAAI,EAAE;MACnBA,OAAO,GAAGE,gBAAU,CAACC,KAAK,CAAqB,EAAE,EAAE;QACjDC,IAAI,EAAE;MACR,CAAC,CAAC;MACFV,YAAY,CAACW,GAAG,CAACT,QAAQ,EAAEI,OAAO,CAAC;IACrC;IAEA,IAAI,CAACA,OAAO,GAAGA,OAAO;IAEtB,IAAAM,oBAAc,EAAC,IAAI,EAAE;MACnBC,SAAS,EAAEC;IACb,CAAC,CAAC;EACJ;EAEA,IAAID,SAASA,CAAA,EAAG;IACd,OAAO,IAAI,CAACP,OAAO,CAACS,MAAM,CAAC,CAACC,GAAG,EAAEC,eAAe,KAAK;MACnD,MAAM;QAAEC,mBAAmB;QAAEC;MAAc,CAAC,GAAGF,eAAe;MAC9D,KAAK,MAAM,CAACG,GAAG,EAAEC,IAAI,CAAC,IAAIH,mBAAmB,EAAE;QAC7C,MAAMI,YAAY,GAAGH,aAAa,CAACZ,GAAG,CAACa,GAAG,CAAC;QAC3C,IAAIE,YAAY,EAAE;UAChBN,GAAG,CAACL,GAAG,CAACS,GAAG,EAAE;YAAEH,eAAe;YAAEI,IAAI;YAAEC;UAAa,CAAC,CAAC;QACvD;MACF;MACA,OAAON,GAAG;IACZ,CAAC,EAAE,IAAIO,GAAG,CAA4E,CAAC,CAAC;EAC1F;AACF;AAACC,OAAA,CAAA/B,gCAAA,GAAAA,gCAAA","ignoreList":[]}