{"version":3,"names":["_events","require","_mobx","_refreshFilter","ArrayFilterState","constructor","params","_defineProperty2","default","EventEmitter","value","name","persistent","defaultValue","parse","simplify","itemKey","itemName","_value","initialValue","matches","item","key","length","some","v","equals","isCustomField","makeObservable","observable","ref","isEmpty","computed","size","reset","action","setValue","changeValue","scheduleRefresh","clone","toArray","toQueryString","JSON","stringify","map","applyFromQueryString","str","maybeArr","Array","isArray","filter","_","encode","decode","raw","emitEvents","options","event","events","emit","refresh","refreshFilter","hasDiff","items","every","i","remove","keysToRemove","Set","has","exports","stringsArrayFilter","arrayFilter","idNameArrayFilter","id","idArrayFilter","idNameArrayFilterNum","String"],"sources":["../../../../src/state/ArrayFilterState/ArrayFilterState.ts"],"sourcesContent":["import { EventEmitter } from 'events';\nimport { action, computed, makeObservable, observable } from 'mobx';\nimport {\n  ChangeValueOptions,\n  Filter,\n  FilterEvents,\n  FilterStateBaseParams,\n} from '../../model';\nimport { refreshFilter } from '../Filter/refreshFilter';\n\nexport interface ArrayFilterStateParams<T> extends FilterStateBaseParams<T[]> {\n  /**\n   * The value to set the value to, when clearing the filter (Optional)\n   * @external\n   */\n  defaultValue?: T[];\n  /**\n   * Convert a unknown object to a T.<br>\n   * If the function returns null, the item will be skipped when we try to deserializate it from an array.\n   * @param value\n   * @external\n   */\n  readonly parse: (\n    value: Record<string, unknown> | string | null | undefined,\n  ) => T | null;\n  /**\n   * Return a simplified form of an item for serialization.\n   * @param value\n   * @external\n   */\n  readonly simplify?: (value: T) => Partial<T>;\n\n  /**\n   * Indicates whether an item matches the current value of the filter\n   * @external\n   */\n  readonly matches?: (item: T, value: T[]) => boolean;\n\n  readonly equals?: (item1: T, item2: T) => boolean;\n}\n\nexport class ArrayFilterState<T> implements Filter<T[]> {\n  _value: T[];\n\n  name: string;\n  persistent;\n  defaultValue: T[];\n  readonly parse: ArrayFilterStateParams<T>['parse'];\n  readonly simplify: (value: T) => Partial<T>;\n  readonly itemKey: (item: T) => string;\n  readonly itemName: (item: T) => string;\n  readonly equals?: (item1: T, item2: T) => boolean;\n  readonly isCustomField?: boolean;\n\n  readonly events = new EventEmitter() as FilterEvents;\n\n  readonly matches: (item: T, value: T[]) => boolean;\n\n  constructor(params: Readonly<ArrayFilterStateParams<T>>) {\n    this.name = params.name ?? '';\n    this.persistent = params.persistent;\n    this.defaultValue = params.defaultValue ?? [];\n    this.parse = params.parse;\n    this.simplify = params.simplify ?? ((value) => value);\n    this.itemKey = params.itemKey;\n    this.itemName = params.itemName;\n    this._value = params.initialValue ?? this.defaultValue;\n    this.matches =\n      params.matches ??\n      ((item, value) => {\n        const { itemKey } = this;\n        const key = typeof item === 'string' ? item : itemKey(item);\n        return (\n          value == null ||\n          !value.length ||\n          value.some((v) => itemKey(v) === key)\n        );\n      });\n    this.equals = params.equals;\n    this.isCustomField = params.isCustomField;\n\n    makeObservable(this, {\n      _value: observable.ref,\n      defaultValue: observable.ref,\n      persistent: observable.ref,\n      isEmpty: computed,\n      size: computed,\n      value: computed,\n      reset: action,\n      setValue: action,\n      changeValue: action,\n      scheduleRefresh: action,\n      clone: action,\n    });\n  }\n\n  get value() {\n    return this._value;\n  }\n\n  _toArray = (value: T[]) => {\n    return value;\n  };\n\n  get toArray() {\n    return this._value;\n  }\n\n  get isEmpty() {\n    return !this.size;\n  }\n\n  get size() {\n    return this._value.length;\n  }\n\n  get toQueryString() {\n    return JSON.stringify(this._value.map(this.simplify));\n  }\n\n  applyFromQueryString(str: string) {\n    try {\n      const maybeArr = JSON.parse(str) as unknown;\n      if (Array.isArray(maybeArr)) {\n        this.setValue(\n          maybeArr.map(this.parse).filter((value): value is T => value != null),\n        );\n      }\n    } catch (_) {}\n  }\n\n  encode(value: T[]) {\n    return value.map(this.simplify);\n  }\n\n  decode(raw: unknown) {\n    if (Array.isArray(raw)) {\n      return raw.map(this.parse).filter((value): value is T => value != null);\n    }\n\n    return [];\n  }\n\n  setValue(value: T[], { emitEvents, ...options }: ChangeValueOptions = {}) {\n    this._value = value;\n    if (emitEvents) {\n      for (const event of emitEvents) {\n        this.events.emit(event, options);\n      }\n    }\n  }\n\n  changeValue(\n    value: T[],\n    { emitEvents = [], ...options }: ChangeValueOptions = {},\n  ) {\n    this.setValue(value, { ...options, emitEvents: ['change', ...emitEvents] });\n  }\n\n  refresh(value: T[], options?: ChangeValueOptions) {\n    refreshFilter(this, value, options);\n  }\n\n  scheduleRefresh(value: T[]) {\n    this.changeValue(value, { emitEvents: ['scheduleRefresh'] });\n  }\n\n  reset(options: ChangeValueOptions = {}) {\n    this.setValue(this.defaultValue, options);\n  }\n\n  hasDiff(items: T[]) {\n    const { value } = this;\n    return (\n      value.length !== items.length ||\n      value.some((item) =>\n        items.every((i) => this.itemKey(i) !== this.itemKey(item)),\n      )\n    );\n  }\n\n  remove(items: T[], options: ChangeValueOptions = {}) {\n    const { itemKey } = this;\n    const keysToRemove = new Set(items.map(itemKey));\n    this.setValue(\n      this._value.filter((item) => !keysToRemove.has(itemKey(item))),\n      options,\n    );\n  }\n\n  clone(params: Partial<ArrayFilterStateParams<T>>): ArrayFilterState<T> {\n    const {\n      itemName,\n      itemKey,\n      simplify,\n      parse,\n      defaultValue,\n      value: initialValue,\n      matches,\n      persistent,\n      name,\n    } = this;\n    return new ArrayFilterState({\n      itemName,\n      itemKey,\n      simplify,\n      parse,\n      defaultValue,\n      initialValue,\n      matches,\n      persistent,\n      name,\n      ...params,\n    });\n  }\n}\n\nexport const stringsArrayFilter = <T extends string>(\n  params?: Partial<ArrayFilterStateParams<T>>,\n) =>\n  new ArrayFilterState<T>({\n    itemKey: (item) => item,\n    itemName: (item) => item,\n    parse: (value) => {\n      if (value == null || typeof value !== 'string') {\n        return null;\n      }\n      return value as T;\n    },\n    simplify: (value) => value,\n    ...params,\n  });\n\nexport const arrayFilter = <T>(params: ArrayFilterStateParams<T>) =>\n  new ArrayFilterState<T>(params);\n\nexport const idNameArrayFilter = <T extends { id: string; name: string }>(\n  params?: Partial<ArrayFilterStateParams<T>>,\n) =>\n  new ArrayFilterState<T>({\n    itemKey: (item) => item.id,\n    itemName: (item) => item.name,\n    parse: (value) => {\n      if (\n        value == null ||\n        typeof value === 'string' ||\n        typeof value.id !== 'string' ||\n        typeof value.name !== 'string'\n      ) {\n        return null;\n      }\n      return value as T;\n    },\n    simplify: (value) =>\n      ({\n        id: value.id,\n        name: value.name,\n      } as Partial<T>),\n    ...params,\n  });\n\nexport const idArrayFilter = <T extends { id: string }>(\n  params?: Partial<ArrayFilterStateParams<T>>,\n) =>\n  new ArrayFilterState<T>({\n    itemKey: (item) => item.id,\n    itemName: () => '',\n    parse: (value) => {\n      if (\n        value == null ||\n        typeof value === 'string' ||\n        typeof value.id !== 'string'\n      ) {\n        return null;\n      }\n      return value as T;\n    },\n    simplify: (value) =>\n      ({\n        id: value.id,\n      } as Partial<T>),\n    ...params,\n  });\n\nexport const idNameArrayFilterNum = <T extends { id: number; name: string }>(\n  params?: Partial<ArrayFilterStateParams<T>>,\n) =>\n  new ArrayFilterState<T>({\n    itemKey: (item) => String(item.id),\n    itemName: (item) => item.name,\n    parse: (value) => {\n      if (\n        value == null ||\n        typeof value === 'string' ||\n        typeof value.id !== 'number' ||\n        typeof value.name !== 'string'\n      ) {\n        return null;\n      }\n      return value as T;\n    },\n    simplify: (value) =>\n      ({\n        id: value.id,\n        name: value.name,\n      } as Partial<T>),\n    ...params,\n  });\n"],"mappings":"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","ignoreList":[]}