{"version":3,"names":["_model","require","_core","_mobx","_events","_QueryState","_QueryResultState","_BulkSelectState","_PromisesState","_Pagination","_PaginationMode","_TaskState","_util","_TransitionState","_FetchTotalState","MAX_RETRIES","CollectionState","queryKeyOptions","query","queryKey","_queryKey","asComputed","originQuery","result","status","isOnline","onlineState","optimisticActions","_optimisticActions","process","env","NODE_ENV","Error","constructor","params","_defineProperty2","default","EventEmitter","PromisesState","TaskState","queryName","filters","rawFilters","search","hasActiveFilters","hasNonPersistentActiveFilters","nonPersistentFiltersKey","columns","computedQuery","items","total","available","cursor","rest","fetchData","Promise","resolve","requestAnimationFrame","action","err","events","errorMonitor","console","error","OfflineError","handled","onError","captureException","getCurrentQuery","invalidate","_resetReactQuery","updateStatus","onNewPageAdded","onNewPageStart","emitter","isError","pagination","nextPage","lifecycleState","onNewPageAddedListeners","listeners","map","l","maybeOnNewPageAdded","promise","currentQuery","onResultListeners","fetch","runInAction","_currentQueryPromise","updateResultInfo","updateResult","forEach","newPages","onNewPageAddedParams","totalNewItems","reduce","agg","page","length","focusManager","isFocused","fetchNextPageIfNeeded","clearResultAndMoveToStart","force","_recoverIfError","state","isPaused","dispatch","type","initTask","runOnce","TransitionState","lodash","persistQueryToUrl","toExtendedFields","makeObservable","bound","clearAndMoveToPage","refreshAllPages","sort","init","setInitialPage","initialFetch","totalPages","computed","hasAvailableItems","showInitialLoader","showRefreshLoader","showEmptyState","showErrorState","resetFiltersAndRefresh","observable","ref","clearResultBeforeRefresh","scrollableContent","_commonDynamicBiParams","fqdn","deferInitialLoading","queryCache","errorHandler","history","fetchErrorMessage","itemKey","itemName","translate","initDependencies","showToast","remove","defaultQueryOptions","queryFn","_queryFn","keepPreviousData","suspense","enabled","retryDelay","staleTime","refetchOnMount","retryOnMount","queryOptions","queryClient","QueryClient","defaultOptions","queries","queryObserver","QueryObserver","retry","failureCount","_this$errorHandler","reportRetryAttempt","QueryState","limit","undefined","refreshOnColumnsChange","_paginationModeRef","paginationModeRef","current","paginationMode","_paginationMode","PaginationMode","selectionConsistencyMode","QueryResultState","toComputed","fetchTotal","FetchTotalState","collection","fetchesHistory","bulkSelect","BulkSelectState","disableAutoSelectAllCount","useNewSelectAllLogic","scrollToTop","_this$scrollableConte","scrollTo","top","left","initialPage","initialPromises","addPromise","animationFramePromise","_runSort","clearResult","emit","moveToFirstPage","scheduleSort","whenNotIdle","debounce","_runSearch","onSearch","onSearchResults","searchEndListeners","resetToDefaults","onResultUpdated","scheduleSearch","setOptions","options","maybeTotal","hasNext","setQueryData","_getProcessedResult","unprocessedPages","unprocessedTotal","currentItemsMap","beforeAddNewPagesListeners","processedPages","pages","listener","processedTotal","_getProcessedTotal","beforeSetTotalListeners","_addToFetchesHistory","offset","push","itemsKeys","flatMap","p","item","queryPageInfo","reactQuery","data","filter","d","lastPage","_keyedItemsMap","addPages","unprocessed","processed","setTotals","setSupportTotal","setHasNext","setCursor","fn","args","isIdle","isFetching","getOptimisticResult","queryStatus","then","catch","isStale","fetchListeners","_totals","Math","ceil","totalStatus","fetchedLastPage","fetchNextPage","minLoaderTime","wait","min","max","fetchPromise","timeoutId","maxWaitPromise","setTimeout","minWaitPromise","race","clearTimeout","clear","initialCursor","fetchAndReplaceResult","queryLookup","Object","assign","filtersKey","findAll","q","col","multiple","forceDirection","origin","changeSort","slice","value","changeValue","clearSearch","changeItem","newItem","changeItems","newItems","changeResult","rollback","addItem","addItems","refreshCurrentPage","noInvalidate","beforeUpdateResult","currentPage","promises","lastPagePromise","pageQuery","id","_pageQuery$state$data","results","all","resetFilters","emitEvents","resetCustomFiltersAndRefresh","resetCustomFilters","onInitialPageFetched","prevQuery","beforeInitialFetchListeners","f","skipInitialFetch","skipFilterListeners","on","onOnlineStateChange","disposers","_registerQueryEvents","subscribe","_this$initDependencie","call","off","disposer","idle","addEventListener","opts","refreshPromises","_this$scrollableConte2","behavior","reaction","fieldsKeyHash","getItem","key","keyedItem","get","getKeyedItem","getKeyedItemByIndex","index","keyedItems","addRefreshPromise","createPromise","_query$sort","_query$sort2","currentFilters","JSON","stringify","currentSortOrder","filteredListSize","initialItems","size","numSortedColumns","isLoading","isLoadingPromises","Boolean","isEmpty","topNotification","_topNotification","text","t","set","show","exports"],"sources":["../../../src/state/CollectionState.ts"],"sourcesContent":["import {\n  CollectionEvents,\n  ComputedQuery,\n  ComputedQueryFull,\n  DataResultKeyed,\n  DataResultRaw,\n  Filter,\n  FiltersKey,\n  FiltersMap,\n  Fqdn,\n  KeyedItem,\n  OnResultUpdated,\n  PatternsErrorHandler,\n  QueryOptions,\n  QueryResultStatus,\n  queryStatus,\n  ShowToast,\n  SortOrder,\n} from '../model';\nimport {\n  Query as ReactQuery,\n  QueryCache,\n  QueryClient,\n  QueryObserver,\n} from 'react-query/core';\nimport {\n  action,\n  computed,\n  makeObservable,\n  observable,\n  reaction,\n  runInAction,\n} from 'mobx';\nimport { EventEmitter } from 'events';\nimport { History } from 'history';\nimport { QueryState } from './QueryState';\nimport { QueryResultState } from './QueryResultState';\nimport { BulkSelectState } from './BulkSelectState';\nimport { PromisesState } from './PromisesState';\nimport { initialCursor } from './Pagination';\nimport { PaginationMode, PaginationModeRef } from './PaginationMode';\nimport { TaskState } from './TaskState';\nimport {\n  ErrorMonitor,\n  ExtendedFields,\n  PartialLodash,\n  Translate,\n} from '../services';\nimport { addEventListener, OfflineError, TypedEmitter } from '../util';\nimport { OnlineState } from './OnlineState';\nimport { TransitionState } from './TransitionState';\nimport { Sortable } from './SortState';\nimport { CollectionOptimisticActions } from './CollectionOptimisticActions';\nimport { FetchTotalState } from './FetchTotalState';\n\nconst MAX_RETRIES = 3;\n\ntype Query<T> = Omit<ReactQuery<DataResultKeyed<T>>, 'promise' | 'dispatch'> & {\n  promise?: Promise<unknown>;\n  dispatch: (action: { type: string; error: unknown }) => void;\n};\n\nexport interface CollectionStateEvents<T, F extends FiltersMap> {\n  triggerReachBottomListener: () => unknown;\n  beforeAddNewPages: (params: {\n    pages: T[][];\n    currentItemsMap: Map<string, KeyedItem<T>>;\n    originQuery: ComputedQueryFull<F>;\n  }) => T[][];\n  beforeSetTotal: (params: {\n    total: number;\n    originQuery: ComputedQuery<F>;\n  }) => number;\n  resultUpdated: () => unknown;\n  beforeResultUpdated: () => unknown;\n  ready: () => unknown;\n  beforeInitialFetch: (params: { isStale: boolean }) => unknown;\n  collectionLayout: () => unknown;\n  fetch: (params: { isStale: boolean }) => void | undefined | (() => unknown);\n  refresh: (params: { isStale: boolean }) => unknown;\n  refreshCurrentPage: () => unknown;\n  refreshAllPages: () => unknown;\n  refreshUpdateResult: () => unknown;\n  searchStart: () => () => unknown;\n  search: (params: { clearResult?: boolean }) => unknown;\n  clearSearch: () => unknown;\n  newPageStart: () => (params: {\n    totalNewItems: number;\n    newPages: DataResultKeyed<T>[];\n  }) => unknown;\n  beforeSortStart: (params: {\n    origin?: 'SidePanel' | 'ColumnHeader';\n  }) => unknown;\n  sortStart: (params: { col: { id: string } }) => unknown;\n  sort: (params: { clearResult?: boolean }) => unknown;\n  beforeClearFilters: (params: { origin: string }) => unknown;\n}\n\ninterface ScrollableContent {\n  scrollTo: (options: ScrollToOptions) => void;\n}\n\nexport interface CollectionStateParams<T, F extends FiltersMap> {\n  readonly queryCache: QueryCache;\n  readonly queryName: string;\n  readonly fqdn?: Fqdn;\n  readonly filters: F;\n  readonly search?: Filter<string>;\n  readonly errorMonitor: ErrorMonitor;\n  readonly errorHandler: PatternsErrorHandler | undefined;\n  readonly onlineState: OnlineState;\n  readonly history: History;\n  readonly showToast?: ShowToast;\n  readonly translate: Translate;\n  readonly itemKey: (item: T) => string;\n  readonly toExtendedFields?: (item: T) => ExtendedFields | undefined | null;\n  readonly initDependencies?: () => Promise<unknown>;\n\n  readonly fetchData: (query: ComputedQuery<F>) => Promise<DataResultRaw<T>>;\n  readonly fetchTotal?: (query: ComputedQuery<F>) => Promise<number>;\n  readonly fetchErrorMessage?: (params: {\n    err: unknown;\n    isOnline: boolean;\n  }) => string | null | undefined;\n  readonly itemName: (item: T) => string;\n  readonly deferInitialLoading?: boolean;\n  readonly events?: CollectionEvents<F>;\n  readonly persistQueryToUrl?: boolean;\n  readonly refreshOnColumnsChange?: boolean;\n  readonly limit?: number;\n  readonly initialPage?: DataResultRaw<T>;\n  readonly queryOptions?: QueryOptions;\n  readonly paginationMode?: 'cursor' | 'offset';\n  readonly paginationModeRef?: PaginationModeRef;\n  readonly selectionConsistencyMode?: 'preserve' | 'clear';\n  readonly disableAutoSelectAllCount?: boolean;\n  readonly useNewSelectAllLogic?: boolean;\n  readonly lodash: PartialLodash;\n}\n\nexport interface CollectionStatePublicAPI<T, F extends FiltersMap> {\n  /**\n   * Invalidates all cache records for this collection.<br>\n   * Optional parameters:<br>\n   *  `filters` - Clears only a specific part of the cache, for example: `invalidate({ filters: { status: ['active'] } })`\n   *  @external\n   */\n  invalidate(params?: {\n    filters?: { [P in keyof F]?: string[] | undefined | null };\n  }): void;\n\n  /**\n   * Invalidates cache and refreshes all previously fetched pages, without showing a loading indication.<br>\n   * Optional parameters:<br>\n   * - `beforeUpdateResult` - A callback function that will be called before updating the result.<br>\n   * - `filters` - Invalidates only a specific part of the cache, for example: `refreshAllPages({ filters: { status: ['active'] } })`.\n   * @external\n   */\n  refreshAllPages(params?: {\n    beforeUpdateResult?: () => unknown;\n    filters?: { [P in keyof F]?: string[] | undefined | null };\n  }): Promise<void>;\n\n  /**\n   * Invalidates cache and refreshes current page, without showing a loading indication.<br>\n   * Optional parameters:<br>\n   * - `noInvalidate` - Refreshes current page without invalidating cache.\n   * @external\n   */\n  refreshCurrentPage(params?: { noInvalidate?: boolean }): Promise<void>;\n\n  /**\n   * Clears all data from the collection and goes back to the first page and refreshes the first page data, while showing a loading indication.<br>\n   * Optional parameters:<br>\n   * - `force` - Invalidates the cache and resets react-query observer.\n   * - `filters` - Clears only a specific part of the cache, for example: `invalidate({ filters: { status: ['active'] } })`\n   * @external\n   */\n  clearResultAndMoveToStart(params?: {\n    force?: boolean;\n    filters?: { [P in keyof F]?: string[] | undefined | null };\n  }): Promise<void>;\n\n  /**\n   * Triggers retry when collection fails to load\n   * @external\n   */\n  retryErrorState(): void;\n\n  /**\n   * [BulkSelectState](./?path=/story/common-state--bulkselectstate)\n   * @external\n   */\n  bulkSelect: BulkSelectState<T>;\n\n  /**\n   * [ComputedQuery](./?path=/story/common-types--computedquery) instance. Holds all the relevant variables to query the server API with.\n   */\n  originQuery: ComputedQueryFull<F>;\n\n  /**\n   * Status of the query. Contains boolean flags of `isIdle`, `isError`, `isLoading`, `isFetching`, `isSuccess`.\n   * The difference between `isLoading` and `isFetching` is that `isLoading` is true during the initial query, `isFetching` is true during the next queries.\n   *  @external\n   */\n  status: QueryResultStatus<DataResultKeyed<T>, unknown>;\n\n  /**\n   * The total number of items, as was returned from the last query.\n   * @external\n   */\n  total: number;\n\n  /**\n   * All the keyed items of the collection\n   * @external\n   */\n  keyedItems: KeyedItem<T>[];\n\n  /**\n   * Get an item object according to its key\n   * @external\n   * @param key The key of the wanted item\n   * @returns The wanted item\n   */\n  getItem(key: string): T | undefined | null;\n}\n\nexport class CollectionState<T, F extends FiltersMap = FiltersMap>\n  implements CollectionStatePublicAPI<T, F>\n{\n  readonly query: QueryState<F>;\n  readonly _paginationModeRef;\n  private readonly _paginationMode: PaginationMode<T, F>;\n  readonly selectionConsistencyMode: 'preserve' | 'clear';\n  readonly result: QueryResultState<T, F>;\n  readonly fetchesHistory: {\n    itemsKeys: string[];\n    queryPageInfo: {\n      page: number;\n      cursor: string | null | undefined;\n      offset: number;\n    };\n  }[];\n  readonly bulkSelect: BulkSelectState<T>;\n  scrollableContent?: ScrollableContent | null = null;\n  readonly errorMonitor: ErrorMonitor;\n  readonly errorHandler;\n\n  readonly queryCache: QueryCache;\n  readonly queryClient: QueryClient;\n\n  readonly queryObserver: QueryObserver<DataResultKeyed<T>>;\n  readonly queryName;\n  readonly fqdn;\n  readonly fetchErrorMessage: CollectionStateParams<T, F>['fetchErrorMessage'];\n  readonly itemName: CollectionStateParams<T, F>['itemName'];\n  readonly itemKey: CollectionStateParams<T, F>['itemKey'];\n  readonly toExtendedFields?;\n  readonly translate: Translate;\n  readonly fetchData: CollectionStateParams<T, F>['fetchData'];\n  readonly lodash;\n\n  readonly deferInitialLoading?: boolean;\n  readonly persistQueryToUrl;\n\n  _optimisticActions?: CollectionOptimisticActions<T, F>;\n  beforeSetData?: () => void | Promise<unknown>;\n  readonly showToast: ShowToast;\n\n  readonly events: CollectionEvents<F>;\n  readonly emitter = new EventEmitter() as TypedEmitter<\n    CollectionStateEvents<T, F>\n  >;\n\n  readonly onlineState: OnlineState;\n  readonly history: History;\n\n  readonly initDependencies?: () => Promise<unknown>;\n  readonly initialPromises = new PromisesState();\n  readonly refreshPromises = new PromisesState();\n\n  readonly initTask = new TaskState();\n\n  /**\n   * Possible flows:\n   * result->refresh, refresh->result, result->fetchMore, fetchMore->result, refresh->refresh, fetchMore->fetchMore\n   */\n  lifecycleState: 'result' | 'refresh' | 'fetchMore' = 'result';\n\n  _queryKey = (asComputed: ComputedQueryFull<F>) => {\n    const { queryName } = this;\n    const {\n      filters,\n      rawFilters,\n      search,\n      hasActiveFilters,\n      hasNonPersistentActiveFilters,\n      nonPersistentFiltersKey,\n      columns,\n      // Pick only properties relevant to `queryKey` uniqueness\n      ...computedQuery\n    } = asComputed;\n\n    return [queryName, computedQuery] as const;\n  };\n\n  get queryKeyOptions() {\n    const { query } = this;\n    return {\n      queryKey: this._queryKey(query.asComputed),\n    };\n  }\n\n  get originQuery() {\n    return this.result.originQuery;\n  }\n\n  get status() {\n    return this.result.status;\n  }\n\n  isOnline() {\n    return this.onlineState.isOnline;\n  }\n\n  get optimisticActions() {\n    if (\n      this._optimisticActions == null &&\n      process.env.NODE_ENV !== 'production'\n    ) {\n      throw new Error('optimisticActions is not initialized');\n    }\n    return this._optimisticActions as CollectionOptimisticActions<T, F>;\n  }\n\n  constructor(params: CollectionStateParams<T, F>) {\n    this.lodash = params.lodash;\n    this.persistQueryToUrl = params.persistQueryToUrl;\n    this.toExtendedFields = params.toExtendedFields;\n    makeObservable(this, {\n      fetchNextPageIfNeeded: action.bound,\n      clearAndMoveToPage: action.bound,\n      clearResultAndMoveToStart: action.bound,\n      refreshAllPages: action.bound,\n      updateStatus: action.bound,\n      updateResult: action.bound,\n      search: action,\n      sort: action,\n      fetch: action,\n      init: action,\n      setInitialPage: action,\n      initialFetch: action,\n      totalPages: computed,\n      hasAvailableItems: computed,\n      showInitialLoader: computed,\n      showRefreshLoader: computed,\n      showEmptyState: computed,\n      showErrorState: computed,\n      resetFiltersAndRefresh: action.bound,\n      lifecycleState: observable.ref,\n      clearResultBeforeRefresh: action,\n      scrollableContent: observable.ref,\n      _commonDynamicBiParams: action,\n    });\n\n    this.queryName = params.queryName;\n    this.fqdn = params.fqdn;\n    this.deferInitialLoading = params.deferInitialLoading;\n    this.queryCache = params.queryCache;\n    this.errorMonitor = params.errorMonitor;\n    this.errorHandler = params.errorHandler;\n    this.onlineState = params.onlineState;\n    this.history = params.history;\n\n    this.fetchErrorMessage = params.fetchErrorMessage;\n    this.itemKey = params.itemKey;\n    this.itemName = params.itemName;\n    this.translate = params.translate;\n    this.fetchData = params.fetchData;\n    this.events = params.events ?? {};\n\n    this.initDependencies = params.initDependencies;\n\n    this.showToast = params.showToast ?? (() => ({ remove: () => {} }));\n\n    const defaultQueryOptions = {\n      queryFn: action(() => this._queryFn(this.query.asComputed)),\n      keepPreviousData: true,\n      suspense: false,\n      enabled: false,\n      retryDelay: 200,\n      staleTime: 120000,\n      onError: this.onError,\n      refetchOnMount: false,\n      retryOnMount: false,\n      ...params.queryOptions,\n    };\n\n    this.queryClient = new QueryClient({\n      queryCache: this.queryCache,\n      defaultOptions: {\n        queries: defaultQueryOptions,\n      },\n    });\n\n    this.queryObserver = new QueryObserver<DataResultKeyed<T>>(\n      this.queryClient,\n      {\n        retry: (failureCount, error) => {\n          if (failureCount < MAX_RETRIES) {\n            this.errorHandler?.reportRetryAttempt?.(error);\n            return true;\n          }\n\n          return false;\n        },\n        ...defaultQueryOptions,\n      },\n    );\n\n    this.query = new QueryState({\n      filters: params.filters,\n      search: params.search,\n      limit: params.limit,\n      history: params.persistQueryToUrl ? params.history : undefined,\n      refreshOnColumnsChange: params.refreshOnColumnsChange,\n    });\n\n    this._paginationModeRef =\n      params.paginationModeRef ??\n      ({ current: params.paginationMode } as PaginationModeRef);\n\n    this._paginationMode = new PaginationMode(this);\n\n    this.selectionConsistencyMode =\n      params.selectionConsistencyMode ?? 'preserve';\n\n    this.result = new QueryResultState<T, F>({\n      itemKey: params.itemKey,\n      originQuery: this.query.toComputed(),\n      fetchTotal: params.fetchTotal\n        ? new FetchTotalState<T, F>({\n            collection: this,\n            queryCache: this.queryCache,\n            fetchTotal: params.fetchTotal,\n          })\n        : undefined,\n    });\n\n    this._resetReactQuery();\n\n    this.fetchesHistory = [];\n\n    this.bulkSelect = new BulkSelectState<T>({\n      disableAutoSelectAllCount: params.disableAutoSelectAllCount,\n      useNewSelectAllLogic: params.useNewSelectAllLogic,\n      collection: this,\n      scrollToTop: () => {\n        this.scrollableContent?.scrollTo({\n          top: 0,\n          left: 0,\n        });\n      },\n    });\n\n    if (params.initialPage) {\n      this.setInitialPage(params.initialPage);\n    }\n\n    if (params.deferInitialLoading) {\n      this.initialPromises.addPromise(this.animationFramePromise);\n    }\n\n    this._runSort = action(({ clearResult }: { clearResult?: boolean }) => {\n      this.emitter.emit('sort', { clearResult });\n      if (clearResult) {\n        this.clearResultBeforeRefresh();\n      }\n      return this.moveToFirstPage();\n    });\n\n    this.scheduleSort = this.whenNotIdle(\n      this.lodash.debounce(this._runSort, 300),\n    );\n\n    this._runSearch = action(async (clearResult?: boolean) => {\n      const {\n        events: { onSearch, onSearchResults },\n        emitter,\n        query,\n      } = this;\n\n      const searchEndListeners = emitter\n        .listeners('searchStart')\n        .map((l) => l());\n      onSearch?.({\n        query: query.asComputed,\n      });\n      emitter.emit('search', { clearResult });\n\n      if (clearResult) {\n        this.clearResultBeforeRefresh();\n      }\n\n      if (this.selectionConsistencyMode === 'clear') {\n        this.bulkSelect.resetToDefaults();\n      }\n\n      return this.moveToFirstPage({\n        onResultUpdated: (params) => {\n          searchEndListeners.forEach((l) => l());\n          onSearchResults?.(params);\n        },\n      });\n    });\n\n    this.scheduleSearch = this.lodash.debounce(this._runSearch, 300);\n  }\n\n  _resetReactQuery() {\n    this.queryObserver.setOptions(\n      {\n        ...this.queryObserver.options,\n        ...this.queryKeyOptions,\n        enabled: false,\n      },\n      {\n        onError: true,\n      },\n    );\n  }\n\n  _queryFn = async (\n    computedQuery: ComputedQuery<F>,\n  ): Promise<DataResultKeyed<T>> => {\n    const {\n      items,\n      total,\n      available = null,\n      cursor = null,\n      ...rest\n    } = await this.fetchData(computedQuery);\n\n    return {\n      items,\n      total,\n      available,\n      cursor,\n      ...rest,\n    };\n  };\n\n  scheduleSort;\n  private readonly scheduleSearch;\n  readonly _runSearch;\n  readonly _runSort;\n\n  setInitialPage(initialPage: DataResultRaw<T>) {\n    const {\n      items,\n      total: maybeTotal,\n      available = null,\n      cursor = null,\n      hasNext,\n    } = initialPage;\n\n    const total = maybeTotal ?? items.length;\n\n    this.queryClient.setQueryData<DataResultKeyed<T>>(\n      this.queryKeyOptions.queryKey,\n      {\n        items,\n        total,\n        available,\n        cursor,\n        hasNext,\n      },\n    );\n  }\n\n  animationFramePromise = () =>\n    new Promise<void>((resolve) => {\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          resolve();\n        });\n      });\n    });\n\n  onError = action((err: unknown) => {\n    if (err == null) {\n      return;\n    }\n\n    const { onlineState, events, errorMonitor } = this;\n    console.error(err);\n\n    const { isOnline } = onlineState;\n\n    if (!(err instanceof OfflineError)) {\n      const handled = events.onError?.({\n        err,\n        isOnline,\n      });\n\n      if (!handled) {\n        errorMonitor.captureException(err);\n      }\n    }\n\n    this.getCurrentQuery().invalidate();\n    this._resetReactQuery();\n    this.updateStatus();\n  });\n\n  _currentQueryPromise?: Promise<void>;\n\n  getCurrentQuery() {\n    const query = this.queryObserver.getCurrentQuery();\n    return query as unknown as Query<T>;\n  }\n\n  get paginationMode() {\n    return this._paginationMode;\n  }\n\n  _getProcessedResult({\n    unprocessedPages,\n    unprocessedTotal,\n    currentItemsMap,\n  }: {\n    unprocessedPages: T[][];\n    unprocessedTotal: number;\n    currentItemsMap: Map<string, KeyedItem<T>>;\n  }) {\n    const { emitter, result } = this;\n    const { originQuery } = result;\n\n    const beforeAddNewPagesListeners = emitter.listeners('beforeAddNewPages');\n\n    const processedPages = beforeAddNewPagesListeners.reduce(\n      (pages, listener) =>\n        listener({\n          pages,\n          currentItemsMap,\n          originQuery,\n        }),\n      unprocessedPages,\n    );\n\n    const processedTotal = this._getProcessedTotal(unprocessedTotal);\n\n    return {\n      processedPages,\n      processedTotal,\n    };\n  }\n\n  _getProcessedTotal(unprocessedTotal: number) {\n    const { emitter, result } = this;\n    const { originQuery } = result;\n\n    const beforeSetTotalListeners = emitter.listeners('beforeSetTotal');\n    return beforeSetTotalListeners.reduce(\n      (total, listener) =>\n        listener({\n          total,\n          originQuery,\n        }),\n      unprocessedTotal,\n    );\n  }\n\n  _addToFetchesHistory(newPages: DataResultKeyed<T>[]) {\n    const { page, cursor, offset } = this.query.asComputed;\n\n    this.fetchesHistory.push({\n      itemsKeys: newPages\n        .flatMap((p) => p.items)\n        .map((item) => this.itemKey(item)),\n      queryPageInfo: {\n        page,\n        cursor,\n        offset,\n      },\n    });\n  }\n\n  updateResult(queries: Query<T>[]) {\n    const { result, paginationMode, emitter } = this;\n\n    const newPages = queries\n      .map((reactQuery) => reactQuery.state.data)\n      .filter((d): d is DataResultKeyed<T> => d != null);\n\n    this.updateStatus();\n\n    if (newPages.length) {\n      emitter.emit('beforeResultUpdated');\n\n      const lastPage = newPages[newPages.length - 1];\n      const { available, cursor, hasNext } = lastPage;\n\n      const unprocessedTotal = lastPage.total ?? lastPage.items.length;\n      const unprocessedPages = newPages.map((data) => data.items);\n\n      const { processedPages, processedTotal } = this._getProcessedResult({\n        unprocessedPages,\n        unprocessedTotal,\n        currentItemsMap: result._keyedItemsMap,\n      });\n\n      result.addPages({\n        unprocessed: unprocessedPages,\n        processed: processedPages,\n      });\n\n      result.setTotals({\n        unprocessed: unprocessedTotal,\n        processed: processedTotal,\n      });\n\n      this._addToFetchesHistory(newPages);\n\n      result.setSupportTotal(lastPage.total != null);\n      result.setHasNext(hasNext);\n\n      paginationMode.setCursor(cursor);\n      if (available != null) {\n        result.available = available;\n      }\n      this.lifecycleState = 'result';\n\n      emitter.emit('resultUpdated');\n\n      return {\n        newPages,\n      };\n    }\n\n    return null;\n  }\n\n  whenNotIdle(fn: (...args: any[]) => unknown) {\n    return (...args: any[]) => {\n      if (this.result.status.isIdle) {\n        return;\n      }\n\n      fn(...args);\n    };\n  }\n\n  updateStatus() {\n    const { queryObserver, result, query } = this;\n    const { status, error, isFetching } = queryObserver.getOptimisticResult(\n      queryObserver.options,\n    );\n\n    result.status = {\n      ...queryStatus[status],\n      isFetching,\n      error,\n    } as QueryResultStatus<DataResultKeyed<T>, unknown>;\n    result.originQuery = query.asComputed;\n  }\n\n  fetch() {\n    const { queryObserver, onlineState, emitter } = this;\n\n    queryObserver.setOptions(\n      {\n        ...queryObserver.options,\n        ...this.queryKeyOptions,\n        enabled: true,\n      },\n      {\n        onError: true,\n      },\n    );\n\n    const currentQuery = this.getCurrentQuery();\n    this._currentQueryPromise = new Promise<void>((resolve) => {\n      if (currentQuery.promise) {\n        currentQuery.promise.then(() => resolve()).catch(() => resolve());\n      } else {\n        resolve();\n      }\n    });\n\n    const isStale = currentQuery.isStale();\n\n    const fetchListeners = emitter.listeners('fetch');\n    const onResultListeners = fetchListeners.map((l) => l({ isStale }));\n\n    if (!onlineState.isOnline) {\n      currentQuery.dispatch({\n        type: 'error',\n        error: new OfflineError('CollectionState.fetch: offline'),\n      });\n    }\n\n    this.updateStatus();\n\n    return {\n      currentQuery,\n      isStale,\n      onResultListeners,\n      promise: this._currentQueryPromise,\n    };\n  }\n\n  get totalPages() {\n    const {\n      result: {\n        _totals: { unprocessed: total },\n      },\n      query: {\n        pagination: { limit },\n      },\n    } = this;\n    return Math.ceil(total / limit);\n  }\n\n  get total() {\n    return this.result.total;\n  }\n\n  get totalStatus() {\n    return this.result.totalStatus;\n  }\n\n  get fetchedLastPage() {\n    const {\n      paginationMode: { fetchedLastPage },\n    } = this;\n    return fetchedLastPage;\n  }\n\n  private readonly fetchNextPage = action(async () => {\n    const {\n      query,\n      result,\n      events: { onNewPageAdded, onNewPageStart },\n      emitter,\n    } = this;\n    // if current page has an error, do not skip to next page\n    if (!result.status.isError) {\n      query.pagination.nextPage();\n    }\n\n    this.lifecycleState = 'fetchMore';\n\n    const onNewPageAddedListeners = emitter\n      .listeners('newPageStart')\n      .map((l) => l());\n    const maybeOnNewPageAdded = onNewPageStart?.({\n      query: query.asComputed,\n    });\n\n    const { promise, currentQuery, onResultListeners } = this.fetch();\n    await promise;\n\n    runInAction(() => {\n      if (promise === this._currentQueryPromise) {\n        const updateResultInfo = this.updateResult([currentQuery]);\n\n        onResultListeners.forEach((l) => l?.());\n\n        if (updateResultInfo) {\n          const { newPages } = updateResultInfo;\n          const onNewPageAddedParams = {\n            totalNewItems: newPages.reduce(\n              (agg, page) => agg + page.items.length,\n              0,\n            ),\n            newPages,\n            query: result.originQuery,\n            result: result.asComputed,\n          };\n          onNewPageAddedListeners.forEach((l) => l(onNewPageAddedParams));\n          if (maybeOnNewPageAdded != null) {\n            maybeOnNewPageAdded(onNewPageAddedParams);\n          }\n          onNewPageAdded?.(onNewPageAddedParams);\n        }\n      }\n    });\n  });\n\n  async fetchNextPageIfNeeded() {\n    const { result, fetchedLastPage, lifecycleState } = this;\n    if (\n      lifecycleState !== 'refresh' &&\n      !result.status.isFetching &&\n      !fetchedLastPage\n    ) {\n      await this.fetchNextPage();\n    }\n  }\n\n  // for rendering only a single page (<PaginationTable />)\n  async clearAndMoveToPage(\n    page: number,\n    options: { wait?: { min: number; max: number } } = {},\n  ) {\n    let minLoaderTime = 0;\n    const { wait = { min: 200, max: 500 } } = options;\n    const {\n      query,\n      result,\n      events: { onNewPageStart },\n    } = this;\n    const { pagination } = query;\n    pagination.page = page;\n\n    const maybeOnNewPageAdded = onNewPageStart?.({\n      query: query.asComputed,\n    });\n\n    const { promise, currentQuery, onResultListeners } = this.fetch();\n    const fetchPromise = promise;\n\n    let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n    const maxWaitPromise = new Promise<void>((resolve) => {\n      timeoutId = setTimeout(() => {\n        // timeoutId was not cleared yet, start showing a loader and set minimal time for the loader to show\n        minLoaderTime = wait.min;\n        this.clearResultBeforeRefresh();\n        resolve();\n      }, wait.max);\n    });\n\n    // minimal time to wait (usually scrolling to top time) before applying the new result\n    const minWaitPromise = new Promise((resolve) => {\n      setTimeout(resolve, wait.min);\n    });\n\n    await Promise.race([maxWaitPromise, fetchPromise]);\n\n    if (timeoutId != null) {\n      clearTimeout(timeoutId);\n    }\n\n    if (minLoaderTime) {\n      await new Promise((resolve) => setTimeout(resolve, minLoaderTime));\n    }\n\n    await minWaitPromise;\n    await fetchPromise;\n\n    if (promise === this._currentQueryPromise) {\n      runInAction(() => {\n        result.clear();\n        const updateResultInfo = this.updateResult([currentQuery]);\n        onResultListeners.forEach((l) => l?.());\n        if (updateResultInfo) {\n          const { newPages } = updateResultInfo;\n          if (maybeOnNewPageAdded != null) {\n            maybeOnNewPageAdded({\n              totalNewItems: newPages.reduce(\n                (agg, page) => agg + page.items.length,\n                0,\n              ),\n              query: result.originQuery,\n              result: result.asComputed,\n            });\n          }\n        }\n      });\n    }\n  }\n\n  clearResultBeforeRefresh() {\n    const { result } = this;\n    this.lifecycleState = 'refresh';\n    result.clear();\n  }\n\n  async moveToFirstPage({\n    onResultUpdated,\n  }: {\n    onResultUpdated?: OnResultUpdated<F>;\n  } = {}) {\n    const {\n      query: { pagination },\n    } = this;\n\n    pagination.page = 1;\n    pagination.cursor = initialCursor;\n\n    await this.fetchAndReplaceResult({ onResultUpdated });\n  }\n\n  invalidate({ filters }: { filters?: FiltersKey<F> } = {}) {\n    const { queryCache, queryName } = this;\n    const queryLookup = {};\n    if (filters) {\n      Object.assign(queryLookup, {\n        filtersKey: filters,\n      });\n    }\n\n    queryCache\n      .findAll({ queryKey: [queryName, queryLookup] })\n      .forEach((q) => q.invalidate());\n  }\n\n  clearResultAndMoveToStart({\n    onResultUpdated,\n    force,\n    filters,\n  }: {\n    onResultUpdated?: OnResultUpdated<F>;\n    force?: boolean;\n    filters?: FiltersKey<F>;\n  } = {}) {\n    if (force) {\n      this.invalidate({ filters });\n    }\n    this._resetReactQuery();\n    this.clearResultBeforeRefresh();\n    return this.moveToFirstPage({ onResultUpdated });\n  }\n\n  sort(\n    col: Sortable,\n    {\n      clearResult,\n      multiple,\n      forceDirection,\n    }: {\n      clearResult?: boolean;\n      multiple?: boolean;\n      forceDirection?: SortOrder;\n    } = {},\n  ) {\n    const { query, emitter } = this;\n\n    emitter.emit('beforeSortStart', {\n      origin: 'ColumnHeader',\n    });\n\n    query.sort.changeSort(col, {\n      multiple,\n      forceDirection,\n    });\n\n    emitter.emit('sortStart', { col });\n\n    return this.scheduleSort({\n      clearResult,\n      multiple,\n      forceDirection,\n    });\n  }\n\n  async fetchAndReplaceResult({\n    onResultUpdated,\n  }: {\n    onResultUpdated?: OnResultUpdated<F>;\n  } = {}) {\n    const { result, query, emitter } = this;\n\n    const { promise, currentQuery, isStale, onResultListeners } = this.fetch();\n    // page=1 means starting over, i.e refresh\n    if (query.pagination.page === 1) {\n      emitter.emit('refresh', { isStale });\n    }\n\n    await promise;\n\n    if (promise === this._currentQueryPromise) {\n      runInAction(() => {\n        result.slice(0, query.pagination.page - 1);\n        this.emitter.emit('refreshUpdateResult');\n        this.updateResult([currentQuery]);\n        onResultListeners.forEach((l) => l?.());\n        onResultUpdated?.({\n          query: result.originQuery,\n          result: result.asComputed,\n        });\n      });\n    }\n\n    return currentQuery;\n  }\n\n  search(\n    value: string,\n    { force, clearResult }: { force?: boolean; clearResult?: boolean } = {},\n  ) {\n    const { query } = this;\n    const { search } = query;\n    if (force || value !== search.value) {\n      search.changeValue(value);\n      this.scheduleSearch(clearResult);\n    }\n  }\n\n  clearSearch() {\n    const {\n      query,\n      events: { onSearchResults },\n      emitter,\n    } = this;\n    const { search } = query;\n    if (search.value === '') {\n      return;\n    }\n\n    search.changeValue('');\n    emitter.emit('clearSearch');\n\n    if (this.selectionConsistencyMode === 'clear') {\n      this.bulkSelect.resetToDefaults();\n    }\n\n    return this.clearResultAndMoveToStart({ onResultUpdated: onSearchResults });\n  }\n\n  get filters() {\n    return this.query.filters;\n  }\n\n  changeItem(newItem: T) {\n    return this.changeItems([newItem]);\n  }\n\n  changeItems(newItems: T[]) {\n    const changeResult = this.result.changeItems(newItems);\n\n    if (changeResult != null) {\n      this.invalidate();\n\n      return changeResult.rollback;\n    }\n\n    return undefined;\n  }\n\n  addItem(newItem: T) {\n    return this.addItems([newItem]);\n  }\n\n  addItems(newItems: T[]) {\n    const changeResult = this.result.addItems(newItems);\n    this.invalidate();\n    return changeResult.rollback;\n  }\n\n  async refreshCurrentPage({ noInvalidate }: { noInvalidate?: boolean } = {}) {\n    const { emitter } = this;\n\n    if (!noInvalidate) {\n      this.invalidate();\n    }\n\n    this._resetReactQuery();\n    emitter.emit('refreshCurrentPage');\n\n    await this.fetchAndReplaceResult();\n  }\n\n  async refreshAllPages({\n    beforeUpdateResult,\n    filters,\n  }: {\n    beforeUpdateResult?: () => unknown;\n    filters?: FiltersKey<F>;\n  } = {}) {\n    const { query, result, paginationMode, emitter } = this;\n    const { pagination } = query;\n    const { page: currentPage } = pagination;\n\n    this.invalidate({ filters });\n\n    const promises: Promise<Query<T>>[] = [];\n\n    pagination.cursor = initialCursor;\n\n    emitter.emit('refreshAllPages');\n    emitter.emit('refresh', { isStale: true }); // Because of invalidation above, all queries are now stale\n\n    let lastPagePromise = undefined as Promise<unknown> | undefined;\n\n    for (let page = 1; page <= currentPage; page++) {\n      pagination.page = page;\n      this._resetReactQuery();\n      const { currentQuery: pageQuery, promise } = this.fetch();\n      if (pageQuery.promise) {\n        if (paginationMode.id === 'cursor') {\n          await pageQuery.promise;\n          runInAction(\n            () => (pagination.cursor = pageQuery.state.data?.cursor ?? null),\n          );\n        }\n        promises.push(pageQuery.promise.then(() => pageQuery));\n      }\n\n      if (page === currentPage) {\n        lastPagePromise = promise;\n      }\n    }\n\n    this.updateStatus();\n\n    const results = await Promise.all(promises);\n\n    runInAction(() => {\n      beforeUpdateResult?.();\n      if (lastPagePromise === this._currentQueryPromise) {\n        result.slice(currentPage);\n        this.emitter.emit('refreshUpdateResult');\n        this.updateResult(results);\n      }\n    });\n  }\n\n  get hasAvailableItems() {\n    return this.result.hasAvailableItems;\n  }\n\n  resetFiltersAndRefresh() {\n    const { query } = this;\n    query.resetFilters({ emitEvents: ['change', 'refresh'] });\n  }\n\n  resetCustomFiltersAndRefresh() {\n    const { query } = this;\n    query.resetCustomFilters({ emitEvents: ['change', 'refresh'] });\n  }\n\n  async initialFetch() {\n    const {\n      result,\n      events: { onInitialPageFetched },\n      emitter,\n      query: { pagination },\n    } = this;\n\n    const prevQuery = this.getCurrentQuery();\n\n    if (!result.status.isIdle && !result.status.isError) {\n      return prevQuery.promise;\n    }\n\n    this._resetReactQuery();\n\n    pagination.page = 1;\n    pagination.cursor = initialCursor;\n\n    this.lifecycleState = 'refresh';\n    const isStale = prevQuery.isStale();\n    const beforeInitialFetchListeners = emitter.listeners('beforeInitialFetch');\n    await Promise.all(beforeInitialFetchListeners.map((f) => f({ isStale })));\n\n    // reset paging state again for any possible edge case caused by external side effect while waiting `beforeInitialFetchListeners`\n    runInAction(() => {\n      pagination.page = 1;\n      pagination.cursor = initialCursor;\n      this.lifecycleState = 'refresh';\n    });\n\n    const currentQuery = await this.fetchAndReplaceResult();\n    await currentQuery.promise;\n    this.emitter.emit('ready');\n    runInAction(() => {\n      const { total, available } = result;\n      onInitialPageFetched?.({\n        result: {\n          total,\n          available: available ?? 0,\n        },\n        query: result.originQuery,\n      });\n    });\n  }\n\n  _recoverIfError = action(() => {\n    const { onlineState } = this;\n    const { focusManager } = onlineState;\n\n    if (\n      focusManager.isFocused() &&\n      onlineState.isOnline &&\n      this.result.status.isError\n    ) {\n      if (this.lifecycleState === 'fetchMore') {\n        // error state is not shown, fetch next page\n        this.fetchNextPageIfNeeded();\n      } else {\n        // error state is shown, move to start\n        this.clearResultAndMoveToStart({ force: true });\n      }\n    }\n  });\n\n  onOnlineStateChange = (isOnline: boolean) => {\n    const currentQuery = this.getCurrentQuery();\n\n    if (isOnline) {\n      this._recoverIfError();\n    } else if (!isOnline && currentQuery.state.isPaused) {\n      currentQuery.dispatch({\n        type: 'error',\n        error: new OfflineError('CollectionState.onOnlineStateChange: offline'),\n      });\n      this.updateStatus();\n    }\n  };\n\n  retryErrorState = action(() => {\n    const { initTask } = this;\n\n    if (initTask.status.isError) {\n      initTask.runOnce();\n    } else {\n      this.clearResultAndMoveToStart();\n    }\n  });\n\n  init({\n    skipInitialFetch,\n    skipFilterListeners,\n  }: { skipInitialFetch?: boolean; skipFilterListeners?: boolean } = {}) {\n    const { bulkSelect, onlineState, query, initTask, result } = this;\n    const { focusManager } = onlineState;\n\n    result.originQuery = query.asComputed;\n\n    onlineState.events.on('change', this.onOnlineStateChange);\n\n    const disposers = [\n      query.init({ skipFilterListeners }),\n      this._registerQueryEvents(),\n      result.init(),\n      bulkSelect.init(),\n      // react-query considers \"mounted\" only if listeners are subscribed\n      this.queryObserver.subscribe(() => {}),\n      focusManager.subscribe(this._recoverIfError),\n    ];\n\n    initTask.runOnce(async () => {\n      await Promise.all([\n        skipInitialFetch ? null : this.initialFetch(),\n        this.initDependencies?.(),\n      ]);\n    });\n\n    return action(() => {\n      onlineState.events.off('change', this.onOnlineStateChange);\n      disposers.forEach((disposer) => disposer());\n      initTask.status = {\n        ...queryStatus.idle,\n      };\n    });\n  }\n\n  _registerQueryEvents() {\n    const { query } = this;\n    const disposers = [\n      addEventListener(query.events, 'refresh', (opts) => {\n        if (this.selectionConsistencyMode === 'clear') {\n          this.bulkSelect.resetToDefaults();\n        }\n\n        if (this.deferInitialLoading) {\n          this.refreshPromises.addPromise(this.animationFramePromise);\n        }\n\n        if (opts?.clearResult !== false) {\n          this.clearResultBeforeRefresh();\n        } else {\n          this.scrollableContent?.scrollTo({ top: 0, behavior: 'smooth' });\n        }\n\n        this.moveToFirstPage();\n      }),\n      addEventListener(query.events, 'scheduleRefresh', (opts) => {\n        this.scheduleSearch(opts?.clearResult);\n      }),\n      ...(query.refreshOnColumnsChange\n        ? [\n            reaction(\n              () => query.fieldsKeyHash,\n              () => {\n                this.clearResultBeforeRefresh();\n                this.moveToFirstPage();\n              },\n            ),\n          ]\n        : []),\n    ];\n\n    return () => {\n      disposers.forEach((d) => d());\n    };\n  }\n\n  getItem(key: string): T | undefined | null {\n    const keyedItem = this.result.get(key);\n    return keyedItem?.item;\n  }\n\n  getKeyedItem(key: string): KeyedItem<T> | undefined | null {\n    return this.result.get(key);\n  }\n\n  getKeyedItemByIndex(index: number): KeyedItem<T> | null {\n    return this.result.keyedItems[index];\n  }\n\n  get keyedItems() {\n    return this.result.keyedItems;\n  }\n\n  addRefreshPromise<P>(createPromise: () => Promise<P>) {\n    return this.refreshPromises.addPromise(createPromise);\n  }\n\n  _commonDynamicBiParams(query = this.result.originQuery): {\n    currentFilters?: string;\n    currentSortOrder?: string;\n    filteredListSize?: number;\n    initialItems?: number;\n    numSortedColumns?: number;\n    csid?: string;\n  } {\n    const { result, fqdn } = this;\n\n    return {\n      ...fqdn,\n      currentFilters: JSON.stringify(query.filtersKey),\n      currentSortOrder: query.sort?.length\n        ? JSON.stringify(query.sort)\n        : undefined,\n      filteredListSize: result.total,\n      initialItems: result.size,\n      numSortedColumns: query.sort?.length,\n    };\n  }\n\n  get showInitialLoader() {\n    const {\n      initTask: {\n        status: { isLoading },\n      },\n      initialPromises: { isLoadingPromises },\n    } = this;\n    return isLoading || isLoadingPromises;\n  }\n\n  get showRefreshLoader() {\n    const {\n      refreshPromises: { isLoadingPromises },\n      result: { status },\n      lifecycleState,\n    } = this;\n    return (\n      isLoadingPromises ||\n      Boolean(status.isFetching && lifecycleState === 'refresh')\n    );\n  }\n\n  get showEmptyState() {\n    const {\n      lifecycleState,\n      result: { isEmpty },\n    } = this;\n    return lifecycleState === 'result' && isEmpty;\n  }\n\n  get showErrorState() {\n    const {\n      result: { status },\n      lifecycleState,\n    } = this;\n    return (\n      !status.isFetching && status.isError && lifecycleState !== 'fetchMore'\n    );\n  }\n\n  _topNotification = new TransitionState<string | null>();\n\n  get topNotification(): {\n    text: string | null | undefined;\n    readonly show: boolean;\n  } {\n    const { _topNotification } = this;\n    return {\n      set text(t: string | null | undefined) {\n        _topNotification.set(t);\n      },\n      get text() {\n        return runInAction(() => _topNotification.data);\n      },\n      get show() {\n        return runInAction(() => _topNotification.show);\n      },\n    };\n  }\n}\n"],"mappings":"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","ignoreList":[]}