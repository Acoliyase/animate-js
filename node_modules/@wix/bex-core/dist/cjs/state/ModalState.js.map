{"version":3,"names":["_ToggleState","require","_mobx","_model","_events","ModalState","constructor","params","_defineProperty2","default","ToggleState","openToggle","toggle","queryStatus","idle","EventEmitter","events","emit","makeObservable","confirming","observable","open","action","bound","confirm","close","isOpen","computed","onConfirm","onClose","setOn","promise","Promise","resolve","once","options","_this$onConfirm","loading","call","runInAction","success","result","setOff","e","error","_this$onClose","decline","_this$onClose2","isOn","exports"],"sources":["../../../src/state/ModalState.ts"],"sourcesContent":["import { ToggleState } from './ToggleState';\nimport {\n  action,\n  computed,\n  makeObservable,\n  observable,\n  runInAction,\n} from 'mobx';\nimport { QueryStatus, queryStatus } from '../model';\nimport { EventEmitter } from 'events';\nimport { TypedEmitter } from '../util';\n\ntype InteractionFn = () => void | Promise<unknown>;\n\nexport interface ModalStateParams {\n  onConfirm?: InteractionFn;\n  onClose?: InteractionFn;\n}\n\ninterface CloseOptions {\n  result: 'confirmed' | 'declined' | 'dismissed';\n}\n\nexport class ModalState {\n  public readonly openToggle = new ToggleState();\n  public readonly toggle = this.openToggle.toggle;\n\n  readonly onConfirm?: InteractionFn;\n  readonly onClose?: InteractionFn;\n  confirming: QueryStatus = queryStatus.idle;\n\n  readonly events = new EventEmitter() as TypedEmitter<{\n    open: () => void;\n    close: (options: CloseOptions) => void;\n    requestClose: () => void;\n  }>;\n\n  constructor(params: ModalStateParams = {}) {\n    makeObservable(this, {\n      confirming: observable,\n      open: action.bound,\n      confirm: action.bound,\n      close: action.bound,\n      isOpen: computed,\n    });\n\n    this.onConfirm = params.onConfirm;\n    this.onClose = params.onClose;\n  }\n\n  open() {\n    this.events.emit('open');\n    this.openToggle.setOn();\n  }\n\n  promise() {\n    return new Promise<CloseOptions>((resolve) => {\n      this.events.once('close', (options) => {\n        resolve(options);\n      });\n    });\n  }\n\n  async confirm() {\n    try {\n      this.confirming = queryStatus.loading;\n      await this.onConfirm?.();\n      runInAction(() => {\n        this.confirming = queryStatus.success;\n        this.events.emit('close', {\n          result: 'confirmed',\n        });\n        return this.openToggle.setOff();\n      });\n    } catch (e) {\n      runInAction(() => {\n        this.confirming = queryStatus.error;\n      });\n    }\n  }\n\n  close() {\n    this.onClose?.();\n    this.events.emit('close', { result: 'dismissed' });\n    return this.openToggle.setOff();\n  }\n\n  decline() {\n    this.onClose?.();\n    this.events.emit('close', { result: 'declined' });\n    return this.openToggle.setOff();\n  }\n\n  requestClose = () => {\n    this.events.emit('requestClose');\n  };\n\n  get isOpen() {\n    return this.openToggle.isOn;\n  }\n}\n"],"mappings":"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","ignoreList":[]}