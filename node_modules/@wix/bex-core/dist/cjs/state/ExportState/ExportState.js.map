{"version":3,"names":["_http","require","_types","_mobx","_model","_services","_mapValues","_interopRequireDefault","_events","_ExportStateBIReporter","_getJobItemsAbsoluteCounter","_getExportAsyncJobErrors","_createExportAsyncJobErrors","defaultPlatformizedQuery","filter","sort","ExportState","constructor","props","_defineProperty2","default","queryStatus","idle","pollingDelay","stateJob","maxPolling","maxRetries","queryJobRetries","delay","max","iterationsCount","pollCount","retries","count","EventEmitter","selected","action","collection","bulkSelect","selectedCountOrTotal","filtered","result","total","supportTotal","all","allItemsQuery","query","asComputed","filtersKey","mapValues","customFilters","undefined","rawFilters","filters","queryKey","_queryKey","allItemsQueryResult","queryClient","fetchQuery","queryFn","_queryFn","e","preventDefault","returnValue","customTotal","differentQueryEndpointThanCollection","translate","createExportAsyncJobRequest","saveAs","window","httpClient","errorHandler","onlineState","exportModalState","collectionPageState","showToast","internalMonitor","reportBi","disabledRadios","transformPlatformizedQuery","bi","ExportStateBIReporter","makeObservable","exportStatus","observable","ref","iterationsCountPoll","isExporting","computed","totalForExport","selectedExportOption","counter","absoluteCounter","onExportToClick","bound","onExportCloseAttemptClick","onCancelExportCloseButtonClick","onCancelExportGoBackButtonClick","onExportSecondaryActionAttempt","onRetryExportToClick","onFailedClose","onFailedCancel","onCancelClick","onCloseClick","init","setTotalForExport","onExportTypeChange","hasFilters","totalForExportMap","hasSelectedRows","isAllSelected","currentStep","_onJobSuccess","_checkIfStaleJob","_throwJobError","_updateJobProgress","isModalOpen","isOpen","isLoading","isSuccess","_cancelJob","_reset","prev","next","_this$maybeToast","maybeToast","remove","clickOpenModal","onOnlineChanged","isOnline","events","emit","on","removeEventListener","beforeunload","removeAllListeners","off","hasActiveFilters","selectedIds","length","allSelected","totalForExportGettersMap","params","collectionTotalPromise","runInAction","close","onCancelExportVerifyButtonClick","onCancelExportButtonClick","onExportCancelAttemptClick","exportStartTime","performance","now","interactionStarted","reportExportEnd","onExportStart","_exportTo","onExportEnd","interactionEnded","job","_job$data","_this$showToast","t","data","signedUrl","once","Promise","resolve","setTimeout","success","_updateAbsoluteCounter","res","biState","beforeToast","call","message","biName","timeout","type","onToastDismissed","by","text","uiType","navigationTarget","url","openInNewTab","onClick","onToastActionClick","download","then","_job$data2","_job$data3","_job$data4","error","applicationError","code","Object","assign","Error","response","_job$data5","_job$data6","status","JobStatus","FINISHED","_job$data7","completionStep","config","_job$data8","newAbsoluteCounter","getJobItemsAbsoluteCounter","Math","floor","random","newCounter","round","_poll","jobId","current","_job$data$error","currentJob","promise","getExportAsyncJobResponse","withErrorHandler","request","getExportAsyncJob","errorCodesMap","getExportAsyncJobErrors","retryFn","catch","getResolvedError","WixPatternsError","errorCode","originalException","extraData","loading","FAILED","_job$data$error2","checkIfStaleJobResult","_job$data9","_job$data0","pagingMetadata","console","reportError","_this$saveAs","addEventListener","platformizedQuery","selectAll","uncheckedInCurrentCollection","uncheckedValues","computedQuery","wixPatternsQuery","exportPublicState","selectedItems","isSelectAll","totalForExportPromise","pageTitle","_createExport","createExportAsyncJobResponse","createExportAsyncJob","fields","methodMetadata","createExportAsyncJobErrors","err","_createExportAsyncJob","id","_createExportAsyncJob2","exports"],"sources":["../../../../src/state/ExportState/ExportState.ts"],"sourcesContent":["import {\n  createExportAsyncJob,\n  getExportAsyncJob,\n} from '@wix/bex-utils/@wix/ambassador-fedinfra-exportservice-v1-export-async-job/http';\nimport {\n  CreateExportAsyncJobRequest,\n  ExportAsyncJob,\n  ExportQueryV2 as QueryV2,\n  Status as JobStatus,\n} from '@wix/bex-utils/@wix/ambassador-fedinfra-exportservice-v1-export-async-job/types';\nimport {\n  action,\n  computed,\n  makeObservable,\n  observable,\n  runInAction,\n} from 'mobx';\nimport {\n  WixPatternsEssentials,\n  ComputedQueryFull,\n  FiltersMap,\n  queryStatus,\n  ShowToast,\n  TaskStatus,\n  PatternsErrorHandler,\n} from '../../model';\nimport {\n  WixPatternsError,\n  WixPatternsMonitor,\n  PartialWindow,\n  ReportBI,\n  Translate,\n} from '../../services';\nimport { CollectionState } from '../CollectionState';\nimport mapValues from 'lodash/mapValues';\nimport { EventEmitter } from 'events';\nimport { TypedEmitter } from '../../util';\nimport { ExportStateBIReporter } from './ExportStateBIReporter';\nimport { ModalState } from '../ModalState';\nimport { getJobItemsAbsoluteCounter } from '../getJobItemsAbsoluteCounter';\nimport { ExportJobStateParams } from './ExportJobState';\nimport { ErrorDetails } from '../../util/isHttpError';\nimport { OnlineState } from '../OnlineState';\nimport { CollectionPageState } from '../CollectionPageState';\nimport { getExportAsyncJobErrors } from './getExportAsyncJobErrors';\nimport { createExportAsyncJobErrors } from './createExportAsyncJobErrors';\n\nfunction defaultPlatformizedQuery(): QueryV2 {\n  return {\n    filter: {},\n    sort: [],\n  };\n}\n\ninterface ExportPublicState<T, F extends FiltersMap> {\n  platformizedQuery: QueryV2;\n  wixPatternsQuery: ComputedQueryFull<F>;\n  selectedItems?: string[];\n  isSelectAll: boolean;\n  uncheckedValues?: T[];\n}\n\nexport type CustomTotalFn<T, F extends FiltersMap> = (\n  params: ExportPublicState<T, F> & {\n    collectionTotalPromise: number | null | Promise<number | null | undefined>;\n  },\n) => number | null | undefined | Promise<number | null | undefined>;\n\nexport type TransformQuery<T, F extends FiltersMap> = (\n  params: ExportPublicState<T, F>,\n) => QueryV2 | Promise<QueryV2>;\n\nexport type SaveAsFn<T, F extends FiltersMap> = (\n  params: ExportPublicState<T, F>,\n) => string;\n\nexport interface ExportStateProps<T, F extends FiltersMap> {\n  transformPlatformizedQuery?: TransformQuery<T, F>;\n  differentQueryEndpointThanCollection?: boolean;\n  customTotal?: CustomTotalFn<T, F>;\n\n  createExportAsyncJobRequest: Partial<CreateExportAsyncJobRequest>;\n  saveAs?: SaveAsFn<T, F>;\n\n  httpClient: WixPatternsEssentials['httpClient'];\n  errorHandler: PatternsErrorHandler;\n  showToast?: ShowToast;\n  translate: Translate;\n  collection: CollectionState<T, F>;\n  reportBi: ReportBI;\n  onlineState: OnlineState;\n  internalMonitor: WixPatternsMonitor;\n\n  exportModalState: ModalState;\n  collectionPageState: CollectionPageState;\n  window: PartialWindow;\n}\n\nexport type SelectedExportOption = 'all' | 'selected' | 'filtered';\n\nexport class ExportState<T, F extends FiltersMap> {\n  exportStatus: TaskStatus<ExportAsyncJob, unknown> = {\n    ...queryStatus.idle,\n  };\n\n  readonly config = {\n    pollingDelay: 2000,\n    stateJob: {\n      maxPolling: 14,\n      maxRetries: 1,\n    },\n    queryJobRetries: {\n      delay: 5000,\n      max: 4,\n    },\n  };\n\n  exportStartTime: number = 0;\n  totalForExport: number | undefined | null = null;\n  selectedExportOption: SelectedExportOption = 'all';\n  disabledRadios: SelectedExportOption[];\n  maybeToast?: { remove: () => void };\n  iterationsCountPoll: {\n    iterationsCount?: number;\n    pollCount: number;\n    retries: number;\n  } = {\n    iterationsCount: 0,\n    pollCount: 0,\n    retries: 0,\n  };\n\n  queryJobRetries: {\n    count: number;\n  } = {\n    count: 0,\n  };\n\n  readonly differentQueryEndpointThanCollection;\n  readonly customTotal;\n  readonly translate;\n  readonly createExportAsyncJobRequest;\n  readonly saveAs;\n  readonly window;\n  readonly httpClient: WixPatternsEssentials['httpClient'];\n  readonly errorHandler;\n  readonly onlineState;\n  readonly exportModalState;\n  readonly collectionPageState;\n  readonly transformPlatformizedQuery?: ExportStateProps<\n    T,\n    F\n  >['transformPlatformizedQuery'];\n  readonly showToast;\n  readonly internalMonitor;\n  readonly collection;\n  readonly reportBi;\n  readonly bi;\n\n  readonly events = new EventEmitter() as TypedEmitter<{\n    afterJobCreated: (params: { job: ExportAsyncJob }) => unknown;\n    undoCancel: () => unknown;\n    online: () => unknown;\n  }>;\n\n  counter = 0;\n  absoluteCounter = 0;\n  retries = 0;\n\n  constructor(props: ExportStateProps<T, F>) {\n    this.customTotal = props.customTotal;\n    this.differentQueryEndpointThanCollection =\n      props.differentQueryEndpointThanCollection;\n    this.translate = props.translate;\n    this.createExportAsyncJobRequest = props.createExportAsyncJobRequest;\n    this.saveAs = props.saveAs;\n    this.window = props.window;\n    this.httpClient = props.httpClient;\n    this.errorHandler = props.errorHandler;\n    this.onlineState = props.onlineState;\n    this.exportModalState = props.exportModalState;\n    this.collectionPageState = props.collectionPageState;\n    this.showToast = props.showToast;\n    this.internalMonitor = props.internalMonitor;\n    this.collection = props.collection;\n    this.reportBi = props.reportBi;\n    this.disabledRadios = [];\n    this.transformPlatformizedQuery = props.transformPlatformizedQuery;\n\n    this.bi = new ExportStateBIReporter(this);\n    makeObservable(this, {\n      exportStatus: observable.ref,\n      iterationsCountPoll: observable.ref,\n      isExporting: computed,\n      totalForExport: observable.ref,\n      selectedExportOption: observable.ref,\n      disabledRadios: observable.ref,\n      counter: observable.ref,\n      absoluteCounter: observable.ref,\n      onExportToClick: action.bound,\n      onExportCloseAttemptClick: action.bound,\n      onCancelExportCloseButtonClick: action.bound,\n      onCancelExportGoBackButtonClick: action.bound,\n      onExportSecondaryActionAttempt: action.bound,\n      onRetryExportToClick: action.bound,\n      onFailedClose: action.bound,\n      onFailedCancel: action.bound,\n      onCancelClick: action.bound,\n      onCloseClick: action.bound,\n      init: action.bound,\n      setTotalForExport: action,\n      onExportTypeChange: action,\n      hasFilters: computed,\n      totalForExportMap: computed,\n      hasSelectedRows: computed,\n      isAllSelected: computed,\n      currentStep: observable.ref,\n      _onJobSuccess: action,\n      _checkIfStaleJob: action,\n      _throwJobError: action,\n      _updateJobProgress: action,\n    });\n  }\n\n  get isModalOpen() {\n    return this.exportModalState.isOpen;\n  }\n\n  currentStep: 'config' | 'progress' | 'error' | 'cancel' = 'config';\n\n  get isExporting() {\n    const { exportStatus } = this;\n    return exportStatus.isLoading || exportStatus.isSuccess;\n  }\n\n  _cancelJob() {\n    // const { events } = this;\n    // events.once('afterJobCreated', ({ job }) => {\n    //   const { httpClient } = this;\n    //   httpClient.request(\n    //     cancelExportAsyncJob({\n    //       jobId: job.id as string,\n    //     }),\n    //   );\n    // });\n  }\n\n  _reset() {\n    this.exportStatus = {\n      ...queryStatus.idle,\n    };\n    this.currentStep = 'config';\n    this.counter = 0;\n    this.absoluteCounter = 0;\n    this.totalForExport = null;\n  }\n\n  onExportTypeChange(selectedExportOption: SelectedExportOption) {\n    this.bi.onExportTypeChange({\n      prev: this.selectedExportOption,\n      next: selectedExportOption,\n    });\n    this.selectedExportOption = selectedExportOption;\n  }\n\n  init() {\n    const { onlineState } = this;\n    this.maybeToast?.remove();\n\n    if (this.hasSelectedRows) {\n      this.disabledRadios = this.hasFilters ? [] : ['filtered'];\n      this.selectedExportOption = 'selected';\n    } else if (this.hasFilters) {\n      this.disabledRadios = ['selected'];\n      this.selectedExportOption = 'filtered';\n    } else {\n      this.disabledRadios = ['selected', 'filtered'];\n      this.selectedExportOption = 'all';\n    }\n\n    this.bi.clickOpenModal();\n\n    const onOnlineChanged = action((isOnline: boolean) => {\n      if (isOnline && this.currentStep === 'error') {\n        this.currentStep = 'progress';\n        this.events.emit('online');\n      }\n    });\n\n    onlineState.events.on('change', onOnlineChanged);\n\n    return () => {\n      window.removeEventListener('beforeunload', this.beforeunload);\n      this.events.removeAllListeners('undoCancel');\n      this.events.removeAllListeners('online');\n      onlineState.events.off('change', onOnlineChanged);\n    };\n  }\n\n  get hasFilters() {\n    return this.collection.query.hasActiveFilters;\n  }\n\n  get hasSelectedRows() {\n    return (\n      this.collection.bulkSelect.selectedIds.length !== undefined &&\n      this.collection.bulkSelect.selectedIds.length > 0\n    );\n  }\n\n  get isAllSelected() {\n    return this.collection.bulkSelect.allSelected;\n  }\n\n  get totalForExportMap() {\n    return {\n      selected: this.totalForExportGettersMap.selected(),\n      filtered: this.totalForExportGettersMap.filtered(),\n    };\n  }\n\n  readonly totalForExportGettersMap = {\n    selected: action(() => {\n      const { collection } = this;\n\n      const {\n        bulkSelect: { selectedCountOrTotal },\n      } = collection;\n\n      return selectedCountOrTotal;\n    }),\n    filtered: action(() => {\n      const { collection } = this;\n      const {\n        result: { total, supportTotal },\n      } = collection;\n\n      if (!supportTotal) {\n        return null;\n      }\n\n      return total;\n    }),\n    all: action(async () => {\n      const { collection } = this;\n\n      const allItemsQuery = {\n        ...collection.query.asComputed,\n        filtersKey: mapValues(collection.query.customFilters, (filter) =>\n          filter != null ? null : undefined,\n        ),\n        rawFilters: {},\n        filters: {},\n      };\n\n      const queryKey = collection._queryKey(allItemsQuery);\n\n      const allItemsQueryResult = await collection.queryClient.fetchQuery({\n        queryFn: () => collection._queryFn(allItemsQuery),\n        queryKey,\n      });\n\n      return allItemsQueryResult.total;\n    }),\n  };\n\n  async setTotalForExport(params: ExportPublicState<T, F>) {\n    const { selectedExportOption, collection } = this;\n    const {\n      result: { supportTotal },\n    } = collection;\n\n    if (this.differentQueryEndpointThanCollection === true) {\n      return;\n    }\n\n    const collectionTotalPromise = (() => {\n      if (selectedExportOption === 'selected') {\n        return this.totalForExportGettersMap.selected();\n      }\n\n      if (selectedExportOption === 'filtered' && supportTotal) {\n        return this.totalForExportGettersMap.filtered();\n      }\n\n      return this.totalForExportGettersMap.all();\n    })();\n\n    if (this.customTotal) {\n      const totalForExport = await this.customTotal({\n        ...params,\n        collectionTotalPromise,\n      });\n      runInAction(() => {\n        this.totalForExport = totalForExport;\n      });\n      return;\n    }\n\n    const totalForExport = await collectionTotalPromise;\n    runInAction(() => {\n      this.totalForExport = totalForExport;\n    });\n  }\n\n  onCancelClick() {\n    const { bi, exportModalState } = this;\n    bi.onCancelClick();\n    exportModalState.close();\n  }\n\n  onCancelExportVerifyButtonClick() {\n    const { bi, exportModalState } = this;\n    bi.onCancelExportButtonClick();\n    exportModalState.close();\n  }\n\n  onCancelExportGoBackButtonClick() {\n    this.currentStep = 'progress';\n    const { bi, events } = this;\n    bi.onCancelExportGoBackButtonClick();\n    events.emit('undoCancel');\n  }\n\n  onCancelExportCloseButtonClick() {\n    this.currentStep = 'progress';\n    const { bi, events } = this;\n    bi.onCancelExportCloseButtonClick();\n    events.emit('undoCancel');\n  }\n\n  onExportCloseAttemptClick() {\n    this.currentStep = 'cancel';\n    const { bi } = this;\n    bi.onExportCloseAttemptClick();\n  }\n\n  onExportSecondaryActionAttempt() {\n    this.currentStep = 'cancel';\n    const { bi } = this;\n    bi.onExportCancelAttemptClick();\n  }\n\n  onCloseClick() {\n    const { bi, exportModalState } = this;\n    bi.onCloseClick();\n    exportModalState.close();\n  }\n\n  async onExportToClick() {\n    const { internalMonitor, bi } = this;\n    this.retries += 1;\n    this.iterationsCountPoll = {\n      iterationsCount: 0,\n      retries: 0,\n      pollCount: 0,\n    };\n    this.queryJobRetries = {\n      count: 0,\n    };\n    this.exportStartTime = performance.now();\n    internalMonitor.interactionStarted('export-to');\n    bi.onExportToClick();\n    const reportExportEnd = bi.onExportStart();\n    this._exportTo({\n      onExportEnd: action((params) => {\n        if (params.result !== 'fail') {\n          internalMonitor.interactionEnded('export-to');\n        }\n\n        reportExportEnd(params);\n      }),\n    });\n  }\n\n  beforeunload = (e: BeforeUnloadEvent) => {\n    e.preventDefault();\n    e.returnValue = '';\n  };\n\n  async onRetryExportToClick() {\n    const { bi } = this;\n    bi.onRetryExportToClick();\n    await this.onExportToClick();\n  }\n\n  async onFailedClose() {\n    const { bi, exportModalState } = this;\n    bi.onFailedClose();\n    exportModalState.close();\n  }\n\n  async onFailedCancel() {\n    const { bi, exportModalState } = this;\n    bi.onFailedCancel();\n    exportModalState.close();\n  }\n\n  async _onJobSuccess(job: ExportAsyncJob, params: ExportJobStateParams) {\n    const { events, exportModalState, translate: t } = this;\n    const { onExportEnd, query, saveAs } = params;\n\n    if (job.data?.signedUrl == null) {\n      return;\n    }\n\n    if (this.currentStep === 'cancel') {\n      events.once('undoCancel', async () => {\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n        return this._onJobSuccess(job, { onExportEnd, query, saveAs });\n      });\n      return;\n    }\n\n    runInAction(() => {\n      this.exportStatus = {\n        ...queryStatus.success,\n        data: job,\n      };\n      this.counter = 100;\n      this._updateAbsoluteCounter(job, params);\n    });\n\n    window.removeEventListener('beforeunload', this.beforeunload);\n    await new Promise((res) => setTimeout(res, 1000)); // wait bit before starting the download for the progress indication animation completes\n\n    const signedUrl = job.data.signedUrl;\n\n    onExportEnd({ job, query, result: 'success', saveAs });\n    const biState = this.bi.beforeToast();\n\n    const maybeToast = this.showToast?.({\n      message: t('cairo.export.successMessage'),\n      biName: 'cairo-export-success-toast',\n      timeout: 'NONE',\n      type: 'SUCCESS',\n      onCloseClick: () => {\n        this.bi.onToastDismissed({\n          ...biState,\n          by: 'manual',\n        });\n        this.maybeToast = undefined;\n      },\n      action: {\n        text: t('cairo.export.downloadManually'),\n        uiType: 'LINK',\n        navigationTarget: {\n          url: signedUrl,\n          openInNewTab: true,\n        },\n        onClick: () => {\n          this.bi.onToastActionClick(biState);\n          this.maybeToast = undefined;\n        },\n      },\n    });\n\n    this.maybeToast = maybeToast;\n\n    this.window.download(signedUrl, saveAs);\n\n    if (maybeToast) {\n      new Promise((resolve) => setTimeout(resolve, 6000)).then(() => {\n        if (maybeToast === this.maybeToast) {\n          maybeToast.remove();\n          this.bi.onToastDismissed({\n            ...biState,\n            by: 'automatic',\n          });\n        }\n      });\n    }\n\n    exportModalState.close();\n  }\n\n  _throwJobError(\n    job: ExportAsyncJob,\n    { onExportEnd, query }: ExportJobStateParams,\n  ) {\n    if (job.data?.error?.applicationError?.code === 'job_cancelled_by_client') {\n      onExportEnd({ job, query, result: 'stopped by user' });\n\n      return;\n    }\n\n    onExportEnd({ job, query, result: 'fail' });\n\n    throw Object.assign(\n      new Error(`ExportAsyncJob.${job.data?.error?.applicationError?.code}`),\n      {\n        response: {\n          data: job.data?.error,\n        },\n        job,\n        query,\n      },\n    );\n  }\n\n  _checkIfStaleJob(\n    job: ExportAsyncJob,\n    { onExportEnd, query }: ExportJobStateParams,\n  ) {\n    const { internalMonitor } = this;\n\n    if (job.status === JobStatus.FINISHED && !job.data?.signedUrl) {\n      internalMonitor.interactionStarted(\n        'export-to-finished-without-download-url',\n      );\n      internalMonitor.interactionEnded(\n        'export-to-finished-without-download-url',\n      );\n    }\n\n    if (\n      job.data?.iterationsCount === this.iterationsCountPoll.iterationsCount\n    ) {\n      this.iterationsCountPoll = {\n        ...this.iterationsCountPoll,\n        pollCount: this.iterationsCountPoll.pollCount + 1,\n      };\n\n      if (\n        job.data?.completionStep !== 'upload' &&\n        this.iterationsCountPoll.pollCount > this.config.stateJob.maxPolling\n      ) {\n        if (\n          this.iterationsCountPoll.retries < this.config.stateJob.maxRetries\n        ) {\n          internalMonitor.interactionStarted('export-to-max-polling-stale-job');\n          internalMonitor.interactionEnded('export-to-max-polling-stale-job');\n          runInAction(() => {\n            this.iterationsCountPoll = {\n              iterationsCount: 0,\n              pollCount: 0,\n              retries: this.iterationsCountPoll.retries + 1,\n            };\n          });\n          window.removeEventListener('beforeunload', this.beforeunload);\n          this._exportTo({ onExportEnd });\n          return 'restarted';\n        }\n\n        onExportEnd({ job, query, result: 'fail' });\n\n        throw Object.assign(new Error('ExportAsyncJob.max_polling_stale_job'), {\n          response: {\n            data: {\n              applicationError: {\n                code: 'max_polling_stale_job',\n              },\n            } as ErrorDetails,\n          },\n        });\n      }\n    } else {\n      this.iterationsCountPoll = {\n        ...this.iterationsCountPoll,\n        iterationsCount: job.data?.iterationsCount,\n        pollCount: 1,\n      };\n    }\n\n    return;\n  }\n\n  _updateAbsoluteCounter(job: ExportAsyncJob, { query }: ExportJobStateParams) {\n    if (job?.data == null) {\n      return;\n    }\n\n    const { totalForExport } = this;\n\n    const newAbsoluteCounter = getJobItemsAbsoluteCounter(job, {\n      query,\n      totalForExport,\n    });\n\n    this.absoluteCounter =\n      totalForExport != null &&\n      newAbsoluteCounter >= totalForExport &&\n      !this.exportStatus.isSuccess\n        ? this.absoluteCounter +\n          Math.floor(\n            Math.random() * (newAbsoluteCounter - this.absoluteCounter),\n          )\n        : newAbsoluteCounter;\n  }\n\n  _updateJobProgress(job: ExportAsyncJob, params: ExportJobStateParams) {\n    this._updateAbsoluteCounter(job, params);\n\n    const { totalForExport } = this;\n    if (totalForExport) {\n      if (this.absoluteCounter) {\n        const newCounter = Math.round(\n          (this.absoluteCounter / totalForExport) * 100,\n        );\n\n        this.counter =\n          newCounter === 100\n            ? this.counter + Math.round(Math.random() * (99 - this.counter))\n            : newCounter;\n      }\n    } else if (this.counter < 90 && this.absoluteCounter > 0) {\n      this.counter += 10;\n    }\n  }\n\n  private async _poll({\n    jobId,\n    saveAs,\n    query,\n    onExportEnd,\n  }: {\n    query: QueryV2;\n    saveAs?: string;\n    onExportEnd: (params: {\n      job: ExportAsyncJob | null;\n      query: QueryV2;\n      result: 'success' | 'fail' | 'stopped by user';\n    }) => void;\n    jobId: string;\n  }) {\n    const { httpClient, events, onlineState, translate, errorHandler } = this;\n\n    let current: ExportAsyncJob | null = null;\n\n    try {\n      // eslint-disable-next-line no-constant-condition\n      while (true) {\n        if (!this.isModalOpen) {\n          const currentJob = await this.exportStatus.promise;\n          if (currentJob) {\n            onExportEnd({\n              job: currentJob,\n              query,\n              result: 'stopped by user',\n            });\n          }\n\n          break;\n        }\n\n        const getExportAsyncJobResponse = await errorHandler\n          .withErrorHandler(\n            () => httpClient.request(getExportAsyncJob({ jobId })),\n            {\n              errorCodesMap: getExportAsyncJobErrors({\n                translate,\n                retryFn: this.onRetryExportToClick,\n              }),\n            },\n          )\n          .catch((error) => {\n            errorHandler.getResolvedError?.(error);\n            return { error };\n          });\n\n        if (\n          getExportAsyncJobResponse &&\n          !('data' in getExportAsyncJobResponse)\n        ) {\n          const error = getExportAsyncJobResponse.error;\n          if (!onlineState.isOnline) {\n            events.once('online', () => {\n              this._poll({\n                jobId,\n                onExportEnd,\n                query,\n                saveAs,\n              });\n            });\n\n            throw new WixPatternsError({\n              errorCode: 'GetExportAsyncJob.offline',\n              originalException: error,\n              extraData: {\n                response: {\n                  data: {\n                    applicationError: {\n                      code: 'offline',\n                    },\n                  } as ErrorDetails,\n                },\n              },\n            });\n          }\n\n          if (this.queryJobRetries.count > this.config.queryJobRetries.max) {\n            onExportEnd({ job: current, query, result: 'fail' });\n            throw new WixPatternsError({\n              originalException: error,\n              errorCode: 'GetExportAsyncJob.failed',\n            });\n          }\n\n          this.queryJobRetries = {\n            ...this.queryJobRetries,\n            count: this.queryJobRetries.count + 1,\n          };\n\n          setTimeout(() => {\n            this._poll({\n              jobId,\n              onExportEnd,\n              query,\n              saveAs,\n            });\n          }, this.config.queryJobRetries.delay);\n\n          break;\n        }\n\n        const job = getExportAsyncJobResponse?.data.job;\n\n        if (job?.data == null) {\n          throw new WixPatternsError({\n            errorCode: 'GetExportAsyncJob.invalid',\n          });\n        }\n\n        current = job;\n\n        this.queryJobRetries = {\n          count: 0,\n        };\n\n        runInAction(() => {\n          this.exportStatus = {\n            ...queryStatus.loading,\n            promise: Promise.resolve(job),\n          };\n        });\n\n        const isModalOpen = runInAction(() => this.isModalOpen);\n        if (!isModalOpen) {\n          break;\n        }\n\n        if (job.data.signedUrl) {\n          await this._onJobSuccess(job, {\n            onExportEnd,\n            saveAs,\n            query,\n          });\n          break;\n        }\n\n        if (\n          job.status === JobStatus.FAILED ||\n          job.data.error?.applicationError != null\n        ) {\n          if (\n            job.data.error?.applicationError?.code ===\n            'media_generate_signed_url'\n          ) {\n            // await this._retryGenerateUrl(job);\n            // continue;\n          }\n\n          this._throwJobError(job, {\n            onExportEnd,\n            query,\n            saveAs,\n          });\n          break;\n        }\n\n        const checkIfStaleJobResult = this._checkIfStaleJob(job, {\n          onExportEnd,\n          saveAs,\n          query,\n        });\n\n        if (checkIfStaleJobResult === 'restarted') {\n          return;\n        }\n\n        await runInAction(async () => {\n          if (\n            !this.totalForExport &&\n            (job.data?.iterationsCount == null || job.data.iterationsCount <= 1)\n          ) {\n            this.totalForExport = job.data?.pagingMetadata?.total;\n          }\n        });\n\n        this._updateJobProgress(job, { onExportEnd, query, saveAs });\n\n        await new Promise((res) => setTimeout(res, this.config.pollingDelay));\n      }\n    } catch (error) {\n      console.error(error);\n\n      this.internalMonitor.reportError({ error });\n\n      runInAction(() => {\n        this.currentStep = 'error';\n        this.exportStatus = {\n          ...queryStatus.error,\n          error,\n        };\n      });\n    }\n  }\n\n  private async _exportTo({\n    onExportEnd,\n  }: {\n    onExportEnd: (params: {\n      job: ExportAsyncJob | null;\n      query: QueryV2;\n      result: 'success' | 'fail' | 'stopped by user';\n    }) => void;\n  }) {\n    const {\n      createExportAsyncJobRequest,\n      httpClient,\n      errorHandler,\n      transformPlatformizedQuery,\n      selectedExportOption,\n      events,\n      onlineState,\n      translate,\n    } = this;\n\n    this._reset();\n    window.addEventListener('beforeunload', this.beforeunload);\n\n    const platformizedQuery = defaultPlatformizedQuery();\n\n    const {\n      bulkSelect: {\n        selectedIds,\n        allSelected: selectAll,\n        uncheckedInCurrentCollection: uncheckedValues,\n      },\n      query: { asComputed: computedQuery },\n    } = this.collection;\n\n    const wixPatternsQuery =\n      selectedExportOption !== 'all'\n        ? computedQuery\n        : {\n            ...computedQuery,\n            filtersKey: {},\n            rawFilters: {},\n            filters: {},\n          };\n\n    const exportPublicState = {\n      platformizedQuery,\n      wixPatternsQuery,\n      selectedItems:\n        selectedExportOption === 'selected' ? selectedIds : undefined,\n      isSelectAll: selectAll,\n      uncheckedValues,\n    };\n\n    const query =\n      (await transformPlatformizedQuery?.(exportPublicState)) ??\n      platformizedQuery;\n\n    const totalForExportPromise = this.setTotalForExport({\n      ...exportPublicState,\n      platformizedQuery: query,\n    });\n\n    const saveAs =\n      this.saveAs?.({\n        platformizedQuery,\n        wixPatternsQuery,\n        selectedItems:\n          selectedExportOption === 'selected' ? selectedIds : undefined,\n        isSelectAll: selectAll,\n      }) ?? this.collectionPageState.pageTitle;\n\n    runInAction(() => {\n      this.currentStep = 'progress';\n    });\n\n    const _createExport = async () => {\n      try {\n        const { data: createExportAsyncJobResponse } = await errorHandler\n          .withErrorHandler(\n            () =>\n              httpClient.request(\n                createExportAsyncJob({\n                  fields: [],\n                  methodMetadata: {},\n                  ...createExportAsyncJobRequest,\n                  saveAs,\n                  query,\n                }),\n              ),\n            {\n              errorCodesMap: createExportAsyncJobErrors({\n                translate,\n              }),\n            },\n          )\n          .catch((err) => {\n            if (!onlineState.isOnline) {\n              events.once('online', () => {\n                this._exportTo({\n                  onExportEnd,\n                });\n              });\n              throw Object.assign(new Error('CreateExportAsyncJob.offline'), {\n                response: {\n                  data: {\n                    applicationError: {\n                      code: 'offline',\n                    },\n                  } as ErrorDetails,\n                },\n              });\n            }\n            onExportEnd({ job: null, query, result: 'fail' });\n\n            throw err;\n          });\n\n        return createExportAsyncJobResponse;\n      } catch (error) {\n        runInAction(() => {\n          this.currentStep = 'error';\n          this.exportStatus = {\n            ...queryStatus.error,\n            error,\n          };\n        });\n\n        throw error;\n      }\n    };\n\n    try {\n      const createExportAsyncJobResponse = await _createExport();\n\n      if (!createExportAsyncJobResponse.job?.id) {\n        throw new Error(\n          `Invalid response from createExportAsyncJob \"jobId=${createExportAsyncJobResponse.job?.id}\"`,\n        );\n      }\n\n      await totalForExportPromise;\n\n      runInAction(() => {\n        this.exportStatus = {\n          ...queryStatus.loading,\n          promise: Promise.resolve(\n            createExportAsyncJobResponse.job as ExportAsyncJob,\n          ),\n        };\n      });\n\n      this.events.emit('afterJobCreated', {\n        job: createExportAsyncJobResponse.job as ExportAsyncJob,\n      });\n\n      runInAction(() => {\n        this.counter = 1;\n      });\n\n      await this._poll({\n        onExportEnd,\n        saveAs,\n        query,\n        jobId: createExportAsyncJobResponse.job.id,\n      });\n    } catch (error) {\n      console.error(error);\n      this.internalMonitor.reportError({ error });\n    }\n\n    window.removeEventListener('beforeunload', this.beforeunload);\n  }\n}\n"],"mappings":"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","ignoreList":[]}