{"version":3,"names":["_chance","require","_lodash","_InMemoryBackend","createProduct","chance","createdAt","date","min","Date","now","max","rest","id","guid","name","description","sentence","price","integer","img","url","status","pickone","updatedAt","country","snakeCase","full","createProductsBackend","createOne","params","Chance","InMemoryBackend","enableTotal","itemKey","item","total","predicate","query","search","filters","rgx","RegExp","escapeRegExp","_filters$status$","_filters$updatedAt","_filters$updatedAt2","test","productId","length","indexOf","some","from","valueOf","to","orderBy","sort","exports"],"sources":["../../../src/testkit/createProductsBackend.ts"],"sourcesContent":["import { Product } from './product';\nimport { Chance } from 'chance';\n\nimport { ProductFilters } from './productFilters';\nimport { escapeRegExp, snakeCase } from 'lodash';\nimport { InMemoryBackend, InMemoryBackendParams } from '../InMemoryBackend';\n\nexport function createProduct(\n  chance: Chance.Chance,\n  {\n    createdAt = chance.date({\n      min: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n      max: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),\n    }) as Date,\n    ...rest\n  }: Partial<Product> = {},\n): Product {\n  return {\n    id: chance.guid(),\n    name: chance.name(),\n    description: chance.sentence(),\n    price: chance.integer({ min: 0, max: 10000 }),\n    img: chance.url(),\n    status: chance.pickone(['available', 'outOfStock']),\n    createdAt,\n    updatedAt: createdAt,\n    country: snakeCase(chance.country({ full: true })),\n    ...rest,\n  };\n}\n\nexport const createProductsBackend = ({\n  createOne,\n  ...params\n}: Partial<InMemoryBackendParams<Product, ProductFilters>> = {}) => {\n  const chance = new Chance();\n  return new InMemoryBackend<Product, ProductFilters>({\n    enableTotal: params?.enableTotal,\n    createOne: createOne ?? (() => createProduct(chance)),\n    itemKey: (item) => item.id,\n    total: 1000,\n    predicate: (query) => {\n      const { search } = query;\n      const filters = query.filters ?? {};\n      const rgx = new RegExp(escapeRegExp(search), 'i');\n\n      return (item) => {\n        if (search && !rgx.test(item.name)) {\n          return false;\n        }\n\n        if (\n          filters.productId &&\n          filters.productId.length &&\n          filters.productId.indexOf(item.id) === -1\n        ) {\n          return false;\n        }\n\n        if (\n          filters.status &&\n          filters.status.length &&\n          filters.status[0]?.id !== 'all' &&\n          !filters.status.some((status) => status.id === item.status)\n        ) {\n          return false;\n        }\n\n        if (\n          item.updatedAt &&\n          filters.updatedAt?.from &&\n          filters.updatedAt.from.valueOf() > item.updatedAt.valueOf()\n        ) {\n          return false;\n        }\n\n        if (\n          item.updatedAt &&\n          filters.updatedAt?.to &&\n          filters.updatedAt.to.valueOf() < item.updatedAt.valueOf()\n        ) {\n          return false;\n        }\n\n        if (\n          item.country &&\n          filters.country &&\n          filters.country.length !== 0 &&\n          !filters.country.some((country) => country.id === item.country)\n        ) {\n          return false;\n        }\n\n        return true;\n      };\n    },\n    orderBy: (query) => {\n      return [...(query.sort ?? [])];\n    },\n    ...params,\n  });\n};\n"],"mappings":"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","ignoreList":[]}