{"version":3,"names":["_http","require","_lodash","appSettingsMocks","whenRequest","db","global","settings","components","getGlobalSettings","reply","data","host","persist","getComponentSettings","_db$components$compon","componentId","Error","setGlobalSettings","merge","setComponentSettings","_db$components","component"],"sources":["../../../src/testkit/appSettingsMocks.ts"],"sourcesContent":["import {\n  getComponentSettings,\n  getGlobalSettings,\n  setComponentSettings,\n  setGlobalSettings,\n} from '@wix/bex-utils/@wix/ambassador-app-settings-v1-settings/http';\nimport { merge } from 'lodash';\nimport type { whenRequest } from '@wix/fe-essentials/http-client/testkit/client';\nimport type { AnyScenario } from '@wix/fe-essentials/http-client/testkit';\n\ntype WhenRequest = typeof whenRequest;\n\nexport type Settings = {\n  [key: string]: Settings | string | number | boolean | null;\n};\n\nexport interface AppSettings {\n  settings: Settings;\n}\n\nexport function appSettingsMocks(whenRequest: WhenRequest): AnyScenario[] {\n  const db = {\n    global: {\n      settings: {},\n    } as AppSettings,\n    components: {} as Record<string, AppSettings | undefined>,\n  };\n\n  return [\n    whenRequest(getGlobalSettings)\n      .reply(200, async (data) => {\n        const { host } = data;\n        return {\n          host,\n          settings: {\n            ...db.global.settings,\n          },\n        };\n      })\n      .persist(),\n\n    whenRequest(getComponentSettings)\n      .reply(200, async (data) => {\n        const { host, componentId } = data;\n\n        if (componentId == null) {\n          throw new Error(\n            `getComponentSettings: Invalid \\`componentId\\`, received: \"${componentId}\"`,\n          );\n        }\n\n        return {\n          host,\n          settings: {\n            ...db.components[componentId]?.settings,\n          },\n        };\n      })\n      .persist(),\n\n    whenRequest(setGlobalSettings)\n      .reply(200, async (data) => {\n        const { host, settings } = data;\n\n        merge(db.global.settings, settings);\n\n        return {\n          host,\n          settings,\n        };\n      })\n      .persist(),\n\n    whenRequest(setComponentSettings)\n      .reply(200, async (data) => {\n        const { host, settings, componentId } = data;\n\n        if (componentId == null) {\n          throw new Error(\n            `setComponentSettings: Invalid \\`componentId\\`, received: \"${componentId}\"`,\n          );\n        }\n\n        const component = (db.components[componentId] ??= { settings: {} });\n\n        merge(component.settings, settings);\n\n        return {\n          host,\n          settings,\n        };\n      })\n      .persist(),\n  ];\n}\n"],"mappings":";;;;AAAA,IAAAA,KAAA,GAAAC,OAAA;AAMA,IAAAC,OAAA,GAAAD,OAAA;AAcO,SAASE,gBAAgBA,CAACC,WAAwB,EAAiB;EACxE,MAAMC,EAAE,GAAG;IACTC,MAAM,EAAE;MACNC,QAAQ,EAAE,CAAC;IACb,CAAgB;IAChBC,UAAU,EAAE,CAAC;EACf,CAAC;EAED,OAAO,CACLJ,WAAW,CAACK,uBAAiB,CAAC,CAC3BC,KAAK,CAAC,GAAG,EAAE,MAAOC,IAAI,IAAK;IAC1B,MAAM;MAAEC;IAAK,CAAC,GAAGD,IAAI;IACrB,OAAO;MACLC,IAAI;MACJL,QAAQ,EAAE;QACR,GAAGF,EAAE,CAACC,MAAM,CAACC;MACf;IACF,CAAC;EACH,CAAC,CAAC,CACDM,OAAO,CAAC,CAAC,EAEZT,WAAW,CAACU,0BAAoB,CAAC,CAC9BJ,KAAK,CAAC,GAAG,EAAE,MAAOC,IAAI,IAAK;IAAA,IAAAI,qBAAA;IAC1B,MAAM;MAAEH,IAAI;MAAEI;IAAY,CAAC,GAAGL,IAAI;IAElC,IAAIK,WAAW,IAAI,IAAI,EAAE;MACvB,MAAM,IAAIC,KAAK,CACb,6DAA6DD,WAAW,GAC1E,CAAC;IACH;IAEA,OAAO;MACLJ,IAAI;MACJL,QAAQ,EAAE;QACR,KAAAQ,qBAAA,GAAGV,EAAE,CAACG,UAAU,CAACQ,WAAW,CAAC,qBAA1BD,qBAAA,CAA4BR,QAAQ;MACzC;IACF,CAAC;EACH,CAAC,CAAC,CACDM,OAAO,CAAC,CAAC,EAEZT,WAAW,CAACc,uBAAiB,CAAC,CAC3BR,KAAK,CAAC,GAAG,EAAE,MAAOC,IAAI,IAAK;IAC1B,MAAM;MAAEC,IAAI;MAAEL;IAAS,CAAC,GAAGI,IAAI;IAE/B,IAAAQ,aAAK,EAACd,EAAE,CAACC,MAAM,CAACC,QAAQ,EAAEA,QAAQ,CAAC;IAEnC,OAAO;MACLK,IAAI;MACJL;IACF,CAAC;EACH,CAAC,CAAC,CACDM,OAAO,CAAC,CAAC,EAEZT,WAAW,CAACgB,0BAAoB,CAAC,CAC9BV,KAAK,CAAC,GAAG,EAAE,MAAOC,IAAI,IAAK;IAAA,IAAAU,cAAA;IAC1B,MAAM;MAAET,IAAI;MAAEL,QAAQ;MAAES;IAAY,CAAC,GAAGL,IAAI;IAE5C,IAAIK,WAAW,IAAI,IAAI,EAAE;MACvB,MAAM,IAAIC,KAAK,CACb,6DAA6DD,WAAW,GAC1E,CAAC;IACH;IAEA,MAAMM,SAAS,GAAI,CAAAD,cAAA,GAAAhB,EAAE,CAACG,UAAU,EAACQ,WAAW,CAAC,KAA1BK,cAAA,CAAcL,WAAW,CAAC,GAAK;MAAET,QAAQ,EAAE,CAAC;IAAE,CAAC,CAAC;IAEnE,IAAAY,aAAK,EAACG,SAAS,CAACf,QAAQ,EAAEA,QAAQ,CAAC;IAEnC,OAAO;MACLK,IAAI;MACJL;IACF,CAAC;EACH,CAAC,CAAC,CACDM,OAAO,CAAC,CAAC,CACb;AACH","ignoreList":[]}