{"version":3,"names":["_chance","require","_lodash","_InMemoryBackend","_nestifyItems","createFolder","chance","createdAt","date","min","Date","now","max","rest","id","guid","name","updatedAt","status","pickone","createFoldersBackend","createOne","depth","total","forceEmptyParentInEachLevel","foldersStaticData","params","Chance","backend","InMemoryBackend","enableTotal","i","raw","itemKey","item","Math","length","predicate","query","search","filters","parentId","folderStatus","level","hasChildren","ancestorId","rgx","RegExp","escapeRegExp","_folderStatus$","test","some","from","valueOf","to","_item$breadcrumbs","breadcrumbs","String","childCount","orderBy","sort","projection","_query$fields","fields","includes","undefined","nestifyItems","values","setDepthOnItem","parent","exports"],"sources":["../../../src/testkit/createFoldersBackend.ts"],"sourcesContent":["import { Folder, FolderRaw } from './folder';\nimport { Chance } from 'chance';\n\nimport { FolderFilters } from './folderFilters';\nimport { escapeRegExp } from 'lodash';\nimport { InMemoryBackend, InMemoryBackendParams } from '../InMemoryBackend';\nimport { nestifyItems } from './nestifyItems';\n\nexport function createFolder(\n  chance: Chance.Chance,\n  {\n    createdAt = chance.date({\n      min: new Date(Date.now() - 365 * 24 * 60 * 60 * 1000),\n      max: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000),\n    }) as Date,\n    ...rest\n  }: Partial<Folder> = {},\n): Folder {\n  return {\n    id: chance.guid(),\n    name: chance.name(),\n    createdAt,\n    updatedAt: createdAt,\n    status: chance.pickone(['visible', 'hidden']),\n    ...rest,\n  };\n}\n\nexport type CreateFoldersBackendParams = Partial<\n  InMemoryBackendParams<Folder, FolderFilters>\n> & {\n  enableTotal?: boolean;\n  depth?: number;\n  forceEmptyParentInEachLevel?: boolean;\n  foldersStaticData?: FolderRaw[];\n};\n\nexport const createFoldersBackend = ({\n  createOne,\n  depth = 4,\n  total = 1000,\n  forceEmptyParentInEachLevel,\n  foldersStaticData,\n  ...params\n}: CreateFoldersBackendParams = {}) => {\n  const chance = new Chance();\n  const backend = new InMemoryBackend<Folder, FolderFilters>({\n    enableTotal: params?.enableTotal,\n    createOne:\n      createOne ??\n      (foldersStaticData\n        ? (i) => {\n            const raw = foldersStaticData[i];\n            return {\n              ...raw,\n              status: raw.status as Folder['status'],\n              createdAt: new Date(raw.createdAt),\n              updatedAt: new Date(raw.updatedAt),\n            };\n          }\n        : () => createFolder(chance)),\n    itemKey: (item) => item.id,\n    total: foldersStaticData\n      ? Math.min(foldersStaticData.length, total)\n      : total,\n    predicate: (query) => {\n      const { search } = query;\n      const filters = query.filters ?? {};\n      const {\n        id,\n        parentId,\n        folderStatus,\n        updatedAt,\n        level,\n        hasChildren,\n        ancestorId,\n      } = filters;\n      const rgx = new RegExp(escapeRegExp(search), 'i');\n\n      return (item) => {\n        if (search && !rgx.test(item.name)) {\n          return false;\n        }\n\n        if (\n          folderStatus &&\n          folderStatus.length &&\n          folderStatus[0]?.id !== 'all' &&\n          !folderStatus.some((status) => status.id === item.status)\n        ) {\n          return false;\n        }\n\n        if (\n          item.updatedAt &&\n          updatedAt?.from &&\n          updatedAt.from.valueOf() > item.updatedAt.valueOf()\n        ) {\n          return false;\n        }\n\n        if (\n          item.updatedAt &&\n          updatedAt?.to &&\n          updatedAt.to.valueOf() < item.updatedAt.valueOf()\n        ) {\n          return false;\n        }\n\n        if (\n          parentId &&\n          parentId.length &&\n          !parentId.some((parentId) =>\n            parentId === 'null'\n              ? item.parentId == null\n              : item.parentId === parentId,\n          )\n        ) {\n          return false;\n        }\n\n        if (\n          ancestorId &&\n          ancestorId.length &&\n          !ancestorId.some((ancestorId) =>\n            item.breadcrumbs?.some(({ id }) => id === ancestorId),\n          )\n        ) {\n          return false;\n        }\n\n        if (id && id.length && !id.some((id) => id === item.id)) {\n          return false;\n        }\n\n        if (\n          level &&\n          level.length &&\n          !level.some((level) => level === String(item.level))\n        ) {\n          return false;\n        }\n\n        if (hasChildren && hasChildren[0] === 'true' && !item.childCount) {\n          return false;\n        }\n\n        if (hasChildren && hasChildren[0] === 'false' && item.childCount) {\n          return false;\n        }\n\n        return true;\n      };\n    },\n    orderBy: (query) => {\n      return [...(query.sort ?? [])];\n    },\n    projection: (query) => (item) => {\n      if (!query.fields?.includes('breadcrumbs')) {\n        return {\n          ...item,\n          breadcrumbs: undefined,\n        };\n      }\n      return item;\n    },\n    ...params,\n  });\n\n  if (!foldersStaticData) {\n    nestifyItems(backend.values, {\n      forceEmptyParentInEachLevel,\n      depth,\n      setDepthOnItem: (item, { depth, parent }) => {\n        item.level = depth;\n        if (parent) {\n          parent.childCount = (parent.childCount ?? 0) + 1;\n        }\n      },\n    });\n  }\n\n  return backend;\n};\n"],"mappings":"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","ignoreList":[]}