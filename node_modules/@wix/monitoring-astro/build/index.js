// src/index.ts
import { outdent as outdent2 } from "outdent";

// src/client/setup-client.ts
import { outdent } from "outdent";

// src/constants.ts
var METHODS = [
  "debug",
  "error",
  "info",
  "log",
  "warn"
];

// src/client/setup-client.ts
var getInlineMonitoringSnippet = () => outdent`
  if (!window.__wixMonitoring && !location.pathname.startsWith('/_wix/extensions/backoffice')) {
    window.__wixMonitoring = {
      queue: [],
      originalMethods: {},
    };

    ${JSON.stringify(METHODS)}.forEach((method) => {
      window.__wixMonitoring.originalMethods[method] = console[method];

      console[method] = (...args) => {
        let stack = '';

        try { throw Error() } catch(e) { stack = e.stack; } 

        window.__wixMonitoring.queue.push({method, stack, timestamp: Date.now(), args });
        window.__wixMonitoring.originalMethods[method].apply(console, args);
      };
    });
  }
  `;

// src/index.ts
var index_default = () => {
  return {
    hooks: {
      "astro:config:setup"({ config, injectScript }) {
        if (!config.integrations.find((integration) => integration.name === "@wix/astro")) {
          throw new Error("The @wix/astro integration is required when using @wix/monitoring-astro");
        }
        injectScript("head-inline", getInlineMonitoringSnippet());
        injectScript(
          "page",
          outdent2`
            import { setupClientMonitoring } from '@wix/monitoring-astro/setup-client';

            setupClientMonitoring();
          `
        );
        injectScript(
          "page-ssr",
          outdent2`
            import { setupServerMonitoring } from '@wix/monitoring-astro/setup-server';

            setupServerMonitoring();
          `
        );
      },
      "astro:config:done": ({ config }) => {
        const astroIntegrationIndex = config.integrations.findIndex((integration) => integration.name === "@wix/astro");
        const monitoringInterationIndex = config.integrations.findIndex((integration) => integration.name === "@wix/monitoring-astro");
        if (astroIntegrationIndex > monitoringInterationIndex) {
          throw new Error("Please make sure the @wix/monitoring-astro integration is listed after @wix/astro");
        }
      }
    },
    name: "@wix/monitoring-astro"
  };
};
export {
  index_default as default
};
//# sourceMappingURL=index.js.map