{"version":3,"names":["_serialize","require","_types","_mathUtils","_commonUtils","getRowProportions","row","cells","reduce","p","c","Math","abs","proportion","getPatternCellCount","pattern","rows","rp","rc","cp","cc","getVerticalParentCss","oppositePattern","verticalGap","verticalGapUnit","horizontalGap","horizontalGapUnit","maxColumns","display","gridTemplateColumns","gridAutoFlow","gap","gridAutoRows","getHorizontalParentCss","gridTemplateRows","gridAutoColumns","getChildCss","itemSelector","cellCount","cellIndex","mode","startColumn","endColumn","CustomGridScrollDirection","vertical","gridColumn","gridRow","buildCustomGridStyles","selectors","parentSelector","flip","GapUnits","px","lcmArray","map","flipValue","parentRule","childRules","patternCellCount","flipIndex","isFlip","cellPosition","cellWeight","reverse","cell","childCss","Object","assign","customGridStylesheet","serializeStyles","styles","cssStringToBuilderReturnType","exports"],"sources":["../../../../../src/lib/utils/customGrid/customGridBuilder.ts"],"sourcesContent":["import { serializeStyles, CSSInterpolation } from '@emotion/serialize';\nimport {\n  BuildCustomGridStylesProps,\n  BuilderReturnType,\n  CustomGridScrollDirection,\n  GapUnits,\n  PatternObject,\n  Row,\n} from '../../types';\nimport { lcmArray } from '../mathUtils';\nimport { cssStringToBuilderReturnType } from '../commonUtils';\n\n// calculates the sum of all 'proportion' values in a row\nconst getRowProportions = (row: Row) =>\n  row.cells.reduce((p, c) => p + Math.abs(c.proportion), 0);\n\nconst getPatternCellCount = (pattern: PatternObject): number =>\n  pattern.rows.reduce(\n    (rp, rc) =>\n      rp + rc.cells.reduce((cp, cc) => cp + (cc.proportion > 0 ? 1 : 0), 0),\n    0,\n  );\n\nconst getVerticalParentCss = (\n  oppositePattern: string,\n  verticalGap: number,\n  verticalGapUnit: GapUnits,\n  horizontalGap: number,\n  horizontalGapUnit: GapUnits,\n  maxColumns: number,\n): CSSInterpolation => {\n  return {\n    display: 'grid',\n    gridTemplateColumns: `repeat(${maxColumns}, 1fr)`,\n    gridAutoFlow: 'row',\n    gap: `${verticalGap + verticalGapUnit} ${horizontalGap + horizontalGapUnit}`,\n    gridAutoRows: oppositePattern || 'auto',\n  };\n};\n\nconst getHorizontalParentCss = (\n  oppositePattern: string,\n  verticalGap: number,\n  verticalGapUnit: GapUnits,\n  horizontalGap: number,\n  horizontalGapUnit: GapUnits,\n  maxColumns: number,\n): CSSInterpolation => {\n  return {\n    display: 'grid',\n    gridTemplateRows: `repeat(${maxColumns}, 1fr)`,\n    gridAutoFlow: 'column',\n    gap: `${verticalGap + verticalGapUnit} ${horizontalGap + horizontalGapUnit}`,\n    gridAutoColumns: oppositePattern || 'auto',\n  };\n};\n\nconst getChildCss = (\n  itemSelector: string,\n  cellCount: number,\n  cellIndex: number,\n  mode: string,\n  startColumn: number,\n  endColumn: number,\n): CSSInterpolation => {\n\n  return {\n    [`${itemSelector}:nth-child(${cellCount}n+${cellIndex})`]:\n      mode === CustomGridScrollDirection.vertical\n        ? {\n            gridColumn: `${startColumn}/${endColumn}`,\n          }\n        : {\n            gridRow: `${startColumn}/${endColumn}`,\n          },\n  };\n};\n\nexport const buildCustomGridStyles = ({\n  selectors: { itemSelector, parentSelector },\n  pattern,\n  oppositePattern = 'auto',\n  flip = false,\n  mode = CustomGridScrollDirection.vertical,\n  horizontalGap = 0,\n  horizontalGapUnit = GapUnits.px,\n  verticalGap = 0,\n  verticalGapUnit = GapUnits.px,\n}: BuildCustomGridStylesProps): BuilderReturnType => {\n  const maxColumns = lcmArray(pattern.rows.map(getRowProportions));\n  const flipValue = flip ? 2 : 1;\n\n  const parentRule = {\n    [parentSelector]:\n      mode === CustomGridScrollDirection.vertical\n        ? getVerticalParentCss(\n            oppositePattern,\n            verticalGap,\n            verticalGapUnit,\n            horizontalGap,\n            horizontalGapUnit,\n            maxColumns,\n          )\n        : getHorizontalParentCss(\n            oppositePattern,\n            verticalGap,\n            verticalGapUnit,\n            horizontalGap,\n            horizontalGapUnit,\n            maxColumns,\n          ),\n  };\n\n  const childRules: CSSInterpolation = {};\n  const patternCellCount = getPatternCellCount(pattern);\n  const cellCount = patternCellCount * flipValue;\n  let cellIndex = 1;\n\n  for (let flipIndex = 0; flipIndex < flipValue; flipIndex++) {\n    const isFlip = flipIndex > 0;\n    for (const row of pattern.rows) {\n      let cellPosition = 0;\n      const cellWeight = maxColumns / getRowProportions(row);\n      const cells = isFlip ? [...row.cells].reverse() : row.cells;\n      for (const cell of cells) {\n        if (cell.proportion > 0) {\n          const startColumn = cellPosition + 1;\n          const endColumn = startColumn + cellWeight * cell.proportion;\n\n          const childCss = getChildCss(\n            itemSelector,\n            cellCount,\n            cellIndex,\n            mode,\n            startColumn,\n            endColumn,\n          );\n          if (childCss) {\n            Object.assign(childRules, {\n              ...(childCss as object),\n            });\n          }\n          cellIndex++;\n        }\n        cellPosition += Math.abs(cell.proportion) * cellWeight;\n      }\n    }\n  }\n  const customGridStylesheet = serializeStyles([{\n    ...parentRule,\n    ...childRules,\n  }]).styles;\n\n  return cssStringToBuilderReturnType(customGridStylesheet);\n};\n"],"mappings":"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","ignoreList":[]}