{"version":3,"names":["_navigationModes","require","_scrollImp","_asyncUtils","_navigationErrors","_navigatorUtils","_lib","_defaultNavigationSettings","DEBOUNCE_TIMEOUT","THROTTLING_TIMEOUT","DEFERRED_MORE_ITEMS_TIMEOUT","debounce","func","timeout","timer","args","clearTimeout","window","setTimeout","Navigator","constructor","initSettings","eventsListener","logger","_args","_defineProperty2","default","x","y","undefined","defaultSettings","Infinity","e","registerScrollStart","throttledScrollTasks","debouncedHandleScrollEnd","fireEvent","GALLERY_EVENTS","LAYOUT_CHANGED","prevMeasurements","newMeasurements","areMeasurementsDifferent","debouncedFireLayoutChanged","GalleryUtils","throttle","getMoreItemsIfNeededScrollBased","bind","handleScrollEnd","registerCenteredItems","canNavigateToNext","canNavigateToPrevious","createNavigationBoundaries","baseSettings","debouncedRegisterCenteredItems","isScrollerRefScrollless","throttledGetMoreItemsIfNeeded","makeEventsListener","CURRENT_ITEM_CHANGED","checkAndFireNavigationStatus","done","setScrollerRef","scrollerRef","_scrollerRef","removeScrollerRef","current","addEventListener","scrollEventHandler","fireNavigationApiReadyEvent","setWrapperRef","wrapperRef","_wrapperRef","removeWrapperRef","setContainerRef","containerRef","_containerRef","removeEventListener","removeContainerRef","getActiveScrollingElement","getActiveScrollingElementMeasurements","_wrapperMeasurement","_scrollerMeasurement","prev","next","width","height","top","left","updateItemMeasurements","index","itemRef","_this$_items$index","_items","measurements","newItem","ref","JSON","stringify","debouncedCreateNavigationBoundaries","fireLayoutChangedEventIfLayoutChanged","updateScrollerMeasurements","updateWrapperMeasurements","updateContainerMeasurements","_containerMeasurement","mergeSettingsWithDefaults","functionSettings","getScrollPositions","itemMeasurements","scrollSettings","activeScrollerMeasurement","mode","NavigationModes","CENTER","START","END","Error","NavigationErrors","INVALID_NAVIGATION_MODE","limitScrollPosition","Math","min","max","round","computeNavigation","settings","NO_SCROLLER_MEASUREMENTS","item","NO_ITEM_MEASUREMENTS","isAbleToNavigateToPrevious","previous","Promise","resolve","isAbleToNavigateToNext","navigate","staleNavigationFunction","isCurrentlyNavigating","currentNavigation","currentScroll","INVALID_NAVIGATION_IN_PROGRESS","activeScrollerRef","scrolllessNavigation","canNavigateByScroller","nativeScrollingNavigation","defaultScrollingNavigation","navigationPromise","reject","scrollPosition","currentScrollPositionX","currentScrollPositionY","scrollLeft","scrollTop","scrollX","scrollY","NO_CHANGE_IN_SCROLL_POSITION","then","catch","scrollParams","scroller","fromX","toX","fromY","toY","duration","isRTL","slideTransition","isContinuousScrolling","autoSlideshowContinuousSpeed","TrackablePromise","cssScrollTo","scrollingPromise","SCROLLER_REF_NOT_SET","error","result","loop","totalItemsCount","loopBack","promiseToBeResolvedNextTimeAScrollEnds","Deferred","currentScrollPosition","promise","getScrollPositionFromMeasurements","fallbackScrollIntoView","_this$promiseToBeReso","setCurrentItem","definedSettings","isAtEnd","_navigationBoundaries","CANNOT_NAVIGATE_TO_NEXT","navigateInDirection","isAtStart","CANNOT_NAVIGATE_TO_PREVIOUS","direction","retries","currentItem","NO_CENTERED_ITEM","newIndex","length","message","event","activeScrollingElement","target","scrollingElement","registerScrollEnd","_this$promiseToBeReso2","_this$currentScroll","getScrollPositionFromEvent","console","warn","scrollerCenterX","scrollerCenterY","closestIndex","smallestDistance","forEach","itemCenterX","itemCenterY","diffX","abs","diffY","distance","sqrt","isItemCenteredBothAxes","setCenteredItemByBothAxes","centeredItemByBothAxes","_this$deferredGetting","deferredGettingMoreItems","isPending","invalidMeasurements","needMoreItems","reachedToNeedMoreItems","NEED_MORE_ITEMS","_this$deferredGetting2","getCenteredItemByBothAxes","getCurrentIndex","updateTotalItemsCount","count","newStatus","lastNavigationStatus","NAVIGATION_STATUS_CHANGED","CANNOT_LOOP_WITHOUT_TOTAL_ITEMS_COUNT","middleIndex","ceil","NAVIGATION_API_READY","getNavigationApi","navigateToIndex","currentIndex","getNextItemByDirection","isALargerThanB","someItemsOutsideOfContainer","calculateNavigationBoundaries","maxX","map","maxY","focusOnFirstItem","directionMap","right","up","_length","down","exports"],"sources":["../../../src/navigator/navigator.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-dynamic-delete */\nimport { NavigationModes } from './navigationModes';\nimport { RefObject } from 'react';\nimport { cssScrollTo, fallbackScrollIntoView } from './scrollImp';\nimport { TrackablePromise, Deferred } from './asyncUtils';\nimport { NavigationErrors } from './navigationErrors';\nimport {\n  isAtEnd,\n  isAtStart,\n  canNavigateByScroller,\n  isALargerThanB,\n  someItemsOutsideOfContainer,\n  isCurrentlyNavigating,\n  getScrollPositionFromMeasurements,\n  getScrollPositionFromEvent,\n  isItemCenteredBothAxes,\n  reachedToNeedMoreItems,\n} from './navigatorUtils';\n// import all types from types.ts\nimport {\n  Measurements,\n  ScrollSettings,\n  Item,\n  FullyDefinedSettings,\n  NavigationAPI,\n  ScrollPosition,\n  INavigator,\n  Direction,\n} from './types';\nimport {\n  GALLERY_EVENTS,\n  EventsListenerFunction,\n  GalleryUtils,\n  makeEventsListener,\n} from '../lib';\n\nimport { defaultSettings } from './defaultNavigationSettings';\n\nconst DEBOUNCE_TIMEOUT = 50;\nconst THROTTLING_TIMEOUT = 500;\nconst DEFERRED_MORE_ITEMS_TIMEOUT = 2000;\n\n// utils debounce function\nfunction debounce(func: Function, timeout: number) {\n  let timer: number;\n  return (...args: any[]) => {\n    clearTimeout(timer);\n    timer = window.setTimeout(() => {\n      func(...args);\n    }, timeout);\n  };\n}\n\nexport class Navigator implements INavigator {\n  // private isScrolling = false;\n  private _items: Item[] = [];\n  private _scrollerMeasurement: Measurements | null = null;\n  private _wrapperMeasurement: Measurements | null = null;\n  private _containerMeasurement: Measurements | null = null;\n  private _navigationBoundaries: Measurements | null = null;\n  private _scrollerRef: RefObject<HTMLDivElement> | null = null;\n  private _wrapperRef: RefObject<Window> | null = null;\n  private _containerRef: RefObject<HTMLDivElement> | null = null;\n  private scrollPosition: ScrollPosition = { x: 0, y: 0 };\n  private centeredItemByBothAxes: number | null = null;\n  private currentItem: number | null = null;\n  private currentScroll: Deferred<ScrollPosition> | undefined = undefined;\n  private promiseToBeResolvedNextTimeAScrollEnds:\n    | Deferred<ScrollPosition>\n    | undefined = undefined;\n  private currentNavigation: TrackablePromise<ScrollPosition> | undefined =\n    undefined;\n  private deferredGettingMoreItems: Deferred<Event | void> | undefined =\n    undefined;\n  private baseSettings: FullyDefinedSettings = defaultSettings;\n  private totalItemsCount: number = Infinity;\n  private eventsListener?: EventsListenerFunction;\n  logger: (...args: any[]) => void;\n\n  constructor({\n    initSettings,\n    eventsListener,\n    logger = (..._args: any[]) => {\n      // console.log('NAVIGATOR:', ..._args);\n    },\n  }: {\n    initSettings?: ScrollSettings;\n    eventsListener?: EventsListenerFunction;\n    logger?: (...args: any[]) => void;\n  } = {}) {\n    this.baseSettings = { ...defaultSettings, ...initSettings };\n    this.logger = logger;\n    this.handleScrollEnd = this.handleScrollEnd.bind(this);\n    this.debouncedHandleScrollEnd = this.debouncedHandleScrollEnd.bind(this);\n    this.debouncedRegisterCenteredItems =\n      this.debouncedRegisterCenteredItems.bind(this);\n    this.registerCenteredItems = this.registerCenteredItems.bind(this);\n    this.isScrollerRefScrollless = this.isScrollerRefScrollless.bind(this);\n    this.throttledGetMoreItemsIfNeeded =\n      this.throttledGetMoreItemsIfNeeded.bind(this);\n    this.eventsListener = makeEventsListener()\n      .CURRENT_ITEM_CHANGED(() => this.checkAndFireNavigationStatus())\n      .LAYOUT_CHANGED(() => this.checkAndFireNavigationStatus())\n      .done(eventsListener);\n  }\n\n  setScrollerRef(scrollerRef: RefObject<HTMLDivElement>) {\n    if (this._scrollerRef) {\n      this.removeScrollerRef(this._scrollerRef);\n    }\n    this._scrollerRef = scrollerRef;\n    if (scrollerRef?.current) {\n      scrollerRef.current.addEventListener('scroll', this.scrollEventHandler);\n    }\n    this.fireNavigationApiReadyEvent();\n  }\n  setWrapperRef(wrapperRef: RefObject<Window>) {\n    if (this._wrapperRef) {\n      this.removeWrapperRef(this._wrapperRef);\n    }\n    this._wrapperRef = wrapperRef;\n    if (wrapperRef?.current) {\n      wrapperRef.current.addEventListener('scroll', this.scrollEventHandler);\n    }\n    this.fireNavigationApiReadyEvent();\n  }\n  setContainerRef(containerRef: RefObject<HTMLDivElement>) {\n    if (this._containerRef) {\n      this.removeScrollerRef(this._containerRef);\n    }\n    this._containerRef = containerRef;\n    if (containerRef?.current) {\n      containerRef.current.addEventListener('scroll', this.scrollEventHandler);\n    }\n    this.fireNavigationApiReadyEvent();\n  }\n\n  removeScrollerRef(scrollerRef: RefObject<HTMLDivElement>) {\n    if (scrollerRef?.current) {\n      scrollerRef.current.removeEventListener(\n        'scroll',\n        this.scrollEventHandler,\n      );\n    }\n  }\n\n  removeWrapperRef(wrapperRef: RefObject<Window>) {\n    if (wrapperRef?.current) {\n      wrapperRef.current.removeEventListener('scroll', this.scrollEventHandler);\n    }\n  }\n\n  removeContainerRef(scrollerRef: RefObject<HTMLDivElement>) {\n    if (scrollerRef?.current) {\n      scrollerRef.current.removeEventListener(\n        'scroll',\n        this.scrollEventHandler,\n      );\n    }\n  }\n\n  getActiveScrollingElement() {\n    if (this.isScrollerRefScrollless()) {\n      return this._wrapperRef;\n    } else {\n      return this._scrollerRef;\n    }\n  }\n  getActiveScrollingElementMeasurements() {\n    if (this.isScrollerRefScrollless()) {\n      return this._wrapperMeasurement;\n    } else {\n      return this._scrollerMeasurement;\n    }\n  }\n\n  private scrollEventHandler: EventListener = (e) => {\n    this.registerScrollStart(e);\n    this.throttledScrollTasks(e);\n    this.debouncedHandleScrollEnd(e);\n  };\n\n  private areMeasurementsDifferent(\n    prev: Measurements | null,\n    next: Measurements,\n  ): boolean {\n    if (!prev) {\n      return true;\n    }\n    const { width, height, top, left } = prev;\n    return (\n      width !== next.width ||\n      height !== next.height ||\n      top !== next.top ||\n      left !== next.left\n    );\n  }\n\n  private debouncedFireLayoutChanged = debounce(() => {\n    this.fireEvent(GALLERY_EVENTS.LAYOUT_CHANGED, {});\n  }, DEBOUNCE_TIMEOUT);\n\n  private fireLayoutChangedEventIfLayoutChanged = (\n    prevMeasurements: Measurements | null,\n    newMeasurements: Measurements,\n  ) => {\n    if (this.areMeasurementsDifferent(prevMeasurements, newMeasurements)) {\n      this.debouncedFireLayoutChanged();\n    }\n  };\n\n  updateItemMeasurements(\n    newMeasurements: Measurements,\n    index: number,\n    itemRef: React.RefObject<HTMLDivElement>,\n  ) {\n    const prevMeasurements = this._items[index]?.measurements || null;\n    const newItem: Item = {\n      index,\n      measurements: newMeasurements,\n      ref: itemRef,\n    };\n    this._items[index] = newItem;\n    this.logger(\n      `Measurements registered for index ${index}: ${JSON.stringify(\n        newMeasurements,\n      )}`,\n    );\n    this.debouncedCreateNavigationBoundaries();\n    this.debouncedRegisterCenteredItems();\n    this.fireLayoutChangedEventIfLayoutChanged(\n      prevMeasurements,\n      newMeasurements,\n    );\n  }\n\n  updateScrollerMeasurements(newMeasurements: Measurements) {\n    const prevMeasurements = this._scrollerMeasurement;\n    this._scrollerMeasurement = newMeasurements;\n    this.logger(\n      `Scroller measurements updated: ${JSON.stringify(newMeasurements)}`,\n    );\n    this.debouncedRegisterCenteredItems();\n    this.fireLayoutChangedEventIfLayoutChanged(\n      prevMeasurements,\n      newMeasurements,\n    );\n  }\n\n  updateWrapperMeasurements(newMeasurements: Measurements) {\n    const prevMeasurements = this._wrapperMeasurement;\n    this._wrapperMeasurement = newMeasurements;\n    this.logger(\n      `Wrapper measurements updated: ${JSON.stringify(newMeasurements)}`,\n    );\n    this.debouncedRegisterCenteredItems();\n    this.fireLayoutChangedEventIfLayoutChanged(\n      prevMeasurements,\n      newMeasurements,\n    );\n  }\n\n  updateContainerMeasurements(newMeasurements: Measurements) {\n    const prevMeasurements = this._containerMeasurement;\n    this._containerMeasurement = newMeasurements;\n    this.logger(\n      `Container measurements updated: ${JSON.stringify(newMeasurements)}`,\n    );\n    this.debouncedCreateNavigationBoundaries();\n    this.fireLayoutChangedEventIfLayoutChanged(\n      prevMeasurements,\n      newMeasurements,\n    );\n  }\n\n  private mergeSettingsWithDefaults(\n    functionSettings?: ScrollSettings,\n  ): FullyDefinedSettings {\n    return {\n      ...this.baseSettings,\n      ...functionSettings,\n    };\n  }\n\n  private getScrollPositions(\n    itemMeasurements: Measurements,\n    scrollSettings: FullyDefinedSettings,\n  ): ScrollPosition {\n    let x = 0;\n    let y = 0;\n    const activeScrollerMeasurement =\n      this.getActiveScrollingElementMeasurements();\n\n    switch (scrollSettings.mode) {\n      case NavigationModes.CENTER:\n        x =\n          itemMeasurements.left +\n          itemMeasurements.width / 2 -\n          activeScrollerMeasurement!.width / 2;\n        y =\n          itemMeasurements.top +\n          itemMeasurements.height / 2 -\n          activeScrollerMeasurement!.height / 2;\n        break;\n\n      case NavigationModes.START:\n        x = itemMeasurements.left;\n        y = itemMeasurements.top;\n        break;\n\n      case NavigationModes.END:\n        x =\n          itemMeasurements.left +\n          itemMeasurements.width -\n          activeScrollerMeasurement!.width;\n        y =\n          itemMeasurements.top +\n          itemMeasurements.height -\n          activeScrollerMeasurement!.height;\n        break;\n\n      default:\n        throw new Error(NavigationErrors.INVALID_NAVIGATION_MODE);\n    }\n\n    return { x, y };\n  }\n\n  private limitScrollPosition(x: number, y: number): ScrollPosition {\n    const activeScrollerMeasurement =\n      this.getActiveScrollingElementMeasurements();\n    x = Math.min(\n      x,\n      this._containerMeasurement!.width - activeScrollerMeasurement!.width,\n    );\n    x = Math.max(0, x);\n\n    y = Math.min(\n      y,\n      this._containerMeasurement!.height - activeScrollerMeasurement!.height,\n    );\n    y = Math.max(0, y);\n\n    return { x: Math.round(x), y: Math.round(y) };\n  }\n\n  computeNavigation(index: number, settings?: ScrollSettings): ScrollPosition {\n    const scrollSettings = this.mergeSettingsWithDefaults(settings);\n    const activeScrollerMeasurement =\n      this.getActiveScrollingElementMeasurements();\n\n    if (!activeScrollerMeasurement) {\n      throw new Error(NavigationErrors.NO_SCROLLER_MEASUREMENTS);\n    }\n\n    const item = this._items[index];\n    if (!item) {\n      throw new Error(NavigationErrors.NO_ITEM_MEASUREMENTS);\n    }\n\n    const { x, y } = this.getScrollPositions(item.measurements, scrollSettings);\n    return this.limitScrollPosition(x, y);\n  }\n\n  async isAbleToNavigateToPrevious(\n    settings?: ScrollSettings,\n  ): Promise<boolean> {\n    try {\n      await this.previous(settings, () => Promise.resolve(true));\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async isAbleToNavigateToNext(settings?: ScrollSettings): Promise<boolean> {\n    try {\n      await this.next(settings, () => Promise.resolve(true));\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  async navigate(\n    index: number,\n    settings?: ScrollSettings,\n    staleNavigationFunction?: () => Promise<boolean>,\n  ): Promise<ScrollPosition> {\n    const scrollSettings = this.mergeSettingsWithDefaults(settings);\n    if (isCurrentlyNavigating(this.currentNavigation, this.currentScroll)) {\n      throw new Error(NavigationErrors.INVALID_NAVIGATION_IN_PROGRESS);\n    }\n    const activeScrollerRef = this.getActiveScrollingElement();\n    const activeScrollerMeasurement =\n      this.getActiveScrollingElementMeasurements();\n\n    if (this.isScrollerRefScrollless()) {\n      // for scrollless galleries, we cant navigate by scrolling. we can only change the current item\n      return this.scrolllessNavigation(\n        index,\n        scrollSettings,\n        staleNavigationFunction,\n      );\n    } else if (\n      !canNavigateByScroller(\n        activeScrollerRef,\n        activeScrollerMeasurement,\n        this._containerMeasurement,\n      )\n    ) {\n      // navigate by native browser scrollIntoView\n      this.logger(\n        'Cannot navigate by scroller, navigating by item.scrollIntoView',\n      );\n      return this.nativeScrollingNavigation(\n        index,\n        scrollSettings,\n        staleNavigationFunction,\n      );\n    } else {\n      // navigate by calculating and css implementation\n      return this.defaultScrollingNavigation(\n        index,\n        scrollSettings,\n        staleNavigationFunction,\n      );\n    }\n  }\n\n  async defaultScrollingNavigation(\n    index: number,\n    scrollSettings: FullyDefinedSettings,\n    staleNavigationFunction?: () => Promise<boolean>,\n  ): Promise<ScrollPosition> {\n    const activeScrollerRef = this.getActiveScrollingElement();\n    try {\n      const navigationPromise = new Promise<ScrollPosition>(\n        async (resolve, reject) => {\n          try {\n            const scrollPosition = this.computeNavigation(\n              index,\n              scrollSettings,\n            );\n            if (activeScrollerRef && activeScrollerRef.current) {\n              let currentScrollPositionX = 0;\n              let currentScrollPositionY = 0;\n              if (activeScrollerRef === this._scrollerRef) {\n                currentScrollPositionX = activeScrollerRef.current.scrollLeft;\n                currentScrollPositionY = activeScrollerRef.current.scrollTop;\n              } else if (activeScrollerRef === this._wrapperRef) {\n                currentScrollPositionX = activeScrollerRef.current.scrollX;\n                currentScrollPositionY = activeScrollerRef.current.scrollY;\n              }\n              if (\n                scrollPosition.x === currentScrollPositionX &&\n                scrollPosition.y === currentScrollPositionY\n              ) {\n                return reject(\n                  new Error(NavigationErrors.NO_CHANGE_IN_SCROLL_POSITION),\n                );\n              } else if (staleNavigationFunction) {\n                return staleNavigationFunction()\n                  .then(() => resolve(scrollPosition))\n                  .catch(reject);\n              } else {\n                const scrollParams = {\n                  scroller: activeScrollerRef.current,\n                  fromX: currentScrollPositionX!,\n                  toX: scrollPosition.x,\n                  fromY: currentScrollPositionY!,\n                  toY: scrollPosition.y,\n                  duration: scrollSettings.duration,\n                  isRTL: false,\n                  slideTransition: scrollSettings.slideTransition,\n                  isContinuousScrolling: false,\n                  autoSlideshowContinuousSpeed: 100,\n                };\n                this.currentNavigation = new TrackablePromise(\n                  cssScrollTo(scrollParams).scrollingPromise,\n                );\n                await this.currentNavigation;\n                resolve(scrollPosition);\n              }\n            } else {\n              return reject(new Error(NavigationErrors.SCROLLER_REF_NOT_SET));\n            }\n          } catch (error) {\n            return reject(error);\n          }\n        },\n      );\n\n      const result = await navigationPromise;\n\n      // Check if we need to loop back after navigation\n      if (scrollSettings.loop && index >= 1.5 * this.totalItemsCount) {\n        await this.loopBack(scrollSettings);\n      }\n      return result;\n    } catch (error) {\n      throw error;\n    } finally {\n      this.currentNavigation = undefined;\n    }\n  }\n\n  async nativeScrollingNavigation(\n    index: number,\n    scrollSettings: FullyDefinedSettings,\n    staleNavigationFunction?: () => Promise<boolean>,\n  ) {\n    this.promiseToBeResolvedNextTimeAScrollEnds = new Deferred();\n    const currentScrollPosition = { ...this.scrollPosition };\n    this.promiseToBeResolvedNextTimeAScrollEnds.promise.then(\n      (scrollPosition) => {\n        if (\n          scrollPosition.x === currentScrollPosition.x &&\n          scrollPosition.y === currentScrollPosition.y\n        ) {\n          throw new Error(NavigationErrors.NO_CHANGE_IN_SCROLL_POSITION);\n        }\n      },\n    );\n    const navigationPromise = new Promise<ScrollPosition>(\n      async (resolve, reject) => {\n        try {\n          if (staleNavigationFunction) {\n            return staleNavigationFunction()\n              .then(() =>\n                resolve(\n                  getScrollPositionFromMeasurements(\n                    this._items[index].measurements,\n                  ),\n                ),\n              )\n              .catch(reject);\n          }\n          const scrollerRef = this.getActiveScrollingElement();\n          fallbackScrollIntoView(\n            this._items[index].ref,\n            scrollerRef,\n            scrollSettings.duration,\n          );\n          this.logger('Item scrolled into view:', index);\n        } catch (error) {\n          return reject(error);\n        } finally {\n          this.promiseToBeResolvedNextTimeAScrollEnds?.promise.then(\n            (scrollPosition) => {\n              this.logger(\n                'Scroll position AT THE END OF THE NATIVE SCROLL:',\n                scrollPosition,\n              );\n              resolve(scrollPosition);\n              this.promiseToBeResolvedNextTimeAScrollEnds = undefined;\n            },\n          );\n        }\n      },\n    );\n\n    const result = await navigationPromise;\n\n    // Check if we need to loop back after navigation\n    if (scrollSettings.loop && index >= 1.5 * this.totalItemsCount) {\n      await this.loopBack(scrollSettings);\n    }\n\n    return result;\n  }\n\n  async scrolllessNavigation(\n    index: number,\n    scrollSettings: FullyDefinedSettings,\n    staleNavigationFunction?: () => Promise<boolean>,\n  ): Promise<ScrollPosition> {\n    staleNavigationFunction\n      ? staleNavigationFunction()\n      : this.setCurrentItem(index);\n    if (scrollSettings.loop && index >= 1.5 * this.totalItemsCount) {\n      // TODO this happens on every navigation implementation and can be refactored\n      await this.loopBack(scrollSettings);\n    }\n    return Promise.resolve(this.scrollPosition);\n  }\n\n  async next(\n    settings?: ScrollSettings,\n    staleNavigationFunction?: () => Promise<boolean>,\n  ): Promise<ScrollPosition> {\n    // If we are already at the ending position, we cannot navigate further forward\n    const definedSettings = this.mergeSettingsWithDefaults(settings);\n    const activeScrollerMeasurement =\n      this.getActiveScrollingElementMeasurements();\n    if (\n      !this.isScrollerRefScrollless() &&\n      isAtEnd(\n        definedSettings.isRTL,\n        activeScrollerMeasurement!,\n        this._navigationBoundaries!,\n        this.scrollPosition,\n      )\n    ) {\n      return Promise.reject(\n        new Error(NavigationErrors.CANNOT_NAVIGATE_TO_NEXT),\n      );\n    }\n\n    return this.navigateInDirection(1, settings, staleNavigationFunction);\n  }\n\n  async previous(\n    settings?: ScrollSettings,\n    staleNavigationFunction?: () => Promise<boolean>,\n  ): Promise<ScrollPosition> {\n    // If we are already at the starting position, we cannot navigate further back\n    const definedSettings = this.mergeSettingsWithDefaults(settings);\n    const activeScrollerMeasurement =\n      this.getActiveScrollingElementMeasurements();\n\n    if (\n      !this.isScrollerRefScrollless() &&\n      isAtStart(\n        definedSettings.isRTL,\n        activeScrollerMeasurement!,\n        this._navigationBoundaries!,\n        this.scrollPosition,\n      )\n    ) {\n      return Promise.reject(\n        new Error(NavigationErrors.CANNOT_NAVIGATE_TO_PREVIOUS),\n      );\n    }\n\n    return this.navigateInDirection(-1, settings, staleNavigationFunction);\n  }\n\n  private async navigateInDirection(\n    direction: 1 | -1,\n    settings?: ScrollSettings,\n    staleNavigationFunction?: () => Promise<boolean>,\n    retries = 0,\n  ): Promise<ScrollPosition> {\n    // if current item is null, we cannot navigate\n    if (this.currentItem === null) {\n      return Promise.reject(new Error(NavigationErrors.NO_CENTERED_ITEM));\n    }\n    // calculate the next item recursively\n    const newIndex = this.currentItem + direction + retries * direction;\n    // make sure the new index is within the bounds of the items\n    if (newIndex >= 0 && newIndex < this._items.length) {\n      return this.navigate(newIndex, settings, staleNavigationFunction).catch(\n        (error) => {\n          if (error.message === NavigationErrors.NO_CHANGE_IN_SCROLL_POSITION) {\n            this.logger('No change in scroll position, retrying navigation');\n            return this.navigateInDirection(\n              direction,\n              settings,\n              staleNavigationFunction,\n              retries + 1,\n            );\n          } else {\n            return Promise.reject(error);\n          }\n        },\n      );\n    } else {\n      return Promise.reject(\n        new Error(\n          direction === 1\n            ? NavigationErrors.CANNOT_NAVIGATE_TO_NEXT\n            : NavigationErrors.CANNOT_NAVIGATE_TO_PREVIOUS,\n        ),\n      );\n    }\n  }\n\n  private throttledGetMoreItemsIfNeeded = GalleryUtils.throttle(\n    this.getMoreItemsIfNeededScrollBased.bind(this),\n    THROTTLING_TIMEOUT,\n  );\n\n  private throttledScrollTasks(event: Event) {\n    this.throttledGetMoreItemsIfNeeded(event);\n  }\n\n  private handleScrollEnd(event: Event) {\n    const activeScrollingElement = this.getActiveScrollingElement();\n    let target;\n    if (activeScrollingElement === this._wrapperRef) {\n      // @ts-expect-error\n      target = event.target.scrollingElement;\n    } else if (activeScrollingElement === this._scrollerRef) {\n      target = event.target as HTMLElement;\n    }\n    this.scrollPosition = {\n      y: target.scrollTop,\n      x: target.scrollLeft,\n    };\n    this.registerScrollEnd(event);\n    this.logger('Scroll position:', this.scrollPosition);\n    this.registerCenteredItems(); // no double debouce\n  }\n\n  private registerScrollStart(event: Event) {\n    if (this.currentScroll) {\n      return;\n    } else {\n      this.currentScroll = new Deferred();\n      if (this.promiseToBeResolvedNextTimeAScrollEnds) {\n        this.currentScroll.promise.then((scrollPosition) => {\n          this.promiseToBeResolvedNextTimeAScrollEnds?.resolve(scrollPosition);\n        });\n      }\n      this.logger('Scroll start:', event);\n    }\n  }\n\n  private registerScrollEnd(event: Event) {\n    this.logger('Scroll end:', event);\n    this.currentScroll?.resolve(getScrollPositionFromEvent(event));\n    this.currentScroll = undefined;\n  }\n\n  private debouncedHandleScrollEnd = debounce(\n    this.handleScrollEnd.bind(this),\n    DEBOUNCE_TIMEOUT,\n  );\n\n  private debouncedRegisterCenteredItems = debounce(\n    this.registerCenteredItems.bind(this),\n    DEBOUNCE_TIMEOUT,\n  );\n\n  private registerCenteredItems() {\n    const activeScrollerMeasurement =\n      this.getActiveScrollingElementMeasurements();\n    if (!activeScrollerMeasurement) {\n      console.warn(NavigationErrors.NO_SCROLLER_MEASUREMENTS);\n      return;\n    }\n\n    const scrollerCenterX =\n      this.scrollPosition.x + activeScrollerMeasurement.width / 2;\n    const scrollerCenterY =\n      this.scrollPosition.y + activeScrollerMeasurement.height / 2;\n\n    let closestIndex: number | null = null;\n    let smallestDistance: number = Infinity;\n\n    this._items.forEach((item) => {\n      const measurements = item.measurements;\n      const itemCenterX = measurements.left + measurements.width / 2;\n      const itemCenterY = measurements.top + measurements.height / 2;\n\n      const diffX = Math.abs(itemCenterX - scrollerCenterX);\n      const diffY = Math.abs(itemCenterY - scrollerCenterY);\n      const distance = Math.sqrt(diffX * diffX + diffY * diffY);\n\n      if (\n        isItemCenteredBothAxes(measurements, scrollerCenterX, scrollerCenterY)\n      ) {\n        this.setCenteredItemByBothAxes(item.index);\n        closestIndex = item.index;\n        smallestDistance = 0;\n      } else if (distance < smallestDistance) {\n        closestIndex = item.index;\n        smallestDistance = distance;\n      }\n    });\n\n    if (closestIndex !== null) {\n      this.setCenteredItemByBothAxes(closestIndex);\n      this.logger(`Centered item in both axes: ${this.centeredItemByBothAxes}`);\n    }\n  }\n\n  private async getMoreItemsIfNeededScrollBased(\n    event: Event,\n  ): Promise<Event | void> {\n    if (this.deferredGettingMoreItems?.isPending) {\n      this.logger('getting more items is in progress, do nothing');\n    } else {\n      this.deferredGettingMoreItems = new Deferred();\n      const activeScrollerMeasurement =\n        this.getActiveScrollingElementMeasurements();\n\n      const invalidMeasurements =\n        !activeScrollerMeasurement ||\n        !this._containerMeasurement ||\n        !this._navigationBoundaries;\n\n      if (invalidMeasurements) {\n        this.deferredGettingMoreItems.reject(\n          NavigationErrors.NO_SCROLLER_MEASUREMENTS,\n        );\n      } else {\n        const needMoreItems = reachedToNeedMoreItems(\n          this.baseSettings.isRTL,\n          activeScrollerMeasurement!,\n          this._navigationBoundaries!,\n          this.scrollPosition!,\n        );\n        if (needMoreItems) {\n          this.fireEvent(GALLERY_EVENTS.NEED_MORE_ITEMS, {\n            event,\n          });\n          setTimeout(() => {\n            this.deferredGettingMoreItems?.resolve(event);\n          }, DEFERRED_MORE_ITEMS_TIMEOUT);\n        } else {\n          this.deferredGettingMoreItems.resolve(event);\n        }\n      }\n    }\n    return this.deferredGettingMoreItems.promise.catch((e) =>\n      console.error('failed in get more items through scrolling', e),\n    );\n  }\n\n  getCenteredItemByBothAxes() {\n    return this.centeredItemByBothAxes;\n  }\n\n  setCenteredItemByBothAxes(index: number) {\n    if (index === this.centeredItemByBothAxes) {\n      return; // unchanged\n    }\n    if (typeof index !== 'number') {\n      return;\n    }\n    this.centeredItemByBothAxes = index;\n    if (!this.isScrollerRefScrollless()) {\n      // dont set by scroll in a scrollless gallery\n      this.setCurrentItem(index);\n    }\n  }\n\n  fireEvent(...args: Parameters<EventsListenerFunction>): void {\n    this.logger('Firing Event:', ...args);\n    if (typeof this.eventsListener === 'function') {\n      this.eventsListener(...args);\n    }\n  }\n\n  setCurrentItem(index: number) {\n    if (this.currentItem !== index) {\n      this.fireEvent(GALLERY_EVENTS.CURRENT_ITEM_CHANGED, { index });\n      this.currentItem = index;\n    }\n  }\n\n  getCurrentIndex() {\n    return this.currentItem;\n  }\n\n  updateTotalItemsCount(count: number) {\n    this.totalItemsCount = count;\n  }\n\n  private lastNavigationStatus: {\n    canNavigateToNext: boolean | null;\n    canNavigateToPrevious: boolean | null;\n  } = {\n    canNavigateToNext: null,\n    canNavigateToPrevious: null,\n  };\n\n  private async checkAndFireNavigationStatus() {\n    const newStatus = {\n      canNavigateToNext: await this.isAbleToNavigateToNext(),\n      canNavigateToPrevious: await this.isAbleToNavigateToPrevious(),\n    };\n\n    if (\n      newStatus.canNavigateToNext !==\n        this.lastNavigationStatus.canNavigateToNext ||\n      newStatus.canNavigateToPrevious !==\n        this.lastNavigationStatus.canNavigateToPrevious\n    ) {\n      this.lastNavigationStatus = newStatus;\n      this.fireEvent(GALLERY_EVENTS.NAVIGATION_STATUS_CHANGED, newStatus);\n    }\n  }\n\n  private async loopBack(\n    settings?: FullyDefinedSettings,\n  ): Promise<ScrollPosition> {\n    if (this.totalItemsCount === Infinity) {\n      return Promise.reject(\n        new Error(NavigationErrors.CANNOT_LOOP_WITHOUT_TOTAL_ITEMS_COUNT),\n      );\n    }\n\n    const middleIndex = Math.ceil(this.totalItemsCount / 2);\n\n    // Use navigate to perform the scroll\n    return this.navigate(middleIndex, { ...settings, duration: 0 });\n  }\n\n  fireNavigationApiReadyEvent() {\n    this.fireEvent(\n      GALLERY_EVENTS.NAVIGATION_API_READY,\n      this.getNavigationApi(),\n    );\n  }\n\n  getNavigationApi(): NavigationAPI {\n    return {\n      navigateToIndex: this.navigate.bind(this),\n      next: this.next.bind(this),\n      previous: this.previous.bind(this),\n      currentIndex: this.getCurrentIndex.bind(this),\n      canNavigateToNext: this.isAbleToNavigateToNext.bind(this),\n      canNavigateToPrevious: this.isAbleToNavigateToPrevious.bind(this),\n      isScrollerRefScrollless: this.isScrollerRefScrollless.bind(this),\n      getNextItemByDirection: this.getNextItemByDirection.bind(this),\n    };\n  }\n\n  isScrollerRefScrollless(): boolean {\n    // Scrolless is the case of a stack of items where all the items are contained in the container boundries and a <= is size. this means there is no scroll (not even fake flex scroll)\n    this.logger(\n      isALargerThanB(this._scrollerMeasurement, this._containerMeasurement),\n      someItemsOutsideOfContainer(this._items, this._containerMeasurement),\n    );\n    return (\n      isALargerThanB(this._scrollerMeasurement, this._containerMeasurement) &&\n      !someItemsOutsideOfContainer(this._items, this._containerMeasurement)\n    );\n  }\n\n  debouncedCreateNavigationBoundaries = debounce(\n    this.createNavigationBoundaries.bind(this),\n    DEBOUNCE_TIMEOUT,\n  );\n\n  createNavigationBoundaries(): void {\n    this._navigationBoundaries = this.calculateNavigationBoundaries();\n  }\n\n  calculateNavigationBoundaries(): Measurements {\n    // this is the maximum value in each axis combining both the containerMeasurements and each one of the item measurements to create the max boundries of the possible navigation\n    const maxX = Math.max(\n      this._containerMeasurement!.width,\n      ...this._items.map(\n        // TODO, im sure this can be optimized, but any optimization in the length of the tested array will create edge cases. maybe for now a reduce could be more relevant\n        (item) => item.measurements.left + item.measurements.width,\n      ),\n    );\n    const maxY = Math.max(\n      this._containerMeasurement!.height,\n      ...this._items.map(\n        // TODO, im sure this can be optimized, but any optimization in the length of the tested array will create edge cases. maybe for now a reduce could be more relevant\n        (item) => item.measurements.top + item.measurements.height,\n      ),\n    );\n    this.logger('Navigation boundaries:', { maxX, maxY });\n    return {\n      width: maxX,\n      height: maxY,\n      top: 0,\n      left: 0,\n    };\n  }\n\n  focusOnFirstItem() {\n    if (this._items.length > 0) {\n      this.setCenteredItemByBothAxes(0);\n      this.setCurrentItem(0);\n      this.logger(`Initial focus set to first item: 0`);\n    }\n  }\n\n  getNextItemByDirection(\n    currentIndex: number,\n    direction: Direction,\n  ): number | null {\n    if (this._items.length === 0) {\n      return null;\n    }\n\n    const directionMap: Record<\n      Direction,\n      (index: number, length: number) => number\n    > = {\n      left: (index, length) => (index === 0 ? length - 1 : index - 1),\n      right: (index, length) => (index === length - 1 ? 0 : index + 1),\n      // Vertical navigation not implemented yet - return current index\n      up: (index, _length) => index,\n      down: (index, _length) => index,\n    };\n\n    return directionMap[direction](currentIndex, this._items.length);\n  }\n}\n"],"mappings":"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","ignoreList":[]}