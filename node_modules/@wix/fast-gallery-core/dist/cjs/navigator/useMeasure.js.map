{"version":3,"names":["_react","require","_navigatorUtils","measureImpUsingOffsets","ref","current","element","isHTMLElement","newMeasurements","width","Math","floor","offsetWidth","height","offsetHeight","top","offsetTop","left","offsetLeft","isWindowElement","innerWidth","innerHeight","Error","console","warn","e","error","useMeasure","callback","index","allowMeasuring","currentMeasurements","setCurrentMeasurements","useState","debounceTimeout","useRef","undefined","measure","useCallback","useEffect","handleEvents","clearTimeout","window","setTimeout","resizeObserver","ResizeObserver","intersectionObserver","IntersectionObserver","addEventListener","observe","unobserve","removeEventListener","exports"],"sources":["../../../src/navigator/useMeasure.ts"],"sourcesContent":["import { RefObject, useCallback, useEffect, useRef, useState } from 'react';\nimport { Measurements } from './types';\nimport { isHTMLElement, isWindowElement } from './navigatorUtils';\n\ninterface useMeasureInterface {\n  callback: (rect: Measurements, index?: number) => void;\n  index?: number;\n  ref: RefObject<HTMLDivElement | Window>;\n  allowMeasuring?: boolean; // New optional prop\n}\n\nconst measureImpUsingOffsets = (ref: RefObject<HTMLDivElement | Window>) => {\n  try {\n    if (ref.current) {\n      const element = ref.current;\n\n      if (isHTMLElement(element)) {\n        const newMeasurements: Measurements = {\n          width: Math.floor(element.offsetWidth),\n          height: Math.floor(element.offsetHeight),\n          top: Math.floor(element.offsetTop),\n          left: Math.floor(element.offsetLeft),\n        };\n\n        return newMeasurements;\n      }\n      if (isWindowElement(element)) {\n        const newMeasurements: Measurements = {\n          width: Math.floor(element.innerWidth),\n          height: Math.floor(element.innerHeight),\n          // todo - check if this is correct\n          top: 0, // Window doesn't have 'top' in the same way\n          left: 0, // Window doesn't have 'left' in the same way\n        };\n        return newMeasurements;\n      }\n      throw new Error('Ref is neither an HTMLElement nor a Window');\n    } else {\n      console.warn('ref.current is null', ref);\n      return { width: 0, height: 0, top: 0, left: 0 };\n    }\n  } catch (e) {\n    console.error('could not get measurements for ', ref, e);\n    return { width: 0, height: 0, top: 0, left: 0 };\n  }\n};\n\nexport const useMeasure = ({\n  callback,\n  index,\n  ref,\n  allowMeasuring = true, // Default value\n}: useMeasureInterface) => {\n  const [currentMeasurements, setCurrentMeasurements] =\n    useState<Measurements | null>(null);\n  const debounceTimeout = useRef<number | undefined>(undefined);\n\n  const measure = useCallback(() => {\n    if (!allowMeasuring || !ref.current) {\n      return;\n    } // Check if measuring is allowed\n\n    const newMeasurements: Measurements = measureImpUsingOffsets(ref);\n    if (\n      !currentMeasurements ||\n      newMeasurements.width !== currentMeasurements.width ||\n      newMeasurements.height !== currentMeasurements.height ||\n      newMeasurements.top !== currentMeasurements.top ||\n      newMeasurements.left !== currentMeasurements.left\n    ) {\n      setCurrentMeasurements(newMeasurements);\n      callback(newMeasurements, index);\n    }\n  }, [allowMeasuring, callback, currentMeasurements, index, ref]);\n\n  useEffect(() => {\n    const handleEvents = () => {\n      if (!allowMeasuring) {\n        return;\n      } // Check if measuring is allowed\n\n      if (debounceTimeout.current) {\n        clearTimeout(debounceTimeout.current);\n      }\n      debounceTimeout.current = window.setTimeout(() => {\n        window.setTimeout(measure, 0);\n      }, 50);\n    };\n\n    const resizeObserver = new ResizeObserver(handleEvents);\n    const intersectionObserver = new IntersectionObserver(handleEvents);\n\n    if (isWindowElement(ref.current)) {\n      window.addEventListener('resize', handleEvents);\n      handleEvents(); // Initial measurement on window resize\n    } else if (ref.current) {\n      resizeObserver.observe(ref.current);\n      intersectionObserver.observe(ref.current);\n    }\n    return () => {\n      if (debounceTimeout.current) {\n        clearTimeout(debounceTimeout.current);\n      }\n      if (isHTMLElement(ref.current)) {\n        resizeObserver.unobserve(ref.current);\n        intersectionObserver.unobserve(ref.current);\n      }\n      if (isWindowElement(ref.current)) {\n        window.removeEventListener('resize', handleEvents);\n      }\n    };\n  }, [allowMeasuring, measure, ref]);\n};\n"],"mappings":"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","ignoreList":[]}