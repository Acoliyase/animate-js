{"version":3,"file":"main.umd.min.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,0BAA2B,GAAIH,GACZ,iBAAZC,QACdA,QAAiC,wBAAID,IAErCD,EAA8B,wBAAIC,GACnC,CATD,CASoB,oBAATK,KAAuBA,KAAOC,MAAO,I,mBCRhD,IAAIC,EAAsB,CCA1BA,EAAwB,CAACN,EAASO,KACjC,IAAI,IAAIC,KAAOD,EACXD,EAAoBG,EAAEF,EAAYC,KAASF,EAAoBG,EAAET,EAASQ,IAC5EE,OAAOC,eAAeX,EAASQ,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDF,EAAwB,CAACQ,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFT,EAAyBN,IACH,oBAAXmB,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeX,EAASmB,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeX,EAAS,aAAc,CAAEqB,OAAO,GAAO,G,gECO9D,MAAMC,EAAcH,OAAO,iBACrBI,EAAiBJ,OAAO,oBACxBK,EAAeL,OAAO,wBACtBM,EAAcN,OAAO,kBACrBO,EAAYC,GAAwB,iBAARA,GAA4B,OAARA,GAAgC,mBAARA,EAgDxEC,EAAmB,IAAIC,IAAI,CAC7B,CAAC,QA7CwB,CACzBC,UAAYH,GAAQD,EAASC,IAAQA,EAAIL,GACzCS,UAAUjB,GACN,MAAM,MAAEkB,EAAK,MAAEC,GAAU,IAAIC,eAE7B,OADAC,EAAOrB,EAAKkB,GACL,CAACC,EAAO,CAACA,GACpB,EACAG,YAAYC,IACRA,EAAKC,QACEC,EAAKF,MAqChB,CAAC,QA/BwB,CACzBP,UAAYT,GAAUK,EAASL,IAAUI,KAAeJ,EACxDU,WAAU,MAAEV,IACR,IAAImB,EAcJ,OAZIA,EADAnB,aAAiBoB,MACJ,CACTC,SAAS,EACTrB,MAAO,CACHsB,QAAStB,EAAMsB,QACfC,KAAMvB,EAAMuB,KACZC,MAAOxB,EAAMwB,QAKR,CAAEH,SAAS,EAAOrB,SAE5B,CAACmB,EAAY,GACxB,EACAJ,YAAYI,GACR,GAAIA,EAAWE,QACX,MAAMhC,OAAOoC,OAAO,IAAIL,MAAMD,EAAWnB,MAAMsB,SAAUH,EAAWnB,OAExE,MAAMmB,EAAWnB,KACrB,MASJ,SAASc,EAAOrB,EAAKiC,EAAK3C,MACtB2C,EAAGC,iBAAiB,WAAW,SAASC,EAASC,GAC7C,IAAKA,IAAOA,EAAGC,KACX,OAEJ,MAAM,GAAEC,EAAE,KAAEC,EAAI,KAAEC,GAAS5C,OAAOoC,OAAO,CAAEQ,KAAM,IAAMJ,EAAGC,MACpDI,GAAgBL,EAAGC,KAAKI,cAAgB,IAAIC,IAAIC,GACtD,IAAIC,EACJ,IACI,MAAMC,EAASL,EAAKM,MAAM,GAAI,GAAGC,QAAO,CAAC/C,EAAKC,IAASD,EAAIC,IAAOD,GAC5DgD,EAAWR,EAAKO,QAAO,CAAC/C,EAAKC,IAASD,EAAIC,IAAOD,GACvD,OAAQuC,GACJ,KAAK,EAEGK,EAAcI,EAElB,MACJ,KAAK,EAEGH,EAAOL,EAAKM,OAAO,GAAG,IAAMH,EAAcP,EAAGC,KAAK9B,OAClDqC,GAAc,EAElB,MACJ,KAAK,EAEGA,EAAcI,EAASC,MAAMJ,EAAQJ,GAEzC,MACJ,KAAK,EAGGG,EAAcM,EADA,IAAIF,KAAYP,IAGlC,MACJ,KAAK,EACD,CACI,MAAM,MAAEvB,EAAK,MAAEC,GAAU,IAAIC,eAC7BC,EAAOrB,EAAKmB,GACZyB,EA4HxB,SAAkB5C,EAAKmD,GAEnB,OADAC,EAAcC,IAAIrD,EAAKmD,GAChBnD,CACX,CA/HsCsD,CAASpC,EAAO,CAACA,GACnC,CACA,MACJ,KAAK,EAEG0B,OAAcW,EAI9B,CACA,MAAOhD,GACHqC,EAAc,CAAErC,QAAO,CAACI,GAAc,EAC1C,CACA6C,QAAQC,QAAQb,GACXc,OAAOnD,IACD,CAAEA,QAAO,CAACI,GAAc,MAE9BgD,MAAMf,IACP,MAAOgB,EAAWC,GAAiBC,EAAYlB,GAC/CX,EAAG8B,YAAYnE,OAAOoC,OAAOpC,OAAOoC,OAAO,CAAC,EAAG4B,GAAY,CAAEtB,OAAOuB,GACvD,IAATtB,IAEAN,EAAG+B,oBAAoB,UAAW7B,GAClC8B,EAAchC,GAClB,GAER,IACIA,EAAGT,OACHS,EAAGT,OAEX,CAIA,SAASyC,EAAcC,IAHvB,SAAuBA,GACnB,MAAqC,gBAA9BA,EAASC,YAAYrC,IAChC,EAEQsC,CAAcF,IACdA,EAASG,OACjB,CACA,SAAS5C,EAAKQ,EAAIqC,GACd,OAAOC,EAAYtC,EAAI,GAAIqC,EAC/B,CACA,SAASE,EAAqBC,GAC1B,GAAIA,EACA,MAAM,IAAI9C,MAAM,6CAExB,CACA,SAAS4C,EAAYtC,EAAIO,EAAO,GAAI8B,EAAS,WAAc,GACvD,IAAII,GAAkB,EACtB,MAAMxB,EAAQ,IAAIyB,MAAML,EAAQ,CAC5BvE,IAAI6E,EAAS3E,GAET,GADAuE,EAAqBE,GACjBzE,IAASS,EACT,MAAO,IACImE,EAAuB5C,EAAI,CAC9BM,KAAM,EACNC,KAAMA,EAAKE,KAAKoC,GAAMA,EAAEC,eACzBpB,MAAK,KACJM,EAAchC,GACdyC,GAAkB,CAAI,IAIlC,GAAa,SAATzE,EAAiB,CACjB,GAAoB,IAAhBuC,EAAKwC,OACL,MAAO,CAAErB,KAAM,IAAMT,GAEzB,MAAM+B,EAAIJ,EAAuB5C,EAAI,CACjCM,KAAM,EACNC,KAAMA,EAAKE,KAAKoC,GAAMA,EAAEC,eACzBpB,KAAKhB,GACR,OAAOsC,EAAEtB,KAAKuB,KAAKD,EACvB,CACA,OAAOV,EAAYtC,EAAI,IAAIO,EAAMvC,GACrC,EACAoD,IAAIuB,EAAS3E,EAAM+C,GACfwB,EAAqBE,GAGrB,MAAOnE,EAAOsD,GAAiBC,EAAYd,GAC3C,OAAO6B,EAAuB5C,EAAI,CAC9BM,KAAM,EACNC,KAAM,IAAIA,EAAMvC,GAAMyC,KAAKoC,GAAMA,EAAEC,aACnCxE,SACDsD,GAAeF,KAAKhB,EAC3B,EACAM,MAAM2B,EAASO,EAAUC,GACrBZ,EAAqBE,GACrB,MAAMW,EAAO7C,EAAKA,EAAKwC,OAAS,GAChC,GAAIK,IAAS5E,EACT,OAAOoE,EAAuB5C,EAAI,CAC9BM,KAAM,IACPoB,KAAKhB,GAGZ,GAAa,SAAT0C,EACA,OAAOd,EAAYtC,EAAIO,EAAKM,MAAM,GAAI,IAE1C,MAAOL,EAAcoB,GAAiByB,EAAiBF,GACvD,OAAOP,EAAuB5C,EAAI,CAC9BM,KAAM,EACNC,KAAMA,EAAKE,KAAKoC,GAAMA,EAAEC,aACxBtC,gBACDoB,GAAeF,KAAKhB,EAC3B,EACA4C,UAAUX,EAASQ,GACfZ,EAAqBE,GACrB,MAAOjC,EAAcoB,GAAiByB,EAAiBF,GACvD,OAAOP,EAAuB5C,EAAI,CAC9BM,KAAM,EACNC,KAAMA,EAAKE,KAAKoC,GAAMA,EAAEC,aACxBtC,gBACDoB,GAAeF,KAAKhB,EAC3B,IAEJ,OAAOO,CACX,CAIA,SAASoC,EAAiB7C,GACtB,MAAM+C,EAAY/C,EAAaC,IAAIoB,GACnC,MAAO,CAAC0B,EAAU9C,KAAK+C,GAAMA,EAAE,MALnBC,EAK+BF,EAAU9C,KAAK+C,GAAMA,EAAE,KAJ3DE,MAAMzF,UAAU0F,OAAO3C,MAAM,GAAIyC,KAD5C,IAAgBA,CAMhB,CACA,MAAMtC,EAAgB,IAAIyC,QAK1B,SAAS3C,EAAMlD,GACX,OAAOJ,OAAOoC,OAAOhC,EAAK,CAAE,CAACQ,IAAc,GAC/C,CAQA,SAASsD,EAAYvD,GACjB,IAAK,MAAOuB,EAAMgE,KAAYhF,EAC1B,GAAIgF,EAAQ9E,UAAUT,GAAQ,CAC1B,MAAOwF,EAAiBlC,GAAiBiC,EAAQ7E,UAAUV,GAC3D,MAAO,CACH,CACIgC,KAAM,EACNT,OACAvB,MAAOwF,GAEXlC,EAER,CAEJ,MAAO,CACH,CACItB,KAAM,EACNhC,SAEJ6C,EAAcrD,IAAIQ,IAAU,GAEpC,CACA,SAASoC,EAAcpC,GACnB,OAAQA,EAAMgC,MACV,KAAK,EACD,OAAOzB,EAAiBf,IAAIQ,EAAMuB,MAAMR,YAAYf,EAAMA,OAC9D,KAAK,EACD,OAAOA,EAAMA,MAEzB,CACA,SAASsE,EAAuB5C,EAAI+D,EAAK7C,GACrC,OAAO,IAAIK,SAASC,IAChB,MAAMnB,EAeH,IAAIqD,MAAM,GACZM,KAAK,GACLvD,KAAI,IAAMwD,KAAKC,MAAMD,KAAKE,SAAWC,OAAOC,kBAAkBvB,SAAS,MACvEwB,KAAK,KAjBNtE,EAAGC,iBAAiB,WAAW,SAASsE,EAAEpE,GACjCA,EAAGC,MAASD,EAAGC,KAAKC,IAAMF,EAAGC,KAAKC,KAAOA,IAG9CL,EAAG+B,oBAAoB,UAAWwC,GAClC/C,EAAQrB,EAAGC,MACf,IACIJ,EAAGT,OACHS,EAAGT,QAEPS,EAAG8B,YAAYnE,OAAOoC,OAAO,CAAEM,MAAM0D,GAAM7C,EAAU,GAE7D,CC/RA,MAAMsD,EAAsB,8BACtBC,EAAqB,6BAiCrBC,EAAuBC,UAG3B,MAAOC,EAASC,GAAaC,QAAqBxG,GAClD,OAAO2C,EAAM,CAAE2D,UAASC,aAAY,EAGhCE,EAAyBJ,SACtBK,EAAmB,MAAL1G,OAAK,EAALA,EAAOsG,cAAoB,MAALtG,OAAK,EAALA,EAAOuG,YAG9CC,EAAkB1E,IACtB,MAAM6E,EAASA,CAACL,EAA2BhG,KACzC,GAAIsG,EAAUtG,GAAM,CAClB,MAAMuG,EAAUC,IAEhB,OADAR,EAAQS,SAASF,GAAWvG,EACrB,CAAE,CAAC6F,GAAqBU,EACjC,CAEA,GAAIG,EAAW1G,GAAM,CACnB,MAAMuG,EAAUC,IAShB,OARAR,EAAQW,UAAUJ,GAAW,CAC3BK,EACAC,KAEA,MAAMC,EAAkBV,EAAcQ,EAAcC,GAC9CE,EAAO/G,KAAO8G,GACpB,OAAOhB,EAAqBiB,EAAK,EAE5B,CAAE,CAACnB,GAAsBW,EAClC,CAEA,OAAIzB,MAAMkC,QAAQhH,GACTA,EAAI6B,KAAKoF,GAAWZ,EAAOL,EAASiB,KAEzClH,EAASC,GACJkH,EAAgBlH,GAAMiH,GAAWZ,EAAOL,EAASiB,KAGnDjH,CAAG,EAGNgG,EAA4B,CAAES,SAAU,CAAC,EAAGE,UAAW,CAAC,GAE9D,MAAO,CAACX,EADmBK,EAAOL,EAASxE,GACP,EAGhC4E,EAAgBA,CAACJ,EAA2BxE,KAChD,GAAIsD,MAAMkC,QAAQxF,GAChB,OAAOA,EAAKK,KAAKoF,GAAWb,EAAcJ,EAASiB,KAGrD,GAAIlH,EAASyB,IAASA,EAAKlC,eAAeuG,GAAqB,CAC7D,MAAMsB,EAAa3F,EAAaqE,GAChC,OAAOG,EAAQS,SAASU,EAC1B,CAEA,GAAIpH,EAASyB,IAASA,EAAKlC,eAAesG,GAAsB,CAC9D,MAAMwB,EAAc5F,EAAaoE,GAGjC,OAAOG,iBAAyB,IAAD,IAAAsB,EAAAC,UAAAnD,OAAdoD,EAAI,IAAAzC,MAAAuC,GAAAG,EAAA,EAAAA,EAAAH,EAAAG,IAAJD,EAAIC,GAAAF,UAAAE,GACnB,MAAOZ,EAAca,GAAiBvB,EAAeqB,GAC/CR,QAAaf,EAAQW,UAAUS,GACnC/E,EAAMuE,GACNa,GAEF,OAAOtB,EAAuBY,EAChC,CACF,CAEA,OAAIhH,EAASyB,GACJ0F,EAAgB1F,GAAOyF,GAAWb,EAAcJ,EAASiB,KAG3DzF,CAAI,EAGPkG,EAAuBA,CAC3BvI,EACAmC,IAEO,IAAIwC,MAAS3E,EAAK,CACvBD,IAAGA,CAACuE,EAAarE,IACVqE,EAAOrE,GAOLkC,EAASmC,EAAOrE,IANd,KACL,MAAM,IAAI0B,MACR,gDAAgD1B,iBAAoBqE,IACrE,IAQL6C,EAAatG,GAAkCA,aAAe2C,QAC9D5C,EAAYC,GAChBA,GAAsB,iBAARA,IAAqBsG,EAAUtG,GACzC0G,EAAc1G,GAA6C,mBAARA,EACnDkH,EAAkBA,CAAC/H,EAAamC,IAE7BvC,OAAO4I,YAAY5I,OAAO6I,QAAQzI,GAAK0C,KAD3BgG,IAAA,IAAEhJ,EAAKa,GAAqBmI,EAAA,MAAK,CAAChJ,EAAKyC,EAAS5B,GAAO,KAGtE8G,EAAW,MACf,IAAIsB,EAAU,EACd,MAAO,MAAQA,CAChB,EAHgB,GCtIJC,EAAgB,6BAchBC,EAAOH,IASd,IAT+B,YACnC3E,EAAW,OACX+E,GAIDJ,EAIC,MAAQxH,MAAO6H,EAAY5H,MAAO6H,GAAa,IAAI5H,eAOnD2C,EALgB,CACdkF,KAAML,EACNM,QAHsB,QAItB3H,KAAMyH,GAEaF,EAAQ,CAACE,IAC9B,MAAMG,GDzB4CC,ECyBZ3H,EAAUsH,GDxBzCR,EAAqBa,GAAMC,GACzBzC,iBAAyB,IAAD,IAAA0C,EAAAnB,UAAAnD,OAAdoD,EAAI,IAAAzC,MAAA2D,GAAAC,EAAA,EAAAA,EAAAD,EAAAC,IAAJnB,EAAImB,GAAApB,UAAAoB,GACnB,MAAO1C,EAASyB,GAAiBvB,EAAeqB,GAC1CoB,QAAuBH,EAC3BnG,EAAM2D,GACNyB,GAEF,OAAOtB,EAAuBwC,EAChC,KATgDJ,MC2BlD,MAAO,CACLD,UACA9E,MAAOA,IAAM8E,EAAQzI,KACtB,EAQU+I,EAAQC,IAMd,IAN+B,IACpCC,EAAG,KACHpI,GAIDmI,EACCrI,EDhCoDsI,IAC7CpB,EAAqBoB,GAAMN,GACzB,CAACxC,EAA2BuB,KACjC,MAAMT,EAAkBV,EAAcJ,EAASuB,GACzCwB,EAAcP,KAAkB1B,GACtC,OAAOhB,EAAqBiD,EAAY,IC2BrCC,CAAwBF,GAAMpI,EAAK,E","sources":["webpack://_wix_communication_channel/webpack/universalModuleDefinition","webpack://_wix_communication_channel/webpack/bootstrap","webpack://_wix_communication_channel/webpack/runtime/define property getters","webpack://_wix_communication_channel/webpack/runtime/hasOwnProperty shorthand","webpack://_wix_communication_channel/webpack/runtime/make namespace object","webpack://_wix_communication_channel/../../node_modules/comlink/dist/esm/comlink.mjs","webpack://_wix_communication_channel/./serialization.ts","webpack://_wix_communication_channel/./index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"WixCommunicationChannel\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WixCommunicationChannel\"] = factory();\n\telse\n\t\troot[\"WixCommunicationChannel\"] = factory();\n})((typeof self !== 'undefined' ? self : this), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * Copyright 2019 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst proxyMarker = Symbol(\"Comlink.proxy\");\r\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\r\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\r\nconst throwMarker = Symbol(\"Comlink.thrown\");\r\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\r\n/**\r\n * Internal transfer handle to handle objects marked to proxy.\r\n */\r\nconst proxyTransferHandler = {\r\n    canHandle: (val) => isObject(val) && val[proxyMarker],\r\n    serialize(obj) {\r\n        const { port1, port2 } = new MessageChannel();\r\n        expose(obj, port1);\r\n        return [port2, [port2]];\r\n    },\r\n    deserialize(port) {\r\n        port.start();\r\n        return wrap(port);\r\n    },\r\n};\r\n/**\r\n * Internal transfer handler to handle thrown exceptions.\r\n */\r\nconst throwTransferHandler = {\r\n    canHandle: (value) => isObject(value) && throwMarker in value,\r\n    serialize({ value }) {\r\n        let serialized;\r\n        if (value instanceof Error) {\r\n            serialized = {\r\n                isError: true,\r\n                value: {\r\n                    message: value.message,\r\n                    name: value.name,\r\n                    stack: value.stack,\r\n                },\r\n            };\r\n        }\r\n        else {\r\n            serialized = { isError: false, value };\r\n        }\r\n        return [serialized, []];\r\n    },\r\n    deserialize(serialized) {\r\n        if (serialized.isError) {\r\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\r\n        }\r\n        throw serialized.value;\r\n    },\r\n};\r\n/**\r\n * Allows customizing the serialization of certain values.\r\n */\r\nconst transferHandlers = new Map([\r\n    [\"proxy\", proxyTransferHandler],\r\n    [\"throw\", throwTransferHandler],\r\n]);\r\nfunction expose(obj, ep = self) {\r\n    ep.addEventListener(\"message\", function callback(ev) {\r\n        if (!ev || !ev.data) {\r\n            return;\r\n        }\r\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\r\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\r\n        let returnValue;\r\n        try {\r\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\r\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\r\n            switch (type) {\r\n                case 0 /* GET */:\r\n                    {\r\n                        returnValue = rawValue;\r\n                    }\r\n                    break;\r\n                case 1 /* SET */:\r\n                    {\r\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\r\n                        returnValue = true;\r\n                    }\r\n                    break;\r\n                case 2 /* APPLY */:\r\n                    {\r\n                        returnValue = rawValue.apply(parent, argumentList);\r\n                    }\r\n                    break;\r\n                case 3 /* CONSTRUCT */:\r\n                    {\r\n                        const value = new rawValue(...argumentList);\r\n                        returnValue = proxy(value);\r\n                    }\r\n                    break;\r\n                case 4 /* ENDPOINT */:\r\n                    {\r\n                        const { port1, port2 } = new MessageChannel();\r\n                        expose(obj, port2);\r\n                        returnValue = transfer(port1, [port1]);\r\n                    }\r\n                    break;\r\n                case 5 /* RELEASE */:\r\n                    {\r\n                        returnValue = undefined;\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n        catch (value) {\r\n            returnValue = { value, [throwMarker]: 0 };\r\n        }\r\n        Promise.resolve(returnValue)\r\n            .catch((value) => {\r\n            return { value, [throwMarker]: 0 };\r\n        })\r\n            .then((returnValue) => {\r\n            const [wireValue, transferables] = toWireValue(returnValue);\r\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\r\n            if (type === 5 /* RELEASE */) {\r\n                // detach and deactive after sending release response above.\r\n                ep.removeEventListener(\"message\", callback);\r\n                closeEndPoint(ep);\r\n            }\r\n        });\r\n    });\r\n    if (ep.start) {\r\n        ep.start();\r\n    }\r\n}\r\nfunction isMessagePort(endpoint) {\r\n    return endpoint.constructor.name === \"MessagePort\";\r\n}\r\nfunction closeEndPoint(endpoint) {\r\n    if (isMessagePort(endpoint))\r\n        endpoint.close();\r\n}\r\nfunction wrap(ep, target) {\r\n    return createProxy(ep, [], target);\r\n}\r\nfunction throwIfProxyReleased(isReleased) {\r\n    if (isReleased) {\r\n        throw new Error(\"Proxy has been released and is not useable\");\r\n    }\r\n}\r\nfunction createProxy(ep, path = [], target = function () { }) {\r\n    let isProxyReleased = false;\r\n    const proxy = new Proxy(target, {\r\n        get(_target, prop) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            if (prop === releaseProxy) {\r\n                return () => {\r\n                    return requestResponseMessage(ep, {\r\n                        type: 5 /* RELEASE */,\r\n                        path: path.map((p) => p.toString()),\r\n                    }).then(() => {\r\n                        closeEndPoint(ep);\r\n                        isProxyReleased = true;\r\n                    });\r\n                };\r\n            }\r\n            if (prop === \"then\") {\r\n                if (path.length === 0) {\r\n                    return { then: () => proxy };\r\n                }\r\n                const r = requestResponseMessage(ep, {\r\n                    type: 0 /* GET */,\r\n                    path: path.map((p) => p.toString()),\r\n                }).then(fromWireValue);\r\n                return r.then.bind(r);\r\n            }\r\n            return createProxy(ep, [...path, prop]);\r\n        },\r\n        set(_target, prop, rawValue) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\r\n            // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\r\n            const [value, transferables] = toWireValue(rawValue);\r\n            return requestResponseMessage(ep, {\r\n                type: 1 /* SET */,\r\n                path: [...path, prop].map((p) => p.toString()),\r\n                value,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        apply(_target, _thisArg, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const last = path[path.length - 1];\r\n            if (last === createEndpoint) {\r\n                return requestResponseMessage(ep, {\r\n                    type: 4 /* ENDPOINT */,\r\n                }).then(fromWireValue);\r\n            }\r\n            // We just pretend that `bind()` didn’t happen.\r\n            if (last === \"bind\") {\r\n                return createProxy(ep, path.slice(0, -1));\r\n            }\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 2 /* APPLY */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        construct(_target, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 3 /* CONSTRUCT */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n    });\r\n    return proxy;\r\n}\r\nfunction myFlat(arr) {\r\n    return Array.prototype.concat.apply([], arr);\r\n}\r\nfunction processArguments(argumentList) {\r\n    const processed = argumentList.map(toWireValue);\r\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\r\n}\r\nconst transferCache = new WeakMap();\r\nfunction transfer(obj, transfers) {\r\n    transferCache.set(obj, transfers);\r\n    return obj;\r\n}\r\nfunction proxy(obj) {\r\n    return Object.assign(obj, { [proxyMarker]: true });\r\n}\r\nfunction windowEndpoint(w, context = self, targetOrigin = \"*\") {\r\n    return {\r\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\r\n        addEventListener: context.addEventListener.bind(context),\r\n        removeEventListener: context.removeEventListener.bind(context),\r\n    };\r\n}\r\nfunction toWireValue(value) {\r\n    for (const [name, handler] of transferHandlers) {\r\n        if (handler.canHandle(value)) {\r\n            const [serializedValue, transferables] = handler.serialize(value);\r\n            return [\r\n                {\r\n                    type: 3 /* HANDLER */,\r\n                    name,\r\n                    value: serializedValue,\r\n                },\r\n                transferables,\r\n            ];\r\n        }\r\n    }\r\n    return [\r\n        {\r\n            type: 0 /* RAW */,\r\n            value,\r\n        },\r\n        transferCache.get(value) || [],\r\n    ];\r\n}\r\nfunction fromWireValue(value) {\r\n    switch (value.type) {\r\n        case 3 /* HANDLER */:\r\n            return transferHandlers.get(value.name).deserialize(value.value);\r\n        case 0 /* RAW */:\r\n            return value.value;\r\n    }\r\n}\r\nfunction requestResponseMessage(ep, msg, transfers) {\r\n    return new Promise((resolve) => {\r\n        const id = generateUUID();\r\n        ep.addEventListener(\"message\", function l(ev) {\r\n            if (!ev.data || !ev.data.id || ev.data.id !== id) {\r\n                return;\r\n            }\r\n            ep.removeEventListener(\"message\", l);\r\n            resolve(ev.data);\r\n        });\r\n        if (ep.start) {\r\n            ep.start();\r\n        }\r\n        ep.postMessage(Object.assign({ id }, msg), transfers);\r\n    });\r\n}\r\nfunction generateUUID() {\r\n    return new Array(4)\r\n        .fill(0)\r\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\r\n        .join(\"-\");\r\n}\n\nexport { createEndpoint, expose, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","import { proxy } from 'comlink';\n\nconst proxyCallbackMarker = '__proxyCallbackId__wixSDK__';\nconst proxyPromiseMarker = '__proxyPromiseId__wixSDK__';\ntype SerializedReturnValue = {\n  proxies: ProxiesCollector;\n  clonables: any;\n};\nexport type ProxiesCollector = {\n  callbacks: { [key: string]: Function };\n  promises: { [key: string]: Promise<any> };\n};\n\nexport const serializeAllMethodsIn = <T extends {}>(sdk: T) => {\n  return wrapMethodsWithProxy(sdk, (originalMethod) => {\n    return async (...args: any) => {\n      const [proxies, argsNoProxies] = extractProxies(args);\n      const originalResult = await originalMethod(\n        proxy(proxies),\n        argsNoProxies,\n      );\n      return deserializeReturnValue(originalResult);\n    };\n  });\n};\n\nexport const deserializeAllMethodsIn = <T extends {}>(api: T) => {\n  return wrapMethodsWithProxy(api, (originalMethod) => {\n    return (proxies: ProxiesCollector, args: any[]) => {\n      const argsWithProxies = insertProxies(proxies, args);\n      const originalRun = originalMethod(...argsWithProxies);\n      return serializeReturnValue(originalRun);\n    };\n  });\n};\n\nconst serializeReturnValue = async (\n  value: any,\n): Promise<SerializedReturnValue> => {\n  const [proxies, clonables] = extractProxies(await value);\n  return proxy({ proxies, clonables });\n};\n\nconst deserializeReturnValue = async (value: any) => {\n  return insertProxies(value?.proxies, await value?.clonables);\n};\n\nconst extractProxies = (data: any): [ProxiesCollector, any] => {\n  const walker = (proxies: ProxiesCollector, val: any): any => {\n    if (isPromise(val)) {\n      const proxyId = uniqueId();\n      proxies.promises[proxyId] = val;\n      return { [proxyPromiseMarker]: proxyId };\n    }\n\n    if (isFunction(val)) {\n      const proxyId = uniqueId();\n      proxies.callbacks[proxyId] = (\n        innerProxies: ProxiesCollector,\n        argsAsArray: any[],\n      ) => {\n        const argsWithProxies = insertProxies(innerProxies, argsAsArray);\n        const exec = val(...argsWithProxies);\n        return serializeReturnValue(exec);\n      };\n      return { [proxyCallbackMarker]: proxyId };\n    }\n\n    if (Array.isArray(val)) {\n      return val.map((i: any) => walker(proxies, i));\n    }\n    if (isObject(val)) {\n      return mapObjectValues(val, (i: any) => walker(proxies, i));\n    }\n\n    return val;\n  };\n\n  const proxies: ProxiesCollector = { promises: {}, callbacks: {} };\n  const dataWithoutProxies = walker(proxies, data);\n  return [proxies, dataWithoutProxies];\n};\n\nconst insertProxies = (proxies: ProxiesCollector, data: any): any => {\n  if (Array.isArray(data)) {\n    return data.map((i: any) => insertProxies(proxies, i));\n  }\n\n  if (isObject(data) && data.hasOwnProperty(proxyPromiseMarker)) {\n    const promiseId = (data as any)[proxyPromiseMarker];\n    return proxies.promises[promiseId];\n  }\n\n  if (isObject(data) && data.hasOwnProperty(proxyCallbackMarker)) {\n    const callbackId = (data as any)[proxyCallbackMarker];\n    // passing args in spread syntax to comlink proxy generates problem when transpiling to old JS version\n    // so pass it as array and handle it on the deserialization level:\n    return async (...args: any) => {\n      const [innerProxies, argsNoProxies] = extractProxies(args);\n      const exec = await proxies.callbacks[callbackId](\n        proxy(innerProxies),\n        argsNoProxies,\n      );\n      return deserializeReturnValue(exec);\n    };\n  }\n\n  if (isObject(data)) {\n    return mapObjectValues(data, (i: any) => insertProxies(proxies, i));\n  }\n\n  return data;\n};\n\nconst wrapMethodsWithProxy = <T extends Record<string, Function>>(\n  obj: T,\n  callback: (originalMethod: Function) => Function,\n) => {\n  return new Proxy<T>(obj, {\n    get(target: any, prop: any) {\n      if (!target[prop]) {\n        return () => {\n          throw new Error(\n            `Serialization error occurred while accessing ${prop} property of ${target}`,\n          );\n        };\n      }\n      return callback(target[prop]);\n    },\n  });\n};\n\nconst isPromise = (val: any): val is Promise<any> => val instanceof Promise;\nconst isObject = (val: any): val is object =>\n  val && typeof val === 'object' && !isPromise(val);\nconst isFunction = (val: any): val is Function => typeof val === 'function';\nconst mapObjectValues = (obj: object, callback: Function) => {\n  const mapEntries = ([key, value]: [string, any]) => [key, callback(value)];\n  return Object.fromEntries(Object.entries(obj).map(mapEntries));\n};\nconst uniqueId = (() => {\n  let counter = 0;\n  return () => ++counter;\n})();\n","import {\n  deserializeAllMethodsIn,\n  serializeAllMethodsIn,\n} from './serialization';\nimport { wrap, expose, releaseProxy, Remote } from 'comlink';\n\nexport const handshakeCode = 'wix-sdk-bo-hello-handshake';\nexport type PostMessage = (\n  message: object,\n  targetOrigin: string,\n  transfer: Transferable[],\n) => void;\n\nexport type OpenedChannel<A> = Remote<A>;\n\n/**\n * Initializes a new channel with a target.\n * @param postMessage - Target's function to receive messages.\n * @param origin - Target's origin.\n */\nexport const open = <API extends {}>({\n  postMessage,\n  origin,\n}: {\n  postMessage: PostMessage;\n  origin: string;\n}): {\n  channel: OpenedChannel<API>;\n  close: () => void;\n} => {\n  const { port1: widgetPort, port2: hostPort } = new MessageChannel();\n  const protocolVersion = '1.0.0';\n  const message = {\n    code: handshakeCode,\n    version: protocolVersion,\n    port: hostPort,\n  };\n  postMessage(message, origin, [hostPort]);\n  const channel = serializeAllMethodsIn(wrap<API>(widgetPort));\n\n  return {\n    channel,\n    close: () => channel[releaseProxy](),\n  };\n};\n\n/**\n * Serves api as a response over the communication channel to given port.\n * @param api - The api object that has the methods inside it.\n * @param port - The port on which the channel was initiated and needs to receive the api.\n */\nexport const serve = <API extends {}>({\n  api,\n  port,\n}: {\n  api: API;\n  port: MessagePort;\n}) => {\n  expose(deserializeAllMethodsIn(api), port);\n};\n"],"names":["root","factory","exports","module","define","amd","self","this","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","proxyMarker","createEndpoint","releaseProxy","throwMarker","isObject","val","transferHandlers","Map","canHandle","serialize","port1","port2","MessageChannel","expose","deserialize","port","start","wrap","serialized","Error","isError","message","name","stack","assign","ep","addEventListener","callback","ev","data","id","type","path","argumentList","map","fromWireValue","returnValue","parent","slice","reduce","rawValue","apply","proxy","transfers","transferCache","set","transfer","undefined","Promise","resolve","catch","then","wireValue","transferables","toWireValue","postMessage","removeEventListener","closeEndPoint","endpoint","constructor","isMessagePort","close","target","createProxy","throwIfProxyReleased","isReleased","isProxyReleased","Proxy","_target","requestResponseMessage","p","toString","length","r","bind","_thisArg","rawArgumentList","last","processArguments","construct","processed","v","arr","Array","concat","WeakMap","handler","serializedValue","msg","fill","Math","floor","random","Number","MAX_SAFE_INTEGER","join","l","proxyCallbackMarker","proxyPromiseMarker","serializeReturnValue","async","proxies","clonables","extractProxies","deserializeReturnValue","insertProxies","walker","isPromise","proxyId","uniqueId","promises","isFunction","callbacks","innerProxies","argsAsArray","argsWithProxies","exec","isArray","i","mapObjectValues","promiseId","callbackId","_len2","arguments","args","_key2","argsNoProxies","wrapMethodsWithProxy","fromEntries","entries","_ref","counter","handshakeCode","open","origin","widgetPort","hostPort","code","version","channel","sdk","originalMethod","_len","_key","originalResult","serve","_ref2","api","originalRun","deserializeAllMethodsIn"],"sourceRoot":""}