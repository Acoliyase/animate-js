{"version":3,"file":"main.umd.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,O;;UCVA;UACA;;;;;WCDA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;;;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,eAAe;AAC/B;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,OAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,2BAA2B;AAC3B;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,iBAAiB,kBAAkB,UAAU;AAC7D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,eAAe;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA,qBAAqB;AACrB,SAAS;AACT;AACA;AACA,yDAAyD,gBAAgB,IAAI;AAC7E;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,qBAAqB;AACrD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT;AACA;AACA;AACA,uCAAuC,IAAI;AAC3C,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEsH;AACtH;;;ACxSA,KAAM,CAAAC,mBAAmB,CAAG,6BAA6B,CACzD,KAAM,CAAAC,kBAAkB,CAAG,4BAA4B,CAUhD,KAAM,CAAAC,qBAAqB,CAAkBC,GAAM,EAAK,CAC7D,MAAO,CAAAC,oBAAoB,CAACD,GAAG,CAAGE,cAAc,EAAK,CACnD,MAAO,iBAAwB,SAAAC,IAAA,CAAAC,SAAA,CAAAC,MAAA,CAAdC,IAAI,KAAAC,KAAA,CAAAJ,IAAA,EAAAK,IAAA,GAAAA,IAAA,CAAAL,IAAA,CAAAK,IAAA,IAAJF,IAAI,CAAAE,IAAA,EAAAJ,SAAA,CAAAI,IAAA,GACnB,KAAM,CAACC,OAAO,CAAEC,aAAa,CAAC,CAAGC,cAAc,CA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","sources":["webpack://_wix_communication_channel/webpack/universalModuleDefinition","webpack://_wix_communication_channel/webpack/bootstrap","webpack://_wix_communication_channel/webpack/runtime/define property getters","webpack://_wix_communication_channel/webpack/runtime/hasOwnProperty shorthand","webpack://_wix_communication_channel/webpack/runtime/make namespace object","webpack://_wix_communication_channel/../../node_modules/comlink/dist/esm/comlink.mjs","webpack://_wix_communication_channel/./serialization.ts","webpack://_wix_communication_channel/./index.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"WixCommunicationChannel\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WixCommunicationChannel\"] = factory();\n\telse\n\t\troot[\"WixCommunicationChannel\"] = factory();\n})((typeof self !== 'undefined' ? self : this), () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\r\n * Copyright 2019 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst proxyMarker = Symbol(\"Comlink.proxy\");\r\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\r\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\r\nconst throwMarker = Symbol(\"Comlink.thrown\");\r\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\r\n/**\r\n * Internal transfer handle to handle objects marked to proxy.\r\n */\r\nconst proxyTransferHandler = {\r\n    canHandle: (val) => isObject(val) && val[proxyMarker],\r\n    serialize(obj) {\r\n        const { port1, port2 } = new MessageChannel();\r\n        expose(obj, port1);\r\n        return [port2, [port2]];\r\n    },\r\n    deserialize(port) {\r\n        port.start();\r\n        return wrap(port);\r\n    },\r\n};\r\n/**\r\n * Internal transfer handler to handle thrown exceptions.\r\n */\r\nconst throwTransferHandler = {\r\n    canHandle: (value) => isObject(value) && throwMarker in value,\r\n    serialize({ value }) {\r\n        let serialized;\r\n        if (value instanceof Error) {\r\n            serialized = {\r\n                isError: true,\r\n                value: {\r\n                    message: value.message,\r\n                    name: value.name,\r\n                    stack: value.stack,\r\n                },\r\n            };\r\n        }\r\n        else {\r\n            serialized = { isError: false, value };\r\n        }\r\n        return [serialized, []];\r\n    },\r\n    deserialize(serialized) {\r\n        if (serialized.isError) {\r\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\r\n        }\r\n        throw serialized.value;\r\n    },\r\n};\r\n/**\r\n * Allows customizing the serialization of certain values.\r\n */\r\nconst transferHandlers = new Map([\r\n    [\"proxy\", proxyTransferHandler],\r\n    [\"throw\", throwTransferHandler],\r\n]);\r\nfunction expose(obj, ep = self) {\r\n    ep.addEventListener(\"message\", function callback(ev) {\r\n        if (!ev || !ev.data) {\r\n            return;\r\n        }\r\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\r\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\r\n        let returnValue;\r\n        try {\r\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\r\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\r\n            switch (type) {\r\n                case 0 /* GET */:\r\n                    {\r\n                        returnValue = rawValue;\r\n                    }\r\n                    break;\r\n                case 1 /* SET */:\r\n                    {\r\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\r\n                        returnValue = true;\r\n                    }\r\n                    break;\r\n                case 2 /* APPLY */:\r\n                    {\r\n                        returnValue = rawValue.apply(parent, argumentList);\r\n                    }\r\n                    break;\r\n                case 3 /* CONSTRUCT */:\r\n                    {\r\n                        const value = new rawValue(...argumentList);\r\n                        returnValue = proxy(value);\r\n                    }\r\n                    break;\r\n                case 4 /* ENDPOINT */:\r\n                    {\r\n                        const { port1, port2 } = new MessageChannel();\r\n                        expose(obj, port2);\r\n                        returnValue = transfer(port1, [port1]);\r\n                    }\r\n                    break;\r\n                case 5 /* RELEASE */:\r\n                    {\r\n                        returnValue = undefined;\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n        catch (value) {\r\n            returnValue = { value, [throwMarker]: 0 };\r\n        }\r\n        Promise.resolve(returnValue)\r\n            .catch((value) => {\r\n            return { value, [throwMarker]: 0 };\r\n        })\r\n            .then((returnValue) => {\r\n            const [wireValue, transferables] = toWireValue(returnValue);\r\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\r\n            if (type === 5 /* RELEASE */) {\r\n                // detach and deactive after sending release response above.\r\n                ep.removeEventListener(\"message\", callback);\r\n                closeEndPoint(ep);\r\n            }\r\n        });\r\n    });\r\n    if (ep.start) {\r\n        ep.start();\r\n    }\r\n}\r\nfunction isMessagePort(endpoint) {\r\n    return endpoint.constructor.name === \"MessagePort\";\r\n}\r\nfunction closeEndPoint(endpoint) {\r\n    if (isMessagePort(endpoint))\r\n        endpoint.close();\r\n}\r\nfunction wrap(ep, target) {\r\n    return createProxy(ep, [], target);\r\n}\r\nfunction throwIfProxyReleased(isReleased) {\r\n    if (isReleased) {\r\n        throw new Error(\"Proxy has been released and is not useable\");\r\n    }\r\n}\r\nfunction createProxy(ep, path = [], target = function () { }) {\r\n    let isProxyReleased = false;\r\n    const proxy = new Proxy(target, {\r\n        get(_target, prop) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            if (prop === releaseProxy) {\r\n                return () => {\r\n                    return requestResponseMessage(ep, {\r\n                        type: 5 /* RELEASE */,\r\n                        path: path.map((p) => p.toString()),\r\n                    }).then(() => {\r\n                        closeEndPoint(ep);\r\n                        isProxyReleased = true;\r\n                    });\r\n                };\r\n            }\r\n            if (prop === \"then\") {\r\n                if (path.length === 0) {\r\n                    return { then: () => proxy };\r\n                }\r\n                const r = requestResponseMessage(ep, {\r\n                    type: 0 /* GET */,\r\n                    path: path.map((p) => p.toString()),\r\n                }).then(fromWireValue);\r\n                return r.then.bind(r);\r\n            }\r\n            return createProxy(ep, [...path, prop]);\r\n        },\r\n        set(_target, prop, rawValue) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\r\n            // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\r\n            const [value, transferables] = toWireValue(rawValue);\r\n            return requestResponseMessage(ep, {\r\n                type: 1 /* SET */,\r\n                path: [...path, prop].map((p) => p.toString()),\r\n                value,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        apply(_target, _thisArg, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const last = path[path.length - 1];\r\n            if (last === createEndpoint) {\r\n                return requestResponseMessage(ep, {\r\n                    type: 4 /* ENDPOINT */,\r\n                }).then(fromWireValue);\r\n            }\r\n            // We just pretend that `bind()` didn’t happen.\r\n            if (last === \"bind\") {\r\n                return createProxy(ep, path.slice(0, -1));\r\n            }\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 2 /* APPLY */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        construct(_target, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 3 /* CONSTRUCT */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n    });\r\n    return proxy;\r\n}\r\nfunction myFlat(arr) {\r\n    return Array.prototype.concat.apply([], arr);\r\n}\r\nfunction processArguments(argumentList) {\r\n    const processed = argumentList.map(toWireValue);\r\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\r\n}\r\nconst transferCache = new WeakMap();\r\nfunction transfer(obj, transfers) {\r\n    transferCache.set(obj, transfers);\r\n    return obj;\r\n}\r\nfunction proxy(obj) {\r\n    return Object.assign(obj, { [proxyMarker]: true });\r\n}\r\nfunction windowEndpoint(w, context = self, targetOrigin = \"*\") {\r\n    return {\r\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\r\n        addEventListener: context.addEventListener.bind(context),\r\n        removeEventListener: context.removeEventListener.bind(context),\r\n    };\r\n}\r\nfunction toWireValue(value) {\r\n    for (const [name, handler] of transferHandlers) {\r\n        if (handler.canHandle(value)) {\r\n            const [serializedValue, transferables] = handler.serialize(value);\r\n            return [\r\n                {\r\n                    type: 3 /* HANDLER */,\r\n                    name,\r\n                    value: serializedValue,\r\n                },\r\n                transferables,\r\n            ];\r\n        }\r\n    }\r\n    return [\r\n        {\r\n            type: 0 /* RAW */,\r\n            value,\r\n        },\r\n        transferCache.get(value) || [],\r\n    ];\r\n}\r\nfunction fromWireValue(value) {\r\n    switch (value.type) {\r\n        case 3 /* HANDLER */:\r\n            return transferHandlers.get(value.name).deserialize(value.value);\r\n        case 0 /* RAW */:\r\n            return value.value;\r\n    }\r\n}\r\nfunction requestResponseMessage(ep, msg, transfers) {\r\n    return new Promise((resolve) => {\r\n        const id = generateUUID();\r\n        ep.addEventListener(\"message\", function l(ev) {\r\n            if (!ev.data || !ev.data.id || ev.data.id !== id) {\r\n                return;\r\n            }\r\n            ep.removeEventListener(\"message\", l);\r\n            resolve(ev.data);\r\n        });\r\n        if (ep.start) {\r\n            ep.start();\r\n        }\r\n        ep.postMessage(Object.assign({ id }, msg), transfers);\r\n    });\r\n}\r\nfunction generateUUID() {\r\n    return new Array(4)\r\n        .fill(0)\r\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\r\n        .join(\"-\");\r\n}\n\nexport { createEndpoint, expose, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","import { proxy } from 'comlink';\n\nconst proxyCallbackMarker = '__proxyCallbackId__wixSDK__';\nconst proxyPromiseMarker = '__proxyPromiseId__wixSDK__';\ntype SerializedReturnValue = {\n  proxies: ProxiesCollector;\n  clonables: any;\n};\nexport type ProxiesCollector = {\n  callbacks: { [key: string]: Function };\n  promises: { [key: string]: Promise<any> };\n};\n\nexport const serializeAllMethodsIn = <T extends {}>(sdk: T) => {\n  return wrapMethodsWithProxy(sdk, (originalMethod) => {\n    return async (...args: any) => {\n      const [proxies, argsNoProxies] = extractProxies(args);\n      const originalResult = await originalMethod(\n        proxy(proxies),\n        argsNoProxies,\n      );\n      return deserializeReturnValue(originalResult);\n    };\n  });\n};\n\nexport const deserializeAllMethodsIn = <T extends {}>(api: T) => {\n  return wrapMethodsWithProxy(api, (originalMethod) => {\n    return (proxies: ProxiesCollector, args: any[]) => {\n      const argsWithProxies = insertProxies(proxies, args);\n      const originalRun = originalMethod(...argsWithProxies);\n      return serializeReturnValue(originalRun);\n    };\n  });\n};\n\nconst serializeReturnValue = async (\n  value: any,\n): Promise<SerializedReturnValue> => {\n  const [proxies, clonables] = extractProxies(await value);\n  return proxy({ proxies, clonables });\n};\n\nconst deserializeReturnValue = async (value: any) => {\n  return insertProxies(value?.proxies, await value?.clonables);\n};\n\nconst extractProxies = (data: any): [ProxiesCollector, any] => {\n  const walker = (proxies: ProxiesCollector, val: any): any => {\n    if (isPromise(val)) {\n      const proxyId = uniqueId();\n      proxies.promises[proxyId] = val;\n      return { [proxyPromiseMarker]: proxyId };\n    }\n\n    if (isFunction(val)) {\n      const proxyId = uniqueId();\n      proxies.callbacks[proxyId] = (\n        innerProxies: ProxiesCollector,\n        argsAsArray: any[],\n      ) => {\n        const argsWithProxies = insertProxies(innerProxies, argsAsArray);\n        const exec = val(...argsWithProxies);\n        return serializeReturnValue(exec);\n      };\n      return { [proxyCallbackMarker]: proxyId };\n    }\n\n    if (Array.isArray(val)) {\n      return val.map((i: any) => walker(proxies, i));\n    }\n    if (isObject(val)) {\n      return mapObjectValues(val, (i: any) => walker(proxies, i));\n    }\n\n    return val;\n  };\n\n  const proxies: ProxiesCollector = { promises: {}, callbacks: {} };\n  const dataWithoutProxies = walker(proxies, data);\n  return [proxies, dataWithoutProxies];\n};\n\nconst insertProxies = (proxies: ProxiesCollector, data: any): any => {\n  if (Array.isArray(data)) {\n    return data.map((i: any) => insertProxies(proxies, i));\n  }\n\n  if (isObject(data) && data.hasOwnProperty(proxyPromiseMarker)) {\n    const promiseId = (data as any)[proxyPromiseMarker];\n    return proxies.promises[promiseId];\n  }\n\n  if (isObject(data) && data.hasOwnProperty(proxyCallbackMarker)) {\n    const callbackId = (data as any)[proxyCallbackMarker];\n    // passing args in spread syntax to comlink proxy generates problem when transpiling to old JS version\n    // so pass it as array and handle it on the deserialization level:\n    return async (...args: any) => {\n      const [innerProxies, argsNoProxies] = extractProxies(args);\n      const exec = await proxies.callbacks[callbackId](\n        proxy(innerProxies),\n        argsNoProxies,\n      );\n      return deserializeReturnValue(exec);\n    };\n  }\n\n  if (isObject(data)) {\n    return mapObjectValues(data, (i: any) => insertProxies(proxies, i));\n  }\n\n  return data;\n};\n\nconst wrapMethodsWithProxy = <T extends Record<string, Function>>(\n  obj: T,\n  callback: (originalMethod: Function) => Function,\n) => {\n  return new Proxy<T>(obj, {\n    get(target: any, prop: any) {\n      if (!target[prop]) {\n        return () => {\n          throw new Error(\n            `Serialization error occurred while accessing ${prop} property of ${target}`,\n          );\n        };\n      }\n      return callback(target[prop]);\n    },\n  });\n};\n\nconst isPromise = (val: any): val is Promise<any> => val instanceof Promise;\nconst isObject = (val: any): val is object =>\n  val && typeof val === 'object' && !isPromise(val);\nconst isFunction = (val: any): val is Function => typeof val === 'function';\nconst mapObjectValues = (obj: object, callback: Function) => {\n  const mapEntries = ([key, value]: [string, any]) => [key, callback(value)];\n  return Object.fromEntries(Object.entries(obj).map(mapEntries));\n};\nconst uniqueId = (() => {\n  let counter = 0;\n  return () => ++counter;\n})();\n","import {\n  deserializeAllMethodsIn,\n  serializeAllMethodsIn,\n} from './serialization';\nimport { wrap, expose, releaseProxy, Remote } from 'comlink';\n\nexport const handshakeCode = 'wix-sdk-bo-hello-handshake';\nexport type PostMessage = (\n  message: object,\n  targetOrigin: string,\n  transfer: Transferable[],\n) => void;\n\nexport type OpenedChannel<A> = Remote<A>;\n\n/**\n * Initializes a new channel with a target.\n * @param postMessage - Target's function to receive messages.\n * @param origin - Target's origin.\n */\nexport const open = <API extends {}>({\n  postMessage,\n  origin,\n}: {\n  postMessage: PostMessage;\n  origin: string;\n}): {\n  channel: OpenedChannel<API>;\n  close: () => void;\n} => {\n  const { port1: widgetPort, port2: hostPort } = new MessageChannel();\n  const protocolVersion = '1.0.0';\n  const message = {\n    code: handshakeCode,\n    version: protocolVersion,\n    port: hostPort,\n  };\n  postMessage(message, origin, [hostPort]);\n  const channel = serializeAllMethodsIn(wrap<API>(widgetPort));\n\n  return {\n    channel,\n    close: () => channel[releaseProxy](),\n  };\n};\n\n/**\n * Serves api as a response over the communication channel to given port.\n * @param api - The api object that has the methods inside it.\n * @param port - The port on which the channel was initiated and needs to receive the api.\n */\nexport const serve = <API extends {}>({\n  api,\n  port,\n}: {\n  api: API;\n  port: MessagePort;\n}) => {\n  expose(deserializeAllMethodsIn(api), port);\n};\n"],"names":["proxy","proxyCallbackMarker","proxyPromiseMarker","serializeAllMethodsIn","sdk","wrapMethodsWithProxy","originalMethod","_len","arguments","length","args","Array","_key","proxies","argsNoProxies","extractProxies","originalResult","deserializeReturnValue","deserializeAllMethodsIn","api","argsWithProxies","insertProxies","originalRun","serializeReturnValue","value","clonables","data","walker","val","isPromise","proxyId","uniqueId","promises","isFunction","callbacks","innerProxies","argsAsArray","exec","isArray","map","i","isObject","mapObjectValues","dataWithoutProxies","hasOwnProperty","promiseId","callbackId","_len2","_key2","obj","callback","Proxy","get","target","prop","Error","Promise","mapEntries","_ref","key","Object","fromEntries","entries","counter","wrap","expose","releaseProxy","handshakeCode","open","postMessage","origin","port1","widgetPort","port2","hostPort","MessageChannel","protocolVersion","message","code","version","port","channel","close","serve","_ref2"],"sourceRoot":""}