{"version":3,"names":["deserializeAllMethodsIn","serializeAllMethodsIn","wrap","expose","releaseProxy","handshakeCode","open","_ref","postMessage","origin","port1","widgetPort","port2","hostPort","MessageChannel","protocolVersion","message","code","version","port","channel","close","serve","_ref2","api"],"sources":["../../src/index.ts"],"sourcesContent":["import {\n  deserializeAllMethodsIn,\n  serializeAllMethodsIn,\n} from './serialization';\nimport { wrap, expose, releaseProxy, Remote } from 'comlink';\n\nexport const handshakeCode = 'wix-sdk-bo-hello-handshake';\nexport type PostMessage = (\n  message: object,\n  targetOrigin: string,\n  transfer: Transferable[],\n) => void;\n\nexport type OpenedChannel<A> = Remote<A>;\n\n/**\n * Initializes a new channel with a target.\n * @param postMessage - Target's function to receive messages.\n * @param origin - Target's origin.\n */\nexport const open = <API extends {}>({\n  postMessage,\n  origin,\n}: {\n  postMessage: PostMessage;\n  origin: string;\n}): {\n  channel: OpenedChannel<API>;\n  close: () => void;\n} => {\n  const { port1: widgetPort, port2: hostPort } = new MessageChannel();\n  const protocolVersion = '1.0.0';\n  const message = {\n    code: handshakeCode,\n    version: protocolVersion,\n    port: hostPort,\n  };\n  postMessage(message, origin, [hostPort]);\n  const channel = serializeAllMethodsIn(wrap<API>(widgetPort));\n\n  return {\n    channel,\n    close: () => channel[releaseProxy](),\n  };\n};\n\n/**\n * Serves api as a response over the communication channel to given port.\n * @param api - The api object that has the methods inside it.\n * @param port - The port on which the channel was initiated and needs to receive the api.\n */\nexport const serve = <API extends {}>({\n  api,\n  port,\n}: {\n  api: API;\n  port: MessagePort;\n}) => {\n  expose(deserializeAllMethodsIn(api), port);\n};\n"],"mappings":"AAAA,SACEA,uBAAuB,EACvBC,qBAAqB,QAChB,iBAAiB;AACxB,SAASC,IAAI,EAAEC,MAAM,EAAEC,YAAY,QAAgB,SAAS;AAE5D,OAAO,MAAMC,aAAa,GAAG,4BAA4B;AASzD;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,IAAI,GAAGC,IAAA,IASf;EAAA,IATgC;IACnCC,WAAW;IACXC;EAIF,CAAC,GAAAF,IAAA;EAIC,MAAM;IAAEG,KAAK,EAAEC,UAAU;IAAEC,KAAK,EAAEC;EAAS,CAAC,GAAG,IAAIC,cAAc,CAAC,CAAC;EACnE,MAAMC,eAAe,GAAG,OAAO;EAC/B,MAAMC,OAAO,GAAG;IACdC,IAAI,EAAEZ,aAAa;IACnBa,OAAO,EAAEH,eAAe;IACxBI,IAAI,EAAEN;EACR,CAAC;EACDL,WAAW,CAACQ,OAAO,EAAEP,MAAM,EAAE,CAACI,QAAQ,CAAC,CAAC;EACxC,MAAMO,OAAO,GAAGnB,qBAAqB,CAACC,IAAI,CAAMS,UAAU,CAAC,CAAC;EAE5D,OAAO;IACLS,OAAO;IACPC,KAAK,EAAEA,CAAA,KAAMD,OAAO,CAAChB,YAAY,CAAC,CAAC;EACrC,CAAC;AACH,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMkB,KAAK,GAAGC,KAAA,IAMf;EAAA,IANgC;IACpCC,GAAG;IACHL;EAIF,CAAC,GAAAI,KAAA;EACCpB,MAAM,CAACH,uBAAuB,CAACwB,GAAG,CAAC,EAAEL,IAAI,CAAC;AAC5C,CAAC","ignoreList":[]}