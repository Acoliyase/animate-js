"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createUniDriverParams = void 0;
const isElementHandleLike_1 = require("./entityTypeChecks/isElementHandleLike");
const getUniDriverParams_1 = require("./getUniDriverParams");
const isPromise_1 = require("./entityTypeChecks/isPromise");
const isAsyncFunction_1 = require("./entityTypeChecks/isAsyncFunction");
const configShapeChecks_1 = require("./configShapeChecks");
const createUniDriverParams = (adapterParams, querySelector) => {
    const getParams = (params) => {
        return (0, getUniDriverParams_1.getUniDriverParams)(params, querySelector);
    };
    if ((0, configShapeChecks_1.hasPage)(adapterParams) || (0, configShapeChecks_1.hasRoot)(adapterParams)) {
        return getParams(adapterParams);
    }
    const resolveParams = (resolver) => {
        const base = async () => {
            const resolvedParams = await resolver();
            const config = getParams(resolvedParams);
            if (typeof config.base === 'function') {
                return config.base();
            }
            return config.base;
        };
        const selector = (async () => {
            const resolvedParams = await resolver();
            return getParams(resolvedParams).selector;
        })();
        const page = (async () => {
            const resolvedParams = await resolver();
            return getParams(resolvedParams).page;
        })();
        return {
            base,
            selector,
            page,
        };
    };
    if ((0, isAsyncFunction_1.isAsyncFunction)(adapterParams)) {
        return resolveParams(() => adapterParams());
    }
    if ((0, isElementHandleLike_1.isElementHandleLike)(adapterParams)) {
        return getParams(adapterParams);
    }
    if ((0, isPromise_1.isPromise)(adapterParams)) {
        return resolveParams(() => adapterParams);
    }
    if (typeof adapterParams === 'function') {
        const resolvedParams = adapterParams();
        return getParams(resolvedParams);
    }
    const errorMessage = (() => {
        try {
            return `[unidriver-puppeteer] Unsupported adapterParams shape encountered: ${JSON.stringify(adapterParams)}`;
        }
        catch {
            return `[unidriver-puppeteer] Unsupported adapterParams shape encountered: {${Object.keys(adapterParams ?? {}).join(',')}}`;
        }
    })();
    return {
        page: undefined,
        base: () => {
            throw new Error(errorMessage);
        },
        selector: errorMessage,
    };
};
exports.createUniDriverParams = createUniDriverParams;
//# sourceMappingURL=createUniDriverParams.js.map