import { isElementHandleLike } from './entityTypeChecks/isElementHandleLike';
import { getUniDriverParams } from './getUniDriverParams';
import { isPromise } from './entityTypeChecks/isPromise';
import { isAsyncFunction } from './entityTypeChecks/isAsyncFunction';
import { hasPage, hasRoot } from './configShapeChecks';
export const createUniDriverParams = (adapterParams, querySelector) => {
    const getParams = (params) => {
        return getUniDriverParams(params, querySelector);
    };
    if (hasPage(adapterParams) || hasRoot(adapterParams)) {
        return getParams(adapterParams);
    }
    const resolveParams = (resolver) => {
        const base = async () => {
            const resolvedParams = await resolver();
            const config = getParams(resolvedParams);
            if (typeof config.base === 'function') {
                return config.base();
            }
            return config.base;
        };
        const selector = (async () => {
            const resolvedParams = await resolver();
            return getParams(resolvedParams).selector;
        })();
        const page = (async () => {
            const resolvedParams = await resolver();
            return getParams(resolvedParams).page;
        })();
        return {
            base,
            selector,
            page,
        };
    };
    if (isAsyncFunction(adapterParams)) {
        return resolveParams(() => adapterParams());
    }
    if (isElementHandleLike(adapterParams)) {
        return getParams(adapterParams);
    }
    if (isPromise(adapterParams)) {
        return resolveParams(() => adapterParams);
    }
    if (typeof adapterParams === 'function') {
        const resolvedParams = adapterParams();
        return getParams(resolvedParams);
    }
    const errorMessage = (() => {
        try {
            return `[unidriver-puppeteer] Unsupported adapterParams shape encountered: ${JSON.stringify(adapterParams)}`;
        }
        catch {
            return `[unidriver-puppeteer] Unsupported adapterParams shape encountered: {${Object.keys(adapterParams ?? {}).join(',')}}`;
        }
    })();
    return {
        page: undefined,
        base: () => {
            throw new Error(errorMessage);
        },
        selector: errorMessage,
    };
};
//# sourceMappingURL=createUniDriverParams.js.map