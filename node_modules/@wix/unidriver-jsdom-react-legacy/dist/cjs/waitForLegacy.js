"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.waitForLegacy = void 0;
const internal_1 = require("@wix/unidriver-core/internal");
function getGlobalThis() {
    if (typeof globalThis !== 'undefined') {
        return globalThis;
    }
    if (typeof self !== 'undefined') {
        return self;
    }
    if (typeof window !== 'undefined') {
        return window;
    }
    if (typeof global !== 'undefined') {
        return global;
    }
    throw new Error('unable to locate global object');
}
function setIsReactActEnvironment(isReactActEnvironment) {
    // @ts-expect-error - global variable type issue
    getGlobalThis().IS_REACT_ACT_ENVIRONMENT = isReactActEnvironment;
}
function getIsReactActEnvironment() {
    // @ts-expect-error - global variable type issue
    // eslint-disable-next-line @typescript-eslint/no-unsafe-return
    return getGlobalThis().IS_REACT_ACT_ENVIRONMENT;
}
// This is a very simplified copy of what testing-library/react is doing
const waitForLegacy = async (fn, params) => {
    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
    const previousActEnvironment = getIsReactActEnvironment();
    setIsReactActEnvironment(false);
    try {
        await (0, internal_1.eventually)(async () => {
            const result = await fn();
            if (!result) {
                throw new Error('predicate returned false');
            }
        }, params);
    }
    finally {
        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument
        setIsReactActEnvironment(previousActEnvironment);
    }
};
exports.waitForLegacy = waitForLegacy;
//# sourceMappingURL=waitForLegacy.js.map