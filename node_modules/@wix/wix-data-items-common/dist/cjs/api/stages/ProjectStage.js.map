{"version":3,"names":["ProjectStageImpl","constructor","_defineProperty2","default","include","fieldNames","forEach","fieldName","fields","push","exclude","reshape","expression","resultFieldName","addField","projectNested","stage","addNestedProjectionField","build","projection","exports"],"sources":["../../../../src/api/stages/ProjectStage.ts"],"sourcesContent":["import { Expression } from '../expressions/Expression'\nimport * as apiTypes from '../../types/data-item-types'\nimport { PipelineStage } from './stages'\n\n/**\n * @builder\n */\nexport interface ProjectStage extends PipelineStage {\n  /**\n   * @internal\n   */\n  fields: apiTypes.Field[]\n  /**\n   * Fields to include in the result.\n   *\n   * When specified, the result includes only the specified fields. All other fields are excluded.\n   *\n   * @public\n   * @documentationMaturity preview\n   * @param fieldNames - Fields to include in the result. Use dot notation to specify nested fields. For example, `user.name` or `product.price`.\n   *\n   * Learn more about [field keys](https://support.wix.com/en/article/cms-formerly-content-manager-about-your-collection-fields#field-id-velo-by-wix-only).\n   * @returns ProjectStage object.\n   */\n  include(...fieldNames: string[]): ProjectStage\n  /**\n   * Fields to exclude from the result.\n   *\n   * When specified, excludes the specified field from the result. All other fields are included.\n   *\n   * @public\n   * @documentationMaturity preview\n   * @param fieldNames - Fields to exclude from the result. Use dot notation to specify nested fields. For example, `user.name` or `product.price`.\n   *\n   * Learn more about [field keys](https://support.wix.com/en/article/cms-formerly-content-manager-about-your-collection-fields#field-id-velo-by-wix-only).\n   * @returns ProjectStage object.\n   */\n  exclude(...fieldNames: string[]): ProjectStage\n  /**\n   * Reshapes a new field based on the specified expression. The result does not include the field used in the expression. For example, reshaping `basePrice` to add `tax` results in a new field `totalPrice` that does not include `basePrice` or `tax`.\n   *\n   * @public\n   * @documentationMaturity preview\n   * @param expression - Expression to resolve. The result of the expression becomes the value of the new field. Learn more about using [expressions in aggregation pipelines](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-aggregate-pipeline-expressions/introduction).\n   * @param resultFieldName - Field to create in the result.\n   *\n   * Learn more about [field keys](https://support.wix.com/en/article/cms-formerly-content-manager-about-your-collection-fields#field-id-velo-by-wix-only).\n   * @returns ProjectStage object.\n   */\n  reshape(expression: Expression, resultFieldName: string): ProjectStage\n  /**\n   * Creates nested fields by including, excluding, or reshaping fields.\n   *\n   * @public\n   * @documentationMaturity preview\n   * @param stage - Projected stage to nest.\n   * @param resultFieldName - Field to nest the projected stage in.\n   *\n   * Learn more about [field keys](https://support.wix.com/en/article/cms-formerly-content-manager-about-your-collection-fields#field-id-velo-by-wix-only).\n   * @returns ProjectStage object.\n   */\n  projectNested(stage: ProjectStage, resultFieldName: string): ProjectStage\n}\n\nexport class ProjectStageImpl implements ProjectStage {\n  fields: apiTypes.Field[] = []\n\n  include(...fieldNames: string[]): ProjectStage {\n    fieldNames.forEach((fieldName) => {\n      this.fields.push({ include: { fieldName } })\n    })\n    return this\n  }\n\n  exclude(...fieldNames: string[]): ProjectStage {\n    fieldNames.forEach((fieldName) => {\n      this.fields.push({ exclude: { fieldName } })\n    })\n    return this\n  }\n\n  reshape(expression: Expression, resultFieldName: string): ProjectStage {\n    this.addField(expression, resultFieldName)\n    return this\n  }\n\n  projectNested(stage: ProjectStage, resultFieldName: string): ProjectStage {\n    return this.addNestedProjectionField(resultFieldName, stage.fields)\n  }\n\n  private addField(\n    expression: Expression,\n    resultFieldName: string\n  ): ProjectStage {\n    this.fields.push({\n      reshape: { resultFieldName, expression: expression.build() },\n    })\n    return this\n  }\n\n  private addNestedProjectionField(\n    resultFieldName: string,\n    fields: apiTypes.Field[]\n  ): ProjectStage {\n    this.fields.push({ projectNested: { resultFieldName, fields } })\n    return this\n  }\n\n  /** @private */\n  build(): apiTypes.Stage {\n    return { projection: { fields: this.fields } }\n  }\n}\n"],"mappings":";;;;;;AAIA;AACA;AACA;;AA0DO,MAAMA,gBAAgB,CAAyB;EAAAC,YAAA;IAAA,IAAAC,gBAAA,CAAAC,OAAA,kBACzB,EAAE;EAAA;EAE7BC,OAAOA,CAAC,GAAGC,UAAoB,EAAgB;IAC7CA,UAAU,CAACC,OAAO,CAAEC,SAAS,IAAK;MAChC,IAAI,CAACC,MAAM,CAACC,IAAI,CAAC;QAAEL,OAAO,EAAE;UAAEG;QAAU;MAAE,CAAC,CAAC;IAC9C,CAAC,CAAC;IACF,OAAO,IAAI;EACb;EAEAG,OAAOA,CAAC,GAAGL,UAAoB,EAAgB;IAC7CA,UAAU,CAACC,OAAO,CAAEC,SAAS,IAAK;MAChC,IAAI,CAACC,MAAM,CAACC,IAAI,CAAC;QAAEC,OAAO,EAAE;UAAEH;QAAU;MAAE,CAAC,CAAC;IAC9C,CAAC,CAAC;IACF,OAAO,IAAI;EACb;EAEAI,OAAOA,CAACC,UAAsB,EAAEC,eAAuB,EAAgB;IACrE,IAAI,CAACC,QAAQ,CAACF,UAAU,EAAEC,eAAe,CAAC;IAC1C,OAAO,IAAI;EACb;EAEAE,aAAaA,CAACC,KAAmB,EAAEH,eAAuB,EAAgB;IACxE,OAAO,IAAI,CAACI,wBAAwB,CAACJ,eAAe,EAAEG,KAAK,CAACR,MAAM,CAAC;EACrE;EAEQM,QAAQA,CACdF,UAAsB,EACtBC,eAAuB,EACT;IACd,IAAI,CAACL,MAAM,CAACC,IAAI,CAAC;MACfE,OAAO,EAAE;QAAEE,eAAe;QAAED,UAAU,EAAEA,UAAU,CAACM,KAAK,CAAC;MAAE;IAC7D,CAAC,CAAC;IACF,OAAO,IAAI;EACb;EAEQD,wBAAwBA,CAC9BJ,eAAuB,EACvBL,MAAwB,EACV;IACd,IAAI,CAACA,MAAM,CAACC,IAAI,CAAC;MAAEM,aAAa,EAAE;QAAEF,eAAe;QAAEL;MAAO;IAAE,CAAC,CAAC;IAChE,OAAO,IAAI;EACb;;EAEA;EACAU,KAAKA,CAAA,EAAmB;IACtB,OAAO;MAAEC,UAAU,EAAE;QAAEX,MAAM,EAAE,IAAI,CAACA;MAAO;IAAE,CAAC;EAChD;AACF;AAACY,OAAA,CAAApB,gBAAA,GAAAA,gBAAA","ignoreList":[]}