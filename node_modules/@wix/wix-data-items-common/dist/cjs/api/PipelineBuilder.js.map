{"version":3,"names":["PipelineBuilderImpl","constructor","_defineProperty2","default","withStages","stages","withPaging","paging","isCursor","cursorPaging","undefined","offsetPaging","build","map","stage","pipelineBuilder"],"sources":["../../../src/api/PipelineBuilder.ts"],"sourcesContent":["import { PipelineStage } from './stages/stages'\nimport { Paging, CursorPaging, AggregationPipeline } from '../types'\n\n/**\n * @builder\n */\nexport interface PipelineBuilder {\n  /**\n   * Adds [pipeline stages](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-aggregate-pipeline-stages/introduction) to the aggregation pipeline.\n   *\n   * Stages are processed sequentially in the order they are provided, with each stage's output becoming the input for the next stage.\n   *\n   * @public\n   * @documentationMaturity preview\n   * @param stages - Array of [pipeline stages](https://dev.wix.com/docs/sdk/backend-modules/data/items/wix-data-aggregate-pipeline-stages/introduction).\n   * @returns PipelineBuilder object\n   */\n  withStages(stages: PipelineStage[]): PipelineBuilder\n\n  /**\n   * Configures pagination for the aggregation pipeline results.\n   *\n   * You can specify either [offset](https://dev.wix.com/docs/sdk/articles/work-with-the-sdk/api-query-language#offset-paging) or [cursor pagination](https://dev.wix.com/docs/sdk/articles/work-with-the-sdk/api-query-language#cursor-paging).\n   *\n   * @public\n   * @documentationMaturity preview\n   * @param paging - Pagination configuration.\n   * @returns PipelineBuilder object\n   */\n  withPaging(paging: Paging | CursorPaging): PipelineBuilder\n\n  /**\n   * Builds the aggregation pipeline.\n   *\n   * Run this method after configuring stages and pagination to build the aggregation pipeline. Specify the pipeline as the `pipeline` parameter when calling the [`aggregatePipeline()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/aggregate-pipeline) method.\n   *\n   * @public\n   * @documentationMaturity preview\n   * @returns AggregationPipeline object ready for running the aggregation pipeline.\n   */\n  build(): AggregationPipeline\n}\n\nclass PipelineBuilderImpl implements PipelineBuilder {\n  private stages: PipelineStage[] = []\n  private offsetPaging?: Paging\n  private cursorPaging?: CursorPaging\n\n  withStages(stages: PipelineStage[]) {\n    this.stages = stages\n    return this\n  }\n\n  withPaging(paging: Paging | CursorPaging) {\n    const isCursor = 'cursor' in paging\n    this.cursorPaging = isCursor ? paging : undefined\n    this.offsetPaging = isCursor ? undefined : paging\n    return this\n  }\n\n  build() {\n    return {\n      stages: this.stages.map((stage) => stage.build()),\n      ...(this.offsetPaging && { paging: this.offsetPaging }),\n      ...(this.cursorPaging && { cursorPaging: this.cursorPaging }),\n    }\n  }\n}\n\n/**\n * Builds an aggregation pipeline for use with [`aggregatePipeline()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/aggregate-pipeline).\n *\n * Configure the pipeline by calling `pipelineBuilder()` and chaining [`PipelineBuilder`](https://dev.wix.com/docs/sdk/backend-modules/data/items/pipeline-builder/introduction) methods. Then, specify the pipeline as the `pipeline` parameter when calling the [`aggregatePipeline()`](https://dev.wix.com/docs/sdk/backend-modules/data/items/aggregate-pipeline) method.\n *\n * > **Note**: You can only build an aggregation pipeline for collections [created in the CMS](https://support.wix.com/en/article/cms-formerly-content-manager-creating-a-collection) or with the [Data Collections API](https://dev.wix.com/docs/sdk/backend-modules/data/collections/introduction). They cannot be used on [Wix app collections](https://support.wix.com/en/article/cms-formerly-content-manager-working-with-wix-app-collections) or [external collections](https://dev.wix.com/docs/develop-websites/articles/databases/external-databases/overview/integrating-external-databases-with-your-wix-site).\n *\n * @public\n * @documentationMaturity preview\n * @returns PipelineBuilder object\n */\nexport function pipelineBuilder(): PipelineBuilder {\n  return new PipelineBuilderImpl()\n}\n"],"mappings":";;;;;;AAGA;AACA;AACA;;AAsCA,MAAMA,mBAAmB,CAA4B;EAAAC,YAAA;IAAA,IAAAC,gBAAA,CAAAC,OAAA,kBACjB,EAAE;IAAA,IAAAD,gBAAA,CAAAC,OAAA;IAAA,IAAAD,gBAAA,CAAAC,OAAA;EAAA;EAIpCC,UAAUA,CAACC,MAAuB,EAAE;IAClC,IAAI,CAACA,MAAM,GAAGA,MAAM;IACpB,OAAO,IAAI;EACb;EAEAC,UAAUA,CAACC,MAA6B,EAAE;IACxC,MAAMC,QAAQ,GAAG,QAAQ,IAAID,MAAM;IACnC,IAAI,CAACE,YAAY,GAAGD,QAAQ,GAAGD,MAAM,GAAGG,SAAS;IACjD,IAAI,CAACC,YAAY,GAAGH,QAAQ,GAAGE,SAAS,GAAGH,MAAM;IACjD,OAAO,IAAI;EACb;EAEAK,KAAKA,CAAA,EAAG;IACN,OAAO;MACLP,MAAM,EAAE,IAAI,CAACA,MAAM,CAACQ,GAAG,CAAEC,KAAK,IAAKA,KAAK,CAACF,KAAK,CAAC,CAAC,CAAC;MACjD,IAAI,IAAI,CAACD,YAAY,IAAI;QAAEJ,MAAM,EAAE,IAAI,CAACI;MAAa,CAAC,CAAC;MACvD,IAAI,IAAI,CAACF,YAAY,IAAI;QAAEA,YAAY,EAAE,IAAI,CAACA;MAAa,CAAC;IAC9D,CAAC;EACH;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASM,eAAeA,CAAA,EAAoB;EACjD,OAAO,IAAIf,mBAAmB,CAAC,CAAC;AAClC","ignoreList":[]}