import { Node_Type } from "./../../ricos-types/index.js";
const isUploadingAudioRich = (node) => node.type === Node_Type.AUDIO && (!node?.audioData?.audio?.src || node.audioData.audio.src.id?.startsWith?.("blob:"));
const isUploadingImageRich = (node) => node.type === Node_Type.IMAGE && !node?.imageData?.image?.src;
const isUploadingVideoRich = (node) => node.type === Node_Type.VIDEO && (!node?.videoData?.video?.src || node.videoData.video.src.url?.startsWith?.("blob:"));
const isUploadingVideoPm = (node) => {
  if (node.type === Node_Type.VIDEO) {
    const pmNode = node;
    return pmNode.attrs.loading;
  }
  return false;
};
const isUploadingFileRich = (node) => {
  return node.type === Node_Type.FILE && !node?.fileData?.src;
};
const isUploadedMedia = (media) => media?.src?.url || media?.src?.id;
const isUploadingGalleryRich = (node) => {
  return node.type === Node_Type.GALLERY && node.galleryData?.items?.some(
    (galleryItem) => "image" in galleryItem && !isUploadedMedia(galleryItem.image?.media) || "video" in galleryItem && !isUploadedMedia(galleryItem.video?.media)
  );
};
const getAllNestedNodes = (content) => {
  const nodes = [];
  const nodesToVisit = [...content.nodes ?? []];
  while (nodesToVisit.length) {
    const node = nodesToVisit.pop();
    if (node) {
      nodes.push(node);
    }
    if (node?.nodes?.length) {
      nodesToVisit.push(...node.nodes);
    }
  }
  return nodes;
};
const getAllNestedPmNodes = (pmContent) => {
  const nodes = [];
  const nodesToVisit = [...pmContent?.content ?? []];
  while (nodesToVisit.length) {
    const node = nodesToVisit.pop();
    if (node) {
      nodes.push(node);
    }
    if (node?.content?.length) {
      nodesToVisit.push(...node.content);
    }
  }
  return nodes;
};
const hasActiveUploads = (content, pmContent) => {
  const allNodes = getAllNestedNodes(content);
  const allPmNodes = getAllNestedPmNodes(pmContent);
  return allPmNodes.some((node) => isUploadingVideoPm(node)) || allNodes.some(
    (node) => isUploadingAudioRich(node) || isUploadingFileRich(node) || isUploadingGalleryRich(node) || isUploadingImageRich(node)
  );
};
const removeUploadingGalleryItems = (node) => ({
  ...node,
  galleryData: {
    ...node.galleryData,
    items: node.galleryData?.items?.filter(
      (item) => item.image ? isUploadedMedia(item.image.media) : item.video ? isUploadedMedia(item.video.media) : item
    ) || []
  }
});
const filterUploadingNodes = (nodes) => nodes.map(cleanUpUploadingNode).filter(Boolean);
const cleanUpUploadingNode = (node) => isUploadingAudioRich(node) || isUploadingFileRich(node) || isUploadingImageRich(node) || isUploadingVideoRich(node) ? void 0 : isUploadingGalleryRich(node) ? removeUploadingGalleryItems(node) : node.nodes?.length ? {
  ...node,
  nodes: filterUploadingNodes(node.nodes)
} : node;
export {
  filterUploadingNodes,
  hasActiveUploads
};
//# sourceMappingURL=activeUploads.js.map
