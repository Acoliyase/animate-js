{"version":3,"file":"provider.umd.min.js","mappings":"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","sources":["webpack://_wix_dashboard/webpack/universalModuleDefinition","webpack://_wix_dashboard/../../../communication-channel/dist/esm/index.js","webpack://_wix_dashboard/../../../communication-channel/dist/esm/serialization.js","webpack://_wix_dashboard/../../../node_modules/comlink/dist/esm/comlink.mjs","webpack://_wix_dashboard/webpack/bootstrap","webpack://_wix_dashboard/webpack/runtime/compat get default export","webpack://_wix_dashboard/webpack/runtime/define property getters","webpack://_wix_dashboard/webpack/runtime/hasOwnProperty shorthand","webpack://_wix_dashboard/webpack/runtime/make namespace object","webpack://_wix_dashboard/./provider.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"WixDashboardSDK\", [], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WixDashboardSDK\"] = factory();\n\telse\n\t\troot[\"WixDashboardSDK\"] = factory();\n})((typeof self !== 'undefined' ? self : this), () => {\nreturn ","import { deserializeAllMethodsIn, serializeAllMethodsIn } from './serialization';\nimport { wrap, expose, releaseProxy } from 'comlink';\nexport const handshakeCode = 'wix-sdk-bo-hello-handshake';\n/**\n * Initializes a new channel with a target.\n * @param postMessage - Target's function to receive messages.\n * @param origin - Target's origin.\n */\nexport const open = _ref => {\n  let {\n    postMessage,\n    origin\n  } = _ref;\n  const {\n    port1: widgetPort,\n    port2: hostPort\n  } = new MessageChannel();\n  const protocolVersion = '1.0.0';\n  const message = {\n    code: handshakeCode,\n    version: protocolVersion,\n    port: hostPort\n  };\n  postMessage(message, origin, [hostPort]);\n  const channel = serializeAllMethodsIn(wrap(widgetPort));\n  return {\n    channel,\n    close: () => channel[releaseProxy]()\n  };\n};\n\n/**\n * Serves api as a response over the communication channel to given port.\n * @param api - The api object that has the methods inside it.\n * @param port - The port on which the channel was initiated and needs to receive the api.\n */\nexport const serve = _ref2 => {\n  let {\n    api,\n    port\n  } = _ref2;\n  expose(deserializeAllMethodsIn(api), port);\n};\n//# sourceMappingURL=index.js.map","import { proxy } from 'comlink';\nconst proxyCallbackMarker = '__proxyCallbackId__wixSDK__';\nconst proxyPromiseMarker = '__proxyPromiseId__wixSDK__';\nexport const serializeAllMethodsIn = sdk => {\n  return wrapMethodsWithProxy(sdk, originalMethod => {\n    return async function () {\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      const [proxies, argsNoProxies] = extractProxies(args);\n      const originalResult = await originalMethod(proxy(proxies), argsNoProxies);\n      return deserializeReturnValue(originalResult);\n    };\n  });\n};\nexport const deserializeAllMethodsIn = api => {\n  return wrapMethodsWithProxy(api, originalMethod => {\n    return (proxies, args) => {\n      const argsWithProxies = insertProxies(proxies, args);\n      const originalRun = originalMethod(...argsWithProxies);\n      return serializeReturnValue(originalRun);\n    };\n  });\n};\nconst serializeReturnValue = async value => {\n  const [proxies, clonables] = extractProxies(await value);\n  return proxy({\n    proxies,\n    clonables\n  });\n};\nconst deserializeReturnValue = async value => {\n  return insertProxies(value == null ? void 0 : value.proxies, await (value == null ? void 0 : value.clonables));\n};\nconst extractProxies = data => {\n  const walker = (proxies, val) => {\n    if (isPromise(val)) {\n      const proxyId = uniqueId();\n      proxies.promises[proxyId] = val;\n      return {\n        [proxyPromiseMarker]: proxyId\n      };\n    }\n    if (isFunction(val)) {\n      const proxyId = uniqueId();\n      proxies.callbacks[proxyId] = (innerProxies, argsAsArray) => {\n        const argsWithProxies = insertProxies(innerProxies, argsAsArray);\n        const exec = val(...argsWithProxies);\n        return serializeReturnValue(exec);\n      };\n      return {\n        [proxyCallbackMarker]: proxyId\n      };\n    }\n    if (Array.isArray(val)) {\n      return val.map(i => walker(proxies, i));\n    }\n    if (isObject(val)) {\n      return mapObjectValues(val, i => walker(proxies, i));\n    }\n    return val;\n  };\n  const proxies = {\n    promises: {},\n    callbacks: {}\n  };\n  const dataWithoutProxies = walker(proxies, data);\n  return [proxies, dataWithoutProxies];\n};\nconst insertProxies = (proxies, data) => {\n  if (Array.isArray(data)) {\n    return data.map(i => insertProxies(proxies, i));\n  }\n  if (isObject(data) && data.hasOwnProperty(proxyPromiseMarker)) {\n    const promiseId = data[proxyPromiseMarker];\n    return proxies.promises[promiseId];\n  }\n  if (isObject(data) && data.hasOwnProperty(proxyCallbackMarker)) {\n    const callbackId = data[proxyCallbackMarker];\n    // passing args in spread syntax to comlink proxy generates problem when transpiling to old JS version\n    // so pass it as array and handle it on the deserialization level:\n    return async function () {\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n      const [innerProxies, argsNoProxies] = extractProxies(args);\n      const exec = await proxies.callbacks[callbackId](proxy(innerProxies), argsNoProxies);\n      return deserializeReturnValue(exec);\n    };\n  }\n  if (isObject(data)) {\n    return mapObjectValues(data, i => insertProxies(proxies, i));\n  }\n  return data;\n};\nconst wrapMethodsWithProxy = (obj, callback) => {\n  return new Proxy(obj, {\n    get(target, prop) {\n      if (!target[prop]) {\n        return () => {\n          throw new Error(`Serialization error occurred while accessing ${prop} property of ${target}`);\n        };\n      }\n      return callback(target[prop]);\n    }\n  });\n};\nconst isPromise = val => val instanceof Promise;\nconst isObject = val => val && typeof val === 'object' && !isPromise(val);\nconst isFunction = val => typeof val === 'function';\nconst mapObjectValues = (obj, callback) => {\n  const mapEntries = _ref => {\n    let [key, value] = _ref;\n    return [key, callback(value)];\n  };\n  return Object.fromEntries(Object.entries(obj).map(mapEntries));\n};\nconst uniqueId = (() => {\n  let counter = 0;\n  return () => ++counter;\n})();\n//# sourceMappingURL=serialization.js.map","/**\r\n * Copyright 2019 Google Inc. All Rights Reserved.\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *     http://www.apache.org/licenses/LICENSE-2.0\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nconst proxyMarker = Symbol(\"Comlink.proxy\");\r\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\r\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\r\nconst throwMarker = Symbol(\"Comlink.thrown\");\r\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\r\n/**\r\n * Internal transfer handle to handle objects marked to proxy.\r\n */\r\nconst proxyTransferHandler = {\r\n    canHandle: (val) => isObject(val) && val[proxyMarker],\r\n    serialize(obj) {\r\n        const { port1, port2 } = new MessageChannel();\r\n        expose(obj, port1);\r\n        return [port2, [port2]];\r\n    },\r\n    deserialize(port) {\r\n        port.start();\r\n        return wrap(port);\r\n    },\r\n};\r\n/**\r\n * Internal transfer handler to handle thrown exceptions.\r\n */\r\nconst throwTransferHandler = {\r\n    canHandle: (value) => isObject(value) && throwMarker in value,\r\n    serialize({ value }) {\r\n        let serialized;\r\n        if (value instanceof Error) {\r\n            serialized = {\r\n                isError: true,\r\n                value: {\r\n                    message: value.message,\r\n                    name: value.name,\r\n                    stack: value.stack,\r\n                },\r\n            };\r\n        }\r\n        else {\r\n            serialized = { isError: false, value };\r\n        }\r\n        return [serialized, []];\r\n    },\r\n    deserialize(serialized) {\r\n        if (serialized.isError) {\r\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\r\n        }\r\n        throw serialized.value;\r\n    },\r\n};\r\n/**\r\n * Allows customizing the serialization of certain values.\r\n */\r\nconst transferHandlers = new Map([\r\n    [\"proxy\", proxyTransferHandler],\r\n    [\"throw\", throwTransferHandler],\r\n]);\r\nfunction expose(obj, ep = self) {\r\n    ep.addEventListener(\"message\", function callback(ev) {\r\n        if (!ev || !ev.data) {\r\n            return;\r\n        }\r\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\r\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\r\n        let returnValue;\r\n        try {\r\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\r\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\r\n            switch (type) {\r\n                case 0 /* GET */:\r\n                    {\r\n                        returnValue = rawValue;\r\n                    }\r\n                    break;\r\n                case 1 /* SET */:\r\n                    {\r\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\r\n                        returnValue = true;\r\n                    }\r\n                    break;\r\n                case 2 /* APPLY */:\r\n                    {\r\n                        returnValue = rawValue.apply(parent, argumentList);\r\n                    }\r\n                    break;\r\n                case 3 /* CONSTRUCT */:\r\n                    {\r\n                        const value = new rawValue(...argumentList);\r\n                        returnValue = proxy(value);\r\n                    }\r\n                    break;\r\n                case 4 /* ENDPOINT */:\r\n                    {\r\n                        const { port1, port2 } = new MessageChannel();\r\n                        expose(obj, port2);\r\n                        returnValue = transfer(port1, [port1]);\r\n                    }\r\n                    break;\r\n                case 5 /* RELEASE */:\r\n                    {\r\n                        returnValue = undefined;\r\n                    }\r\n                    break;\r\n            }\r\n        }\r\n        catch (value) {\r\n            returnValue = { value, [throwMarker]: 0 };\r\n        }\r\n        Promise.resolve(returnValue)\r\n            .catch((value) => {\r\n            return { value, [throwMarker]: 0 };\r\n        })\r\n            .then((returnValue) => {\r\n            const [wireValue, transferables] = toWireValue(returnValue);\r\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\r\n            if (type === 5 /* RELEASE */) {\r\n                // detach and deactive after sending release response above.\r\n                ep.removeEventListener(\"message\", callback);\r\n                closeEndPoint(ep);\r\n            }\r\n        });\r\n    });\r\n    if (ep.start) {\r\n        ep.start();\r\n    }\r\n}\r\nfunction isMessagePort(endpoint) {\r\n    return endpoint.constructor.name === \"MessagePort\";\r\n}\r\nfunction closeEndPoint(endpoint) {\r\n    if (isMessagePort(endpoint))\r\n        endpoint.close();\r\n}\r\nfunction wrap(ep, target) {\r\n    return createProxy(ep, [], target);\r\n}\r\nfunction throwIfProxyReleased(isReleased) {\r\n    if (isReleased) {\r\n        throw new Error(\"Proxy has been released and is not useable\");\r\n    }\r\n}\r\nfunction createProxy(ep, path = [], target = function () { }) {\r\n    let isProxyReleased = false;\r\n    const proxy = new Proxy(target, {\r\n        get(_target, prop) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            if (prop === releaseProxy) {\r\n                return () => {\r\n                    return requestResponseMessage(ep, {\r\n                        type: 5 /* RELEASE */,\r\n                        path: path.map((p) => p.toString()),\r\n                    }).then(() => {\r\n                        closeEndPoint(ep);\r\n                        isProxyReleased = true;\r\n                    });\r\n                };\r\n            }\r\n            if (prop === \"then\") {\r\n                if (path.length === 0) {\r\n                    return { then: () => proxy };\r\n                }\r\n                const r = requestResponseMessage(ep, {\r\n                    type: 0 /* GET */,\r\n                    path: path.map((p) => p.toString()),\r\n                }).then(fromWireValue);\r\n                return r.then.bind(r);\r\n            }\r\n            return createProxy(ep, [...path, prop]);\r\n        },\r\n        set(_target, prop, rawValue) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\r\n            // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\r\n            const [value, transferables] = toWireValue(rawValue);\r\n            return requestResponseMessage(ep, {\r\n                type: 1 /* SET */,\r\n                path: [...path, prop].map((p) => p.toString()),\r\n                value,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        apply(_target, _thisArg, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const last = path[path.length - 1];\r\n            if (last === createEndpoint) {\r\n                return requestResponseMessage(ep, {\r\n                    type: 4 /* ENDPOINT */,\r\n                }).then(fromWireValue);\r\n            }\r\n            // We just pretend that `bind()` didn’t happen.\r\n            if (last === \"bind\") {\r\n                return createProxy(ep, path.slice(0, -1));\r\n            }\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 2 /* APPLY */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n        construct(_target, rawArgumentList) {\r\n            throwIfProxyReleased(isProxyReleased);\r\n            const [argumentList, transferables] = processArguments(rawArgumentList);\r\n            return requestResponseMessage(ep, {\r\n                type: 3 /* CONSTRUCT */,\r\n                path: path.map((p) => p.toString()),\r\n                argumentList,\r\n            }, transferables).then(fromWireValue);\r\n        },\r\n    });\r\n    return proxy;\r\n}\r\nfunction myFlat(arr) {\r\n    return Array.prototype.concat.apply([], arr);\r\n}\r\nfunction processArguments(argumentList) {\r\n    const processed = argumentList.map(toWireValue);\r\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\r\n}\r\nconst transferCache = new WeakMap();\r\nfunction transfer(obj, transfers) {\r\n    transferCache.set(obj, transfers);\r\n    return obj;\r\n}\r\nfunction proxy(obj) {\r\n    return Object.assign(obj, { [proxyMarker]: true });\r\n}\r\nfunction windowEndpoint(w, context = self, targetOrigin = \"*\") {\r\n    return {\r\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\r\n        addEventListener: context.addEventListener.bind(context),\r\n        removeEventListener: context.removeEventListener.bind(context),\r\n    };\r\n}\r\nfunction toWireValue(value) {\r\n    for (const [name, handler] of transferHandlers) {\r\n        if (handler.canHandle(value)) {\r\n            const [serializedValue, transferables] = handler.serialize(value);\r\n            return [\r\n                {\r\n                    type: 3 /* HANDLER */,\r\n                    name,\r\n                    value: serializedValue,\r\n                },\r\n                transferables,\r\n            ];\r\n        }\r\n    }\r\n    return [\r\n        {\r\n            type: 0 /* RAW */,\r\n            value,\r\n        },\r\n        transferCache.get(value) || [],\r\n    ];\r\n}\r\nfunction fromWireValue(value) {\r\n    switch (value.type) {\r\n        case 3 /* HANDLER */:\r\n            return transferHandlers.get(value.name).deserialize(value.value);\r\n        case 0 /* RAW */:\r\n            return value.value;\r\n    }\r\n}\r\nfunction requestResponseMessage(ep, msg, transfers) {\r\n    return new Promise((resolve) => {\r\n        const id = generateUUID();\r\n        ep.addEventListener(\"message\", function l(ev) {\r\n            if (!ev.data || !ev.data.id || ev.data.id !== id) {\r\n                return;\r\n            }\r\n            ep.removeEventListener(\"message\", l);\r\n            resolve(ev.data);\r\n        });\r\n        if (ep.start) {\r\n            ep.start();\r\n        }\r\n        ep.postMessage(Object.assign({ id }, msg), transfers);\r\n    });\r\n}\r\nfunction generateUUID() {\r\n    return new Array(4)\r\n        .fill(0)\r\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\r\n        .join(\"-\");\r\n}\n\nexport { createEndpoint, expose, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { serve } from '@wix/communication-channel';\nimport type { ProviderAPI } from './types';\n\nexport { handshakeCode } from '@wix/communication-channel';\n\nexport * from './types';\n\ninterface ProvideParams {\n  api: ProviderAPI;\n  port: MessagePort;\n}\nexport function provideSDKApi({ api, port }: ProvideParams) {\n  serve({ api, port });\n}\n"],"names":["root","factory","exports","module","define","amd","self","this","handshakeCode","serve","_ref2","api","port","proxyCallbackMarker","proxyPromiseMarker","deserializeAllMethodsIn","wrapMethodsWithProxy","originalMethod","proxies","args","argsWithProxies","insertProxies","originalRun","serializeReturnValue","async","clonables","extractProxies","value","deserializeReturnValue","data","walker","val","isPromise","proxyId","uniqueId","promises","isFunction","callbacks","innerProxies","argsAsArray","exec","Array","isArray","map","i","isObject","mapObjectValues","hasOwnProperty","promiseId","callbackId","_len2","arguments","length","_key2","argsNoProxies","obj","callback","Proxy","get","target","prop","Error","Promise","Object","fromEntries","entries","_ref","key","counter","proxyMarker","Symbol","createEndpoint","releaseProxy","throwMarker","transferHandlers","Map","canHandle","serialize","port1","port2","MessageChannel","expose","deserialize","start","createProxy","serialized","isError","message","name","stack","assign","ep","addEventListener","ev","id","type","path","argumentList","fromWireValue","returnValue","parent","slice","reduce","rawValue","apply","proxy","transfers","transferCache","set","transfer","undefined","resolve","catch","then","wireValue","transferables","toWireValue","postMessage","removeEventListener","closeEndPoint","endpoint","constructor","isMessagePort","close","throwIfProxyReleased","isReleased","isProxyReleased","_target","requestResponseMessage","p","toString","r","bind","_thisArg","rawArgumentList","last","processArguments","construct","processed","v","arr","prototype","concat","WeakMap","handler","serializedValue","msg","fill","Math","floor","random","Number","MAX_SAFE_INTEGER","join","l","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","n","getter","__esModule","d","a","definition","o","defineProperty","enumerable","call","toStringTag","provideSDKApi"],"sourceRoot":""}