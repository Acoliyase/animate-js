{"version":3,"names":["_react","_interopRequireWildcard","require","_sdk","_index","_jsxFileName","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","useBeforeRenderEffect","effect","effectCondition","lastEffectResult","setState","useState","withContextualWixClient","Component","ownPropsWithHost","host","compProps","useHostAndProps","createClient","auth","dashboard","enableContext","lastHost","createElement","_extends2","__self","__source","fileName","lineNumber","columnNumber","exports","maybeLocalHost","ownProps","hostType","lastResult","hostProps","setHostProps","undefined","useEffect","observeResult","channel","observeState","newPropsFromHost","cleanup","disconnect","close"],"sources":["../../src/internal.tsx"],"sourcesContent":["// eslint-disable-next-line import/no-extraneous-dependencies\nimport React, { ComponentType, useEffect, useState } from 'react';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { createClient } from '@wix/sdk';\nimport { dashboard, type RemoteHost, type LocalHost } from './index';\n\nconst useBeforeRenderEffect = <T extends unknown>(\n  effect: () => T,\n  effectCondition: (lastEffectResult: T) => boolean,\n): T => {\n  const [lastEffectResult, setState] = useState(() => effect());\n  if (effectCondition(lastEffectResult)) {\n    setState(effect());\n  }\n  return lastEffectResult;\n};\n\nexport const withContextualWixClient = <P extends {} = {}>(\n  Component: ComponentType<P>,\n): ComponentType<P & { host?: LocalHost }> => {\n  return (ownPropsWithHost) => {\n    const { host, compProps } = useHostAndProps(ownPropsWithHost);\n\n    useBeforeRenderEffect(\n      () => {\n        createClient({\n          auth: dashboard.auth(),\n          host,\n        }).enableContext('module');\n        return host;\n      },\n      (lastHost) => lastHost !== host,\n    );\n\n    return compProps ? <Component host={host} {...compProps} /> : null;\n  };\n};\n\nconst useHostAndProps = <P extends {}>(\n  ownPropsWithHost: P & { host?: LocalHost },\n):\n  | { host: LocalHost; compProps: P }\n  | {\n      host: RemoteHost;\n      compProps: P | undefined;\n    } => {\n  const { host: maybeLocalHost, ...ownProps } = ownPropsWithHost;\n\n  const { host, hostType } = useBeforeRenderEffect(\n    () =>\n      maybeLocalHost\n        ? { host: maybeLocalHost, hostType: 'local' as const }\n        : { host: dashboard.host(), hostType: 'remote' as const },\n    (lastResult) => !!maybeLocalHost && maybeLocalHost !== lastResult.host,\n  );\n\n  const [hostProps, setHostProps] = useState<P | undefined>(undefined);\n\n  useEffect(() => {\n    if (hostType === 'local') {\n      return;\n    }\n\n    const observeResult = host.channel.observeState((newPropsFromHost: any) => {\n      setHostProps((newPropsFromHost || {}) as P);\n    });\n\n    const cleanup = async () => {\n      (await observeResult).disconnect();\n      host.close();\n    };\n\n    return () => {\n      cleanup();\n    };\n  }, [host, hostType]);\n\n  return hostType === 'local'\n    ? { host, compProps: ownProps as P }\n    : {\n        host,\n        compProps: hostProps ? { ...hostProps, ...ownProps } : undefined,\n      };\n};\n"],"mappings":";;;;;;AACA,IAAAA,MAAA,GAAAC,uBAAA,CAAAC,OAAA;AAEA,IAAAC,IAAA,GAAAD,OAAA;AACA,IAAAE,MAAA,GAAAF,OAAA;AAAqE,IAAAG,YAAA,yFAJrE;AAEA;AAAA,SAAAC,yBAAAC,CAAA,6BAAAC,OAAA,mBAAAC,CAAA,OAAAD,OAAA,IAAAE,CAAA,OAAAF,OAAA,YAAAF,wBAAA,YAAAA,CAAAC,CAAA,WAAAA,CAAA,GAAAG,CAAA,GAAAD,CAAA,KAAAF,CAAA;AAAA,SAAAN,wBAAAM,CAAA,EAAAE,CAAA,SAAAA,CAAA,IAAAF,CAAA,IAAAA,CAAA,CAAAI,UAAA,SAAAJ,CAAA,eAAAA,CAAA,uBAAAA,CAAA,yBAAAA,CAAA,WAAAK,OAAA,EAAAL,CAAA,QAAAG,CAAA,GAAAJ,wBAAA,CAAAG,CAAA,OAAAC,CAAA,IAAAA,CAAA,CAAAG,GAAA,CAAAN,CAAA,UAAAG,CAAA,CAAAI,GAAA,CAAAP,CAAA,OAAAQ,CAAA,KAAAC,SAAA,UAAAC,CAAA,GAAAC,MAAA,CAAAC,cAAA,IAAAD,MAAA,CAAAE,wBAAA,WAAAC,CAAA,IAAAd,CAAA,oBAAAc,CAAA,OAAAC,cAAA,CAAAC,IAAA,CAAAhB,CAAA,EAAAc,CAAA,SAAAG,CAAA,GAAAP,CAAA,GAAAC,MAAA,CAAAE,wBAAA,CAAAb,CAAA,EAAAc,CAAA,UAAAG,CAAA,KAAAA,CAAA,CAAAV,GAAA,IAAAU,CAAA,CAAAC,GAAA,IAAAP,MAAA,CAAAC,cAAA,CAAAJ,CAAA,EAAAM,CAAA,EAAAG,CAAA,IAAAT,CAAA,CAAAM,CAAA,IAAAd,CAAA,CAAAc,CAAA,YAAAN,CAAA,CAAAH,OAAA,GAAAL,CAAA,EAAAG,CAAA,IAAAA,CAAA,CAAAe,GAAA,CAAAlB,CAAA,EAAAQ,CAAA,GAAAA,CAAA;AAIA,MAAMW,qBAAqB,GAAGA,CAC5BC,MAAe,EACfC,eAAiD,KAC3C;EACN,MAAM,CAACC,gBAAgB,EAAEC,QAAQ,CAAC,GAAG,IAAAC,eAAQ,EAAC,MAAMJ,MAAM,CAAC,CAAC,CAAC;EAC7D,IAAIC,eAAe,CAACC,gBAAgB,CAAC,EAAE;IACrCC,QAAQ,CAACH,MAAM,CAAC,CAAC,CAAC;EACpB;EACA,OAAOE,gBAAgB;AACzB,CAAC;AAEM,MAAMG,uBAAuB,GAClCC,SAA2B,IACiB;EAC5C,OAAQC,gBAAgB,IAAK;IAC3B,MAAM;MAAEC,IAAI;MAAEC;IAAU,CAAC,GAAGC,eAAe,CAACH,gBAAgB,CAAC;IAE7DR,qBAAqB,CACnB,MAAM;MACJ,IAAAY,iBAAY,EAAC;QACXC,IAAI,EAAEC,gBAAS,CAACD,IAAI,CAAC,CAAC;QACtBJ;MACF,CAAC,CAAC,CAACM,aAAa,CAAC,QAAQ,CAAC;MAC1B,OAAON,IAAI;IACb,CAAC,EACAO,QAAQ,IAAKA,QAAQ,KAAKP,IAC7B,CAAC;IAED,OAAOC,SAAS,gBAAGpC,MAAA,CAAAY,OAAA,CAAA+B,aAAA,CAACV,SAAS,MAAAW,SAAA,CAAAhC,OAAA;MAACuB,IAAI,EAAEA;IAAK,GAAKC,SAAS;MAAAS,MAAA;MAAAC,QAAA;QAAAC,QAAA,EAAA1C,YAAA;QAAA2C,UAAA;QAAAC,YAAA;MAAA;IAAA,EAAG,CAAC,GAAG,IAAI;EACpE,CAAC;AACH,CAAC;AAACC,OAAA,CAAAlB,uBAAA,GAAAA,uBAAA;AAEF,MAAMK,eAAe,GACnBH,gBAA0C,IAMnC;EACP,MAAM;IAAEC,IAAI,EAAEgB,cAAc;IAAE,GAAGC;EAAS,CAAC,GAAGlB,gBAAgB;EAE9D,MAAM;IAAEC,IAAI;IAAEkB;EAAS,CAAC,GAAG3B,qBAAqB,CAC9C,MACEyB,cAAc,GACV;IAAEhB,IAAI,EAAEgB,cAAc;IAAEE,QAAQ,EAAE;EAAiB,CAAC,GACpD;IAAElB,IAAI,EAAEK,gBAAS,CAACL,IAAI,CAAC,CAAC;IAAEkB,QAAQ,EAAE;EAAkB,CAAC,EAC5DC,UAAU,IAAK,CAAC,CAACH,cAAc,IAAIA,cAAc,KAAKG,UAAU,CAACnB,IACpE,CAAC;EAED,MAAM,CAACoB,SAAS,EAAEC,YAAY,CAAC,GAAG,IAAAzB,eAAQ,EAAgB0B,SAAS,CAAC;EAEpE,IAAAC,gBAAS,EAAC,MAAM;IACd,IAAIL,QAAQ,KAAK,OAAO,EAAE;MACxB;IACF;IAEA,MAAMM,aAAa,GAAGxB,IAAI,CAACyB,OAAO,CAACC,YAAY,CAAEC,gBAAqB,IAAK;MACzEN,YAAY,CAAEM,gBAAgB,IAAI,CAAC,CAAO,CAAC;IAC7C,CAAC,CAAC;IAEF,MAAMC,OAAO,GAAG,MAAAA,CAAA,KAAY;MAC1B,CAAC,MAAMJ,aAAa,EAAEK,UAAU,CAAC,CAAC;MAClC7B,IAAI,CAAC8B,KAAK,CAAC,CAAC;IACd,CAAC;IAED,OAAO,MAAM;MACXF,OAAO,CAAC,CAAC;IACX,CAAC;EACH,CAAC,EAAE,CAAC5B,IAAI,EAAEkB,QAAQ,CAAC,CAAC;EAEpB,OAAOA,QAAQ,KAAK,OAAO,GACvB;IAAElB,IAAI;IAAEC,SAAS,EAAEgB;EAAc,CAAC,GAClC;IACEjB,IAAI;IACJC,SAAS,EAAEmB,SAAS,GAAG;MAAE,GAAGA,SAAS;MAAE,GAAGH;IAAS,CAAC,GAAGK;EACzD,CAAC;AACP,CAAC","ignoreList":[]}