{"version":3,"names":["_addSitePlugin","require","createSDKBuilders","showToast","channel","args","handle","remove","Promise","resolve","then","h","observeState","disconnect","navigate","navigateBack","openModal","modalInfo","modalParams","modalId","params","modalClosed","closeModal","closeData","undefined","filteredArg","JSON","parse","stringify","getAccessToken","getPageUrl","openMediaManager","addSitePlugin","pluginId","options","PLUGINS_DASHBOARD_MODAL_ID","additionalParams","placement","action","resp","type","AddSitePluginModalError","message","code","data","error","onBeforeUnload","setPageTitle","pageTitle","getLanguage","host","language","_observeStateResult","observeStateResult","_","envState","requestFeedback","onLayerStateChange","resultOrPromise","installApp","getWidget","Error","getDashboardPlugins","getDashboardMenuPlugins","getSiteInfo","exports"],"sources":["../../src/sdk.ts"],"sourcesContent":["import {\n  CloseModal,\n  GetAccessToken,\n  GetLanguage,\n  GetPageUrl,\n  Host,\n  Navigate,\n  ObserveState,\n  OnBeforeUnload,\n  OpenModal,\n  ShowToast,\n  RequestFeedback,\n  SetPageTitle,\n  NavigateBack,\n  OnLayerStateChange,\n  ProviderOpenModal,\n  OpenMediaManager,\n} from './types';\nimport {\n  AddSitePlugin,\n  AddSitePluginModalError,\n  AddSitePluginModalResult,\n} from './types/addSitePlugin';\nimport { InstallApp } from './types/installApp';\nimport { GetDashboardMenuPlugins, GetDashboardPlugins } from './types/slots';\nimport { GetWidget } from './types/widget';\nimport { GetSiteInfo } from './types/getSiteInfo';\n\nexport const createSDKBuilders = () => {\n  const showToast =\n    ({ channel }: Host): ShowToast =>\n    (...args) => {\n      const handle = channel.showToast(...args);\n      const remove = () => Promise.resolve(handle).then((h) => h.remove());\n      return { remove };\n    };\n\n  const observeState =\n    ({ channel }: Host): ObserveState =>\n    (...args) => {\n      const handle = (channel.observeState as ObserveState)(\n        ...args,\n      ) as ReturnType<Host['channel']['observeState']>; // this temporary casting is needed because it seems that typescript can't handle this by itself.\n      const disconnect = () =>\n        Promise.resolve(handle).then((h) => h.disconnect());\n      return { disconnect };\n    };\n\n  const navigate =\n    ({ channel }: Host): Navigate =>\n    (...args) => {\n      return channel.navigate(...args);\n    };\n\n  const navigateBack =\n    ({ channel }: Host): NavigateBack =>\n    () => {\n      return channel.navigateBack();\n    };\n\n  const openModal =\n    ({ channel }: Host): OpenModal =>\n    (modalInfo, modalParams?) => {\n      const [modalId, params]: Parameters<ProviderOpenModal> =\n        typeof modalInfo === 'string'\n          ? [modalInfo, modalParams]\n          : [modalInfo.modalId, modalInfo.params];\n\n      const handle = channel.openModal(modalId, params);\n      return {\n        modalClosed: Promise.resolve(handle).then((h) => h.modalClosed),\n      };\n    };\n\n  const closeModal =\n    ({ channel }: Host): CloseModal =>\n    (closeData) => {\n      if (closeData === undefined) {\n        return channel.closeModal();\n      }\n      const filteredArg = JSON.parse(JSON.stringify(closeData));\n      return channel.closeModal(filteredArg);\n    };\n\n  const getAccessToken =\n    ({ channel }: Host): GetAccessToken =>\n    () => {\n      return channel.getAccessToken();\n    };\n\n  const getPageUrl =\n    ({ channel }: Host): GetPageUrl =>\n    (...args) => {\n      return channel.getPageUrl(...args);\n    };\n\n  const openMediaManager =\n    ({ channel }: Host): OpenMediaManager =>\n    (...args) => {\n      return channel.openMediaManager(...args);\n    };\n\n  const addSitePlugin =\n    ({ channel }: Host): AddSitePlugin =>\n    (pluginId, options) => {\n      const PLUGINS_DASHBOARD_MODAL_ID = '802c76e4-b381-4bb3-9152-96acabbf3194';\n      const additionalParams = options?.placement || {};\n      const handle = channel.openModal(PLUGINS_DASHBOARD_MODAL_ID, {\n        ...additionalParams,\n        pluginId,\n        action: 'populate',\n      });\n      return Promise.resolve(handle)\n        .then(\n          (h) => h.modalClosed as unknown as Promise<AddSitePluginModalResult>,\n        )\n        .then((resp) => {\n          if (resp?.type === undefined) {\n            throw new AddSitePluginModalError({\n              message: 'Aborted by user',\n              code: 3006,\n            });\n          }\n          if (resp?.type === 'ERROR') {\n            throw new AddSitePluginModalError(resp.data.error);\n          }\n        });\n    };\n\n  const onBeforeUnload =\n    ({ channel }: Host): OnBeforeUnload =>\n    (...args) => {\n      return channel.onBeforeUnload(...args);\n    };\n\n  const setPageTitle =\n    ({ channel }: Host): SetPageTitle =>\n    (pageTitle: string | null) => {\n      return channel.setPageTitle(pageTitle);\n    };\n\n  const getLanguage = (host: Host): GetLanguage => {\n    let language: string | null = null;\n    return async () => {\n      if (language) {\n        return language;\n      }\n      let observeStateResult = null as ReturnType<ObserveState> | null;\n      language = await new Promise<string>((resolve) => {\n        observeStateResult = observeState(host)((_, envState) => {\n          resolve(envState.language);\n        });\n      });\n      observeStateResult?.disconnect();\n      return language;\n    };\n  };\n\n  const requestFeedback =\n    ({ channel }: Host): RequestFeedback =>\n    (...args) => {\n      return channel.requestFeedback(...args);\n    };\n\n  const onLayerStateChange =\n    ({ channel }: Host): OnLayerStateChange =>\n    (...args) => {\n      const resultOrPromise = channel.onLayerStateChange(...args);\n      const remove = () =>\n        Promise.resolve(resultOrPromise).then((h) => h.remove());\n      return { remove };\n    };\n\n  const installApp = ({ channel }: Host): InstallApp => channel.installApp;\n\n  const getWidget =\n    ({ channel }: Host): GetWidget =>\n    (...args) => {\n      if ('getWidget' in channel) {\n        return channel.getWidget(...args);\n      } else {\n        throw new Error('Unsupported');\n      }\n    };\n\n  const getDashboardPlugins =\n    ({ channel }: Host): GetDashboardPlugins =>\n    (...args) => {\n      if ('getDashboardPlugins' in channel) {\n        return channel.getDashboardPlugins(...args);\n      } else {\n        throw new Error('Unsupported');\n      }\n    };\n\n  const getDashboardMenuPlugins =\n    ({ channel }: Host): GetDashboardMenuPlugins =>\n    (...args) => {\n      if ('getDashboardMenuPlugins' in channel) {\n        return channel.getDashboardMenuPlugins(...args);\n      } else {\n        throw new Error('Unsupported');\n      }\n    };\n\n  const getSiteInfo = ({ channel }: Host): GetSiteInfo => channel.getSiteInfo;\n\n  return {\n    showToast,\n    observeState,\n    navigate,\n    navigateBack,\n    openModal,\n    closeModal,\n    getAccessToken,\n    getPageUrl,\n    openMediaManager,\n    addSitePlugin,\n    onBeforeUnload,\n    setPageTitle,\n    getLanguage,\n    requestFeedback,\n    onLayerStateChange,\n    installApp,\n    getSiteInfo,\n    getWidget,\n    getDashboardPlugins,\n    getDashboardMenuPlugins,\n  };\n};\n"],"mappings":"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","ignoreList":[]}