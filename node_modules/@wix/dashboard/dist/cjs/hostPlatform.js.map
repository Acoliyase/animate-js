{"version":3,"names":["_communicationChannel","require","_monitoringBrowserSdkHost","_registerHeightReporter","_isWixOrigin","_registerOnBeforeUnload","_essentials","createHost","config","searchString","fullUrl","URL","search","window","location","queryParams","URLSearchParams","origin","get","postMessage","parent","bind","isWixOrigin","Error","channel","close","open","closeMethods","autoHeightUpdate","undefined","element","autoHeightElement","document","documentElement","clearHeightReport","registerHeightReporter","push","onBeforeUnload","clearBeforeUnloadHandler","registerBeforeUnloadHandler","siteInfo","parseSiteInfo","getSiteInfoSync","channelProxy","Proxy","target","prop","receiver","Reflect","monitoring","essentials","getEssentialsFromQueryParams","getMonitoringClient","getMonitoringClientFunction","hostContext","context","monitoringConfig","sentrySDK","Sentry","forEach","method","exports","JSON","parse","decodeURIComponent","e","console","warn"],"sources":["../../src/hostPlatform.ts"],"sourcesContent":["import { open } from '@wix/communication-channel';\nimport { getMonitoringClientFunction } from '@wix/monitoring-browser-sdk-host';\nimport { CreateHost, ProviderAPI, OnBeforeUnload } from './types';\nimport { registerHeightReporter } from './helpers/registerHeightReporter';\nimport { isWixOrigin } from './helpers/isWixOrigin';\nimport { registerBeforeUnloadHandler } from './helpers/registerOnBeforeUnload';\nimport { getEssentialsFromQueryParams } from './helpers/essentials';\nimport { GetSiteInfo } from './types/getSiteInfo';\n\ndeclare global {\n  interface Window {\n    Sentry?: any;\n  }\n}\n\nexport const createHost: CreateHost = function (config = {}) {\n  // when full url is provided (worker case) use it and ignore own location search\n  const searchString =\n    (config.fullUrl && new URL(config.fullUrl).search) ||\n    (typeof window !== 'undefined' && window.location.search) ||\n    '';\n  const queryParams = new URLSearchParams(searchString);\n  const origin = config.origin || queryParams.get('origin') || '';\n  const postMessage =\n    config.postMessage || window.parent.postMessage.bind(window.parent);\n\n  if (!isWixOrigin(origin)) {\n    throw new Error(\n      `Wix Dashboard SDK: Unable to establish a connection with the Wix dashboard. Please ensure that you are running your app within the Wix dashboard.`,\n    );\n  }\n\n  const { channel, close } = open<ProviderAPI>({ postMessage, origin });\n  const closeMethods = [close];\n\n  if (config.autoHeightUpdate === undefined || config.autoHeightUpdate) {\n    const element = config.autoHeightElement || document.documentElement;\n    const clearHeightReport = registerHeightReporter(channel, element);\n    closeMethods.push(() => clearHeightReport());\n  }\n\n  const { onBeforeUnload, clearBeforeUnloadHandler } =\n    registerBeforeUnloadHandler(channel);\n  closeMethods.push(clearBeforeUnloadHandler);\n\n  const siteInfo = parseSiteInfo(queryParams.get('siteInfo') || '');\n  const getSiteInfoSync: GetSiteInfo = () => siteInfo;\n\n  const channelProxy = new Proxy(channel, {\n    get(target, prop, receiver) {\n      if (prop === 'onBeforeUnload') {\n        return onBeforeUnload;\n      }\n      if (prop === 'getSiteInfo') {\n        return getSiteInfoSync;\n      }\n      return Reflect.get(target, prop, receiver);\n    },\n  }) as typeof channel & {\n    onBeforeUnload: OnBeforeUnload;\n    getSiteInfo: GetSiteInfo; // keeping it sync\n  };\n\n  const { monitoring, ...essentials } =\n    getEssentialsFromQueryParams(queryParams) || {};\n\n  const getMonitoringClient = getMonitoringClientFunction({\n    hostContext: monitoring?.context,\n    monitoringConfig: monitoring?.config,\n    sentrySDK: typeof window !== 'undefined' ? window.Sentry : undefined,\n  });\n\n  return {\n    channel: channelProxy,\n    close: () => closeMethods.forEach((method) => method()),\n    getMonitoringClient,\n    essentials,\n  };\n};\n\nconst parseSiteInfo = (siteInfo: string) => {\n  try {\n    return JSON.parse(decodeURIComponent(siteInfo));\n  } catch (e) {\n    console.warn(\n      'Failed to parse \"siteInfo\" query parameter. Make sure to run the code inside a supported Wix App extension.',\n      e,\n    );\n    return {};\n  }\n};\n"],"mappings":"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","ignoreList":[]}