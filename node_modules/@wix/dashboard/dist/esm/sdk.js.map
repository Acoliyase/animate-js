{"version":3,"names":["AddSitePluginModalError","createSDKBuilders","showToast","_ref","channel","handle","arguments","remove","Promise","resolve","then","h","observeState","_ref2","disconnect","navigate","_ref3","navigateBack","_ref4","openModal","_ref5","modalInfo","modalParams","modalId","params","modalClosed","closeModal","_ref6","closeData","undefined","filteredArg","JSON","parse","stringify","getAccessToken","_ref7","getPageUrl","_ref8","openMediaManager","_ref9","addSitePlugin","_ref10","pluginId","options","PLUGINS_DASHBOARD_MODAL_ID","additionalParams","placement","action","resp","type","message","code","data","error","onBeforeUnload","_ref11","setPageTitle","_ref12","pageTitle","getLanguage","host","language","_observeStateResult","observeStateResult","_","envState","requestFeedback","_ref13","onLayerStateChange","_ref14","resultOrPromise","installApp","_ref15","getWidget","_ref16","Error","getDashboardPlugins","_ref17","getDashboardMenuPlugins","_ref18","getSiteInfo","_ref19"],"sources":["../../src/sdk.ts"],"sourcesContent":["import {\n  CloseModal,\n  GetAccessToken,\n  GetLanguage,\n  GetPageUrl,\n  Host,\n  Navigate,\n  ObserveState,\n  OnBeforeUnload,\n  OpenModal,\n  ShowToast,\n  RequestFeedback,\n  SetPageTitle,\n  NavigateBack,\n  OnLayerStateChange,\n  ProviderOpenModal,\n  OpenMediaManager,\n} from './types';\nimport {\n  AddSitePlugin,\n  AddSitePluginModalError,\n  AddSitePluginModalResult,\n} from './types/addSitePlugin';\nimport { InstallApp } from './types/installApp';\nimport { GetDashboardMenuPlugins, GetDashboardPlugins } from './types/slots';\nimport { GetWidget } from './types/widget';\nimport { GetSiteInfo } from './types/getSiteInfo';\n\nexport const createSDKBuilders = () => {\n  const showToast =\n    ({ channel }: Host): ShowToast =>\n    (...args) => {\n      const handle = channel.showToast(...args);\n      const remove = () => Promise.resolve(handle).then((h) => h.remove());\n      return { remove };\n    };\n\n  const observeState =\n    ({ channel }: Host): ObserveState =>\n    (...args) => {\n      const handle = (channel.observeState as ObserveState)(\n        ...args,\n      ) as ReturnType<Host['channel']['observeState']>; // this temporary casting is needed because it seems that typescript can't handle this by itself.\n      const disconnect = () =>\n        Promise.resolve(handle).then((h) => h.disconnect());\n      return { disconnect };\n    };\n\n  const navigate =\n    ({ channel }: Host): Navigate =>\n    (...args) => {\n      return channel.navigate(...args);\n    };\n\n  const navigateBack =\n    ({ channel }: Host): NavigateBack =>\n    () => {\n      return channel.navigateBack();\n    };\n\n  const openModal =\n    ({ channel }: Host): OpenModal =>\n    (modalInfo, modalParams?) => {\n      const [modalId, params]: Parameters<ProviderOpenModal> =\n        typeof modalInfo === 'string'\n          ? [modalInfo, modalParams]\n          : [modalInfo.modalId, modalInfo.params];\n\n      const handle = channel.openModal(modalId, params);\n      return {\n        modalClosed: Promise.resolve(handle).then((h) => h.modalClosed),\n      };\n    };\n\n  const closeModal =\n    ({ channel }: Host): CloseModal =>\n    (closeData) => {\n      if (closeData === undefined) {\n        return channel.closeModal();\n      }\n      const filteredArg = JSON.parse(JSON.stringify(closeData));\n      return channel.closeModal(filteredArg);\n    };\n\n  const getAccessToken =\n    ({ channel }: Host): GetAccessToken =>\n    () => {\n      return channel.getAccessToken();\n    };\n\n  const getPageUrl =\n    ({ channel }: Host): GetPageUrl =>\n    (...args) => {\n      return channel.getPageUrl(...args);\n    };\n\n  const openMediaManager =\n    ({ channel }: Host): OpenMediaManager =>\n    (...args) => {\n      return channel.openMediaManager(...args);\n    };\n\n  const addSitePlugin =\n    ({ channel }: Host): AddSitePlugin =>\n    (pluginId, options) => {\n      const PLUGINS_DASHBOARD_MODAL_ID = '802c76e4-b381-4bb3-9152-96acabbf3194';\n      const additionalParams = options?.placement || {};\n      const handle = channel.openModal(PLUGINS_DASHBOARD_MODAL_ID, {\n        ...additionalParams,\n        pluginId,\n        action: 'populate',\n      });\n      return Promise.resolve(handle)\n        .then(\n          (h) => h.modalClosed as unknown as Promise<AddSitePluginModalResult>,\n        )\n        .then((resp) => {\n          if (resp?.type === undefined) {\n            throw new AddSitePluginModalError({\n              message: 'Aborted by user',\n              code: 3006,\n            });\n          }\n          if (resp?.type === 'ERROR') {\n            throw new AddSitePluginModalError(resp.data.error);\n          }\n        });\n    };\n\n  const onBeforeUnload =\n    ({ channel }: Host): OnBeforeUnload =>\n    (...args) => {\n      return channel.onBeforeUnload(...args);\n    };\n\n  const setPageTitle =\n    ({ channel }: Host): SetPageTitle =>\n    (pageTitle: string | null) => {\n      return channel.setPageTitle(pageTitle);\n    };\n\n  const getLanguage = (host: Host): GetLanguage => {\n    let language: string | null = null;\n    return async () => {\n      if (language) {\n        return language;\n      }\n      let observeStateResult = null as ReturnType<ObserveState> | null;\n      language = await new Promise<string>((resolve) => {\n        observeStateResult = observeState(host)((_, envState) => {\n          resolve(envState.language);\n        });\n      });\n      observeStateResult?.disconnect();\n      return language;\n    };\n  };\n\n  const requestFeedback =\n    ({ channel }: Host): RequestFeedback =>\n    (...args) => {\n      return channel.requestFeedback(...args);\n    };\n\n  const onLayerStateChange =\n    ({ channel }: Host): OnLayerStateChange =>\n    (...args) => {\n      const resultOrPromise = channel.onLayerStateChange(...args);\n      const remove = () =>\n        Promise.resolve(resultOrPromise).then((h) => h.remove());\n      return { remove };\n    };\n\n  const installApp = ({ channel }: Host): InstallApp => channel.installApp;\n\n  const getWidget =\n    ({ channel }: Host): GetWidget =>\n    (...args) => {\n      if ('getWidget' in channel) {\n        return channel.getWidget(...args);\n      } else {\n        throw new Error('Unsupported');\n      }\n    };\n\n  const getDashboardPlugins =\n    ({ channel }: Host): GetDashboardPlugins =>\n    (...args) => {\n      if ('getDashboardPlugins' in channel) {\n        return channel.getDashboardPlugins(...args);\n      } else {\n        throw new Error('Unsupported');\n      }\n    };\n\n  const getDashboardMenuPlugins =\n    ({ channel }: Host): GetDashboardMenuPlugins =>\n    (...args) => {\n      if ('getDashboardMenuPlugins' in channel) {\n        return channel.getDashboardMenuPlugins(...args);\n      } else {\n        throw new Error('Unsupported');\n      }\n    };\n\n  const getSiteInfo = ({ channel }: Host): GetSiteInfo => channel.getSiteInfo;\n\n  return {\n    showToast,\n    observeState,\n    navigate,\n    navigateBack,\n    openModal,\n    closeModal,\n    getAccessToken,\n    getPageUrl,\n    openMediaManager,\n    addSitePlugin,\n    onBeforeUnload,\n    setPageTitle,\n    getLanguage,\n    requestFeedback,\n    onLayerStateChange,\n    installApp,\n    getSiteInfo,\n    getWidget,\n    getDashboardPlugins,\n    getDashboardMenuPlugins,\n  };\n};\n"],"mappings":"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","ignoreList":[]}