{"version":3,"names":["React","useEffect","useState","createClient","dashboard","useBeforeRenderEffect","effect","effectCondition","lastEffectResult","setState","withContextualWixClient","Component","ownPropsWithHost","host","compProps","useHostAndProps","auth","enableContext","lastHost","createElement","_extends","maybeLocalHost","ownProps","hostType","lastResult","hostProps","setHostProps","undefined","observeResult","channel","observeState","newPropsFromHost","cleanup","disconnect","close"],"sources":["../../src/internal.tsx"],"sourcesContent":["// eslint-disable-next-line import/no-extraneous-dependencies\nimport React, { ComponentType, useEffect, useState } from 'react';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { createClient } from '@wix/sdk';\nimport { dashboard, type RemoteHost, type LocalHost } from './index';\n\nconst useBeforeRenderEffect = <T extends unknown>(\n  effect: () => T,\n  effectCondition: (lastEffectResult: T) => boolean,\n): T => {\n  const [lastEffectResult, setState] = useState(() => effect());\n  if (effectCondition(lastEffectResult)) {\n    setState(effect());\n  }\n  return lastEffectResult;\n};\n\nexport const withContextualWixClient = <P extends {} = {}>(\n  Component: ComponentType<P>,\n): ComponentType<P & { host?: LocalHost }> => {\n  return (ownPropsWithHost) => {\n    const { host, compProps } = useHostAndProps(ownPropsWithHost);\n\n    useBeforeRenderEffect(\n      () => {\n        createClient({\n          auth: dashboard.auth(),\n          host,\n        }).enableContext('module');\n        return host;\n      },\n      (lastHost) => lastHost !== host,\n    );\n\n    return compProps ? <Component host={host} {...compProps} /> : null;\n  };\n};\n\nconst useHostAndProps = <P extends {}>(\n  ownPropsWithHost: P & { host?: LocalHost },\n):\n  | { host: LocalHost; compProps: P }\n  | {\n      host: RemoteHost;\n      compProps: P | undefined;\n    } => {\n  const { host: maybeLocalHost, ...ownProps } = ownPropsWithHost;\n\n  const { host, hostType } = useBeforeRenderEffect(\n    () =>\n      maybeLocalHost\n        ? { host: maybeLocalHost, hostType: 'local' as const }\n        : { host: dashboard.host(), hostType: 'remote' as const },\n    (lastResult) => !!maybeLocalHost && maybeLocalHost !== lastResult.host,\n  );\n\n  const [hostProps, setHostProps] = useState<P | undefined>(undefined);\n\n  useEffect(() => {\n    if (hostType === 'local') {\n      return;\n    }\n\n    const observeResult = host.channel.observeState((newPropsFromHost: any) => {\n      setHostProps((newPropsFromHost || {}) as P);\n    });\n\n    const cleanup = async () => {\n      (await observeResult).disconnect();\n      host.close();\n    };\n\n    return () => {\n      cleanup();\n    };\n  }, [host, hostType]);\n\n  return hostType === 'local'\n    ? { host, compProps: ownProps as P }\n    : {\n        host,\n        compProps: hostProps ? { ...hostProps, ...ownProps } : undefined,\n      };\n};\n"],"mappings":";AAAA;AACA,OAAOA,KAAK,IAAmBC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AACjE;AACA,SAASC,YAAY,QAAQ,UAAU;AACvC,SAASC,SAAS,QAAyC,SAAS;AAEpE,MAAMC,qBAAqB,GAAGA,CAC5BC,MAAe,EACfC,eAAiD,KAC3C;EACN,MAAM,CAACC,gBAAgB,EAAEC,QAAQ,CAAC,GAAGP,QAAQ,CAAC,MAAMI,MAAM,CAAC,CAAC,CAAC;EAC7D,IAAIC,eAAe,CAACC,gBAAgB,CAAC,EAAE;IACrCC,QAAQ,CAACH,MAAM,CAAC,CAAC,CAAC;EACpB;EACA,OAAOE,gBAAgB;AACzB,CAAC;AAED,OAAO,MAAME,uBAAuB,GAClCC,SAA2B,IACiB;EAC5C,OAAQC,gBAAgB,IAAK;IAC3B,MAAM;MAAEC,IAAI;MAAEC;IAAU,CAAC,GAAGC,eAAe,CAACH,gBAAgB,CAAC;IAE7DP,qBAAqB,CACnB,MAAM;MACJF,YAAY,CAAC;QACXa,IAAI,EAAEZ,SAAS,CAACY,IAAI,CAAC,CAAC;QACtBH;MACF,CAAC,CAAC,CAACI,aAAa,CAAC,QAAQ,CAAC;MAC1B,OAAOJ,IAAI;IACb,CAAC,EACAK,QAAQ,IAAKA,QAAQ,KAAKL,IAC7B,CAAC;IAED,OAAOC,SAAS,gBAAGd,KAAA,CAAAmB,aAAA,CAACR,SAAS,EAAAS,QAAA;MAACP,IAAI,EAAEA;IAAK,GAAKC,SAAS,CAAG,CAAC,GAAG,IAAI;EACpE,CAAC;AACH,CAAC;AAED,MAAMC,eAAe,GACnBH,gBAA0C,IAMnC;EACP,MAAM;IAAEC,IAAI,EAAEQ,cAAc;IAAE,GAAGC;EAAS,CAAC,GAAGV,gBAAgB;EAE9D,MAAM;IAAEC,IAAI;IAAEU;EAAS,CAAC,GAAGlB,qBAAqB,CAC9C,MACEgB,cAAc,GACV;IAAER,IAAI,EAAEQ,cAAc;IAAEE,QAAQ,EAAE;EAAiB,CAAC,GACpD;IAAEV,IAAI,EAAET,SAAS,CAACS,IAAI,CAAC,CAAC;IAAEU,QAAQ,EAAE;EAAkB,CAAC,EAC5DC,UAAU,IAAK,CAAC,CAACH,cAAc,IAAIA,cAAc,KAAKG,UAAU,CAACX,IACpE,CAAC;EAED,MAAM,CAACY,SAAS,EAAEC,YAAY,CAAC,GAAGxB,QAAQ,CAAgByB,SAAS,CAAC;EAEpE1B,SAAS,CAAC,MAAM;IACd,IAAIsB,QAAQ,KAAK,OAAO,EAAE;MACxB;IACF;IAEA,MAAMK,aAAa,GAAGf,IAAI,CAACgB,OAAO,CAACC,YAAY,CAAEC,gBAAqB,IAAK;MACzEL,YAAY,CAAEK,gBAAgB,IAAI,CAAC,CAAO,CAAC;IAC7C,CAAC,CAAC;IAEF,MAAMC,OAAO,GAAG,MAAAA,CAAA,KAAY;MAC1B,CAAC,MAAMJ,aAAa,EAAEK,UAAU,CAAC,CAAC;MAClCpB,IAAI,CAACqB,KAAK,CAAC,CAAC;IACd,CAAC;IAED,OAAO,MAAM;MACXF,OAAO,CAAC,CAAC;IACX,CAAC;EACH,CAAC,EAAE,CAACnB,IAAI,EAAEU,QAAQ,CAAC,CAAC;EAEpB,OAAOA,QAAQ,KAAK,OAAO,GACvB;IAAEV,IAAI;IAAEC,SAAS,EAAEQ;EAAc,CAAC,GAClC;IACET,IAAI;IACJC,SAAS,EAAEW,SAAS,GAAG;MAAE,GAAGA,SAAS;MAAE,GAAGH;IAAS,CAAC,GAAGK;EACzD,CAAC;AACP,CAAC","ignoreList":[]}