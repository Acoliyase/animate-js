"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _react = _interopRequireDefault(require("react"));
var _designSystem = require("@wix/design-system");
var _testkit = require("@wix/design-system/dist/testkit");
var _react2 = require("@testing-library/react");
var _dragAndDrop = require("../drag-and-drop");
var _testUtils = require("../test-utils");
var _jsxFileName = "/home/builduser/work/b60d7defec63c7cc/packages/wix-style-react-incubator/dist/cjs/__tests__/table.spec.tsx";
const TestApp = ({
  showSelection = false
} = {}) => {
  const [items, setItems] = _react.default.useState(() => [{
    id: '5880f692-4468-40cf-b5b5-07a0f535506a',
    name: 'Ice Cream',
    price: '$2.00'
  }, {
    id: '60b73a3b-0252-4426-9bef-ac8a20a09492',
    name: 'Sandwich',
    price: '$5.00'
  }, {
    id: '58319273-f5cc-4920-88fa-85b228763c95',
    name: 'Mushroom Pasta',
    price: '$7.00'
  }]);
  return /*#__PURE__*/_react.default.createElement(_designSystem.Table, {
    dataHook: "table",
    columns: [{
      title: 'Name',
      render: row => row.name
    }, {
      title: 'Price',
      render: row => row.price
    }],
    data: items,
    dragAndDrop: _dragAndDrop.TableDragAndDrop,
    onDragEnd: ({
      active,
      over
    }) => {
      const newItems = (0, _testUtils.move)(items, active.id, over == null ? void 0 : over.id);
      if (newItems) {
        setItems(newItems);
      }
    },
    showSelection: showSelection,
    __self: void 0,
    __source: {
      fileName: _jsxFileName,
      lineNumber: 31,
      columnNumber: 5
    }
  });
};
const dragStart = async node => {
  _react2.fireEvent.pointerDown(await node.getNative());
};
const dragEnd = async node => {
  _react2.fireEvent.pointerUp(await node.getNative());
};
describe('Table DragAndDrop', () => {
  it('should reorder rows', async () => {
    const result = (0, _react2.render)(/*#__PURE__*/_react.default.createElement(TestApp, {
      __self: void 0,
      __source: {
        fileName: _jsxFileName,
        lineNumber: 60,
        columnNumber: 27
      }
    }));
    const table = (0, _testkit.TableTestkit)({
      wrapper: result.baseElement,
      dataHook: 'table'
    });
    expect((await table.getRowText(0))[1]).toBe('Ice Cream');
    expect((await table.getRowText(1))[1]).toBe('Sandwich');
    expect((await table.getRowText(2))[1]).toBe('Mushroom Pasta');
    await dragStart(table.getRow(0));
    await dragEnd(table.getRow(2));
    expect((await table.getRowText(0))[1]).toBe('Sandwich');
    expect((await table.getRowText(1))[1]).toBe('Mushroom Pasta');
    expect((await table.getRowText(2))[1]).toBe('Ice Cream');
  });
  it('should be able to click on selectAll with enabled DragAndDrop', async () => {
    const result = (0, _react2.render)(/*#__PURE__*/_react.default.createElement(TestApp, {
      showSelection: true,
      __self: void 0,
      __source: {
        fileName: _jsxFileName,
        lineNumber: 79,
        columnNumber: 27
      }
    }));
    const table = (0, _testkit.TableTestkit)({
      wrapper: result.baseElement,
      dataHook: 'table'
    });
    expect(await table.exists()).toBe(true);
    const selectAll = await table.getBulkSelectionCheckboxDriver();
    await selectAll.click();
    expect(await table.isRowSelected(0)).toBe(true);
    expect(await table.isRowSelected(1)).toBe(true);
  });
});
//# sourceMappingURL=table.spec.js.map