{"version":3,"names":["_jsBase","require","flattenParams","data","path","params","Object","entries","forEach","key","value","isObject","Array","isArray","fieldPath","resolvePath","serializedObject","assign","toURLSearchParams","isComplexRequest","flatten","isPayloadNonSerializableAsUrlSearchParams","some","includes","v","shouldSerializeToRParam","URLSearchParams","encode","JSON","stringify","reduce","urlSearchParams","keyParams","param","undefined","append"],"sources":["../../src/flatten-params.ts"],"sourcesContent":["import { encode } from 'js-base64';\n\n// Flatten a nested object to params object { field: { text: 'foo' } } => { field.text ='foo' }\nfunction flattenParams(data: object, path = ''): object {\n  const params: any = {};\n\n  Object.entries(data).forEach(([key, value]) => {\n    const isObject =\n      value !== null && typeof value === 'object' && !Array.isArray(value);\n    const fieldPath = resolvePath(path, key);\n\n    if (isObject) {\n      const serializedObject = flattenParams(value, fieldPath);\n      Object.assign(params, serializedObject);\n    } else {\n      params[fieldPath] = value;\n    }\n  });\n\n  return params;\n}\n\nfunction resolvePath(path: string, key: string) {\n  return `${path}${path ? '.' : ''}${key}`;\n}\n\n/**\n * serializes the params object to URLSearchParams,\n * if isComplexRequest is true and the payload is not serializable as regular URLSearchParams (because of nested fields),\n * it will serialize the payload into the .r query param exclusively\n * @param params\n * @param isComplexRequest\n * @returns\n */\nexport function toURLSearchParams(params: object, isComplexRequest?: boolean) {\n  const flatten = flattenParams(params);\n\n  // payloads with deep arrays or complex arrays are not serializable as URLSearchParams\n  const isPayloadNonSerializableAsUrlSearchParams = Object.entries(\n    flatten,\n  ).some(\n    ([key, value]) =>\n      key.includes('.') ||\n      (Array.isArray(value) && value.some((v) => typeof v === 'object')),\n  );\n  const shouldSerializeToRParam =\n    isComplexRequest && isPayloadNonSerializableAsUrlSearchParams;\n\n  if (shouldSerializeToRParam) {\n    return new URLSearchParams({ '.r': encode(JSON.stringify(params), true) });\n  } else {\n    return Object.entries(flatten).reduce((urlSearchParams, [key, value]) => {\n      // inorder to make `foo: [1,2]` turn into `foo=1&foo=2` and not `foo[]=1&foo[]=2`\n      const keyParams = Array.isArray(value) ? value : [value];\n\n      keyParams.forEach((param: any) => {\n        if (\n          param === undefined ||\n          param === null ||\n          (Array.isArray(value) && typeof param === 'object')\n        ) {\n          return;\n        }\n\n        urlSearchParams.append(key, param);\n      });\n\n      return urlSearchParams;\n    }, new URLSearchParams());\n  }\n}\n"],"mappings":";;;;AAAA,IAAAA,OAAA,GAAAC,OAAA;AAEA;AACA,SAASC,aAAaA,CAACC,IAAY,EAAEC,IAAI,GAAG,EAAE,EAAU;EACtD,MAAMC,MAAW,GAAG,CAAC,CAAC;EAEtBC,MAAM,CAACC,OAAO,CAACJ,IAAI,CAAC,CAACK,OAAO,CAAC,CAAC,CAACC,GAAG,EAAEC,KAAK,CAAC,KAAK;IAC7C,MAAMC,QAAQ,GACZD,KAAK,KAAK,IAAI,IAAI,OAAOA,KAAK,KAAK,QAAQ,IAAI,CAACE,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC;IACtE,MAAMI,SAAS,GAAGC,WAAW,CAACX,IAAI,EAAEK,GAAG,CAAC;IAExC,IAAIE,QAAQ,EAAE;MACZ,MAAMK,gBAAgB,GAAGd,aAAa,CAACQ,KAAK,EAAEI,SAAS,CAAC;MACxDR,MAAM,CAACW,MAAM,CAACZ,MAAM,EAAEW,gBAAgB,CAAC;IACzC,CAAC,MAAM;MACLX,MAAM,CAACS,SAAS,CAAC,GAAGJ,KAAK;IAC3B;EACF,CAAC,CAAC;EAEF,OAAOL,MAAM;AACf;AAEA,SAASU,WAAWA,CAACX,IAAY,EAAEK,GAAW,EAAE;EAC9C,OAAO,GAAGL,IAAI,GAAGA,IAAI,GAAG,GAAG,GAAG,EAAE,GAAGK,GAAG,EAAE;AAC1C;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,SAASS,iBAAiBA,CAACb,MAAc,EAAEc,gBAA0B,EAAE;EAC5E,MAAMC,OAAO,GAAGlB,aAAa,CAACG,MAAM,CAAC;;EAErC;EACA,MAAMgB,yCAAyC,GAAGf,MAAM,CAACC,OAAO,CAC9Da,OACF,CAAC,CAACE,IAAI,CACJ,CAAC,CAACb,GAAG,EAAEC,KAAK,CAAC,KACXD,GAAG,CAACc,QAAQ,CAAC,GAAG,CAAC,IAChBX,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,IAAIA,KAAK,CAACY,IAAI,CAAEE,CAAC,IAAK,OAAOA,CAAC,KAAK,QAAQ,CACpE,CAAC;EACD,MAAMC,uBAAuB,GAC3BN,gBAAgB,IAAIE,yCAAyC;EAE/D,IAAII,uBAAuB,EAAE;IAC3B,OAAO,IAAIC,eAAe,CAAC;MAAE,IAAI,EAAE,IAAAC,cAAM,EAACC,IAAI,CAACC,SAAS,CAACxB,MAAM,CAAC,EAAE,IAAI;IAAE,CAAC,CAAC;EAC5E,CAAC,MAAM;IACL,OAAOC,MAAM,CAACC,OAAO,CAACa,OAAO,CAAC,CAACU,MAAM,CAAC,CAACC,eAAe,EAAE,CAACtB,GAAG,EAAEC,KAAK,CAAC,KAAK;MACvE;MACA,MAAMsB,SAAS,GAAGpB,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC;MAExDsB,SAAS,CAACxB,OAAO,CAAEyB,KAAU,IAAK;QAChC,IACEA,KAAK,KAAKC,SAAS,IACnBD,KAAK,KAAK,IAAI,IACbrB,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,IAAI,OAAOuB,KAAK,KAAK,QAAS,EACnD;UACA;QACF;QAEAF,eAAe,CAACI,MAAM,CAAC1B,GAAG,EAAEwB,KAAK,CAAC;MACpC,CAAC,CAAC;MAEF,OAAOF,eAAe;IACxB,CAAC,EAAE,IAAIL,eAAe,CAAC,CAAC,CAAC;EAC3B;AACF","ignoreList":[]}