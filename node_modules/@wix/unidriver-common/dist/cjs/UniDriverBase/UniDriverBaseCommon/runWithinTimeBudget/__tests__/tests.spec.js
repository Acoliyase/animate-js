"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const internal_1 = require("@wix/unidriver-core/internal");
const delay_1 = require("../../../../utils/delay");
const runWithinTimeBudget_1 = require("../runWithinTimeBudget");
describe('runWithinTimeBudget', () => {
    describe('Pass', () => {
        it('should complete within the time budget', async () => {
            const fn = vi.fn().mockResolvedValue('success');
            const result = await Promise.race([
                (0, runWithinTimeBudget_1.runWithinTimeBudget)(fn, 10),
                new Promise((_, reject) => {
                    setTimeout(() => {
                        reject(new Error('timeout'));
                    }, 100);
                }),
            ]);
            expect(result).toBe('success');
            expect(fn).toHaveBeenCalled();
        });
    });
    describe('Not pass', () => {
        it('should throw TimeoutError if function does not complete in time', async () => {
            const fn = vi.fn().mockImplementation(() => (0, delay_1.delay)(100));
            try {
                await (0, runWithinTimeBudget_1.runWithinTimeBudget)(fn, 10);
            }
            catch (e) {
                expect(e).toBeInstanceOf(internal_1.TimeoutError);
            }
        });
        it('should throw original error if function does not complete because of error', async () => {
            class OriginalError extends Error {
                constructor() {
                    super('Original error');
                }
            }
            const fn = vi.fn().mockImplementation(() => {
                throw new OriginalError();
            });
            try {
                await (0, runWithinTimeBudget_1.runWithinTimeBudget)(fn, 10);
            }
            catch (e) {
                expect(e).toBeInstanceOf(OriginalError);
            }
        });
    });
});
//# sourceMappingURL=tests.spec.js.map