"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const react_1 = require("@testing-library/react");
const unidriver_core_1 = require("@wix/unidriver-core");
const react_2 = tslib_1.__importDefault(require("react"));
const vitest_1 = require("vitest");
const testUniDriver_1 = require("./TestUniDriver/testUniDriver");
(0, vitest_1.describe)('configureUniDriver', () => {
    afterEach(() => {
        (0, unidriver_core_1.configureUniDriver)();
    });
    (0, vitest_1.describe)('queryAttribute', () => {
        it('should work with string', async () => {
            (0, unidriver_core_1.configureUniDriver)({ queryAttribute: 'data-hook' });
            const { container } = (0, react_1.render)(react_2.default.createElement("div", null,
                react_2.default.createElement("span", { "data-hook": "test-hook" }, "TEXT")));
            const driver = (0, testUniDriver_1.testUniDriver)(container);
            expect(await driver.s('[data-hook="test-hook"]').text()).toBe('TEXT');
            expect(await driver.$('test-hook').text()).toBe('TEXT');
        });
        it('should work with function', async () => {
            (0, unidriver_core_1.configureUniDriver)({ queryAttribute: (selector) => `[data-hook="${selector}"]` });
            const { container } = (0, react_1.render)(react_2.default.createElement("div", null,
                react_2.default.createElement("span", { "data-hook": "test-hook" }, "TEXT")));
            const driver = (0, testUniDriver_1.testUniDriver)(container);
            expect(await driver.s('[data-hook="test-hook"]').text()).toBe('TEXT');
            expect(await driver.$('test-hook').text()).toBe('TEXT');
        });
    });
    it('should set defaultTimeout', async () => {
        (0, unidriver_core_1.configureUniDriver)({ defaultTimeout: 10 });
        const { container } = (0, react_1.render)(react_2.default.createElement("div", null,
            react_2.default.createElement("span", { "data-hook": "test-hook" }, "TEXT")));
        const driver = (0, testUniDriver_1.testUniDriver)(container);
        const firstCompletedTask = await Promise.race([
            driver
                .$('div')
                .$('button')
                .click()
                .catch(() => {
                return 'selector';
            }),
            new Promise((resolve) => {
                setTimeout(() => {
                    resolve('timeout');
                }, 100);
            }),
        ]);
        expect(firstCompletedTask).toBe('selector');
    });
    it('should override with newest value', async () => {
        (0, unidriver_core_1.configureUniDriver)({ queryAttribute: 'some-test-id' });
        (0, unidriver_core_1.configureUniDriver)({ queryAttribute: 'data-hook' });
        const { container } = (0, react_1.render)(react_2.default.createElement("div", null,
            react_2.default.createElement("span", { "data-hook": "test-hook" }, "TEXT")));
        const driver = (0, testUniDriver_1.testUniDriver)(container);
        expect(await driver.$('test-hook').text()).toBe('TEXT');
    });
    it('should reset to default if called without params', async () => {
        (0, unidriver_core_1.configureUniDriver)({ queryAttribute: 'some-test-id' });
        (0, unidriver_core_1.configureUniDriver)();
        const { container } = (0, react_1.render)(react_2.default.createElement("div", null,
            react_2.default.createElement("span", { "data-hook": "test-hook" }, "TEXT")));
        const driver = (0, testUniDriver_1.testUniDriver)(container).awaited(0);
        expect(await driver
            .$('test-hook')
            .text()
            .catch(() => {
            return 'not_found';
        })).toBe('not_found');
    });
});
//# sourceMappingURL=configureUniDriver.spec.js.map