import { TimeoutError } from '@wix/unidriver-core/internal';
import { delay } from '../../../../utils/delay';
import { runWithinTimeBudget } from '../runWithinTimeBudget';
describe('runWithinTimeBudget', () => {
    describe('Pass', () => {
        it('should complete within the time budget', async () => {
            const fn = vi.fn().mockResolvedValue('success');
            const result = await Promise.race([
                runWithinTimeBudget(fn, 10),
                new Promise((_, reject) => {
                    setTimeout(() => {
                        reject(new Error('timeout'));
                    }, 100);
                }),
            ]);
            expect(result).toBe('success');
            expect(fn).toHaveBeenCalled();
        });
    });
    describe('Not pass', () => {
        it('should throw TimeoutError if function does not complete in time', async () => {
            const fn = vi.fn().mockImplementation(() => delay(100));
            try {
                await runWithinTimeBudget(fn, 10);
            }
            catch (e) {
                expect(e).toBeInstanceOf(TimeoutError);
            }
        });
        it('should throw original error if function does not complete because of error', async () => {
            class OriginalError extends Error {
                constructor() {
                    super('Original error');
                }
            }
            const fn = vi.fn().mockImplementation(() => {
                throw new OriginalError();
            });
            try {
                await runWithinTimeBudget(fn, 10);
            }
            catch (e) {
                expect(e).toBeInstanceOf(OriginalError);
            }
        });
    });
});
//# sourceMappingURL=tests.spec.js.map