import {
  object,
  string
} from "../chunk-BIARYLOZ.js";
import {
  auth,
  returnToQueryParamName
} from "../chunk-YHKPE45V.js";
import "../chunk-MLKGABMK.js";

// src/routes/logout.ts
var logoutSearchParams = object({
  returnToUrl: string().optional()
});
var POST = async ({ redirect, request, url }) => {
  const { returnToUrl = "/" } = logoutSearchParams.parse(
    Object.fromEntries(url.searchParams.entries())
  );
  const baseUrl = `${new URL(request.url).origin}/${import.meta.env.BASE_URL}`;
  const postFlowUrl = new URL("/api/auth/logout-callback", baseUrl);
  const referer = request.headers.get("referer");
  if (referer != null) {
    const originalUrl = new URL(referer);
    postFlowUrl.protocol = originalUrl.protocol;
  }
  postFlowUrl.searchParams.set(returnToQueryParamName, returnToUrl);
  const { logoutUrl } = await auth.logout(postFlowUrl.toString());
  return redirect(logoutUrl);
};
export {
  POST
};
