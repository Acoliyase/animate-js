// src/runtime/utils.ts
import { AppStrategy, createClient } from "@wix/sdk";
import { WIX_CLIENT_ID } from "astro:env/client";
import { WIX_CLIENT_PUBLIC_KEY, WIX_CLIENT_SECRET } from "astro:env/server";
async function setupClient(fn) {
  const client = createClient({
    auth: AppStrategy({
      appId: WIX_CLIENT_ID,
      appSecret: WIX_CLIENT_SECRET,
      publicKey: WIX_CLIENT_PUBLIC_KEY
    })
  });
  const olderClient = globalThis.__wix_context__?.client;
  client.enableContext("global");
  await fn();
  if (olderClient) {
    olderClient.enableContext("global");
  }
  return client;
}

export {
  setupClient
};
