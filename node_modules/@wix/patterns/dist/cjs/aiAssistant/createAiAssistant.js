"use strict";

exports.__esModule = true;
exports.createAiAssistant = createAiAssistant;
var _react = require("@wix/bex-core/react");
var _aiAssistant = require("./aiAssistant");
var _useAiAssistantContext = require("./useAiAssistantContext");
var _react2 = require("react");
var _bi = require("@wix/bex-core/bi");
function createAiAssistant({
  appDefId
}) {
  return {
    useAiAssistant: ({
      collection,
      loadingRowState
    }) => {
      useAiAssistantCreation({
        appDefId,
        collection,
        loadingRowState
      });
    }
  };
}
function useAiAssistantCreation(props) {
  const {
    appDefId,
    collection,
    loadingRowState
  } = props;
  const optimisticActions = (0, _react.useOptimisticActions)(collection);
  const {
    useAssistantEffect
  } = (0, _useAiAssistantContext.useAiAssistantContext)();
  const {
    reportBi
  } = (0, _react.useWixPatternsContainer)();
  (0, _react2.useState)(() => {
    loadingRowState._loadAnimationAssets();
  });
  useAssistantEffect(payload => {
    if (!payload.item) {
      if (process.env.NODE_ENV !== 'production') {
        console.warn('No item provided in the payload. Pass the new item that should be added to the collection like {item: myNewItem}. Skipping creation.');
      }
      return;
    }
    const itemKey = collection.itemKey(payload.item);
    loadingRowState.addLoadingItem(itemKey);
    reportBi((0, _bi.wixPatternsItemCreatedWithAiSrc144Evid3)({
      itemId: itemKey
    }));
    optimisticActions.createOne(payload.item, {
      submit: async newItem => {
        return newItem;
      }
    });
  }, appDefId, (0, _aiAssistant.createWixPatternsCreationEventName)(collection));
}
//# sourceMappingURL=createAiAssistant.js.map