import { observer } from 'mobx-react-lite';
import React, { useCallback, useEffect } from 'react';
import { Box } from '@wix/design-system';
import { addEventListener } from '@wix/bex-core/util';
import { ColumnListTableListItem } from './ColumnListTableListItem';
function _ColumnsList(props) {
    const { state } = props;
    const { columnsCollection, dragAndDrop } = state;
    useEffect(() => {
        if (dragAndDrop == null) {
            return;
        }
        const { table: { sidePanel }, } = state;
        const disposers = [
            addEventListener(sidePanel.transition.events, 'entered', () => {
                dragAndDrop.listRect._syncThrottled();
            }),
            dragAndDrop.listRect.init(),
        ];
        return () => {
            disposers.forEach((d) => d?.());
        };
    }, []);
    const renderItem = useCallback((column, index, { length }) => {
        let child = (React.createElement(ColumnListTableListItem, { key: column.id, index: index, state: state, column: column, showDivider: index < length - 1 }));
        if (dragAndDrop) {
            const { DraggableListItem } = dragAndDrop.components;
            child = (React.createElement(DraggableListItem, { key: column.id, dndDisabled: column.reorderDisabled, id: column.id, index: index, state: dragAndDrop }, child));
        }
        return child;
    }, []);
    let child = (React.createElement(Box, { direction: "vertical", dataHook: "custom-columns-list", backgroundColor: "D60" }, columnsCollection.result.items.map(renderItem)));
    if (dragAndDrop) {
        const { ListDragAndDropContext, DraggableListItemOverlay } = dragAndDrop.components;
        child = (React.createElement(ListDragAndDropContext, { state: dragAndDrop, onSubmit: async ({ from, over }) => {
                state.customizeColumnsInSidePanelBi({ actionName: 'reorder' });
                state.dragAndDrop?._onCustomColumnsReorder(from.item.id, over.item.id);
            } },
            React.createElement(React.Fragment, null,
                child,
                React.createElement(DraggableListItemOverlay, { state: dragAndDrop, renderItem: (index) => {
                        const item = columnsCollection.result.items[index];
                        return item ? renderItem(item, index, { length: 0 }) : null;
                    } }))));
    }
    return child;
}
export const ColumnsList = observer(_ColumnsList);
//# sourceMappingURL=ColumnsList.js.map