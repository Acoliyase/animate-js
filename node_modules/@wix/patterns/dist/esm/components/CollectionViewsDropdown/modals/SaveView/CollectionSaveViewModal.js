import { Box, Cell, CustomModalLayout, FormField, Input, Layout, Modal, Text, TextButton, } from '@wix/design-system';
import React, { useCallback, useEffect, useState } from 'react';
import { observer } from 'mobx-react-lite';
import { TextWidthLoader } from '../../../TextWidthLoader';
function _CollectionSaveViewModal({ state, ...rest }) {
    const { views: { saveViewModal, collection }, } = state;
    const { translate: t } = collection;
    const [nameInputValue, setNameInputValue] = useState('');
    const [statusMessage, setStatusMessage] = useState();
    const [nameInputStatus, setNameInputStatus] = useState(undefined);
    const [submitted, setSubmitted] = useState(false);
    useEffect(() => {
        if (nameInputValue !== '') {
            setNameInputStatus(undefined);
            setStatusMessage(undefined);
        }
    }, [nameInputValue]);
    useEffect(() => {
        saveViewModal.events.on('open', sendSaveNewViewSelectedBI);
        return () => {
            saveViewModal.events.off('open', sendSaveNewViewSelectedBI);
        };
    }, []);
    const sendSaveNewViewSelectedBI = () => {
        state.sendSaveNewViewSelectedBI();
    };
    const onCloseModal = () => {
        setNameInputStatus(undefined);
        setNameInputValue('');
        saveViewModal.close();
    };
    const primaryButtonOnClick = useCallback(async (event) => {
        event?.preventDefault();
        if (submitted) {
            return;
        }
        if (nameInputValue === '') {
            setNameInputStatus('error');
            setStatusMessage(t('cairo.noViewName.validationTooltip'));
            return;
        }
        setSubmitted(true);
        await state.saveNewView(nameInputValue);
        onCloseModal();
    }, [submitted, nameInputValue]);
    return (React.createElement(Modal, { ...rest, onAfterClose: () => {
            setSubmitted(false);
        }, isOpen: saveViewModal.isOpen },
        React.createElement("form", { onSubmit: primaryButtonOnClick },
            React.createElement(CustomModalLayout, { overflowY: "visible", title: t('cairo.table.saveViewModal.title'), subtitle: React.createElement(Box, null,
                    React.createElement(Text, { secondary: true },
                        t('cairo.table.saveViewModal.body'),
                        state.learnMoreLink && (React.createElement(React.Fragment, null,
                            ' ',
                            React.createElement(TextButton, { as: "a", rel: "noopener", target: "_blank", href: state.learnMoreLink, dataHook: "save-view-modal-learn-more-link" }, t('cairo.table.saveViewModal.learnMoreLink')))))), primaryButtonText: submitted ? undefined : t('cairo.saveViewModal.saveButton'), primaryButtonProps: {
                    children: submitted && (React.createElement(TextWidthLoader, { size: "tiny", text: t('cairo.saveViewModal.saveButton') })),
                }, primaryButtonOnClick: primaryButtonOnClick, secondaryButtonText: t('cairo.saveViewModal.cancelButton'), secondaryButtonOnClick: onCloseModal, onCloseButtonClick: onCloseModal, dataHook: "save-view-modal", width: "510px" },
                React.createElement(Layout, null,
                    React.createElement(Cell, null,
                        React.createElement(FormField, { label: t('cairo.table.saveViewModal.nameLabel'), dataHook: "save-view-modal-form-field" },
                            React.createElement(Input, { autoFocus: true, placeholder: state.viewNamePlaceholder ??
                                    t('cairo.table.saveViewModal.placeholder'), dataHook: "save-view-modal-input", value: nameInputValue, onChange: (e) => setNameInputValue(e.target.value), status: nameInputStatus, statusMessage: statusMessage, maxLength: 50 }))))))));
}
export const CollectionSaveViewModal = observer(_CollectionSaveViewModal);
//# sourceMappingURL=CollectionSaveViewModal.js.map