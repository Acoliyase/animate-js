import { Cell, CustomModalLayout, FormField, Input, Layout, Modal, } from '@wix/design-system';
import React, { useCallback, useEffect, useState } from 'react';
import { observer } from 'mobx-react-lite';
import { TextWidthLoader } from '../../../TextWidthLoader';
function _CollectionRenameViewModal({ state, ...rest }) {
    const { views: { renameViewModal, collection }, } = state;
    const { translate: t } = collection;
    const [nameInputValue, setNameInputValue] = useState(state.views.currentView?.name ?? '');
    const [statusMessage, setStatusMessage] = useState();
    const [nameInputStatus, setNameInputStatus] = useState(undefined);
    const [submitted, setSubmitted] = useState(false);
    useEffect(() => {
        if (nameInputValue !== '') {
            setNameInputStatus(undefined);
            setStatusMessage(undefined);
        }
    }, [nameInputValue]);
    useEffect(() => {
        renameViewModal.events.on('open', onOpenRenameViewModal);
        return () => {
            renameViewModal.events.off('open', onOpenRenameViewModal);
        };
    }, []);
    const onOpenRenameViewModal = () => {
        setNameInputValue(state.views.currentView?.name ?? '');
        state.sendRenameViewSelectedBI();
    };
    const onCloseModal = () => {
        setNameInputStatus(undefined);
        setNameInputValue('');
        renameViewModal.close();
    };
    const primaryButtonOnClick = useCallback(async (event) => {
        event?.preventDefault();
        if (submitted || nameInputValue === state.views.currentView?.name) {
            return;
        }
        if (nameInputValue === '') {
            setNameInputStatus('error');
            setStatusMessage(t('cairo.noViewName.validationTooltip'));
            return;
        }
        setSubmitted(true);
        await state.renameView(nameInputValue);
        onCloseModal();
    }, [submitted, nameInputValue]);
    return (React.createElement(Modal, { ...rest, onAfterClose: () => {
            setSubmitted(false);
        }, isOpen: renameViewModal.isOpen },
        React.createElement("form", { onSubmit: primaryButtonOnClick },
            React.createElement(CustomModalLayout, { overflowY: "visible", title: t('cairo.manageView.Rename.modal.title'), primaryButtonText: submitted ? undefined : t('cairo.manageView.Rename.modal.save.CTA'), primaryButtonProps: {
                    children: submitted && (React.createElement(TextWidthLoader, { size: "tiny", text: t('cairo.manageView.Rename.modal.save.CTA') })),
                    disabled: nameInputValue === state.views.currentView?.name,
                    type: 'submit',
                }, primaryButtonOnClick: primaryButtonOnClick, secondaryButtonText: t('cairo.manageView.Rename.modal.cancel.CTA'), secondaryButtonOnClick: onCloseModal, onCloseButtonClick: onCloseModal, dataHook: "rename-view-modal", width: "510px" },
                React.createElement(Layout, null,
                    React.createElement(Cell, null,
                        React.createElement(FormField, { label: t('cairo.manageView.Rename.modal.field.title'), dataHook: "rename-view-modal-form-field" },
                            React.createElement(Input, { autoFocus: true, dataHook: "rename-view-modal-input", value: nameInputValue, onChange: (e) => setNameInputValue(e.target.value), status: nameInputStatus, statusMessage: statusMessage, maxLength: 50 }))))))));
}
export const CollectionRenameViewModal = observer(_CollectionRenameViewModal);
//# sourceMappingURL=CollectionRenameViewModal.js.map