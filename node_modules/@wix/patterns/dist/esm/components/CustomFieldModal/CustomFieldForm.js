import React, { useEffect } from 'react';
import { observer } from 'mobx-react-lite';
import { Box, Cell, Checkbox, Collapse, Divider, FloatingNotification, FormField, InfoIcon, Input, Layout, Text, TextButton, } from '@wix/design-system';
import { useWixPatternsContainer } from '@wix/bex-core/react';
import { CustomFieldTypeDropdown } from './CustomFieldTypeDropdown';
import { ChevronDown, ChevronUp, InfoCircle } from '@wix/wix-ui-icons-common';
import { Trans } from '../Trans';
import { runInAction } from 'mobx';
import { PiiFormFields } from './CustomFieldFormPiiFields';
export const _CustomFieldForm = (props) => {
    const { state } = props;
    const { form: { $: { key, type, name, readApps, readUsers, writeApps, writeUsers, containsPii, }, }, errorToastConfig, disabledFields: { permissions }, mode, settings, customFieldModalBiReporter, generateUniqueKey, setKeyFieldIfNotDirty, dataExtensionState: { defaultPermissions }, } = state;
    const { reportAdvancedSettingsClick, reportKeyFormFieldChange } = customFieldModalBiReporter;
    const { translate: t, environment: { language }, } = useWixPatternsContainer();
    useEffect(() => customFieldModalBiReporter.init(), []);
    return (React.createElement(Box, { width: 552, direction: "vertical" },
        errorToastConfig && (React.createElement(Box, { position: "absolute", top: "24px", left: "49%", transform: "translateX(-50%)" },
            React.createElement(FloatingNotification, { dataHook: "custom-field-modal-error-state", type: "destructive", prefixIcon: React.createElement(InfoCircle, null), text: errorToastConfig.message, textButtonProps: errorToastConfig?.action && {
                    label: errorToastConfig.action.text,
                    onClick: () => errorToastConfig?.action?.onClick?.(),
                }, onClose: () => {
                    runInAction(() => {
                        state.errorToastConfig = undefined;
                    });
                } }))),
        React.createElement(Box, { paddingLeft: "SP1", paddingRight: "SP1", direction: "vertical" },
            React.createElement(Layout, null,
                React.createElement(Cell, { span: 6 },
                    React.createElement(FormField, { dataHook: "custom-field-modal-field-type", required: true, label: t('cairo.customFields.addCustomField.modal.fieldType'), status: type.hasError ? 'error' : undefined, statusMessage: type.error },
                        React.createElement(CustomFieldTypeDropdown, { state: state }),
                        mode === 'edit' && (React.createElement(Box, { marginTop: "SP1" },
                            React.createElement(Text, { size: "tiny", secondary: true }, t('cairo.customFields.editCustomField.fieldType.tooltip')))))),
                React.createElement(Cell, { span: 6 },
                    React.createElement(FormField, { dataHook: "custom-field-modal-field-name", required: true, label: t('cairo.customFields.addCustomField.modal.fieldName'), status: name.hasError ? 'error' : undefined, statusMessage: name.error },
                        React.createElement(Input, { dataHook: "custom-field-modal-name", onChange: (e) => {
                                name.onChange(e.target.value);
                                setKeyFieldIfNotDirty(generateUniqueKey(e.target.value));
                            }, value: name.value, maxLength: 64, placeholder: state.namePlaceholder }))),
                state.dataExtensionState.containsPii && (React.createElement(PiiFormFields, { containsPii: {
                        value: containsPii.value,
                        onChange: containsPii.onChange,
                    }, mode: mode, language: language }))),
            React.createElement(Box, { marginTop: "SP4" },
                React.createElement(TextButton, { dataHook: "custom-field-modal-settings-button", size: "small", suffixIcon: settings.isOn ? React.createElement(ChevronUp, null) : React.createElement(ChevronDown, null), onClick: () => settings.toggle() }, t('cairo.customFields.addCustomField.modal.advancedSettings'))),
            React.createElement(Collapse, { open: settings.isOn, onExpandAnimationEnd: () => {
                    reportAdvancedSettingsClick('Open');
                }, onCollapseAnimationEnd: () => {
                    reportAdvancedSettingsClick('Close');
                } },
                (!defaultPermissions?.installedApps?.hide ||
                    !defaultPermissions?.siteVisitors?.hide) && (React.createElement(Box, { marginTop: "SP4", direction: "vertical", width: "320px" },
                    React.createElement(Text, { size: "small" }, t('cairo.customFields.addCustomField.modal.advancedSettings.readPermissions')),
                    React.createElement(Text, { size: "tiny", light: true, secondary: true }, t('cairo.customFields.addCustomField.modal.advancedSettings.readPermissions.tooltip')))),
                !defaultPermissions?.installedApps?.hide && (React.createElement(Box, { marginTop: "SP3", dataHook: "custom-field-modal-apps-section" },
                    React.createElement(Layout, null,
                        React.createElement(Cell, { span: 4 },
                            React.createElement(Box, { verticalAlign: "middle", gap: "SP1" },
                                React.createElement(Text, { size: "small" }, t('cairo.customFields.addCustomField.modal.advancedSettings.externalApps')),
                                React.createElement(InfoIcon, { size: "small", content: React.createElement(Trans, { i18nKey: "cairo.customFields.addCustomField.modal.advancedSettings.externalApps.tooltip" }) }))),
                        React.createElement(Cell, { span: 2 },
                            React.createElement(Checkbox, { dataHook: "custom-field-modal-read-apps", disabled: mode === 'edit' && permissions.read.apps, size: "small", onChange: () => {
                                    readApps.onChange(!readApps.value);
                                }, checked: readApps.value }, t('cairo.customFields.addCustomField.modal.advancedSettings.read'))),
                        React.createElement(Cell, { span: 2 },
                            React.createElement(Checkbox, { dataHook: "custom-field-modal-write-apps", disabled: mode === 'edit' && permissions.write.apps, size: "small", onChange: () => {
                                    writeApps.onChange(!writeApps.value);
                                }, checked: writeApps.value }, t('cairo.customFields.addCustomField.modal.advancedSettings.write')))))),
                !defaultPermissions?.siteVisitors?.hide && (React.createElement(React.Fragment, null,
                    React.createElement(Box, { marginTop: "SP2", dataHook: "custom-field-modal-users-section" },
                        React.createElement(Layout, null,
                            React.createElement(Cell, { span: 4 },
                                React.createElement(Box, { verticalAlign: "middle", gap: "SP1" },
                                    React.createElement(Text, { size: "small" }, t('cairo.customFields.addCustomField.modal.advancedSettings.siteVisitors')),
                                    React.createElement(InfoIcon, { size: "small", content: React.createElement(Trans, { i18nKey: "cairo.customFields.addCustomField.modal.advancedSettings.siteVisitors.tooltip", components: {
                                                learnMore: (React.createElement(TextButton, { underline: "always", skin: "light", size: "small", as: "a", rel: "noopener", target: "_blank", href: `https://support.wix.com/${language}/article/cms-about-datasets` })),
                                            } }) }))),
                            React.createElement(Cell, { span: 2 },
                                React.createElement(Checkbox, { dataHook: "custom-field-modal-read-users", disabled: mode === 'edit' && permissions.read.users, size: "small", onChange: () => {
                                        readUsers.onChange(!readUsers.value);
                                    }, checked: readUsers.value }, t('cairo.customFields.addCustomField.modal.advancedSettings.read'))),
                            React.createElement(Cell, { span: 2 },
                                React.createElement(Checkbox, { dataHook: "custom-field-modal-write-users", disabled: mode === 'edit' && permissions.write.users, size: "small", onChange: () => {
                                        writeUsers.onChange(!writeUsers.value);
                                    }, checked: writeUsers.value }, t('cairo.customFields.addCustomField.modal.advancedSettings.write'))))),
                    React.createElement(Box, null,
                        React.createElement(Text, { size: "tiny", light: true, secondary: true, dataHook: "permissions-note" },
                            React.createElement(Trans, { i18nKey: "cairo.customFields.addCustomField.modal.advancedSettings.siteVisitors.note", components: {
                                    learnMore: (React.createElement(TextButton, { size: "tiny", as: "a", rel: "noopener", target: "_blank", href: `https://support.wix.com/${language}/article/content-manager-connecting-elements-to-a-collection-using-a-dataset` })),
                                } }))))),
                React.createElement(Box, { direction: "vertical" },
                    React.createElement(Box, { marginTop: "SP3", marginBottom: "SP3" },
                        React.createElement(Divider, null)),
                    React.createElement(FormField, { dataHook: "custom-field-modal-field-key", required: true, label: t('cairo.customFields.addCustomField.modal.advancedSettings.key.title'), status: key.hasError ? 'error' : undefined, statusMessage: key.error },
                        React.createElement(Layout, null,
                            React.createElement(Cell, { span: 6 },
                                React.createElement(Input, { dataHook: "custom-field-modal-key", disabled: mode === 'edit', value: key.value, onChange: (e) => {
                                        key.onChange(e.target.value.toLowerCase());
                                        reportKeyFormFieldChange();
                                    }, placeholder: t('cairo.customFields.addCustomField.modal.advancedSettings.key.placeholder') })))),
                    !key.hasError && (React.createElement(Box, { marginTop: "SP1" },
                        React.createElement(Text, { size: "tiny", secondary: true, dataHook: "custom-field-modal-fieldKey-tooltip" }, mode === 'new'
                            ? t('cairo.customFields.addCustomField.modal.advancedSettings.key.tooltip')
                            : t('cairo.customFields.editCustomField.fieldKey.tooltip')))))))));
};
export const CustomFieldForm = observer(_CustomFieldForm);
//# sourceMappingURL=CustomFieldForm.js.map