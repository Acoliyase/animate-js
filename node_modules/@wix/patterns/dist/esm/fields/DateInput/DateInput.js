import React, { useRef, useState } from 'react';
import { FormField, DatePicker } from '@wix/design-system';
import { Field } from '../Field';
import { dataHooks } from '../dataHooks';
import { useCustomFieldsFormContext } from '../../components/CustomFieldsFormContext';
import { getDateWithoutTimezone, getISODateStringWithFixedTimezone, } from '../../utils/datesUtil';
export const DateInput = ({ dataHook, schema, initialValue, inputRef, onChange, }) => {
    const [date, setDate] = useState(() => initialValue
        ? getDateWithoutTimezone(getISODateStringWithFixedTimezone(initialValue))
        : undefined);
    const ref = useRef({});
    const [statusMessage, setStatusMessage] = useState('');
    const formState = useCustomFieldsFormContext();
    return (React.createElement(Field, { dataHook: dataHook, type: schema.type },
        React.createElement(FormField, { dataHook: dataHooks.Label, label: schema.label },
            React.createElement(DatePicker, { ref: (internalRef) => {
                    inputRef?.(ref.current);
                    // TODO: PR to WSR needed to expose as public API
                    // @ts-expect-error
                    ref.current.focus = () => internalRef?.state?.inputRef?.focus?.();
                }, dataHook: dataHooks.Input, width: "100%", value: date, onChange: (newValue) => {
                    const formatedDate = getISODateStringWithFixedTimezone(newValue);
                    setDate(newValue);
                    onChange(formatedDate.split('T')[0]);
                }, onValidate: ({ validationType, value, format }) => {
                    if (validationType === 'valid') {
                        setStatusMessage('');
                        ref.current.invalid = false;
                    }
                    else if (validationType === 'formatError' && value === '') {
                        setDate(undefined);
                        onChange(null);
                        setStatusMessage('');
                        ref.current.invalid = false;
                    }
                    else {
                        setStatusMessage(formState._translate('cairo.customFields.fieldType.date.invalid.value', { dateFormat: format ?? '' }));
                        ref.current.invalid = true;
                    }
                }, status: ref.current.invalid ? 'error' : undefined, statusMessage: statusMessage }))));
};
//# sourceMappingURL=DateInput.js.map