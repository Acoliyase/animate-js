{"version":3,"sources":["webpack://image-client-api/webpack/universalModuleDefinition","webpack://image-client-api/webpack/bootstrap","webpack://image-client-api/./src/helpers/imageServiceConstants.js","webpack://image-client-api/./src/helpers/imageServiceUtils.js","webpack://image-client-api/./src/helpers/utils.js","webpack://image-client-api/./src/api/transform.js","webpack://image-client-api/./src/helpers/imageServiceFeatureSupportObject.js","webpack://image-client-api/./src/helpers/imageTransformParts.js","webpack://image-client-api/./src/helpers/imageTransformOptions.js","webpack://image-client-api/./src/api/uri.js","webpack://image-client-api/./src/engines/transforms.js","webpack://image-client-api/./src/sdk/index.js","webpack://image-client-api/./src/api/uri/index.js"],"names":["root","factory","exports","module","define","amd","this","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","fileType","JPG","JPEG","PNG","WEBP","WIX_ICO_MP","WIX_MP","GIF","SVG","UNRECOGNIZED","supportedExtensions","alignTypes","CENTER","TOP","TOP_LEFT","TOP_RIGHT","BOTTOM","BOTTOM_LEFT","BOTTOM_RIGHT","LEFT","RIGHT","alignTypesMap","center","top","top_left","top_right","bottom","bottom_left","bottom_right","left","right","transformTypes","FIT","FILL","FILL_FOCAL","CROP","LEGACY_CROP","LEGACY_FILL","fittingTypes","SCALE_TO_FILL","SCALE_TO_FIT","STRETCH","ORIGINAL_SIZE","TILE","TILE_HORIZONTAL","TILE_VERTICAL","FIT_AND_TILE","LEGACY_STRIP_TILE","LEGACY_STRIP_TILE_HORIZONTAL","LEGACY_STRIP_TILE_VERTICAL","LEGACY_STRIP_SCALE_TO_FILL","LEGACY_STRIP_SCALE_TO_FIT","LEGACY_STRIP_FIT_AND_TILE","LEGACY_STRIP_ORIGINAL_SIZE","LEGACY_ORIGINAL_SIZE","LEGACY_FIT_WIDTH","LEGACY_FIT_HEIGHT","LEGACY_FULL","LEGACY_BG_FIT_AND_TILE","LEGACY_BG_FIT_AND_TILE_HORIZONTAL","LEGACY_BG_FIT_AND_TILE_VERTICAL","LEGACY_BG_NORMAL","htmlTag","BG","IMG","upscaleMethods","AUTO","CLASSIC","SUPER","upscaleMethodsValues","classic","super","defaultUSM","radius","amount","threshold","emptyData","uri","css","img","container","attr","imageQuality","HIGH","MEDIUM","LOW","TINY","imageFilters","CONTRAST","BRIGHTNESS","SATURATION","HUE","BLUR","imageScaleDefaults","size","quality","maxUpscale","webp","LOSSLESS","LOSSY","ALPHA","ANIMATION","SAFE_TRANSFORMED_AREA","MAX_TRANSFORMED_IMAGE_WIDTH","SUPER_UPSCALE_MODELS","MAX_DEVICE_PIXEL_RATIO","API_VERSION","utils","require","constants","globalFeatureSupportObject","checkWEBPSupport","type","webpImg","window","Image","onload","isWebpFeature","getFeature","width","height","setFeature","src","lossy","lossless","alpha","animation","isImageTypeSupported","supportedImageExtensions","includes","getFileExtension","isWEBP","isExternalUrl","url","test","exec","toLowerCase","getScaleFactor","sWidth","sHeight","dWidth","dHeight","transformType","Math","max","getFillScaleFactor","min","getFitScaleFactor","getClassicScaleData","imageKey","getImageQualityKey","optimizedScaleFactor","upscaleMethodValue","forceUSM","getAutoScaleData","getSuperScaleData","scaleFactor","last","imageWidth","imageHeight","roundToFixed","precision","truncatePrecision","pow","toFixed","parseInt","populateGlobalFeatureSupport","document","documentElement","style","isWEBPBrowserSupport","isLosssyJPG","isLosslessPNG","isAlphaPNG","isObjectFitBrowserSupport","isImageTransformApplicable","isValidRequest","fittingType","target","id","trim","getFileType","isJPG","isPNG","getFileName","fileExtensionRegexp","length","illegalChars","map","encodeURIComponent","illegalCharsRegex","RegExp","concat","join","fileName","extension","match","replace","trimmed","getAlignedRect","sRect","dRect","alignment","x","y","getOverlappingRect","getTransformData","upscaleMethod","DAR","pixelAspectRatio","getDevicePixelRatio","_getSafeTransformData","dimensionScaleFactor","sqrt","getSafeTransformData","tWidth","tHeight","_getOptimizedScaleDat","auto","getOptimizedScaleData","cssUpscaleNeeded","getOptimizedTransformData","getAlignment","getPreferredImageQuality","getDimension","round","getFocalPoint","focalPoint","fp","isNaN","getUpscaleString","options","toUpperCase","assign","arguments","sources","Array","slice","source","prop","indexOf","_typeof","keys","some","array","template","string","data","result","imageServiceUtils","transformParts","transformOptions","transformsObj","fileExtension","isWEBPSupport","isCropped","parts","progressive","watermark","unsharpMask","filters","setTransformParts","setTransformOptions","globalFeaturesSupportObj","isObjectFitBrowser","feature","getFitPart","transformedData","upscale","getCropPart","rect","crop","cropped","push","focalPointX","focalPointY","getFillPart","clonedTarget","getStretchPart","getLegacyCropPart","getLegacyFitPart","getLegacyFillPart","isValidImageFilter","filterValue","minValue","maxValue","transformData","defaultQuality","getQuality","getProgressive","getWatermark","usm","isUSMValid","isZeroUSM","transformPart","isUSMNeeded","getUnsharpMask","filterOptions","getFilters","transforms","transform","transformObj","getImageURI","fitTemplate","fillTemplate","fillFocalTemplate","cropTemplate","legacyCropTemplate","legacyFillTemplate","upscaleTemplate","qualityTemplate","unSharpMaskTemplate","nonProgressiveTemplate","watermarkTemplate","filterTemplatesMap","_filterTemplatesMap","transformsObjStrArr","forEach","legacyFillStr","fitStr","fillStr","fillFocalStr","transformsStr","filterName","imageClientApi","wixStatic","wixStaticWithMedia","HAS_MEDIA_PREFIX_RE","devicePixelRatio","getURL","getScaleToFitImageURL","relativeUrl","sourceWidth","sourceHeight","targetWidth","targetHeight","getData","getScaleToFillImageURL","getCropImageURL","cropX","cropY","cropWidth","cropHeight","getURI"],"mappings":"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","file":"imageClientSDK.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"imageClientSDK\"] = factory();\n\telse\n\t\troot[\"imageClientSDK\"] = factory();\n})(this, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 15);\n","'use strict'\n\n/**\n * image service api version\n */\nconst API_VERSION = 'v1'\n\n\n/*\nthe maximum retina factor\n */\nconst MAX_DEVICE_PIXEL_RATIO = 2\n\n/**\n * Enum string values of requested image fitting types\n * Note: TILE_HORIZONTAL, TILE_VERTICAL, FIT_AND_TILE are supported for legacy purposes but are not exposed\n * in the documentation because they should not be exposed for new features\n * @type {{SCALE_TO_FILL: string, SCALE_TO_FIT: string, TILE: string, ORIGINAL_SIZE: string, STRETCH: string}}\n */\nconst fittingTypes = {\n    SCALE_TO_FILL: 'fill',\n    SCALE_TO_FIT: 'fit',\n    STRETCH: 'stretch',\n    ORIGINAL_SIZE: 'original_size',\n    TILE: 'tile',\n    TILE_HORIZONTAL: 'tile_horizontal',\n    TILE_VERTICAL: 'tile_vertical',\n    FIT_AND_TILE: 'fit_and_tile',\n    LEGACY_STRIP_TILE: 'legacy_strip_tile',\n    LEGACY_STRIP_TILE_HORIZONTAL: 'legacy_strip_tile_horizontal',\n    LEGACY_STRIP_TILE_VERTICAL: 'legacy_strip_tile_vertical',\n    LEGACY_STRIP_SCALE_TO_FILL: 'legacy_strip_fill',\n    LEGACY_STRIP_SCALE_TO_FIT: 'legacy_strip_fit',\n    LEGACY_STRIP_FIT_AND_TILE: 'legacy_strip_fit_and_tile',\n    LEGACY_STRIP_ORIGINAL_SIZE: 'legacy_strip_original_size',\n    LEGACY_ORIGINAL_SIZE: 'actual_size',\n    LEGACY_FIT_WIDTH: 'fitWidth',\n    LEGACY_FIT_HEIGHT: 'fitHeight',\n    LEGACY_FULL: 'full',\n    LEGACY_BG_FIT_AND_TILE: 'legacy_tile',\n    LEGACY_BG_FIT_AND_TILE_HORIZONTAL: 'legacy_tile_horizontal',\n    LEGACY_BG_FIT_AND_TILE_VERTICAL: 'legacy_tile_vertical',\n    LEGACY_BG_NORMAL: 'legacy_normal'\n}\n\n/**\n * Enum string values of image transform types as passed to the image service api\n */\nconst transformTypes = {\n    FIT: 'fit',\n    FILL: 'fill',\n    FILL_FOCAL: 'fill_focal',\n    CROP: 'crop',\n    LEGACY_CROP: 'legacy_crop',\n    LEGACY_FILL: 'legacy_fill'\n}\n\n/**\n * Enum string values of requested image align types\n * @type {{CENTER: string, RIGHT: string, LEFT: string, TOP: string, BOTTOM: string, TOP_RIGHT: string, TOP_LEFT: string, BOTTOM_RIGHT: string, BOTTOM_LEFT: string}}\n */\nconst alignTypes = {\n    CENTER: 'center',\n    TOP: 'top',\n    TOP_LEFT: 'top_left',\n    TOP_RIGHT: 'top_right',\n    BOTTOM: 'bottom',\n    BOTTOM_LEFT: 'bottom_left',\n    BOTTOM_RIGHT: 'bottom_right',\n    LEFT: 'left',\n    RIGHT: 'right'\n}\n\n/**\n * Enum string values of image align types as passed to the image service\n */\nconst alignTypesMap = {\n    center: 'c',\n    top: 't',\n    top_left: 'tl',\n    top_right: 'tr',\n    bottom: 'b',\n    bottom_left: 'bl',\n    bottom_right: 'br',\n    left: 'l',\n    right: 'r'\n}\n\n/**\n * Enum string values of html tag used to construct the css or svg attributes\n *  @type {{BG: string, IMG: string, SVG: string}}\n */\nconst htmlTag = {\n    BG: 'bg',\n    IMG: 'img',\n    SVG: 'svg'\n}\n\n/**\n * Enum string values of upscale method\n *  @type {{DEFAULT: string, SUPER: string}}\n */\nconst upscaleMethods = {\n    AUTO: 'auto',\n    CLASSIC: 'classic',\n    SUPER: 'super'\n}\n\n/**\n *  api values of upscale method\n *  @type {{default: number, super: number}}\n */\nconst upscaleMethodsValues = {\n    classic: 1,\n    super: 2\n}\n\n\n/**\n * default unsharp mask values\n *  @type {{radius: number, amount: number, threshold: number}}\n */\nconst defaultUSM = {\n    radius: 0.66,\n    amount: 1.0,\n    threshold: 0.01\n}\n\n/**\n * default empty data\n *  @type {{uri: '', css: {img: {}, container: {}}, attr: {img: {}, container: {}}}}\n */\nconst emptyData = {\n    uri: '',\n    css: {\n        img: {},\n        container: {}\n    },\n    attr: {\n        img: {},\n        container: {}\n    }\n}\n\nconst MAX_TRANSFORMED_IMAGE_WIDTH = 5000\nconst MAX_TRANSFORMED_IMAGE_HEIGHT = 5000\nconst SAFE_TRANSFORMED_AREA = MAX_TRANSFORMED_IMAGE_WIDTH * MAX_TRANSFORMED_IMAGE_HEIGHT\n\n/**\n * super res machine learning upscale factor models -\n * @type {number[]}\n */\nconst SUPER_UPSCALE_MODELS = [1.5, 2, 4]\n\n/**\n * image qualities\n */\nconst imageScaleDefaults = {\n    HIGH: {\n        size: 1400 * 1400,\n        quality: 90,\n        maxUpscale: 1\n    },\n    MEDIUM: {\n        size: 600 * 600,\n        quality: 85,\n        maxUpscale: 1\n    },\n    LOW: {\n        size: 400 * 400,\n        quality: 80,\n        maxUpscale: 1.2\n    },\n    TINY: {\n        size: 0,\n        quality: 80,\n        maxUpscale: 1.4\n    }\n}\n\n/**\n * image quality\n * @type {{HIGH: string, MEDIUM: string, LOW: string, TINY: string}}\n */\nconst imageQuality = {\n    HIGH: 'HIGH',\n    MEDIUM: 'MEDIUM',\n    LOW: 'LOW',\n    TINY: 'TINY'\n}\n\n/**\n * image filters\n * @type {{CONTRAST: string, BRIGHTNESS: string, SATURATION: string, HUE: string, BLUR: string}}\n */\nconst imageFilters = {\n    CONTRAST: 'contrast',\n    BRIGHTNESS: 'brightness',\n    SATURATION: 'saturation',\n    HUE: 'hue',\n    BLUR: 'blur'\n}\n\n\nconst fileType = {\n    JPG: 'jpg',\n    JPEG: 'jpeg',\n    PNG: 'png',\n    WEBP: 'webp',\n    WIX_ICO_MP: 'wix_ico_mp',\n    WIX_MP: 'wix_mp',\n    GIF: 'gif',\n    SVG: 'svg',\n    UNRECOGNIZED: 'unrecognized'\n}\n\nconst supportedExtensions = [fileType.JPG, fileType.JPEG, fileType.PNG, fileType.GIF, fileType.WEBP]\n\nconst webp = {\n    LOSSLESS: 'lossless',\n    LOSSY: 'lossy',\n    ALPHA: 'alpha',\n    ANIMATION: 'animation'\n}\n\nmodule.exports = {\n    alignTypes,\n    alignTypesMap,\n    transformTypes,\n    fittingTypes,\n    htmlTag,\n    upscaleMethods,\n    upscaleMethodsValues,\n    defaultUSM,\n    emptyData,\n    imageQuality,\n    imageFilters,\n    imageScaleDefaults,\n    fileType,\n    supportedExtensions,\n    webp,\n    SAFE_TRANSFORMED_AREA,\n    SUPER_UPSCALE_MODELS,\n    MAX_DEVICE_PIXEL_RATIO,\n    API_VERSION\n\n}\n","'use strict'\nconst utils = require('./utils')\nconst constants = require('./imageServiceConstants')\nconst globalFeatureSupportObject = require('./imageServiceFeatureSupportObject')\n\n/**\n * Check once for browser support and store on global features support object\n * https://developers.google.com/speed/webp/faq#how_can_i_detect_browser_support_using_javascript\n */\nfunction checkWEBPSupport(type) {\n    const webpTypes = {\n        lossy: 'UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA',\n        lossless: 'UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==',\n        alpha: 'UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==',\n        animation: 'UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA'\n    }\n\n    const webpImg = new window.Image()\n    webpImg.onload = function () {\n        const isWebpFeature = globalFeatureSupportObject.getFeature('isWEBP')\n        isWebpFeature[type] = webpImg.width > 0 && webpImg.height > 0\n        globalFeatureSupportObject.setFeature('isWEBP', isWebpFeature)\n    }\n\n    webpImg.src = `data:image/webp;base64,${webpTypes[type]}`\n}\n\n/**\n * Populate the global feature support object with browser specific values\n */\nfunction populateGlobalFeatureSupport() {\n    if (typeof window !== 'undefined') {\n        // jpg 2 webp\n        checkWEBPSupport(constants.webp.LOSSY)\n        // png 2 webp\n        checkWEBPSupport(constants.webp.LOSSLESS)\n        checkWEBPSupport(constants.webp.ALPHA)\n        // 2 animation\n        checkWEBPSupport(constants.webp.ANIMATION)\n\n        // objectfit support\n        globalFeatureSupportObject.setFeature('isObjectFitBrowser', isPropertySupported('objectFit'))\n    }\n}\n\n/**\n * check if the browser supports webp image display\n * for the image source type\n * @param {string}    fileType\n *\n * @returns {boolean}\n */\nfunction isWEBPBrowserSupport(fileType) {\n    const isWebpFeature = globalFeatureSupportObject.getFeature('isWEBP')\n    const isLosssyJPG = fileType === constants.fileType.JPG && isWebpFeature[constants.webp.LOSSY]\n    const isLosslessPNG = fileType === constants.fileType.PNG && isWebpFeature[constants.webp.LOSSLESS]\n    const isAlphaPNG = fileType === constants.fileType.PNG && isWebpFeature[constants.webp.ALPHA]\n\n    return isLosssyJPG || isLosslessPNG && isAlphaPNG\n}\n\n/**\n * check if the browser supports ObjectFit css attribute\n *\n * @returns {boolean}\n */\nfunction isObjectFitBrowserSupport() {\n    return globalFeatureSupportObject.getFeature('isObjectFitBrowser')\n}\n\n/**\n * returns if a css property is supported\n * @param property\n *\n * @returns {boolean}\n */\nfunction isPropertySupported(property) {\n    return property in window.document.documentElement.style\n}\n\n/**\n * checks if image type is supported\n * @param {string}     uri      image source uri\n *\n * @returns {boolean}\n */\nfunction isImageTypeSupported(uri) {\n    const supportedImageExtensions = [\n        constants.fileType.PNG,\n        constants.fileType.JPEG,\n        constants.fileType.JPG,\n        constants.fileType.WIX_ICO_MP,\n        constants.fileType.WIX_MP\n    ]\n    return utils.includes(supportedImageExtensions, getFileExtension(uri))\n}\n\n/**\n * check request integrity\n * @param {string}                  fittingType         imageService.fittingTypes\n * @param {ImageTransformSource}    src\n * @param {ImageTransformTarget}    target\n *\n * @returns {boolean}\n */\nfunction isValidRequest(fittingType, src, target) {\n    return target && (src && !isUrlEmptyOrNone(src.id)) && utils.includes(constants.fittingTypes, fittingType)\n}\n\n/**\n * check if image transform is supported for source image\n * @param {string}     uri\n *\n * @returns {boolean}\n */\nfunction isImageTransformApplicable(uri) {\n    return isImageTypeSupported(uri) && !isExternalUrl(uri)\n}\n\n/**\n * returns true if image is of JPG type\n * @param {string}  uri\n *\n * @returns {boolean}\n */\nfunction isJPG(uri) {\n    return utils.includes(['jpg', 'jpeg'], getFileExtension(uri))\n}\n\n/**\n * returns true if image is of PNG type\n * @param {string}  uri\n *\n * @returns {boolean}\n */\nfunction isPNG(uri) {\n    return utils.includes(['png'], getFileExtension(uri))\n}\n\n/**\n * returns true if image is of webP type\n * @param {string}  uri\n *\n * @returns {boolean}\n */\nfunction isWEBP(uri) {\n    return utils.includes(['webp'], getFileExtension(uri))\n}\n\n/**\n * returns true if the url starts with http, https, // or data\n * @param {string}  url\n *\n * @returns {boolean}\n */\nfunction isExternalUrl(url) {\n    return (/(^https?)|(^data)|(^\\/\\/)/).test(url)\n}\n\n/**\n * returns true if the url empty or none string\n * @param {string}  url\n *\n * @returns {boolean}\n */\nfunction isUrlEmptyOrNone(url) {\n    return !url || !url.trim() || url.toLowerCase() === 'none'\n}\n\n/**\n * returns source image file name (no extension)\n * @param {string}     uri      image source uri\n * @param {string}     [name]   optional image source name\n *\n * @returns {string}\n */\nfunction getFileName(uri, name) {\n    const beforeLeadingSlashRegexp = /\\/(.*?)$/\n    const fileExtensionRegexp = /\\.([^.]*)$/\n\n    // if name is a non empty string, remove only supported extension if exists and url encode the string\n    if (typeof name === 'string' && name.length) {\n        //https://jira.wixpress.com/browse/WEED-12667\n        //const illegalChars = ['/', '\\\\', '#', '^', '?', '{', '}', '<', '>', '|', '`', '“', ':', '\"'].map(encodeURIComponent)\n        const illegalChars = ['/', '\\\\', '?', '<', '>', '|', '“', ':', '\"'].map(encodeURIComponent)\n        const urlSafeIllegalChars = ['\\\\.', '\\\\*']\n        const illegalCharsRegex = new RegExp(`(${illegalChars.concat(urlSafeIllegalChars).join('|')})`, 'g')\n        const illegalCharsReplacement = '_'\n\n        let fileName = name\n\n        const extension = name.match(fileExtensionRegexp)\n\n        if (extension && utils.includes(constants.supportedExtensions, extension[1])) {\n            fileName = name.replace(fileExtensionRegexp, '')\n        }\n        return encodeURIComponent(fileName).replace(illegalCharsRegex, illegalCharsReplacement)\n    }\n\n    // else, trim any preceding media structure from the uri string (like \"media/\" etc.) and remove extension\n    const trimmed = uri.match(beforeLeadingSlashRegexp)\n    const fileName = trimmed ? trimmed[1] : uri\n    return fileName.replace(fileExtensionRegexp, '')\n}\n\n/**\n * returns source image file name (no extension)\n * @param {string}     uri      image source uri\n *\n * @returns {string}\n */\nfunction getFileType(uri) {\n    if (isJPG(uri)) {\n        return constants.fileType.JPG\n    } else if (isPNG(uri)) {\n        return constants.fileType.PNG\n    } else if (isWEBP(uri)) {\n        return constants.fileType.WEBP\n    }\n    return constants.fileType.UNRECOGNIZED\n}\n\n/**\n * returns source image file extension\n * @param {string}     uri      image source uri\n *\n * @returns {string}\n */\nfunction getFileExtension(uri) {\n    const splitURI = /[.]([^.]+)$/.exec(uri)\n    return (splitURI && /[.]([^.]+)$/.exec(uri)[1] || '').toLowerCase()\n}\n\n/**\n * returns scale factor needed if FIT fitting\n * @param {number}  sWidth\n * @param {number}  sHeight\n * @param {number}  dWidth\n * @param {number}  dHeight\n *\n * @returns {number}\n */\nfunction getFitScaleFactor(sWidth, sHeight, dWidth, dHeight) {\n    return Math.min(dWidth / sWidth, dHeight / sHeight)\n}\n\n/**\n * returns scale factor needed if FILL fitting\n * @param {number}  sWidth\n * @param {number}  sHeight\n * @param {number}  dWidth\n * @param {number}  dHeight\n *\n * @returns {number}\n */\nfunction getFillScaleFactor(sWidth, sHeight, dWidth, dHeight) {\n    return Math.max(dWidth / sWidth, dHeight / sHeight)\n}\n\n/**\n * returns scale factor source target\n * @param {number}  sWidth\n * @param {number}  sHeight\n * @param {number}  dWidth\n * @param {number}  dHeight\n * @param {string}  transformType\n *\n * @returns {number}\n */\nfunction getScaleFactor(sWidth, sHeight, dWidth, dHeight, transformType) {\n    let scaleFactor\n    if (transformType === constants.transformTypes.FILL) {\n        scaleFactor = getFillScaleFactor(sWidth, sHeight, dWidth, dHeight)\n    } else if (transformType === constants.transformTypes.FIT) {\n        scaleFactor = getFitScaleFactor(sWidth, sHeight, dWidth, dHeight)\n    } else {\n        scaleFactor = 1\n    }\n    return scaleFactor\n}\n\n\n/**\n * get calculated scale factor , width and height while considering wixmp image transform dimension limits\n * @param sWidth\n * @param sHeight\n * @param dWidth\n * @param dHeight\n * @param transformType\n * @returns {{scaleFactor: *, width: *, height: *}}\n */\nfunction getSafeTransformData(sWidth, sHeight, dWidth, dHeight, transformType) {\n    let scaleFactor\n    let width\n    let height\n\n\n    // calculate safe image transformed area\n    scaleFactor = getScaleFactor(sWidth, sHeight, dWidth, dHeight, transformType)\n    if (transformType === constants.transformTypes.FILL) {\n        width = dWidth\n        height = dHeight\n    } else if (transformType === constants.transformTypes.FIT) {\n        width = sWidth * scaleFactor\n        height = sHeight * scaleFactor\n    }\n\n    // adjust target width & height & scaleFactor\n    if (width * height > constants.SAFE_TRANSFORMED_AREA) {\n        const dimensionScaleFactor = Math.sqrt(constants.SAFE_TRANSFORMED_AREA / (width * height))\n        width *= dimensionScaleFactor\n        height *= dimensionScaleFactor\n        //get the new scale factor\n        scaleFactor = getScaleFactor(sWidth, sHeight, width, height, transformType)\n    }\n\n    return {\n        scaleFactor,\n        width,\n        height\n    }\n}\n\n\n\n/**\n * returns the destination rectangle\n * @param {number}                  sWidth\n * @param {number}                  sHeight\n * @param {ImageTransformTarget}    target\n * @param {string}                  transformType\n * @param {string}                  upscaleMethod\n *\n * @returns {object}                {width, height, scaleFactor, upscaleMethodValue, forceUSM, cssUpscaleNeeded}\n */\nfunction getTransformData(sWidth, sHeight, target, transformType, upscaleMethod) {\n    //use target dimension is src not provided\n    sWidth = sWidth || target.width\n    sHeight = sHeight || target.height\n    // device pixel aspect ratio\n    const DAR = getDevicePixelRatio(target)\n\n    // adjust image transform values considering server side transform limitations and performance\n    const {scaleFactor, width, height} = getSafeTransformData(sWidth, sHeight, target.width * DAR, target.height * DAR, transformType)\n\n    // adjust image transform values to optimizing upsacle quality and payload\n    return getOptimizedTransformData(sWidth, sHeight, width, height, upscaleMethod, scaleFactor, transformType)\n}\n\n/**\n * returns overlapping rectangle where sRect\n * id aligned (according to alignment) within dRect\n * @param {object}      sRect         rect 1\n * @param {object}      dRect         rect 2\n * @param {string}      alignment\n *\n * @returns {{x:number,y:number,width:number, height:number}}\n */\nfunction getAlignedRect(sRect, dRect, alignment) {\n    let x\n    let y\n\n    // calculate cropping x,y\n    switch (alignment) {\n        case constants.alignTypes.CENTER:\n            x = Math.max(0, (sRect.width - dRect.width) / 2)\n            y = Math.max(0, (sRect.height - dRect.height) / 2)\n            break\n        case constants.alignTypes.TOP:\n            x = Math.max(0, (sRect.width - dRect.width) / 2)\n            y = 0\n            break\n        case constants.alignTypes.TOP_LEFT:\n            x = 0\n            y = 0\n            break\n        case constants.alignTypes.TOP_RIGHT:\n            x = Math.max(0, sRect.width - dRect.width)\n            y = 0\n            break\n        case constants.alignTypes.BOTTOM:\n            x = Math.max(0, (sRect.width - dRect.width) / 2)\n            y = Math.max(0, sRect.height - dRect.height)\n            break\n        case constants.alignTypes.BOTTOM_LEFT:\n            x = 0\n            y = Math.max(0, sRect.height - dRect.height)\n            break\n        case constants.alignTypes.BOTTOM_RIGHT:\n            x = Math.max(0, sRect.width - dRect.width)\n            y = Math.max(0, sRect.height - dRect.height)\n            break\n        case constants.alignTypes.LEFT:\n            x = 0\n            y = Math.max(0, (sRect.height - dRect.height) / 2)\n            break\n        case constants.alignTypes.RIGHT:\n            x = Math.max(0, sRect.width - dRect.width)\n            y = Math.max(0, (sRect.height - dRect.height) / 2)\n            break\n    }\n\n    // rect\n    return {\n        x: sRect.x ? sRect.x + x : x,\n        y: sRect.y ? sRect.y + y : y,\n        width: Math.min(sRect.width, dRect.width),\n        height: Math.min(sRect.height, dRect.height)\n    }\n}\n\n/**\n * returns overlapping rectangle between sRect and dRect\n * @param {object}      sRect         rect 1\n * @param {object}      dRect         rect 2\n *\n * @returns {{x:number,y:number,width:number, height:number} || null}\n */\nfunction getOverlappingRect(sRect, dRect) {\n    const width = Math.max(0, Math.min(sRect.width, dRect.x + dRect.width) - Math.max(0, dRect.x))\n    const height = Math.max(0, Math.min(sRect.height, dRect.y + dRect.height) - Math.max(0, dRect.y))\n\n\n    const isValidRect = width && height && (sRect.width !== width || sRect.height !== height)\n\n    // return overlapping sRect/dRect rectangle(x, y, width, height)\n    return isValidRect ? {\n        x: Math.max(0, dRect.x),\n        y: Math.max(0, dRect.y),\n        width,\n        height\n    } : null\n}\n\n/**\n * returns pixel aspect ratio value\n * @param {ImageTransformTarget}    target\n *\n * @returns {number}\n */\nfunction getDevicePixelRatio(target) {\n    return Math.min(target.pixelAspectRatio || 1, constants.MAX_DEVICE_PIXEL_RATIO)\n}\n\n/**\n * returns target alignment value\n * @param {ImageTransformTarget}    target\n *\n * @returns {string}\n */\nfunction getAlignment(target) {\n    return constants.alignTypesMap[target.alignment] || constants.alignTypesMap[constants.alignTypes.CENTER]\n}\n\n/**\n * returns the focal point value, if no focal point passed use alignment\n * @param {{x: number, y: number}|undefined} focalPoint\n */\nfunction getFocalPoint(focalPoint) {\n    let fp = null\n\n    if (typeof focalPoint.x === 'number' && !isNaN(focalPoint.x) && typeof focalPoint.y === 'number' && !isNaN(focalPoint.y)) {\n        fp = {\n            x: roundToFixed(Math.max(0, Math.min(100, focalPoint.x)) / 100, 2),\n            y: roundToFixed(Math.max(0, Math.min(100, focalPoint.y)) / 100, 2)\n        }\n    }\n\n    return fp\n}\n\n/**\n * returns preferred image quality value\n * @param {number}    imageWidth\n * @param {number}    imageHeight\n *\n * @returns {number}\n */\nfunction getPreferredImageQuality(imageWidth, imageHeight) {\n    return constants.imageScaleDefaults[getImageQualityKey(imageWidth, imageHeight)].quality\n}\n\n/**\n * returns the scale descriptor of CLASSIC upscale method\n * @param sWidth\n * @param sHeight\n * @returns {{optimizedScaleFactor: number, upscaleMethodValue: number, forceUSM: boolean}}\n */\nfunction getClassicScaleData(sWidth, sHeight) {\n    const imageKey = getImageQualityKey(sWidth, sHeight)\n    return {\n        optimizedScaleFactor: constants.imageScaleDefaults[imageKey].maxUpscale,\n        upscaleMethodValue: constants.upscaleMethodsValues.classic,\n        forceUSM: false\n    }\n}\n\n/**\n * returns the scale descriptor of AUTO upscale method\n * @param sWidth\n * @param sHeight\n * @returns {{optimizedScaleFactor: number, upscaleMethodValue: number, forceUSM: boolean}}\n */\nfunction getAutoScaleData(sWidth, sHeight) {\n    const imageKey = getImageQualityKey(sWidth, sHeight)\n    return {\n        optimizedScaleFactor: constants.imageScaleDefaults[imageKey].maxUpscale,\n        upscaleMethodValue: constants.upscaleMethodsValues.classic,\n        forceUSM: false\n    }\n}\n\n/**\n * returns the scale descriptor of SUPER upscale method\n * @param sWidth\n * @param sHeight\n * @param scaleFactor\n * @returns {{optimizedScaleFactor: number, upscaleMethodValue: number, forceUSM: boolean}}\n */\nfunction getSuperScaleData(sWidth, sHeight, scaleFactor) {\n    return {\n        optimizedScaleFactor: utils.last(constants.SUPER_UPSCALE_MODELS),\n        upscaleMethodValue: constants.upscaleMethodsValues.super,\n        forceUSM: !(constants.SUPER_UPSCALE_MODELS.includes(scaleFactor) || scaleFactor > utils.last(constants.SUPER_UPSCALE_MODELS))\n    }\n}\n\n/**\n * returns upscale descriptor object\n * @param {number}    sWidth\n * @param {number}    sHeight\n * @param {string}    upscaleMethod\n * @param {number}    scaleFactor\n *\n * @returns  {{maxScale: number, upscaleMethodValue: number, forceUSM: boolean}}\n */\nfunction getOptimizedScaleData(sWidth, sHeight, scaleFactor, upscaleMethod) {\n    const scaleDataFunc = {\n        classic: getClassicScaleData,\n        auto: getAutoScaleData,\n        super: getSuperScaleData\n    }\n    return scaleDataFunc[upscaleMethod](sWidth, sHeight, scaleFactor)\n}\n\n/**\n * returns optimized upscale data, considering requested upscale method , optimize upscale for best quality and banswidth\n * @param {number}    sWidth\n * @param {number}    sHeight\n * @param {number}    tWidth\n * @param {number}    tHeight\n * @param {string}    upscaleMethod\n * @param {number}    scaleFactor\n * @param {string}    transformType\n *\n * @returns  {{width: number, height: number, sacleFactor: number, upscaleMethodValue: number, forceUSM: boolean, cssUpscaleNeeded: boolean}}\n */\nfunction getOptimizedTransformData(sWidth, sHeight, tWidth, tHeight, upscaleMethod, scaleFactor, transformType) {\n    const {optimizedScaleFactor, upscaleMethodValue, forceUSM} = getOptimizedScaleData(sWidth, sHeight, scaleFactor, upscaleMethod)\n\n    if (scaleFactor <= optimizedScaleFactor) {\n        // target upscale within limits or downscale\n        return {\n            width: tWidth,\n            height: tHeight,\n            scaleFactor,\n            upscaleMethodValue,\n            forceUSM,\n            cssUpscaleNeeded: false\n        }\n    }\n    // limited upscale\n    let width\n    let height\n    switch (transformType) {\n        case constants.transformTypes.FILL:\n            width = tWidth * (optimizedScaleFactor / scaleFactor)\n            height = tHeight * (optimizedScaleFactor / scaleFactor)\n            break\n        case constants.transformTypes.FIT:\n            width = sWidth * optimizedScaleFactor\n            height = sHeight * optimizedScaleFactor\n            break\n        default:\n            break\n    }\n    // adjust transform values\n    return {\n        width,\n        height,\n        scaleFactor: optimizedScaleFactor,\n        upscaleMethodValue,\n        forceUSM,\n        cssUpscaleNeeded: true\n    }\n}\n\n\n/**\n * returns image quality key\n * @param {number}    imageWidth\n * @param {number}    imageHeight\n *\n * @returns {string}\n */\nfunction getImageQualityKey(imageWidth, imageHeight) {\n    const size = imageWidth * imageHeight\n\n    if (size > constants.imageScaleDefaults[constants.imageQuality.HIGH].size) {\n        return constants.imageQuality.HIGH\n    } else if (size > constants.imageScaleDefaults[constants.imageQuality.MEDIUM].size) {\n        return constants.imageQuality.MEDIUM\n    } else if (size > constants.imageScaleDefaults[constants.imageQuality.LOW].size) {\n        return constants.imageQuality.LOW\n    }\n    return constants.imageQuality.TINY\n}\n\n/**\n * return the actual rounded dimension of a scaled rectangle\n * @param sWidth\n * @param sHeight\n * @param tWidth\n * @param tHeight\n * @param transformType\n * @returns {{width: number, height: number}}\n */\nfunction getDimension(sWidth, sHeight, tWidth, tHeight, transformType) {\n    const scaleFactor = getScaleFactor(sWidth, sHeight, tWidth, tHeight, transformType)\n    return {\n        width: Math.round(sWidth * scaleFactor),\n        height: Math.round(sHeight * scaleFactor)\n    }\n}\n\n/**\n * rounds number n digit precision and converts to string\n * @param {number}      value\n * @param {number}      precision\n *\n * @returns {string}\n */\nfunction roundToFixed(value, precision) {\n    const truncatePrecision = Math.pow(10, precision || 0)\n    return (value * truncatePrecision / truncatePrecision).toFixed(parseInt(precision, 10))\n}\n\n/**\n * get normalize scale method\n * @param options\n * @returns {*}\n */\nfunction getUpscaleString(options) {\n    if (!options || !options.upscaleMethod || typeof options.upscaleMethod !== 'string') {\n        return constants.upscaleMethods.AUTO\n    }\n    return constants.upscaleMethods[options.upscaleMethod.toUpperCase()] || constants.upscaleMethods.AUTO\n}\n\n\nmodule.exports = {\n    populateGlobalFeatureSupport,\n    isWEBPBrowserSupport,\n    isObjectFitBrowserSupport,\n    isImageTransformApplicable,\n    isValidRequest,\n    isImageTypeSupported,\n    isExternalUrl,\n    isWEBP,\n    getFileType,\n    getFileExtension,\n    getFileName,\n    getAlignedRect,\n    getOverlappingRect,\n    getScaleFactor,\n    getTransformData,\n    getAlignment,\n    getPreferredImageQuality,\n    getDimension,\n    getFocalPoint,\n    getUpscaleString,\n    roundToFixed\n}\n","'use strict'\n\n/**\n * Shallow object 'extend' function.\n * Receives any number of objects and assigns all by order to the first\n * @returns {{}}\n */\nfunction assign() {\n    const target = arguments[0] || {}\n    const sources = Array.prototype.slice.call(arguments, 1, arguments.length)\n\n    for (let i = 0; i < sources.length; i++) {\n        const source = sources[i]\n        for (const prop in source) {\n            if (source.hasOwnProperty(prop)) {\n                target[prop] = source[prop]\n            }\n        }\n    }\n    return target\n}\n\n/**\n * return if an Array, String or Object includes a value\n * @param source\n * @param value\n * @returns {boolean}\n */\nfunction includes(source, value) {\n    // Array and String\n    if (source.indexOf) {\n        return source.indexOf(value) > -1 // eslint-disable-line lodash/prefer-includes\n    }\n    // Object\n    if (source && typeof source === 'object') {\n        return Object.keys(source).some(key => source[key] === value)\n    }\n    return false\n}\n\n/**\n * Simple templates.\n * Receives a string with es6 ${...} style template arguments and returns a transformed string.\n * @param string\n * @returns {Function}\n */\nfunction template(string) {\n    return function templateFunc(data) {\n        let result = string\n        for (const key in data) {\n            if (data.hasOwnProperty(key)) {\n                result = result.replace(new RegExp(`\\\\$\\{${key}\\}`, 'g'), data[key])\n            }\n        }\n        return result\n    }\n}\n\n/**\n * Get the last element in an array\n * @param array\n * @returns {*}\n */\nfunction last(array) {\n    return array[array.length - 1]\n}\n\nmodule.exports = {\n    assign,\n    includes,\n    last,\n    template\n}\n\n","'use strict'\n\nconst imageServiceUtils = require('../helpers/imageServiceUtils')\nconst transformParts = require('../helpers/imageTransformParts')\nconst transformOptions = require('../helpers/imageTransformOptions')\n\n/**\n * returns image transform data\n *\n * @param {string}                  fittingType         imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src                 source image\n * @param {ImageTransformTarget}    target              target component\n * @param {ImageTransformOptions}   [options]           transform options\n *\n * @returns {Object}\n */\nfunction getTransform(fittingType, src, target, options) {\n    const fileType = imageServiceUtils.getFileType(src.id)\n    const fileName = imageServiceUtils.getFileName(src.id, src.name)\n    const fileExtension = imageServiceUtils.getFileExtension(src.id)\n    const isWEBPSupport = imageServiceUtils.isWEBPBrowserSupport(fileType)\n\n    const transformsObj = {\n        fileName,\n        fileExtension,\n        fileType,\n        isWEBPSupport,\n        fittingType,\n        src: {\n            id: src.id,\n            width: src.width,\n            height: src.height,\n            isCropped: false\n        },\n        focalPoint: {\n            x: src.focalPoint && src.focalPoint.x,\n            y: src.focalPoint && src.focalPoint.y\n        },\n        parts: [],\n        // options - general\n        quality: 0,\n        upscaleMethod: imageServiceUtils.getUpscaleString(options),\n        progressive: true,\n        watermark: '',\n        // options - filters & adjustments\n        unsharpMask: {},\n        filters: {}\n    }\n\n    if (imageServiceUtils.isImageTransformApplicable(src.id)) {\n        transformParts.setTransformParts(transformsObj, src, target)\n        transformOptions.setTransformOptions(transformsObj, options)\n    }\n\n    return transformsObj\n}\n\nmodule.exports = getTransform\n\n/**\n * the source image to transform\n * @typedef  {object} ImageTransformSource\n * @property {string}  id               source image uri\n * @property {number}  width            source image width\n * @property {number}  height           source image height\n * @property {string}  [name]           source image display name\n * @property {object}  [crop]           source image crop values\n * @property {number}  crop.x           crop x\n * @property {number}  crop.y           crop y\n * @property {number}  crop.width       crop width\n * @property {number}  crop.height      crop height\n * @property {object}  [focalPoint]     source image focal point values\n * @property {number}  focalPoint.x     focal point x\n * @property {number}  focalPoint.y     focal point y\n */\n\n/**\n * the destination container\n * @typedef  {object}  ImageTransformTarget\n * @property {number}  width                destination container width\n * @property {number}  height               destination container height\n * @property {number}  [pixelAspectRatio]   for retina and mobile displays, 1 (default)\n * @property {string}  [alignment]          how to align the image in the container, imageService.alignTypes  CENTER(default)\n * @property {string}  [htmlTag]            the css style, imageService.htmlTag IMG(default)\n */\n\n/**\n * the transform options\n * @typedef  {object}   ImageTransformOptions\n * @property {boolean}  [progressive]               image transform progressive\n * @property {string}   [upscaleMethod]             image upscale method\n * @property {number}   [quality]                   image transform quality\n * @property {string}   [watermark]                 image watermark id\n * @property {object}   [unsharpMask]               unsharpMask filter\n * @property {number}   [unsharpMask.radius]        unsharpMask radius\n * @property {number}   [unsharpMask.amount]        unsharpMask amount\n * @property {number}   [unsharpMask.threshold]     unsharpMask threshold\n */\n\n/**\n * the transform results\n * @typedef  {object} ImageTransformResult\n * @property {string} uri the generated image uri, *without* base path\n * @property {object} css CSS properties for the image and it's parent container, empty object for SVG\n * @property {object} css.img CSS for the image element\n * @property {object} css.container CSS for the image container\n * @property {object} attr HTML Attributes for the image and it's parent container, empty object for bg and img types\n * @property {object} attr.img HTML Attributes for the image element\n * @property {object} attr.container HTML Attributes for the image container\n *\n */\n","'use strict'\n\n/**\n * Global MUTABLE support object\n * For tests, override the getFeature function and not the object\n * @type {{isWEBP: {lossless: boolean, lossy: boolean, alpha: boolean, animation: boolean}, isObjectFitBrowser: boolean}}\n */\nconst globalFeaturesSupportObj = {\n    /**\n     * checks if the browser supports webp image type\n     * @type {object<boolean>}\n     */\n    isWEBP: {\n        lossless: false,\n        lossy: false,\n        alpha: false,\n        animation: false\n    },\n    /**\n     * checks if the browser supports 'objectFit'\n     * @type {boolean}\n     */\n    isObjectFitBrowser: true\n}\n\nmodule.exports = {\n    getFeature(feature) {\n        return globalFeaturesSupportObj[feature]\n    },\n    setFeature(feature, value) {\n        globalFeaturesSupportObj[feature] = value\n    }\n}\n","'use strict'\n\nconst utils = require('./utils')\nconst constants = require('./imageServiceConstants')\nconst imageServiceUtils = require('./imageServiceUtils')\n\n/**\n * request analysis, returns parsed transforms object\n * @param {object}                  transformsObj\n * @param {ImageTransformSource}    src\n * @param {ImageTransformTarget}    target\n */\nfunction setTransformParts(transformsObj, src, target) {\n    let rect\n\n    // crop source image if needed\n    // set crop part and adjust source dimensions\n    if (src.crop) {\n        rect = imageServiceUtils.getOverlappingRect(src, src.crop)\n        if (rect) {\n            transformsObj.src.width = rect.width\n            transformsObj.src.height = rect.height\n            transformsObj.src.cropped = true\n            transformsObj.parts.push(getCropPart(rect))\n        }\n    }\n\n    // set additional transform part\n    switch (transformsObj.fittingType) {\n        case constants.fittingTypes.SCALE_TO_FIT:\n        case constants.fittingTypes.LEGACY_FIT_WIDTH:\n        case constants.fittingTypes.LEGACY_FIT_HEIGHT:\n        case constants.fittingTypes.LEGACY_FULL:\n        case constants.fittingTypes.FIT_AND_TILE:\n        case constants.fittingTypes.LEGACY_BG_FIT_AND_TILE:\n        case constants.fittingTypes.LEGACY_BG_FIT_AND_TILE_HORIZONTAL:\n        case constants.fittingTypes.LEGACY_BG_FIT_AND_TILE_VERTICAL:\n        case constants.fittingTypes.LEGACY_BG_NORMAL:\n        // fit\n            transformsObj.parts.push(getFitPart(transformsObj, target))\n            break\n\n        case constants.fittingTypes.SCALE_TO_FILL:\n        // fill\n            transformsObj.parts.push(getFillPart(transformsObj, target))\n            break\n\n        case constants.fittingTypes.STRETCH:\n        // stretch\n            transformsObj.parts.push(getStretchPart(transformsObj, target))\n            break\n\n        case constants.fittingTypes.TILE_HORIZONTAL:\n        case constants.fittingTypes.TILE_VERTICAL:\n        case constants.fittingTypes.TILE:\n        case constants.fittingTypes.LEGACY_ORIGINAL_SIZE:\n        case constants.fittingTypes.ORIGINAL_SIZE:\n        // use crop transform\n        // if crop of source image was requested adjust cropping rectangle\n            rect = imageServiceUtils.getAlignedRect(transformsObj.src, target, target.alignment)\n            if (transformsObj.src.isCropped) {\n                utils.assign(transformsObj.parts[0], rect)\n\n                // update source width & height accordingly\n                transformsObj.src.width = rect.width\n                transformsObj.src.height = rect.height\n            } else {\n                transformsObj.parts.push(getCropPart(rect))\n            }\n            break\n\n        // ---------------------------------------------------------------------------------------\n        // handles a legacy bug on bgImageStrip, background html tag\n        // component Full Width Strip stored incorrect image source width and height\n        // ---------------------------------------------------------------------------------------\n        case constants.fittingTypes.LEGACY_STRIP_TILE_HORIZONTAL:\n        case constants.fittingTypes.LEGACY_STRIP_TILE_VERTICAL:\n        case constants.fittingTypes.LEGACY_STRIP_TILE:\n        case constants.fittingTypes.LEGACY_STRIP_ORIGINAL_SIZE:\n        // crop request of source image is not supported\n        // use legacy crop\n            transformsObj.parts.push(getLegacyCropPart(target))\n            break\n\n        case constants.fittingTypes.LEGACY_STRIP_SCALE_TO_FIT:\n        case constants.fittingTypes.LEGACY_STRIP_FIT_AND_TILE:\n        // legacy fit\n            transformsObj.parts.push(getLegacyFitPart(target))\n            break\n\n        case constants.fittingTypes.LEGACY_STRIP_SCALE_TO_FILL:\n        // legacy fill\n            transformsObj.parts.push(getLegacyFillPart(target))\n            break\n    }\n}\n\n/**\n * returns fit part of the image transform uri\n * @param {object}                  transformsObj\n * @param {ImageTransformTarget}    target\n *\n * @returns {object}\n */\nfunction getFitPart(transformsObj, target) {\n    // calculate the transformed image size needed\n    const transformedData = imageServiceUtils.getTransformData(\n        transformsObj.src.width,\n        transformsObj.src.height,\n        target,\n        constants.transformTypes.FIT,\n        transformsObj.upscaleMethod)\n    const transformType = constants.transformTypes.FILL\n\n    // return fit transform data\n    return {\n        transformType,\n        width: Math.round(transformedData.width),\n        height: Math.round(transformedData.height),\n        alignment: constants.alignTypesMap.center,\n        upscale: transformedData.scaleFactor > 1,\n\n        forceUSM: transformedData.forceUSM,\n        scaleFactor: transformedData.scaleFactor,\n        cssUpscaleNeeded: transformedData.cssUpscaleNeeded,\n        upscaleMethodValue: transformedData.upscaleMethodValue\n    }\n}\n\n/**\n * returns fill part of the image transform uri\n * @param {object}                  transformsObj\n * @param {ImageTransformTarget}    target\n *\n * @returns {object}                {transformType, width, height, alignment, upscale, scaleFactor}\n */\nfunction getFillPart(transformsObj, target) {\n    // calculate the transformed image size needed\n    const transformedData = imageServiceUtils.getTransformData(\n        transformsObj.src.width,\n        transformsObj.src.height,\n        target,\n        constants.transformTypes.FILL,\n        transformsObj.upscaleMethod\n    )\n    const focalPoint = imageServiceUtils.getFocalPoint(transformsObj.focalPoint)\n    const transformType = focalPoint ? constants.transformTypes.FILL_FOCAL : constants.transformTypes.FILL\n\n    // return fill transform data\n    return {\n        transformType,\n        width: Math.round(transformedData.width),\n        height: Math.round(transformedData.height),\n        alignment: imageServiceUtils.getAlignment(target),\n        focalPointX: focalPoint && focalPoint.x,\n        focalPointY: focalPoint && focalPoint.y,\n        upscale: transformedData.scaleFactor > 1,\n\n        forceUSM: transformedData.forceUSM,\n        scaleFactor: transformedData.scaleFactor,\n        cssUpscaleNeeded: transformedData.cssUpscaleNeeded,\n        upscaleMethodValue: transformedData.upscaleMethodValue\n    }\n}\n\n/**\n * returns fill part of the image transform uri\n * @param {object}                  transformsObj\n * @param {ImageTransformTarget}    target\n *\n * @returns {object}\n */\nfunction getStretchPart(transformsObj, target) {\n    // stretch data\n    const scaleFactor = imageServiceUtils.getScaleFactor(transformsObj.src.width, transformsObj.src.height, target.width, target.height, constants.transformTypes.FILL)\n    const clonedTarget = utils.assign({}, target)\n    clonedTarget.width = transformsObj.src.width * scaleFactor\n    clonedTarget.height = transformsObj.src.height * scaleFactor\n\n    // return stretch part\n    return getFitPart(transformsObj, clonedTarget)\n}\n\n/**\n * returns crop part of the image transform uri\n * @param {Object}  rect     x, y, width, height\n *\n * @returns {object}\n */\nfunction getCropPart(rect) {\n    // crop data\n    return {\n        transformType: constants.transformTypes.CROP,\n        x: Math.round(rect.x),\n        y: Math.round(rect.y),\n        width: Math.round(rect.width),\n        height: Math.round(rect.height),\n        upscale: false,\n\n        forceUSM: false,\n        scaleFactor: 1,\n        cssUpscaleNeeded: false\n    }\n}\n\n// ---------------------------------------------------------------------------------------\n// handles a legacy bug on bgImageStrip, background html tag\n// component Full Width Strip stored incorrect image source width and height\n// ---------------------------------------------------------------------------------------\n\n/**\n * returns fit part of the image transform uri\n * @param {ImageTransformTarget}    target\n *\n * @returns {object}\n */\nfunction getLegacyFitPart(target) {\n    // return fit part\n    return {\n        transformType: constants.transformTypes.FIT,\n        width: Math.round(target.width),\n        height: Math.round(target.height),\n        upscale: false,\n\n        forceUSM: true,\n        scaleFactor: 1,\n        cssUpscaleNeeded: false\n    }\n}\n\n\n/**\n * returns fill part of the image transform uri\n * @param {ImageTransformTarget}    target\n *\n * @returns {object}\n */\nfunction getLegacyFillPart(target) {\n    // return fill part\n    return {\n        transformType: constants.transformTypes.LEGACY_FILL,\n        width: Math.round(target.width),\n        height: Math.round(target.height),\n        alignment: imageServiceUtils.getAlignment(target),\n        upscale: false,\n\n        forceUSM: true,\n        scaleFactor: 1,\n        cssUpscaleNeeded: false\n    }\n}\n\n/**\n * returns legacy crop part of the image transform uri\n * @param {ImageTransformTarget}     target\n *\n * @returns {object}\n */\nfunction getLegacyCropPart(target) {\n    // return crop part\n    return {\n        transformType: constants.transformTypes.LEGACY_CROP,\n        width: Math.round(target.width),\n        height: Math.round(target.height),\n        alignment: imageServiceUtils.getAlignment(target),\n        upscale: false,\n\n        forceUSM: false,\n        scaleFactor: 1,\n        cssUpscaleNeeded: false\n    }\n}\n\n\nmodule.exports = {\n    setTransformParts\n}\n","'use strict'\n\nconst utils = require('./utils')\nconst constants = require('./imageServiceConstants')\nconst imageServiceUtils = require('./imageServiceUtils')\n\n\n/**\n * returns image filters part of the image transform uri\n * @param {object}                  transformsObj    transform parts object\n * @param {ImageTransformOptions}   options\n */\nfunction setTransformOptions(transformsObj, options) {\n    options = options || {}\n    // options - general\n    transformsObj.quality = getQuality(transformsObj, options)\n    transformsObj.progressive = getProgressive(options)\n    transformsObj.watermark = getWatermark(options)\n    // options - filters & adjustments\n    transformsObj.unsharpMask = getUnsharpMask(transformsObj, options)\n    transformsObj.filters = getFilters(options)\n}\n\n/**\n *\n * @param {ImageTransformOptions}   options\n * @returns {string}\n */\nfunction getWatermark(options) {\n    return options.watermark\n}\n\n\n/**\n * returns progressive if required\n * @param {ImageTransformOptions}   options\n *\n * @returns {boolean}\n */\nfunction getProgressive(options) {\n    return options.progressive !== false\n}\n\n/**\n * returns image filters part of the image transform uri\n * @param {object}                  transformsObj    transform parts object\n * @param {ImageTransformOptions}   options\n *\n * @returns {number}\n */\nfunction getQuality(transformsObj, options) {\n    const transformData = utils.last(transformsObj.parts)\n\n    const defaultQuality = imageServiceUtils.getPreferredImageQuality(transformData.width, transformData.height)\n    const quality = options.quality && (options.quality >= 5 && options.quality <= 90) ? options.quality : defaultQuality\n\n    // return quality\n    return parseInt(quality, 10)\n}\n\n/**\n * returns the desired transformed image filters\n * @param {ImageTransformOptions}   options\n *\n * @returns {object}\n */\nfunction getFilters(options) {\n    const filterOptions = options.filters || {}\n    const filters = {}\n\n\n    // contrast\n    if (isValidImageFilter(filterOptions[constants.imageFilters.CONTRAST], -100, 100)) {\n        filters[constants.imageFilters.CONTRAST] = filterOptions[constants.imageFilters.CONTRAST]\n    }\n\n    // brightness\n    if (isValidImageFilter(filterOptions[constants.imageFilters.BRIGHTNESS], -100, 100)) {\n        filters[constants.imageFilters.BRIGHTNESS] = filterOptions[constants.imageFilters.BRIGHTNESS]\n    }\n\n    // saturation\n    if (isValidImageFilter(filterOptions[constants.imageFilters.SATURATION], -100, 100)) {\n        filters[constants.imageFilters.SATURATION] = filterOptions[constants.imageFilters.SATURATION]\n    }\n\n    // hue\n    if (isValidImageFilter(filterOptions[constants.imageFilters.HUE], -180, 180)) {\n        filters[constants.imageFilters.HUE] = filterOptions[constants.imageFilters.HUE]\n    }\n\n    // blur\n    if (isValidImageFilter(filterOptions[constants.imageFilters.BLUR], 0, 100)) {\n        filters[constants.imageFilters.BLUR] = filterOptions[constants.imageFilters.BLUR]\n    }\n\n    return filters\n}\n\n/**\n * indicates if requested filter value is valid\n * @param {number}  filterValue     filter's value\n * @param {number}  minValue        min range\n * @param {number}  maxValue        max range\n *\n * @returns {boolean}\n */\nfunction isValidImageFilter(filterValue, minValue, maxValue) {\n    // check if filter name and filter values range valid\n    return !isNaN(filterValue) && typeof filterValue === 'number' && filterValue !== 0 && (filterValue >= minValue && filterValue <= maxValue)\n}\n\n/**\n * returns the desired transformed image unSharpMask values\n * @param {object}                  transformsObj    transform parts object\n * @param {ImageTransformOptions}   options\n *\n * @returns {object}\n */\nfunction getUnsharpMask(transformsObj, options) {\n    // construct usm values\n    let usm\n\n    // If options.unsharpMask is a valid value, use it\n    if (isUSMValid(options.unsharpMask)) {\n        usm = {\n            radius: options.unsharpMask.radius,\n            amount: options.unsharpMask.amount,\n            threshold: options.unsharpMask.threshold\n        }\n    // if options.unsharpMask is not all zeros and not valid and usm should be used, use default\n    } else if (!isZeroUSM(options.unsharpMask)) {\n        if (isUSMNeeded(transformsObj)) {\n            usm = constants.defaultUSM\n        }\n    }\n    // If we got usm, change values to have trailing zeros (.00), else return undefined\n    if (usm) {\n        usm.radius = imageServiceUtils.roundToFixed(usm.radius, 2)\n        usm.amount = imageServiceUtils.roundToFixed(usm.amount, 2)\n        usm.threshold = imageServiceUtils.roundToFixed(usm.threshold, 2)\n    }\n\n    return usm\n}\n\n/**\n * indicates if usm is needed\n * @param {object}      transformsObj   transform parts object\n *\n * @returns {boolean}\n */\nfunction isUSMNeeded(transformsObj) {\n    // ---------------------------------------------------------------------------------------\n    // do not apply usm if transformed image width & height is same as source image or larger\n    // and no force usm is desired\n    // ---------------------------------------------------------------------------------------\n    const transformPart = utils.last(transformsObj.parts)\n    const upscale = transformPart.scaleFactor >= 1\n\n    // return if usm is needed\n    return !upscale || transformPart.forceUSM\n}\n\n\n/**\n * indicates if all usm values are presented and in range\n * @param {object}  usm     unsharp mask\n *\n * @returns {boolean}\n */\nfunction isUSMValid(usm) {\n    usm = usm || {}\n    const radius = !isNaN(usm.radius) && typeof usm.radius === 'number' && (usm.radius >= 0.1 && usm.radius <= 500)\n    const amount = !isNaN(usm.amount) && typeof usm.amount === 'number' && (usm.amount >= 0 && usm.amount <= 10)\n    const threshold = !isNaN(usm.threshold) && typeof usm.threshold === 'number' && (usm.threshold >= 0 && usm.threshold <= 255)\n\n    // return is a valid USM data\n    return radius && amount && threshold\n}\n\n/**\n * indicates if all usm values are presented and are zero. an explicit request to not apply usm\n * @param {object}  usm     unsharp mask\n *\n * @returns {boolean}\n */\nfunction isZeroUSM(usm) {\n    usm = usm || {}\n    return !isNaN(usm.radius) && typeof usm.radius === 'number' && usm.radius === 0 &&\n        (!isNaN(usm.amount) && typeof usm.amount === 'number' && usm.amount === 0) &&\n        (!isNaN(usm.threshold) && typeof usm.threshold === 'number' && usm.threshold === 0)\n}\n\nmodule.exports = {\n    setTransformOptions\n}\n","'use strict'\n\nconst constants = require('../helpers/imageServiceConstants')\nconst imageServiceUtils = require('../helpers/imageServiceUtils')\nconst transforms = require('../engines/transforms')\nconst transform = require('./transform')\n\n/**\n * returns image transform uri\n *\n * @param {string}                  fittingType         imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src                 source image\n * @param {ImageTransformTarget}    target              target component\n * @param {ImageTransformOptions}   options             transform options\n * @param {Object}                  [transformObj]      transform data object to use\n *\n * @returns {string}\n */\nfunction getURI(fittingType, src, target, options, transformObj) {\n    let uri = constants.emptyData.uri\n\n    // check if image transformation is applicable (e.g. .gif, .wix_mp)\n    if (imageServiceUtils.isImageTransformApplicable(src.id)) {\n        transformObj = transformObj || transform(fittingType, src, target, options, transformObj)\n\n        // set the uri property\n        uri = transforms.getImageURI(transformObj)\n    } else {\n        uri = src.id\n    }\n\n    return uri\n}\n\nmodule.exports = getURI\n\n/**\n * the source image to transform\n * @typedef  {object} ImageTransformSource\n * @property {string}  id               source image uri\n * @property {number}  width            source image width\n * @property {number}  height           source image height\n * @property {object}  [crop]           source image crop values\n * @property {number}  crop.x           crop x\n * @property {number}  crop.y           crop y\n * @property {number}  crop.width       crop width\n * @property {number}  crop.height      crop height\n * @property {object}  [focalPoint]     source image focal point values\n * @property {number}  focalPoint.x     focal point x\n * @property {number}  focalPoint.y     focal point y\n */\n\n/**\n * the destination container\n * @typedef  {object}  ImageTransformTarget\n * @property {number}  width                destination container width\n * @property {number}  height               destination container height\n * @property {number}  [pixelAspectRatio]   for retina and mobile displays, 1 (default)\n * @property {string}  [alignment]          how to align the image in the container, imageService.alignTypes  CENTER(default)\n * @property {string}  [htmlTag]            the css style, imageService.htmlTag IMG(default)\n */\n\n/**\n * the transform options\n * @typedef  {object}   ImageTransformOptions\n * @property {boolean}  [progressive]               image transform progressive\n * @property {number}   [quality]                   image transform quality\n * @property {string}   [watermark]                 image watermark id\n * @property {object}   [unsharpMask]               unsharpMask filter\n * @property {number}   [unsharpMask.radius]        unsharpMask radius\n * @property {number}   [unsharpMask.amount]        unsharpMask amount\n * @property {number}   [unsharpMask.threshold]     unsharpMask threshold\n */\n\n/**\n * the transform results\n * @typedef  {object} ImageTransformResult\n * @property {string} uri the generated image uri, *without* base path\n * @property {object} css CSS properties for the image and it's parent container, empty object for SVG\n * @property {object} css.img CSS for the image element\n * @property {object} css.container CSS for the image container\n * @property {object} attr HTML Attributes for the image and it's parent container, empty object for bg and img types\n * @property {object} attr.img HTML Attributes for the image element\n * @property {object} attr.container HTML Attributes for the image container\n *\n */\n","'use strict'\nconst utils = require('../helpers/utils')\nconst constants = require('../helpers/imageServiceConstants')\n\n// transform templates\nconst fitTemplate = utils.template('fit/w_${width},h_${height}')\nconst fillTemplate = utils.template('fill/w_${width},h_${height},al_${alignment}')\nconst fillFocalTemplate = utils.template('fill/w_${width},h_${height},fp_${focalPointX}_${focalPointY}')\nconst cropTemplate = utils.template('crop/x_${x},y_${y},w_${width},h_${height}')\n\n// legacy templates\nconst legacyCropTemplate = utils.template('crop/w_${width},h_${height},al_${alignment}')\nconst legacyFillTemplate = utils.template('fill/w_${width},h_${height},al_${alignment}')\n\n// upscale template\nconst upscaleTemplate = utils.template(',lg_${upscaleMethodValue}')\n\n// options templates\nconst qualityTemplate = utils.template(',q_${quality}')\nconst unSharpMaskTemplate = utils.template(',usm_${radius}_${amount}_${threshold}')\nconst nonProgressiveTemplate = utils.template(',bl')\nconst watermarkTemplate = utils.template(',wm_${watermark}')\nconst filterTemplatesMap = {\n    [constants.imageFilters.CONTRAST]: utils.template(',con_${contrast}'),\n    [constants.imageFilters.BRIGHTNESS]: utils.template(',br_${brightness}'),\n    [constants.imageFilters.SATURATION]: utils.template(',sat_${saturation}'),\n    [constants.imageFilters.HUE]: utils.template(',hue_${hue}'),\n    [constants.imageFilters.BLUR]: utils.template(',blur_${blur}')\n}\n\n/**\n * returns image transform uri\n * @param {object}  transformsObj\n *\n * @returns {string}\n */\nfunction getImageURI(transformsObj) {\n    // construct image transforms\n    const transformsObjStrArr = []\n\n    // construct transform\n    transformsObj.parts.forEach(transformPart => {\n        switch (transformPart.transformType) {\n            case constants.transformTypes.CROP:\n                transformsObjStrArr.push(cropTemplate(transformPart))\n                break\n\n            case constants.transformTypes.LEGACY_CROP:\n                transformsObjStrArr.push(legacyCropTemplate(transformPart))\n                break\n\n            case constants.transformTypes.LEGACY_FILL:\n                let legacyFillStr = legacyFillTemplate(transformPart)\n                if (transformPart.upscale) {\n                    legacyFillStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(legacyFillStr)\n                break\n\n            case constants.transformTypes.FIT:\n                let fitStr = fitTemplate(transformPart)\n                if (transformPart.upscale) {\n                    fitStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(fitStr)\n                break\n\n            case constants.transformTypes.FILL:\n                let fillStr = fillTemplate(transformPart)\n                if (transformPart.upscale) {\n                    fillStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(fillStr)\n                break\n\n            case constants.transformTypes.FILL_FOCAL:\n                let fillFocalStr = fillFocalTemplate(transformPart)\n                if (transformPart.upscale) {\n                    fillFocalStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(fillFocalStr)\n                break\n        }\n    })\n\n    let transformsStr = transformsObjStrArr.join('/')\n\n    // construct transform options\n    // quality\n    if (transformsObj.fileType === constants.fileType.PNG && transformsObj.isWEBPSupport ||\n        transformsObj.fileType === constants.fileType.JPG) {\n        transformsStr += qualityTemplate(transformsObj)\n    }\n    // un-sharp mask\n    if (transformsObj.unsharpMask) {\n        transformsStr += unSharpMaskTemplate(transformsObj.unsharpMask)\n    }\n    // progressive\n    if (!transformsObj.progressive) {\n        transformsStr += nonProgressiveTemplate(transformsObj)\n    }\n    // watermark\n    if (transformsObj.watermark) {\n        transformsStr += watermarkTemplate(transformsObj)\n    }\n    // filters\n    if (transformsObj.filters) {\n        transformsStr += Object.keys(transformsObj.filters).map(filterName =>\n            filterTemplatesMap[filterName](transformsObj.filters)\n        ).join('')\n    }\n\n    // image url string\n    return `${transformsObj.src.id}/${constants.API_VERSION}/${transformsStr}/${transformsObj.fileName}.${transformsObj.isWEBPSupport ? 'webp' : transformsObj.fileExtension}`\n}\n\nmodule.exports = {\n    getImageURI\n}\n","'use strict'\nconst imageClientApi = require('../api/uri/index')\nconst constants = require('../helpers/imageServiceConstants')\n\nimageClientApi.populateGlobalFeatureSupport()\n\nconst wixStatic = 'https://static.wixstatic.com/'\nconst wixStaticWithMedia = 'https://static.wixstatic.com/media/'\nconst HAS_MEDIA_PREFIX_RE = /^media\\//i\n\nconst devicePixelRatio = typeof window !== 'undefined' ? window.devicePixelRatio : 1\n\nfunction getURL(uri) {\n    return HAS_MEDIA_PREFIX_RE.test(uri) ? `${wixStatic}${uri}` : `${wixStaticWithMedia}${uri}`\n}\n\nfunction getScaleToFitImageURL(relativeUrl, sourceWidth, sourceHeight, targetWidth, targetHeight, options) {\n    const data = imageClientApi.getData(constants.fittingTypes.SCALE_TO_FIT, {\n        id: relativeUrl,\n        width: sourceWidth,\n        height: sourceHeight,\n        name: options && options.name\n    }, {\n        width: targetWidth,\n        height: targetHeight,\n        htmlTag: imageClientApi.htmlTag.IMG,\n        alignment: imageClientApi.alignTypes.CENTER,\n        pixelAspectRatio: devicePixelRatio\n    }, options)\n\n    return getURL(data.uri)\n}\n\nfunction getScaleToFillImageURL(relativeUrl, sourceWidth, sourceHeight, targetWidth, targetHeight, options) {\n    const data = imageClientApi.getData(constants.fittingTypes.SCALE_TO_FILL, {\n        id: relativeUrl,\n        width: sourceWidth,\n        height: sourceHeight,\n        name: options && options.name,\n        focalPoint: {\n            x: options && options.focalPoint && options.focalPoint.x,\n            y: options && options.focalPoint && options.focalPoint.y\n        }\n    }, {\n        width: targetWidth,\n        height: targetHeight,\n        htmlTag: imageClientApi.htmlTag.IMG,\n        alignment: imageClientApi.alignTypes.CENTER,\n        pixelAspectRatio: devicePixelRatio\n    }, options)\n\n    return getURL(data.uri)\n}\n\nfunction getCropImageURL(relativeUrl, sourceWidth, sourceHeight, cropX, cropY, cropWidth, cropHeight, targetWidth, targetHeight, options) {\n    const data = imageClientApi.getData(constants.fittingTypes.SCALE_TO_FILL, {\n        id: relativeUrl,\n        width: sourceWidth,\n        height: sourceHeight,\n        name: options && options.name,\n        crop: {\n            x: cropX,\n            y: cropY,\n            width: cropWidth,\n            height: cropHeight\n        }\n    }, {\n        width: targetWidth,\n        height: targetHeight,\n        htmlTag: imageClientApi.htmlTag.IMG,\n        alignment: imageClientApi.alignTypes.CENTER,\n        pixelAspectRatio: devicePixelRatio\n    }, options)\n\n    return getURL(data.uri)\n}\n\nmodule.exports = {\n    getScaleToFitImageURL,\n    getScaleToFillImageURL,\n    getCropImageURL\n}","'use strict'\n\nconst constants = require('../../helpers/imageServiceConstants')\nconst imageServiceUtils = require('../../helpers/imageServiceUtils')\nconst getURI = require('../uri')\n\n/**\n * returns image transform uri\n *\n * @param {string}                  fittingType         imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src                 source image\n * @param {ImageTransformTarget}    target              target component\n * @param {ImageTransformOptions}   [options]           transform options\n *\n * @returns {{uri: string}}\n */\nfunction getData(fittingType, src, target, options) {\n    let uri = constants.emptyData.uri\n\n    // check if valid request\n    if (imageServiceUtils.isValidRequest(fittingType, src, target)) {\n        uri = getURI(fittingType, src, target, options)\n    }\n\n    return {\n        uri\n    }\n}\n\nmodule.exports = {\n    populateGlobalFeatureSupport: imageServiceUtils.populateGlobalFeatureSupport,\n    getData,\n    fittingTypes: constants.fittingTypes,\n    alignTypes: constants.alignTypes,\n    htmlTag: constants.htmlTag,\n    upscaleMethods: constants.upscaleMethods\n}\n\n/**\n * the source image to transform\n * @typedef  {object} ImageTransformSource\n * @property {string}  id               source image uri\n * @property {number}  width            source image width\n * @property {number}  height           source image height\n * @property {object}  [crop]           source image crop values\n * @property {number}  crop.x           crop x\n * @property {number}  crop.y           crop y\n * @property {number}  crop.width       crop width\n * @property {number}  crop.height      crop height\n * @property {object}  [focalPoint]     source image focal point values\n * @property {number}  focalPoint.x     focal point x\n * @property {number}  focalPoint.y     focal point y\n */\n\n/**\n * the destination container\n * @typedef  {object}  ImageTransformTarget\n * @property {number}  width                destination container width\n * @property {number}  height               destination container height\n * @property {number}  [pixelAspectRatio]   for retina and mobile displays, 1 (default)\n * @property {string}  [alignment]          how to align the image in the container, imageService.alignTypes  CENTER(default)\n * @property {string}  [htmlTag]            the css style, imageService.htmlTag IMG(default)\n */\n\n/**\n * the transform options\n * @typedef  {object}   ImageTransformOptions\n * @property {boolean}  [progressive]               image transform progressive\n * @property {number}   [quality]                   image transform quality\n * @property {string}   [watermark]                 image watermark id\n * @property {object}   [unsharpMask]               unsharpMask filter\n * @property {number}   [unsharpMask.radius]        unsharpMask radius\n * @property {number}   [unsharpMask.amount]        unsharpMask amount\n * @property {number}   [unsharpMask.threshold]     unsharpMask threshold\n */\n\n/**\n * the transform results\n * @typedef  {object} ImageTransformResult\n * @property {string} uri the generated image uri, *without* base path\n * @property {object} css CSS properties for the image and it's parent container, empty object for SVG\n * @property {object} css.img CSS for the image element\n * @property {object} css.container CSS for the image container\n * @property {object} attr HTML Attributes for the image and it's parent container, empty object for bg and img types\n * @property {object} attr.img HTML Attributes for the image element\n * @property {object} attr.container HTML Attributes for the image container\n *\n */\n"],"sourceRoot":""}