{"version":3,"sources":["../../../src/engines/transforms.js"],"names":["utils","require","constants","fitTemplate","template","fillTemplate","fillFocalTemplate","cropTemplate","legacyCropTemplate","legacyFillTemplate","upscaleTemplate","qualityTemplate","unSharpMaskTemplate","nonProgressiveTemplate","watermarkTemplate","filterTemplatesMap","imageFilters","CONTRAST","BRIGHTNESS","SATURATION","HUE","BLUR","getImageURI","transformsObj","transformsObjStrArr","parts","forEach","transformPart","transformType","transformTypes","CROP","push","LEGACY_CROP","LEGACY_FILL","legacyFillStr","upscale","FIT","fitStr","FILL","fillStr","FILL_FOCAL","fillFocalStr","transformsStr","join","fileType","PNG","isWEBPSupport","JPG","unsharpMask","progressive","watermark","filters","Object","keys","map","filterName","src","id","API_VERSION","fileName","fileExtension","module","exports"],"mappings":"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","file":"transforms.js","sourcesContent":["'use strict'\nconst utils = require('../helpers/utils')\nconst constants = require('../helpers/imageServiceConstants')\n\n// transform templates\nconst fitTemplate = utils.template('fit/w_${width},h_${height}')\nconst fillTemplate = utils.template('fill/w_${width},h_${height},al_${alignment}')\nconst fillFocalTemplate = utils.template('fill/w_${width},h_${height},fp_${focalPointX}_${focalPointY}')\nconst cropTemplate = utils.template('crop/x_${x},y_${y},w_${width},h_${height}')\n\n// legacy templates\nconst legacyCropTemplate = utils.template('crop/w_${width},h_${height},al_${alignment}')\nconst legacyFillTemplate = utils.template('fill/w_${width},h_${height},al_${alignment}')\n\n// upscale template\nconst upscaleTemplate = utils.template(',lg_${upscaleMethodValue}')\n\n// options templates\nconst qualityTemplate = utils.template(',q_${quality}')\nconst unSharpMaskTemplate = utils.template(',usm_${radius}_${amount}_${threshold}')\nconst nonProgressiveTemplate = utils.template(',bl')\nconst watermarkTemplate = utils.template(',wm_${watermark}')\nconst filterTemplatesMap = {\n    [constants.imageFilters.CONTRAST]: utils.template(',con_${contrast}'),\n    [constants.imageFilters.BRIGHTNESS]: utils.template(',br_${brightness}'),\n    [constants.imageFilters.SATURATION]: utils.template(',sat_${saturation}'),\n    [constants.imageFilters.HUE]: utils.template(',hue_${hue}'),\n    [constants.imageFilters.BLUR]: utils.template(',blur_${blur}')\n}\n\n/**\n * returns image transform uri\n * @param {object}  transformsObj\n *\n * @returns {string}\n */\nfunction getImageURI(transformsObj) {\n    // construct image transforms\n    const transformsObjStrArr = []\n\n    // construct transform\n    transformsObj.parts.forEach(transformPart => {\n        switch (transformPart.transformType) {\n            case constants.transformTypes.CROP:\n                transformsObjStrArr.push(cropTemplate(transformPart))\n                break\n\n            case constants.transformTypes.LEGACY_CROP:\n                transformsObjStrArr.push(legacyCropTemplate(transformPart))\n                break\n\n            case constants.transformTypes.LEGACY_FILL:\n                let legacyFillStr = legacyFillTemplate(transformPart)\n                if (transformPart.upscale) {\n                    legacyFillStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(legacyFillStr)\n                break\n\n            case constants.transformTypes.FIT:\n                let fitStr = fitTemplate(transformPart)\n                if (transformPart.upscale) {\n                    fitStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(fitStr)\n                break\n\n            case constants.transformTypes.FILL:\n                let fillStr = fillTemplate(transformPart)\n                if (transformPart.upscale) {\n                    fillStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(fillStr)\n                break\n\n            case constants.transformTypes.FILL_FOCAL:\n                let fillFocalStr = fillFocalTemplate(transformPart)\n                if (transformPart.upscale) {\n                    fillFocalStr += upscaleTemplate(transformPart)\n                }\n                transformsObjStrArr.push(fillFocalStr)\n                break\n        }\n    })\n\n    let transformsStr = transformsObjStrArr.join('/')\n\n    // construct transform options\n    // quality\n    if (transformsObj.fileType === constants.fileType.PNG && transformsObj.isWEBPSupport ||\n        transformsObj.fileType === constants.fileType.JPG) {\n        transformsStr += qualityTemplate(transformsObj)\n    }\n    // un-sharp mask\n    if (transformsObj.unsharpMask) {\n        transformsStr += unSharpMaskTemplate(transformsObj.unsharpMask)\n    }\n    // progressive\n    if (!transformsObj.progressive) {\n        transformsStr += nonProgressiveTemplate(transformsObj)\n    }\n    // watermark\n    if (transformsObj.watermark) {\n        transformsStr += watermarkTemplate(transformsObj)\n    }\n    // filters\n    if (transformsObj.filters) {\n        transformsStr += Object.keys(transformsObj.filters).map(filterName =>\n            filterTemplatesMap[filterName](transformsObj.filters)\n        ).join('')\n    }\n\n    // image url string\n    return `${transformsObj.src.id}/${constants.API_VERSION}/${transformsStr}/${transformsObj.fileName}.${transformsObj.isWEBPSupport ? 'webp' : transformsObj.fileExtension}`\n}\n\nmodule.exports = {\n    getImageURI\n}\n"]}