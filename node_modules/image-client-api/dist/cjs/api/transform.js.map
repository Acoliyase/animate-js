{"version":3,"sources":["../../../src/api/transform.js"],"names":["imageServiceUtils","require","transformParts","transformOptions","getTransform","fittingType","src","target","options","fileType","getFileType","id","fileName","getFileName","name","fileExtension","getFileExtension","isWEBPSupport","isWEBPBrowserSupport","transformsObj","width","height","isCropped","focalPoint","x","y","parts","quality","upscaleMethod","getUpscaleString","progressive","watermark","unsharpMask","filters","isImageTransformApplicable","setTransformParts","setTransformOptions","module","exports"],"mappings":"AAAA;;AAEA,IAAMA,oBAAoBC,QAAQ,8BAAR,CAA1B;AACA,IAAMC,iBAAiBD,QAAQ,gCAAR,CAAvB;AACA,IAAME,mBAAmBF,QAAQ,kCAAR,CAAzB;;AAEA;;;;;;;;;;AAUA,SAASG,YAAT,CAAsBC,WAAtB,EAAmCC,GAAnC,EAAwCC,MAAxC,EAAgDC,OAAhD,EAAyD;AACrD,QAAMC,WAAWT,kBAAkBU,WAAlB,CAA8BJ,IAAIK,EAAlC,CAAjB;AACA,QAAMC,WAAWZ,kBAAkBa,WAAlB,CAA8BP,IAAIK,EAAlC,EAAsCL,IAAIQ,IAA1C,CAAjB;AACA,QAAMC,gBAAgBf,kBAAkBgB,gBAAlB,CAAmCV,IAAIK,EAAvC,CAAtB;AACA,QAAMM,gBAAgBjB,kBAAkBkB,oBAAlB,CAAuCT,QAAvC,CAAtB;;AAEA,QAAMU,gBAAgB;AAClBP,0BADkB;AAElBG,oCAFkB;AAGlBN,0BAHkB;AAIlBQ,oCAJkB;AAKlBZ,gCALkB;AAMlBC,aAAK;AACDK,gBAAIL,IAAIK,EADP;AAEDS,mBAAOd,IAAIc,KAFV;AAGDC,oBAAQf,IAAIe,MAHX;AAIDC,uBAAW;AAJV,SANa;AAYlBC,oBAAY;AACRC,eAAGlB,IAAIiB,UAAJ,IAAkBjB,IAAIiB,UAAJ,CAAeC,CAD5B;AAERC,eAAGnB,IAAIiB,UAAJ,IAAkBjB,IAAIiB,UAAJ,CAAeE;AAF5B,SAZM;AAgBlBC,eAAO,EAhBW;AAiBlB;AACAC,iBAAS,CAlBS;AAmBlBC,uBAAe5B,kBAAkB6B,gBAAlB,CAAmCrB,OAAnC,CAnBG;AAoBlBsB,qBAAa,IApBK;AAqBlBC,mBAAW,EArBO;AAsBlB;AACAC,qBAAa,EAvBK;AAwBlBC,iBAAS;AAxBS,KAAtB;;AA2BA,QAAIjC,kBAAkBkC,0BAAlB,CAA6C5B,IAAIK,EAAjD,CAAJ,EAA0D;AACtDT,uBAAeiC,iBAAf,CAAiChB,aAAjC,EAAgDb,GAAhD,EAAqDC,MAArD;AACAJ,yBAAiBiC,mBAAjB,CAAqCjB,aAArC,EAAoDX,OAApD;AACH;;AAED,WAAOW,aAAP;AACH;;AAEDkB,OAAOC,OAAP,GAAiBlC,YAAjB;;AAEA;;;;;;;;;;;;;;;;;AAiBA;;;;;;;;;;AAUA;;;;;;;;;;;;;AAaA","file":"transform.js","sourcesContent":["'use strict'\n\nconst imageServiceUtils = require('../helpers/imageServiceUtils')\nconst transformParts = require('../helpers/imageTransformParts')\nconst transformOptions = require('../helpers/imageTransformOptions')\n\n/**\n * returns image transform data\n *\n * @param {string}                  fittingType         imageServicesTypes.fittingTypes\n * @param {ImageTransformSource}    src                 source image\n * @param {ImageTransformTarget}    target              target component\n * @param {ImageTransformOptions}   [options]           transform options\n *\n * @returns {Object}\n */\nfunction getTransform(fittingType, src, target, options) {\n    const fileType = imageServiceUtils.getFileType(src.id)\n    const fileName = imageServiceUtils.getFileName(src.id, src.name)\n    const fileExtension = imageServiceUtils.getFileExtension(src.id)\n    const isWEBPSupport = imageServiceUtils.isWEBPBrowserSupport(fileType)\n\n    const transformsObj = {\n        fileName,\n        fileExtension,\n        fileType,\n        isWEBPSupport,\n        fittingType,\n        src: {\n            id: src.id,\n            width: src.width,\n            height: src.height,\n            isCropped: false\n        },\n        focalPoint: {\n            x: src.focalPoint && src.focalPoint.x,\n            y: src.focalPoint && src.focalPoint.y\n        },\n        parts: [],\n        // options - general\n        quality: 0,\n        upscaleMethod: imageServiceUtils.getUpscaleString(options),\n        progressive: true,\n        watermark: '',\n        // options - filters & adjustments\n        unsharpMask: {},\n        filters: {}\n    }\n\n    if (imageServiceUtils.isImageTransformApplicable(src.id)) {\n        transformParts.setTransformParts(transformsObj, src, target)\n        transformOptions.setTransformOptions(transformsObj, options)\n    }\n\n    return transformsObj\n}\n\nmodule.exports = getTransform\n\n/**\n * the source image to transform\n * @typedef  {object} ImageTransformSource\n * @property {string}  id               source image uri\n * @property {number}  width            source image width\n * @property {number}  height           source image height\n * @property {string}  [name]           source image display name\n * @property {object}  [crop]           source image crop values\n * @property {number}  crop.x           crop x\n * @property {number}  crop.y           crop y\n * @property {number}  crop.width       crop width\n * @property {number}  crop.height      crop height\n * @property {object}  [focalPoint]     source image focal point values\n * @property {number}  focalPoint.x     focal point x\n * @property {number}  focalPoint.y     focal point y\n */\n\n/**\n * the destination container\n * @typedef  {object}  ImageTransformTarget\n * @property {number}  width                destination container width\n * @property {number}  height               destination container height\n * @property {number}  [pixelAspectRatio]   for retina and mobile displays, 1 (default)\n * @property {string}  [alignment]          how to align the image in the container, imageService.alignTypes  CENTER(default)\n * @property {string}  [htmlTag]            the css style, imageService.htmlTag IMG(default)\n */\n\n/**\n * the transform options\n * @typedef  {object}   ImageTransformOptions\n * @property {boolean}  [progressive]               image transform progressive\n * @property {string}   [upscaleMethod]             image upscale method\n * @property {number}   [quality]                   image transform quality\n * @property {string}   [watermark]                 image watermark id\n * @property {object}   [unsharpMask]               unsharpMask filter\n * @property {number}   [unsharpMask.radius]        unsharpMask radius\n * @property {number}   [unsharpMask.amount]        unsharpMask amount\n * @property {number}   [unsharpMask.threshold]     unsharpMask threshold\n */\n\n/**\n * the transform results\n * @typedef  {object} ImageTransformResult\n * @property {string} uri the generated image uri, *without* base path\n * @property {object} css CSS properties for the image and it's parent container, empty object for SVG\n * @property {object} css.img CSS for the image element\n * @property {object} css.container CSS for the image container\n * @property {object} attr HTML Attributes for the image and it's parent container, empty object for bg and img types\n * @property {object} attr.img HTML Attributes for the image element\n * @property {object} attr.container HTML Attributes for the image container\n *\n */\n"]}