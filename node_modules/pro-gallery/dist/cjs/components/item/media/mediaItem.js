"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
/* eslint-disable @typescript-eslint/ban-types */
const react_1 = tslib_1.__importStar(require("react"));
const pro_gallery_lib_1 = require("pro-gallery-lib");
const GalleryUI_js_1 = require("./GalleryUI.js");
const pro_gallery_lib_2 = require("pro-gallery-lib");
const imageItem_js_1 = tslib_1.__importDefault(require("../imageItem.js"));
const IframeVideoPlayer_js_1 = tslib_1.__importDefault(require("../videos/IframeVideoPlayer.js"));
const getPlayButtonComponentByItemType = (type) => {
    if (type === 'video') {
        return react_1.default.createElement(GalleryUI_js_1.GalleryUI, { type: 'videoPlayButton', size: 60 });
    }
    else if (type === '3d') {
        return react_1.default.createElement(GalleryUI_js_1.GalleryUI, { type: 'rotateArrow', size: 60 });
    }
    else {
        return react_1.default.createElement(react_1.default.Fragment, null);
    }
};
function MediaItem(props) {
    const { hasLink, options, imageDimensions, showPlayButton, MediaImplementation, enableImagePlaceholder, isVideoPlaceholder, videoPlaceholderUrl, } = props;
    const { behaviourParams_item_clickAction: clickAction, behaviourParams_item_video_playTrigger: playTrigger } = options;
    const [isMounted, setIsMounted] = (0, react_1.useState)(false);
    (0, react_1.useEffect)(() => {
        setIsMounted(true);
    }, []);
    const isMediaPlayable = (0, react_1.useMemo)(() => {
        if (pro_gallery_lib_2.utils.isSSR()) {
            return false;
        }
        if (playTrigger === pro_gallery_lib_1.GALLERY_CONSTS[pro_gallery_lib_1.optionsMap.behaviourParams.item.video.playTrigger].HOVER ||
            playTrigger === pro_gallery_lib_1.GALLERY_CONSTS[pro_gallery_lib_1.optionsMap.behaviourParams.item.video.playTrigger].AUTO) {
            return true;
        }
        else if (clickAction === pro_gallery_lib_1.GALLERY_CONSTS[pro_gallery_lib_1.optionsMap.behaviourParams.item.clickAction].NOTHING ||
            clickAction === pro_gallery_lib_1.GALLERY_CONSTS[pro_gallery_lib_1.optionsMap.behaviourParams.item.clickAction].MAGNIFY) {
            return true;
        }
        else if (clickAction === pro_gallery_lib_1.GALLERY_CONSTS[pro_gallery_lib_1.optionsMap.behaviourParams.item.clickAction].LINK && !hasLink) {
            return true;
        }
        return false;
    }, [hasLink, playTrigger, clickAction]);
    const createIframePlayer = () => (react_1.default.createElement(IframeVideoPlayer_js_1.default, { dimensions: imageDimensions, url: isVideoPlaceholder ? videoPlaceholderUrl : props.videoUrl }));
    const createThumbnail = (propsOverrides = {}) => enableImagePlaceholder ? (react_1.default.createElement(imageItem_js_1.default, Object.assign({}, props, { imageDimensions: imageDimensions, id: props.idx, overlay: showPlayButton && !isMediaPlayable && getPlayButtonComponentByItemType(props.type), extraClasses: props.placeholderExtraClasses.join(' ') }, propsOverrides))) : (react_1.default.createElement(react_1.default.Fragment, null));
    const thumbnail = createThumbnail();
    const iframeVideoPlayer = createIframePlayer();
    const placeholder = (react_1.default.createElement(react_1.default.Fragment, null,
        thumbnail,
        iframeVideoPlayer,
        props.hover));
    if (!isMediaPlayable || props.isPrerenderMode || !isMounted) {
        return placeholder;
    }
    if ((0, pro_gallery_lib_1.isEditMode)()) {
        return (react_1.default.createElement(react_1.default.Fragment, null,
            thumbnail,
            props.hover));
    }
    return (react_1.default.createElement(react_1.default.Suspense, { fallback: placeholder },
        react_1.default.createElement(MediaImplementation, Object.assign({}, props, { thumbnail: thumbnail, placeholder: placeholder, thumbnailWithOverride: createThumbnail }))));
}
exports.default = MediaItem;
//# sourceMappingURL=mediaItem.js.map