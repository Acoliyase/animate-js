{"version":3,"file":"imageItem.js","sourceRoot":"","sources":["../../../../src/components/item/imageItem.js"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { GALLERY_CONSTS, optionsMap, utils } from 'pro-gallery-lib';\nimport ImageRenderer from './imageRenderer.js';\n\nclass ImageItem extends React.Component {\n  constructor(props) {\n    super(props);\n    this.getImageContainer = this.getImageContainer.bind(this);\n    this.getImageContainerClassNames = this.getImageContainerClassNames.bind(this);\n\n    this.state = {\n      isHighResImageLoaded: false,\n    };\n\n    this.handleHighResImageLoad = this.handleHighResImageLoad.bind(this);\n  }\n\n  componentDidMount() {\n    try {\n      if (typeof this.props.actions.setItemLoaded === 'function') {\n        this.props.actions.setItemLoaded();\n      }\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  handleHighResImageLoad() {\n    this.setState({ isHighResImageLoaded: true });\n    try {\n      this.props.actions.setItemLoaded();\n    } catch (e) {\n      console.error('Failed to load high res image', e);\n    }\n  }\n\n  getImageContainerClassNames() {\n    const { isCurrentHover, options } = this.props;\n    const { isHighResImageLoaded } = this.state;\n\n    const imageContainerClassNames = [\n      'gallery-item-content',\n      isCurrentHover ? 'item-content-hover' : 'item-content-regular',\n      'image-item',\n      'gallery-item-visible',\n      'gallery-item',\n      'gallery-item-preloaded',\n      options[optionsMap.layoutParams.crop.enable] &&\n      options[optionsMap.layoutParams.crop.method] === GALLERY_CONSTS[optionsMap.layoutParams.crop.method].FIT\n        ? 'grid-fit'\n        : '',\n      options[optionsMap.behaviourParams.item.content.loader] ===\n      GALLERY_CONSTS[optionsMap.behaviourParams.item.content.loader].COLOR\n        ? `load-with-color ${isHighResImageLoaded ? 'image-loaded' : ''}`\n        : '',\n    ].join(' ');\n\n    return imageContainerClassNames;\n  }\n\n  getImageContainer(imageRenderer, classNames, extraNodes) {\n    const { imageDimensions, id, actions } = this.props;\n\n    return (\n      <div\n        className={classNames}\n        onTouchStart={actions.handleItemMouseDown}\n        onTouchEnd={actions.handleItemMouseUp}\n        key={'image_container-' + id}\n        data-hook={'image-item'}\n        style={imageDimensions}\n      >\n        {imageRenderer()}\n        {extraNodes}\n      </div>\n    );\n  }\n\n  getImageAnimationOverlay() {\n    const { imageDimensions, options, createUrl, id } = this.props;\n\n    let imageAnimationUrl = null;\n    switch (options[optionsMap.behaviourParams.gallery.scrollAnimation]) {\n      case GALLERY_CONSTS[optionsMap.behaviourParams.gallery.scrollAnimation].BLUR:\n        imageAnimationUrl = createUrl(GALLERY_CONSTS.urlSizes.RESIZED, GALLERY_CONSTS.urlTypes.LOW_RES);\n        break;\n      case GALLERY_CONSTS[optionsMap.behaviourParams.gallery.scrollAnimation].MAIN_COLOR:\n        imageAnimationUrl = createUrl(GALLERY_CONSTS.urlSizes.PIXEL, GALLERY_CONSTS.urlTypes.HIGH_RES);\n        break;\n    }\n\n    return (\n      imageAnimationUrl && (\n        <div\n          key={'image_container-overlay-' + id}\n          data-hook={'image-item-overlay'}\n          style={{\n            ...imageDimensions,\n            backgroundImage: `url(${imageAnimationUrl})`,\n            backgroundSize: 'cover',\n            pointerEvents: 'none',\n            position: 'absolute',\n            top: 0,\n            left: 0,\n          }}\n        ></div>\n      )\n    );\n  }\n\n  getImageElement() {\n    const { alt, imageDimensions, createUrl, id, idx, settings = {}, options } = this.props;\n    const { isHighResImageLoaded } = this.state;\n    const imageProps =\n      settings && settings.imageProps && typeof settings.imageProps === 'function' ? settings.imageProps(id) : {};\n\n    // eslint-disable-next-line no-unused-vars\n    const { marginLeft, marginTop, ...imageSizing } = imageDimensions;\n\n    const image = () => {\n      const imagesComponents = [];\n      const altText = typeof alt === 'string' ? alt : 'untitled image';\n      const blockDownloadStyles =\n        utils.isMobile() && this.props.options[optionsMap.behaviourParams.gallery.blockContextMenu]\n          ? {\n              WebkitUserSelect: 'none',\n              WebkitTouchCallout: 'none',\n            }\n          : {};\n\n      const preloadStyles = this.props.isPrerenderMode\n        ? {\n            width: '100%',\n            height: '100%',\n          }\n        : {};\n      if (!isHighResImageLoaded) {\n        let preload = null;\n        const preloadProps = {\n          className: 'gallery-item-visible gallery-item gallery-item-preloaded',\n          key: 'gallery-item-image-img-preload',\n          'data-hook': 'gallery-item-image-img-preload',\n          loading: 'eager',\n          ...imageProps,\n        };\n        switch (options[optionsMap.behaviourParams.item.content.loader]) {\n          case GALLERY_CONSTS[optionsMap.behaviourParams.item.content.loader].BLUR:\n            preload = (\n              <ImageRenderer\n                alt={altText}\n                key={'image_preload_blur-' + id}\n                src={createUrl(GALLERY_CONSTS.urlSizes.RESIZED, GALLERY_CONSTS.urlTypes.LOW_RES)}\n                style={{\n                  ...imageSizing,\n                  ...preloadStyles,\n                  ...blockDownloadStyles,\n                }}\n                {...preloadProps}\n                customImageRenderer={this.props.customComponents?.customImageRenderer}\n              />\n            );\n            break;\n          case GALLERY_CONSTS[optionsMap.behaviourParams.item.content.loader].MAIN_COLOR:\n            preload = (\n              <ImageRenderer\n                alt={altText}\n                key={'image_preload_main_color-' + id}\n                src={createUrl(GALLERY_CONSTS.urlSizes.PIXEL, GALLERY_CONSTS.urlTypes.HIGH_RES)}\n                style={{\n                  ...imageSizing,\n                  ...preloadStyles,\n                  ...blockDownloadStyles,\n                }}\n                {...preloadProps}\n                customImageRenderer={this.props.customComponents?.customImageRenderer}\n              />\n            );\n            break;\n        }\n\n        imagesComponents.push(preload);\n      }\n\n      const shouldRenderHighResImages = !this.props.isPrerenderMode;\n      const imageType =\n        options[optionsMap.stylingParams.itemResolutionMode] ===\n        GALLERY_CONSTS[optionsMap.stylingParams.itemResolutionMode].FULL\n          ? GALLERY_CONSTS.urlSizes.FULL\n          : GALLERY_CONSTS.urlSizes.MULTI;\n      const src = createUrl(imageType, GALLERY_CONSTS.urlTypes.HIGH_RES);\n\n      const highres = (\n        <ImageRenderer\n          key={'image_highres-' + id}\n          className={`gallery-item-visible gallery-item gallery-item-preloaded`}\n          data-hook=\"gallery-item-image-img\"\n          data-idx={idx}\n          src={src}\n          alt={altText}\n          onLoad={this.handleHighResImageLoad}\n          loading={this.props.isPrerenderMode ? 'lazy' : 'eager'}\n          style={{\n            ...imageSizing,\n            ...blockDownloadStyles,\n            ...(!shouldRenderHighResImages && preloadStyles),\n          }}\n          {...imageProps}\n          customImageRenderer={this.props.customComponents?.customImageRenderer}\n        />\n      );\n\n      imagesComponents.push(highres);\n\n      return imagesComponents;\n    };\n\n    return image;\n  }\n\n  render() {\n    const imageRenderer = this.getImageElement();\n    const imageContainerClassNames = `${this.getImageContainerClassNames()} ${this.props.extraClasses || ''}`;\n    const animationOverlay = this.props.overlay || this.getImageAnimationOverlay();\n\n    const renderedItem = this.getImageContainer(imageRenderer, imageContainerClassNames, animationOverlay);\n    return renderedItem;\n  }\n}\n/* eslint-enable prettier/prettier */\nexport default ImageItem;\n"]}