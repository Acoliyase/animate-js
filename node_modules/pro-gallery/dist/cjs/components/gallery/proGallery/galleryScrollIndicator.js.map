{"version":3,"file":"galleryScrollIndicator.js","sourceRoot":"","sources":["../../../../../src/components/gallery/proGallery/galleryScrollIndicator.js"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { utils, GALLERY_CONSTS, optionsMap } from 'pro-gallery-lib';\nimport { cssScrollHelper } from '../../helpers/cssScrollHelper.js';\n\nexport default class ScrollIndicator extends React.Component {\n  constructor(props) {\n    super();\n\n    this.state = {\n      scrollTop: 0,\n      scrollLeft: 0,\n    };\n    this.debouncedOnScroll = utils.debounce(props.onScroll, 50);\n  }\n\n  removeScrollListener() {\n    if (this.scrollEventListenerSet) {\n      const scrollingElement = this.props.scrollingElement;\n      try {\n        scrollingElement.vertical().removeEventListener('scroll', this.onVerticalScroll);\n      } catch (e) {\n        //\n      }\n\n      try {\n        const { scrollDirection } = this.props;\n        if (scrollDirection === GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL) {\n          scrollingElement.horizontal().removeEventListener('scroll', this.onHorizontalScroll);\n        }\n      } catch (e) {\n        //\n      }\n      this.scrollEventListenerSet = false;\n    }\n  }\n\n  initScrollListener() {\n    if (this.scrollEventListenerSet) {\n      this.removeScrollListener();\n    }\n\n    this.scrollEventListenerSet = true;\n    const scrollingElement = this.props.scrollingElement;\n    //Horizontal Scroll\n    this.onHorizontalScrollTransition = ({ detail }) => {\n      const step = Math.round(detail);\n      if (step >= 0) {\n        if (\n          this.props.galleryScrollDirection ===\n          GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL\n        ) {\n          this.setState({\n            scrollLeft: this.state.scrollLeft + step,\n          });\n        }\n      }\n    };\n\n    this.onHorizontalScroll = (e) => {\n      this.props.setGotFirstScrollIfNeeded();\n      const target = e.currentTarget || e.target || e;\n      let left = target && (target.scrollX ?? target.scrollLeft ?? target.x);\n      if (this.props.isRTL) {\n        left = Math.abs(left); //this.props.totalWidth - left;\n      }\n      if (left >= 0) {\n        if (\n          this.props.galleryScrollDirection ===\n          GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL\n        ) {\n          this.setState({\n            scrollTop: left,\n            scrollLeft: left,\n          });\n          this.props.getMoreItemsIfNeeded(left);\n          this.debouncedOnScroll({ left });\n        }\n      }\n    };\n\n    if (\n      this.props.galleryScrollDirection === GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL\n    ) {\n      try {\n        scrollingElement?.horizontal()?.addEventListener('scroll', this.onHorizontalScroll);\n        scrollingElement?.horizontal()?.addEventListener('scrollTransition', this.onHorizontalScrollTransition);\n      } catch (e) {\n        console.error(e);\n      }\n    }\n    //Vertical Scroll\n    this.onVerticalScroll = (e) => {\n      this.props.setGotFirstScrollIfNeeded();\n      const target = e.currentTarget || e.target || e;\n      const top = target && (target.scrollY || target.scrollTop || target.y);\n      // console.log('[RTL SCROLL] onVerticalScroll: ', left);\n      if (top >= 0) {\n        if (\n          this.props.galleryScrollDirection ===\n          GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].VERTICAL\n        ) {\n          this.setState({\n            scrollTop: top,\n          });\n          this.props.getMoreItemsIfNeeded(top);\n        }\n        this.debouncedOnScroll({ top });\n      }\n    };\n    try {\n      scrollingElement.vertical().addEventListener('scroll', this.onVerticalScroll);\n    } catch (e) {\n      console.error(e);\n    }\n  }\n\n  componentWillUnmount() {\n    this.removeScrollListener();\n  }\n\n  componentDidMount() {\n    this.initScrollListener();\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    let didChange = false;\n    for (const prop of ['id', 'scrollDirection', 'isRTL', 'totalWidth', 'scrollBase', 'scrollingElement']) {\n      if (nextProps[prop] !== this.props[prop]) {\n        didChange = true;\n        break;\n      }\n    }\n\n    if (didChange) {\n      this.initScrollListener();\n    }\n  }\n\n  render() {\n    const verticalScrollBase =\n      this.props.galleryScrollDirection ===\n        GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].VERTICAL && this.props.scrollBase > 0\n        ? this.props.scrollBase\n        : 0;\n    const scrollTopWithoutBase = this.state.scrollTop - verticalScrollBase;\n    const { id } = this.props;\n    return (\n      <div\n        key=\"css-scroll-indicator\"\n        data-hook=\"css-scroll-indicator\"\n        data-scroll-base={verticalScrollBase}\n        data-scroll-top={this.state.scrollTop}\n        className={cssScrollHelper.calcScrollClasses(id, scrollTopWithoutBase)}\n        style={{ display: 'none' }}\n      />\n    );\n  }\n}\n"]}