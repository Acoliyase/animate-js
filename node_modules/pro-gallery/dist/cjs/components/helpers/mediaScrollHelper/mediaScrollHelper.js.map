{"version":3,"file":"mediaScrollHelper.js","sourceRoot":"","sources":["../../../../../src/components/helpers/mediaScrollHelper/mediaScrollHelper.ts"],"names":[],"mappings":"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","sourcesContent":["import { GALLERY_CONSTS, PlayTrigger, optionsMap, window } from 'pro-gallery-lib';\nimport { isWithinPaddingVertically, isWithinPaddingHorizontally } from './utils.js';\nimport { SetItemIdx, UpdateGalleryData, SetScroll, Scroll, HandleEvents, GetPlayTrigger } from './types.js';\n\nclass VideoScrollHelper {\n  private scrollBase = 0;\n  private items: any[] = [];\n  private currentPlayingIdx = -1;\n  private currentItemCount = 0;\n  private playTrigger?: PlayTrigger;\n  private scrollDirection?: string;\n  private lastVideoPlayed = -1;\n  private readonly itemRatingMap = new Map();\n  private galleryWidth?: number;\n  private videoLoop?: boolean;\n  private top!: number;\n  private left!: number;\n  constructor(\n    public setPlayingItem: SetItemIdx,\n    public readonly isItemSupported: (item: any) => boolean,\n    public readonly getPlayTrigger: GetPlayTrigger\n  ) {}\n\n  //--------------------------updates----------------------------------//\n  public readonly updateGalleryStructure: UpdateGalleryData = ({\n    galleryStructure,\n    galleryWidth,\n    scrollBase,\n    options,\n  }) => {\n    this.galleryWidth = galleryWidth;\n    this.scrollBase = scrollBase;\n    this.playTrigger = this.getPlayTrigger(options);\n    this.videoLoop = options.behaviourParams_item_video_loop;\n    this.scrollDirection = options.layoutParams_structure_scrollDirection;\n    this.currentItemCount = galleryStructure.galleryItems.length;\n    this.items = [];\n    galleryStructure.galleryItems.forEach((item) => {\n      if (this.isItemSupported(item)) {\n        if (!this.itemRatingMap.has(item.id)) {\n          this.itemRatingMap.set(item.id, item.idx);\n        }\n        this.items.push(item);\n      }\n    });\n  };\n\n  //--------------------------triggers--------------------------------//\n\n  public readonly handleEvent: HandleEvents = ({ eventName, eventData }) => {\n    switch (eventName) {\n      case GALLERY_CONSTS.events.ITEM_ACTION_TRIGGERED:\n        //case VIDEO_EVENTS.clicked:\n        this.itemClicked(eventData.idx);\n        break;\n      case GALLERY_CONSTS.events.VIDEO_PAUSED:\n        if (this.currentPlayingIdx === eventData.idx) {\n          this.stop(eventData.idx);\n        }\n        break;\n      case GALLERY_CONSTS.events.HOVER_SET:\n        //case VIDEO_EVENTS.hovered:\n        this.itemHovered(eventData);\n        break;\n      case GALLERY_CONSTS.events.VIDEO_ENDED:\n        //case VIDEO_EVENTS.ended:\n        this.videoEnded(eventData.idx);\n        break;\n      case GALLERY_CONSTS.events.VIDEO_PLAYED:\n        //case VIDEO_EVENTS.ended:\n        this.videoPlayed(eventData.idx);\n        break;\n      case GALLERY_CONSTS.events.VIDEO_ERROR:\n        //case VIDEO_EVENTS.ended:\n        this.videoErrorReported();\n        break;\n      default:\n    }\n  };\n\n  private readonly shouldTriggerAction = (idx: number, action: PlayTrigger = 'HOVER'): boolean => {\n    return this.findItem(idx) && this.shouldTrigger(action);\n  };\n\n  private readonly itemHovered: SetItemIdx = (idx) => {\n    this.shouldTriggerAction(idx, 'HOVER') && this.play(idx);\n  };\n\n  private readonly itemClicked: SetItemIdx = (idx) => {\n    if (!this.shouldTriggerAction(idx, 'CLICK')) {\n      return;\n    }\n    if (this.currentPlayingIdx === idx) {\n      this.stop(idx);\n    } else {\n      this.play(idx);\n    }\n  };\n\n  public readonly onScroll: SetScroll = ({ top, left }) => {\n    this.top = top >= 0 ? top : this.top;\n    this.left = left >= 0 ? left : this.left;\n    if (this.currentPlayingIdx === -1) {\n      this.autoPlayNextItemByRating({ top: this.top, left: this.left });\n    } else {\n      if (!this.isCurrentItemStillVisible({ top: this.top, left: this.left })) {\n        this.stop(this.currentPlayingIdx);\n      }\n      this.autoPlayNextItemByRating({ top: this.top, left: this.left });\n    }\n  };\n\n  private readonly videoEnded: SetItemIdx = (idx) => {\n    this.stop(idx);\n    const scroll = { top: this.top, left: this.left };\n    this.autoPlayNextItemByRating(scroll);\n  };\n\n  private readonly videoPlayed: SetItemIdx = (idx) => {\n    if (this.currentPlayingIdx !== idx && !this.findItem(idx)) {\n      this.play(idx);\n    }\n    this.lastVideoPlayed = idx;\n  };\n\n  private readonly videoErrorReported = (): void => {\n    this.stop();\n  };\n\n  public readonly initializePlayState = (): void => {\n    this.autoPlayNextItemByRating({ top: this.top, left: this.left });\n  };\n\n  //-------------------------------controls------------------------------------//\n\n  private readonly autoPlayNextItemByRating: SetScroll = ({ top, left }) => {\n    if (!this.shouldTrigger('AUTO')) {\n      return;\n    }\n\n    const secondBestRating = {\n      idx: -1,\n      rating: Infinity,\n    };\n    const bestRating = {\n      idx: -1,\n      rating: Infinity,\n    };\n    this.items.some((item) => {\n      if (this.isVisible(item, { top, left })) {\n        const itemRating = this.itemRatingMap.get(item.id);\n        if (itemRating <= bestRating.rating) {\n          secondBestRating.idx = bestRating.idx;\n          secondBestRating.rating = bestRating.rating;\n          bestRating.idx = item.idx;\n          bestRating.rating = itemRating;\n        } else if (itemRating <= secondBestRating.rating) {\n          secondBestRating.idx = item.idx;\n          secondBestRating.rating = itemRating;\n        }\n        return false;\n      } else {\n        if (bestRating.idx >= 0) {\n          return true;\n        }\n        return false;\n      }\n    });\n    if (bestRating.idx >= 0) {\n      if (!this.videoLoop && bestRating.idx === this.lastVideoPlayed) {\n        if (secondBestRating.idx >= 0) {\n          this.play(secondBestRating.idx); //play 2nd in line instead. keep best rating for next by the score he got...\n        } else {\n          return; //cant play same video twice.\n        }\n      } else {\n        this.play(bestRating.idx);\n      }\n    } else {\n      this.lastVideoPlayed = -2; //if there are no videos to play. we can reset this mechanism so that one-video galleries can keep playing the same video\n    }\n  };\n\n  private readonly play: SetItemIdx = (idx) => {\n    this.setPlayingIdx(idx);\n  };\n\n  public readonly stop = (idx = this.currentPlayingIdx): void => {\n    const item = this.findItem(idx);\n    if (item) {\n      const newRating = this.itemRatingMap.get(item.id) + this.currentItemCount;\n      this.itemRatingMap.set(item.id, newRating);\n    }\n    this.setPlayingIdx(-1);\n  };\n\n  private readonly onPlayingIdxChange = (): void => {\n    this.setPlayingItem(this.currentPlayingIdx);\n  };\n  //-------------------------------get/set----------------------------------------//\n\n  private readonly setPlayingIdx: SetItemIdx = (idx) => {\n    if (this.currentPlayingIdx !== idx) {\n      this.currentPlayingIdx = idx;\n      this.onPlayingIdxChange();\n    }\n  };\n\n  //-----------------------------Utils--------------------------------------------//\n\n  private readonly isCurrentItemStillVisible = ({ top, left }: Scroll): boolean => {\n    const currentItemPlacement = this.findItem(this.currentPlayingIdx);\n    if (!currentItemPlacement) {\n      return false;\n    }\n    return this.isVisible(currentItemPlacement, { top, left });\n  };\n  private readonly isVisible = (item: any, { top, left }: Scroll): boolean => {\n    const target = {\n      offsetTop: this.scrollBase || 0,\n      scrollY: top,\n      scrollLeft: left,\n    };\n    const itemPlayVerticalTolerance = (item.offset.top - item.offset.bottom) / 2;\n    const itemPlayHorizontalTolerance = (item.offset.left - item.offset.right) / 2;\n    const visibleVertically = isWithinPaddingVertically({\n      target,\n      scrollBase: this.scrollBase,\n      top: item.offset.top,\n      bottom: item.offset.top + item.style.height,\n      screenHeight: window && window.innerHeight,\n      padding: itemPlayVerticalTolerance,\n    });\n    let visibleHorizontally;\n    if (this.scrollDirection === GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].VERTICAL) {\n      visibleHorizontally = true;\n    } else {\n      visibleHorizontally = isWithinPaddingHorizontally({\n        target,\n        left: item.offset.left,\n        right: item.offset.left + item.style.width,\n        screenWidth: this.galleryWidth || (window && window.innerWidth),\n        padding: itemPlayHorizontalTolerance,\n      });\n    }\n    return visibleVertically && visibleHorizontally;\n  };\n  private readonly shouldTrigger = (action: PlayTrigger): boolean => {\n    return this.playTrigger === action;\n  };\n  public readonly findItem = (idx: number): any => {\n    return this.items.find((item) => item.idx === idx);\n  };\n}\n\nexport default VideoScrollHelper;\n"]}