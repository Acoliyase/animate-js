{"version":3,"file":"mediaItem.js","sourceRoot":"","sources":["../../../../../src/components/item/media/mediaItem.tsx"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/ban-types */\nimport React, { useMemo, useEffect, useState } from 'react';\nimport { optionsMap, GALLERY_CONSTS, isEditMode } from 'pro-gallery-lib';\nimport { GalleryUI } from './GalleryUI.js';\nimport { Options, Settings, utils } from 'pro-gallery-lib';\nimport ImageItem from '../imageItem.js';\nimport IframeVideoPlayer from '../videos/IframeVideoPlayer.js';\n\nexport type MediaBaseProps = {\n  calculatedAlt: string;\n  title: string;\n  description: string;\n  id: string;\n  idx: number;\n  activeIndex: number;\n  isCurrentHover: boolean;\n  options: Options;\n  createUrl: any;\n  createMagnifiedUrl: any;\n  settings: Settings;\n  isPrerenderMode: boolean;\n  isTransparent: boolean;\n  style: any;\n  actions: any;\n  customComponents: any;\n  shouldPlay: boolean;\n  imageDimensions: any;\n  hasLink: boolean;\n  placeholderExtraClasses: string[];\n  showPlayButton: boolean;\n  hover: JSX.Element;\n  enableImagePlaceholder: boolean;\n};\n\nexport type MediaProps<T extends Record<string, any>> = MediaBaseProps & {\n  MediaImplementation: React.ComponentType<MediaImplementationProps<Omit<T, 'MediaImplementation'>>>;\n} & T;\n\nexport type MediaImplementationProps<T = {}> = T &\n  MediaBaseProps & {\n    thumbnail: JSX.Element;\n    thumbnailWithOverride(props: ImageItem['props']): JSX.Element;\n    placeholder: JSX.Element;\n  };\n\nconst getPlayButtonComponentByItemType = (type: string) => {\n  if (type === 'video') {\n    return <GalleryUI type={'videoPlayButton'} size={60} />;\n  } else if (type === '3d') {\n    return <GalleryUI type={'rotateArrow'} size={60} />;\n  } else {\n    return <></>;\n  }\n};\n\nexport default function MediaItem<T extends Record<string, any>>(props: MediaProps<T>): JSX.Element {\n  const {\n    hasLink,\n    options,\n    imageDimensions,\n    showPlayButton,\n    MediaImplementation,\n    enableImagePlaceholder,\n    isVideoPlaceholder,\n    videoPlaceholderUrl,\n  } = props;\n  const { behaviourParams_item_clickAction: clickAction, behaviourParams_item_video_playTrigger: playTrigger } =\n    options;\n\n  const [isMounted, setIsMounted] = useState(false);\n\n  useEffect(() => {\n    setIsMounted(true);\n  }, []);\n\n  const isMediaPlayable = useMemo(() => {\n    if (utils.isSSR()) {\n      return false;\n    }\n    if (\n      playTrigger === GALLERY_CONSTS[optionsMap.behaviourParams.item.video.playTrigger].HOVER ||\n      playTrigger === GALLERY_CONSTS[optionsMap.behaviourParams.item.video.playTrigger].AUTO\n    ) {\n      return true;\n    } else if (\n      clickAction === GALLERY_CONSTS[optionsMap.behaviourParams.item.clickAction].NOTHING ||\n      clickAction === GALLERY_CONSTS[optionsMap.behaviourParams.item.clickAction].MAGNIFY\n    ) {\n      return true;\n    } else if (clickAction === GALLERY_CONSTS[optionsMap.behaviourParams.item.clickAction].LINK && !hasLink) {\n      return true;\n    }\n    return false;\n  }, [hasLink, playTrigger, clickAction]);\n\n  const createIframePlayer = () => (\n    <IframeVideoPlayer dimensions={imageDimensions} url={isVideoPlaceholder ? videoPlaceholderUrl : props.videoUrl} />\n  );\n\n  const createThumbnail = (propsOverrides: any = {}) =>\n    enableImagePlaceholder ? (\n      <ImageItem\n        {...props}\n        imageDimensions={imageDimensions}\n        id={props.idx}\n        overlay={showPlayButton && !isMediaPlayable && getPlayButtonComponentByItemType(props.type)}\n        extraClasses={props.placeholderExtraClasses.join(' ')}\n        {...propsOverrides}\n      />\n    ) : (\n      <></>\n    );\n  const thumbnail = createThumbnail();\n  const iframeVideoPlayer = createIframePlayer();\n  const placeholder = (\n    <>\n      {thumbnail}\n      {iframeVideoPlayer}\n      {props.hover}\n    </>\n  );\n  if (!isMediaPlayable || props.isPrerenderMode || !isMounted) {\n    return placeholder;\n  }\n\n  if (isEditMode()) {\n    return (\n      <>\n        {thumbnail}\n        {props.hover}\n      </>\n    );\n  }\n\n  return (\n    <React.Suspense fallback={placeholder}>\n      <MediaImplementation\n        {...props}\n        thumbnail={thumbnail}\n        placeholder={placeholder}\n        thumbnailWithOverride={createThumbnail}\n      />\n    </React.Suspense>\n  );\n}\n"]}