{"version":3,"file":"textItem.js","sourceRoot":"","sources":["../../../../src/components/item/textItem.js"],"names":[],"mappings":"AAAA,OAAO,EAAE,cAAc,EAAE,UAAU,EAAE,MAAM,iBAAiB,CAAC;AAC7D,OAAO,KAAK,MAAM,OAAO,CAAC;AAE1B,MAAM,CAAC,OAAO,OAAO,QAAS,SAAQ,KAAK,CAAC,SAAS;IACnD,YAAY,KAAK;QACf,KAAK,CAAC,KAAK,CAAC,CAAC;QACb,IAAI,OAAO,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,KAAK,UAAU,EAAE;YAC1D,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,EAAE,CAAC;SACpC;IACH,CAAC;IAED,iBAAiB;QACf,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,SAAS,EAAE,eAAe,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;QAClE,MAAM,cAAc,GAAG,KAAK,CAAC,KAAK,GAAG,SAAS,GAAG,IAAI,CAAC;QACtD,MAAM,EAAE,UAAU,EAAE,SAAS,EAAE,GAAG,eAAe,CAAC;QAClD,iCAAiC;QACjC,MAAM,UAAU,GACd,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,GAAG,KAAK,CAAC,SAAS,CAAC;QACrG,MAAM,SAAS,GACb,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,GAAG,KAAK,CAAC,QAAQ,CAAC;QACrG,MAAM,SAAS,GACb,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,cAAc,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG;YACtG,CAAC,CAAC,MAAM;YACR,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,CAAC,OAAO,IAAI,CAAC,KAAK,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,UAAU,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC;QACzG,MAAM,KAAK,GAAG,cAAc,CAAC,CAAC,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC,QAAQ,CAAC;QAC7F,MAAM,SAAS,GAAG,aAAa,SAAS,WAAW,KAAK,GAAG,CAAC;QAC5D,MAAM,gBAAgB,GAAG,IAAI,CAAC,KAAK,CAAC,UAAU,GAAG,KAAK,CAAC,CAAC;QACxD,MAAM,eAAe,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,GAAG,KAAK,CAAC,CAAC;QACtD,OAAO;YACL,KAAK,EAAE,KAAK,CAAC,QAAQ,GAAG,IAAI;YAC5B,MAAM,EAAE,KAAK,CAAC,SAAS,GAAG,IAAI;YAC9B,UAAU,EAAE,gBAAgB;YAC5B,SAAS,EAAE,eAAe;YAC1B,eAAe,EAAE,GAAG,CAAC,gBAAgB,MAAM,CAAC,eAAe,IAAI;YAC/D,eAAe,EAAE,SAAS;YAC1B,WAAW,EAAE,SAAS;YACtB,UAAU,EAAE,SAAS;YACrB,SAAS;SACV,CAAC;IACJ,CAAC;IAED,gBAAgB,CAAC,IAAI;QACnB,kDAAkD;QAClD,2HAA2H;QAC3H,IAAI;YACF,OAAO,IAAI,CAAC,OAAO,CAAC,oBAAoB,EAAE,EAAE,CAAC,CAAC;SAC/C;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,IAAI,CAAC;SACb;IACH,CAAC;IAED,MAAM;QACJ,MAAM,EAAE,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,eAAe,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;QAC1E,MAAM,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,CAAC;QAClD,MAAM,UAAU,GAAG,IAAI,CAAC,iBAAiB,EAAE,CAAC;QAC5C,MAAM,SAAS,GAAG,EAAE,uBAAuB,EAAE,EAAE,MAAM,EAAE,aAAa,EAAE,EAAE,CAAC;QACzE,MAAM,aAAa,GAAG;YACpB,KAAK,EAAE,MAAM,CAAC,MAAM,CAClB,UAAU,EACV,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,cAAc,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG;gBACtG,CAAC,CAAC,EAAE,eAAe,EAAE,KAAK,CAAC,OAAO,EAAE;gBACpC,CAAC,CAAC,EAAE,CACP;SACF,CAAC;QACF,MAAM,UAAU,mCACX,SAAS,GACT,aAAa,CACjB,CAAC;QACF,MAAM,gBAAgB,GAAG;YACvB,MAAM,EAAE,eAAe,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC,CAAC,eAAe,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS;YAC3F,eAAe,EACb,OAAO,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,cAAc,CAAC,UAAU,CAAC,YAAY,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,GAAG;gBACtG,CAAC,CAAC,KAAK,CAAC,OAAO;gBACf,CAAC,CAAC,SAAS;SAChB,CAAC;QAEF,IAAI,eAAe,IAAI,eAAe,CAAC,YAAY,EAAE;YACnD,gBAAgB,CAAC,YAAY,GAAG,eAAe,CAAC,YAAY,CAAC;SAC9D;QACD,MAAM,gBAAgB,GAAG;YACvB,sBAAsB;YACtB,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC,oBAAoB,CAAC,CAAC,CAAC,sBAAsB;SAC1E,CAAC;QACF,OAAO,CACL,6BAAK,SAAS,EAAE,gBAAgB,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,KAAK,EAAE,gBAAgB;YACjE,2CACE,SAAS,EAAE,iEAAiE,EAC5E,GAAG,EAAE,YAAY,GAAG,EAAE,EACtB,YAAY,EAAE,OAAO,CAAC,mBAAmB,EACzC,UAAU,EAAE,OAAO,CAAC,iBAAiB,eAC3B,WAAW,IACjB,UAAU,EACd,CACE,CACP,CAAC;IACJ,CAAC;CACF;AACD,qCAAqC","sourcesContent":["import { GALLERY_CONSTS, optionsMap } from 'pro-gallery-lib';\nimport React from 'react';\n\nexport default class TextItem extends React.Component {\n  constructor(props) {\n    super(props);\n    if (typeof this.props.actions.setItemLoaded === 'function') {\n      this.props.actions.setItemLoaded();\n    }\n  }\n\n  getTextDimensions() {\n    const { style, options, cropRatio, imageDimensions } = this.props;\n    const isVerticalItem = style.ratio < cropRatio - 0.01;\n    const { marginLeft, marginTop } = imageDimensions;\n    //text dimensions include scaling\n    const textHeight =\n      (isVerticalItem ? style.height / style.maxHeight : style.width / style.maxWidth) * style.maxHeight;\n    const textWidth =\n      (!isVerticalItem ? style.width / style.maxWidth : style.height / style.maxHeight) * style.maxWidth;\n    const translate =\n      options[optionsMap.layoutParams.crop.method] === GALLERY_CONSTS[optionsMap.layoutParams.crop.method].FIT\n        ? '0, 0'\n        : `${Math.round((style.width - textWidth) / 2)}px, ${Math.round((style.height - textHeight) / 2)}px`;\n    const scale = isVerticalItem ? style.height / style.maxHeight : style.width / style.maxWidth;\n    const transform = `translate(${translate}) scale(${scale})`;\n    const scaledMarginLeft = Math.round(marginLeft / scale);\n    const scaledMarginTop = Math.round(marginTop / scale);\n    return {\n      width: style.maxWidth + 'px',\n      height: style.maxHeight + 'px',\n      marginLeft: scaledMarginLeft,\n      marginTop: scaledMarginTop,\n      transformOrigin: `${-scaledMarginLeft}px ${-scaledMarginTop}px`,\n      WebkitTransform: transform,\n      MsTransform: transform,\n      OTransform: transform,\n      transform,\n    };\n  }\n\n  processInnerhtml(html) {\n    // Remove html class name from inner html elements\n    // In older version of the text editor we used font themes (set as classes). Without the iframe it clashes with Santa's css\n    try {\n      return html.replace(/class=\"font_\\d+\"/gm, '');\n    } catch (e) {\n      return html;\n    }\n  }\n\n  render() {\n    const { id, options, html, style, actions, imageDimensions } = this.props;\n    const processedHtml = this.processInnerhtml(html);\n    const dimensions = this.getTextDimensions();\n    const htmlParam = { dangerouslySetInnerHTML: { __html: processedHtml } };\n    const changeBgColor = {\n      style: Object.assign(\n        dimensions,\n        options[optionsMap.layoutParams.crop.method] === GALLERY_CONSTS[optionsMap.layoutParams.crop.method].FIT\n          ? { backgroundColor: style.bgColor }\n          : {}\n      ),\n    };\n    const attributes = {\n      ...htmlParam,\n      ...changeBgColor,\n    };\n    const itemContentStyle = {\n      height: imageDimensions && !this.props.isPrerenderMode ? imageDimensions.height : 'inherit',\n      backgroundColor:\n        options[optionsMap.layoutParams.crop.method] !== GALLERY_CONSTS[optionsMap.layoutParams.crop.method].FIT\n          ? style.bgColor\n          : 'inherit',\n    };\n\n    if (imageDimensions && imageDimensions.borderRadius) {\n      itemContentStyle.borderRadius = imageDimensions.borderRadius;\n    }\n    const containerClasses = [\n      'gallery-item-content',\n      this.props.isCurrentHover ? 'item-content-hover' : 'item-content-regular',\n    ];\n    return (\n      <div className={containerClasses.join(' ')} style={itemContentStyle}>\n        <div\n          className={'gallery-item-visible gallery-item gallery-item-loaded text-item'}\n          key={'item-text-' + id}\n          onTouchStart={actions.handleItemMouseDown}\n          onTouchEnd={actions.handleItemMouseUp}\n          data-hook=\"text-item\"\n          {...attributes}\n        />\n      </div>\n    );\n  }\n}\n/* eslint-enable prettier/prettier */\n"]}