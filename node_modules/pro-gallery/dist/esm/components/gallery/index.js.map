{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../../src/components/gallery/index.tsx"],"names":[],"mappings":"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","sourcesContent":["import React from 'react';\nimport { GALLERY_CONSTS, utils } from 'pro-gallery-lib';\nimport { BlueprintsManager } from 'pro-gallery-blueprints';\nimport ProGallery from './proGallery/proGallery.js';\nimport { GalleryProps, GalleryState } from 'pro-gallery-lib';\nimport shouldValidate from './typeValidator/shouldValidate.js';\nimport { ViewModeWrapperHOC } from './proGallery/viewModeWrapper.js';\n\nclass Gallery extends React.Component<GalleryProps, GalleryState> {\n  private blueprintsManager: any;\n  private galleryProps: any;\n\n  constructor(props: GalleryProps) {\n    super(props);\n    this.isUsingCustomInfoElements = this.isUsingCustomInfoElements.bind(this);\n    this.blueprintsManager = new BlueprintsManager({ id: 'layoutingGallery' });\n    this.blueprintsManager.init({\n      deviceType: props.deviceType,\n      api: {\n        isUsingCustomInfoElements: this.isUsingCustomInfoElements,\n        fetchMoreItems: (from) => {\n          typeof props.eventsListener === 'function' &&\n            props.eventsListener(GALLERY_CONSTS.events.NEED_MORE_ITEMS, from);\n        },\n        onBlueprintReady: ({ blueprint, blueprintChanged, initialBlueprint }) => {\n          if (blueprintChanged) {\n            this.setBlueprint(blueprint, initialBlueprint);\n          } else {\n            if (utils.isVerbose()) {\n              console.count('>>> Blueprint not changed, not setting it');\n            }\n          }\n        },\n      },\n    });\n    this.onNewProps(props, true);\n    this.state = {\n      blueprint: this.blueprintsManager.createInitialBlueprint(props) || null,\n    };\n  }\n\n  setBlueprint(blueprint, initialBlueprint) {\n    if (initialBlueprint) {\n      // the blueprint from the initial blueprint flow will be set in the constructor\n    } else {\n      this.setState({ blueprint });\n    }\n  }\n\n  isUsingCustomInfoElements() {\n    return (\n      !!this.galleryProps.customComponents.customHoverRenderer ||\n      !!this.galleryProps.customComponents.customInfoRenderer\n    );\n  }\n\n  onNewProps(props, calledByConstructor) {\n    const { eventsListener, ...otherProps } = props;\n    const _eventsListener = (eventName, eventData, event) => {\n      if (eventName === GALLERY_CONSTS.events.NEED_MORE_ITEMS) {\n        this.blueprintsManager.getMoreItems(eventData);\n      } else {\n        typeof eventsListener === 'function' && eventsListener(eventName, eventData, event);\n      }\n    };\n    this.galleryProps = {\n      ...otherProps,\n      eventsListener: _eventsListener,\n      id: props.id || 'default-dom-id',\n      customComponents: props.customComponents || {},\n    };\n    if (calledByConstructor) {\n      // the blueprint will be initiated with the state\n    } else {\n      this.blueprintsManager.createBlueprint(this.galleryProps).catch((e) => {\n        //TODOVER3 check totalItemsCount\n        console.error('Could not create a blueprint from the new props', e);\n      });\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(newProps) {\n    this.onNewProps(newProps, false);\n  }\n\n  render() {\n    const { blueprint, typeErrors } = this.state;\n\n    if (typeErrors) {\n      return typeErrors;\n    }\n    if (blueprint && Object.keys(blueprint).length > 0) {\n      return <ProGallery {...this.galleryProps} {...blueprint} />;\n    } else {\n      return null;\n    }\n  }\n\n  async componentDidMount() {\n    if (shouldValidate(this.props, utils.isSSR()) === false) {\n      return;\n    }\n    const validateTypesModule = await import(\n      /* webpackChunkName: \"proGallery_validateTypes\" */ './typeValidator/validateTypes.js'\n    );\n    const { validate, typeErrorsUI } = validateTypesModule;\n    const typeErrors = validate(this.state.blueprint.options);\n    if (typeErrors.length > 0) {\n      this.setState({ typeErrors: typeErrorsUI(typeErrors) });\n    }\n  }\n}\n\nexport default ViewModeWrapperHOC<GalleryProps>(Gallery);\n"]}