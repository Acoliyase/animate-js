{"version":3,"file":"mediaScrollHelperWrapper.js","sourceRoot":"","sources":["../../../../../src/components/helpers/mediaScrollHelper/mediaScrollHelperWrapper.ts"],"names":[],"mappings":"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","sourcesContent":["import { isEditMode } from 'pro-gallery-lib';\nimport {\n  HandleEvents,\n  MediaScrollHelperHandlerConfiguration,\n  SetItemIdx,\n  SetScroll,\n  UpdateGalleryData,\n} from './types.js';\n\nclass MediaScrollHelper {\n  left: number;\n  top: number;\n  private scrollHelpers: InstanceType<typeof import('./mediaScrollHelper')['default']>[] = [];\n  constructor(private config: MediaScrollHelperHandlerConfiguration) {\n    this.left = 0;\n    this.top = 0;\n  }\n  stop: SetItemIdx = (idx) => {\n    for (const scrollHelper of this.scrollHelpers) {\n      if (scrollHelper.findItem(idx)) {\n        scrollHelper.stop(idx);\n      }\n    }\n  };\n  initializePlayState = (): void => {\n    for (const scrollHelper of this.scrollHelpers) {\n      scrollHelper.initializePlayState();\n    }\n  };\n  onScroll: SetScroll = ({ top, left }) => {\n    if (!this.scrollHelpers.length) {\n      this.top = top || this.top;\n      this.left = left || this.left;\n    }\n    for (const scrollHelper of this.scrollHelpers) {\n      scrollHelper.onScroll({ top, left });\n    }\n  };\n  latestGalleryStructure: any;\n  scrollHelperPromise: Promise<void> | undefined;\n  handleEvent: HandleEvents = (event) => {\n    for (const scrollHelper of this.scrollHelpers) {\n      scrollHelper.handleEvent(event);\n    }\n  };\n  updateGalleryStructure: UpdateGalleryData = (data) => {\n    if (data.isSSR) {\n      //TODO - This could be broken in hydrate since we use inPrerenderMode. (diff between hydrate and ssr are breaking)\n      return;\n    }\n    for (const scrollHelper of this.scrollHelpers) {\n      scrollHelper.updateGalleryStructure(data);\n    }\n    if (this.scrollHelperPromise) {\n      this.latestGalleryStructure = data;\n      return;\n    }\n    this.latestGalleryStructure = data;\n    if (isEditMode()) {\n      return;\n    }\n    if (!data.galleryStructure.galleryItems.some((item) => this.config.some((c) => c.supportedItemsFilter(item)))) {\n      return;\n    }\n    this.scrollHelperPromise = import(/* webpackChunkName: \"proGallery_videoScrollHelper\" */ './mediaScrollHelper.js')\n      .then(({ default: VideoScrollHelper }) => {\n        for (const config of this.config) {\n          this.scrollHelpers.push(\n            // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n            // @ts-ignore\n            new VideoScrollHelper(config.onSetPlayingIdx, config.supportedItemsFilter, config.getPlayTrigger)\n          );\n        }\n        this.updateGalleryStructure(this.latestGalleryStructure);\n        this.onScroll({ top: this.top, left: this.left });\n      })\n      .catch((e) => {\n        console.error('Failed to load videoScrollHelper. error: ' + e);\n      });\n  };\n}\n\nexport default MediaScrollHelper;\n"]}