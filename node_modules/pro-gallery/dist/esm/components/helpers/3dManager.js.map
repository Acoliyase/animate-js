{"version":3,"file":"3dManager.js","sourceRoot":"","sources":["../../../../src/components/helpers/3dManager.ts"],"names":[],"mappings":"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","sourcesContent":["import { useCallback, useState } from 'react';\nimport * as THREE from 'three';\nimport { GLTFLoader, GLTF } from 'three/examples/jsm/loaders/GLTFLoader.js';\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader.js';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls.js';\nimport { RoomEnvironment } from 'three/examples/jsm/environments/RoomEnvironment.js';\nimport { LoadingManager } from 'three';\n\ninterface ManagerInstance {\n  stop: boolean;\n  opacity: number;\n  environment: {\n    loadBackground(url: string): void;\n    loadTextureAsLightmap(url: string): void;\n    addByDirectionalLights(\n      intensity?: number,\n      color?: number\n    ): {\n      remove(): void;\n    };\n    sun(\n      intensity?: number,\n      color?: number\n    ): {\n      remove(): void;\n    };\n    addAmbientLight(\n      intensity?: number,\n      color?: number\n    ): {\n      remove(): void;\n    };\n    loadHDR(url: string): Promise<{\n      remove(): void;\n    }>;\n  };\n  model: {\n    load3DModel(url: string): Promise<{\n      remove(): void;\n      punctualLights: boolean;\n    }>;\n    addGround(opacity?: number): {\n      remove(): void;\n    };\n    transform: {\n      setRotation(x: number | undefined, y: number | undefined, z: number | undefined): void;\n      setPosition(x: number | undefined, y: number | undefined, z: number | undefined): void;\n      setScale(x: number | undefined, y: number | undefined, z: number | undefined): void;\n    };\n  };\n  camera: {\n    enablePan: boolean;\n    enableZoom: boolean;\n    enableRotate: boolean;\n    enableAutoRotate: boolean;\n  };\n  dispose(): void;\n}\n\nconst GLOBAL_LOADING_MANAGER = new LoadingManager();\n\nconst DEFAULT_OPTIONS = {\n  SUN_LIGHT_COLOR: 0xffffff,\n  SUN_LIGHT_INTENSITY: 0.2,\n  SUN_POSITION: [0.5, 0, 0.866] as const,\n  AMBIENT_LIGHT_COLOR: 0xffffff,\n  AMBIENT_LIGHT_INTENSITY: 0.2,\n  DIRECTIONAL_LIGHT_COLOR: 0xffffff,\n  DIRECTIONAL_LIGHT_INTENSITY: 1,\n  CAMERA_FOV: 50,\n  CAMERA_NEAR: 0.1,\n  CAMERA_FAR: 12,\n  CAMERA_POSITION: [0, 0, 0.8] as const,\n  CAMERA_TARGET: [0, 0, 0] as const,\n  CAMERA_MIN_DISTANCE: 0.65,\n  CAMERA_MAX_DISTANCE: 1.6,\n  GROUND_OPACITY: 0.5,\n};\n\nexport function createSceneManager(container: HTMLElement, canvas: HTMLCanvasElement): ManagerInstance {\n  const scene = new THREE.Scene();\n  const dracoLoader = new DRACOLoader(GLOBAL_LOADING_MANAGER);\n  const gltfLoader = new GLTFLoader(GLOBAL_LOADING_MANAGER);\n  gltfLoader.setDRACOLoader(dracoLoader);\n  const width = container.clientWidth;\n  const height = container.clientHeight;\n  const camera = new THREE.PerspectiveCamera(\n    DEFAULT_OPTIONS.CAMERA_FOV,\n    width / height,\n    DEFAULT_OPTIONS.CAMERA_NEAR,\n    DEFAULT_OPTIONS.CAMERA_FAR\n  );\n  scene.add(camera);\n  const controls = new OrbitControls(camera, container);\n  controls.target.set(...DEFAULT_OPTIONS.CAMERA_TARGET);\n  camera.position.set(...DEFAULT_OPTIONS.CAMERA_POSITION);\n  controls.maxDistance = DEFAULT_OPTIONS.CAMERA_MAX_DISTANCE;\n  controls.minDistance = DEFAULT_OPTIONS.CAMERA_MIN_DISTANCE;\n  const initRenderer = () => {\n    const renderer = new THREE.WebGLRenderer({\n      antialias: true,\n      alpha: true,\n      canvas,\n    });\n    renderer.setClearColor(0x000000, 0);\n    renderer.setSize(width, height);\n    renderer.toneMapping = THREE.LinearToneMapping;\n    renderer.toneMappingExposure = 1;\n    renderer.domElement.style.position = 'absolute';\n    renderer.domElement.style.userSelect = 'none';\n    renderer.domElement.style.transition = 'opacity 0.3s ease-in-out';\n    const envTexture = new THREE.PMREMGenerator(renderer).fromScene(new RoomEnvironment()).texture;\n    scene.environment = envTexture;\n    return renderer;\n  };\n  let renderer: THREE.WebGLRenderer | undefined = initRenderer();\n  let opacity = 1;\n  const mixers: THREE.AnimationMixer[] = [];\n  let previousRAF: number | undefined;\n  function animate(stamp?: DOMHighResTimeStamp) {\n    if (!renderer) {\n      previousRAF = undefined;\n      return;\n    }\n    const delta = (previousRAF && stamp ? stamp - previousRAF : 0) / 1000;\n    previousRAF = stamp;\n    canvas.width = container.clientWidth;\n    canvas.height = container.clientHeight;\n    renderer.setSize(container.clientWidth, container.clientHeight);\n    requestAnimationFrame(animate);\n    controls.update();\n    mixers.forEach((mixer) => {\n      mixer.update(delta);\n    });\n    renderer.render(scene, camera);\n  }\n  animate();\n\n  let model: GLTF['scene'] | undefined;\n\n  // let modelBasePosition: THREE.Vector3 | undefined;\n  let manualPosition = false;\n  const api: ManagerInstance = {\n    get stop() {\n      return !renderer;\n    },\n    set stop(value) {\n      if (!value && !renderer) {\n        // controls = new OrbitControls(camera, container);\n        renderer = initRenderer();\n        animate();\n      }\n      if (value && renderer) {\n        renderer.dispose();\n        // controls.dispose();\n        renderer = undefined;\n      }\n    },\n    get opacity() {\n      return opacity;\n    },\n    set opacity(value) {\n      opacity = value;\n      canvas.style.opacity = opacity.toString();\n    },\n    environment: {\n      loadBackground(url) {\n        const backgroundTexture = new THREE.TextureLoader().load(url);\n        scene.background = backgroundTexture;\n        scene.environment = backgroundTexture;\n      },\n      loadTextureAsLightmap(url) {\n        const lightmapTexture = new THREE.TextureLoader().load(url);\n        scene.traverse((child) => {\n          if (child instanceof THREE.Mesh) {\n            child.material.lightmapIntensity = 1;\n            child.material.lightmap = lightmapTexture;\n          }\n        });\n      },\n      addByDirectionalLights(\n        intensity = DEFAULT_OPTIONS.DIRECTIONAL_LIGHT_INTENSITY,\n        color = DEFAULT_OPTIONS.DIRECTIONAL_LIGHT_COLOR\n      ) {\n        const light = new THREE.DirectionalLight(color, intensity);\n        const lightBack = new THREE.DirectionalLight(color, intensity);\n        light.position.set(0, 0, 2);\n        lightBack.position.set(0, 0, -2);\n        scene.add(light);\n        scene.add(lightBack);\n        return {\n          remove() {\n            scene.remove(light);\n            scene.remove(lightBack);\n          },\n        };\n      },\n      sun(intensity = DEFAULT_OPTIONS.DIRECTIONAL_LIGHT_INTENSITY, color = DEFAULT_OPTIONS.DIRECTIONAL_LIGHT_COLOR) {\n        const light = new THREE.DirectionalLight(color, intensity);\n        light.position.set(...DEFAULT_OPTIONS.SUN_POSITION); //from https://github.com/donmccurdy/three-gltf-viewer/blob/main/src/viewer.js#L430\n        camera.add(light);\n        return {\n          remove() {\n            camera.remove(light);\n          },\n        };\n      },\n      addAmbientLight(\n        intensity = DEFAULT_OPTIONS.AMBIENT_LIGHT_INTENSITY,\n        color = DEFAULT_OPTIONS.AMBIENT_LIGHT_COLOR\n      ) {\n        const light = new THREE.AmbientLight(color, intensity);\n        camera.add(light);\n        return {\n          remove() {\n            camera.remove(light);\n          },\n        };\n      },\n      async loadHDR(url) {\n        const { RGBELoader } = await import(\n          /* webpackChunkName: \"three-rbdl-loader\" */ 'three/examples/jsm/loaders/RGBELoader.js'\n        );\n        const hdrLoader = new RGBELoader();\n        const hdr = await new Promise<THREE.Texture>((resolve) => {\n          hdrLoader.load(url, resolve);\n        });\n        hdr.mapping = THREE.EquirectangularReflectionMapping;\n        scene.background = hdr;\n        scene.environment = hdr;\n        return {\n          remove() {\n            scene.background = null;\n            scene.environment = null;\n          },\n        };\n      },\n    },\n    model: {\n      async load3DModel(url) {\n        const gltf = await new Promise<GLTF>((resolve) => {\n          gltfLoader.load(url, resolve);\n        });\n        const gltfScene = gltf.scene || gltf.scenes[0];\n        const clips = gltf.animations || [];\n        const { punctualLights, mixer } = addModel(scene, gltfScene, clips, camera, controls, manualPosition);\n        mixers.push(mixer);\n        model = gltfScene;\n        return {\n          remove() {\n            if (model) {\n              scene.remove(model);\n            }\n          },\n          punctualLights,\n        };\n      },\n      addGround(opacity = DEFAULT_OPTIONS.GROUND_OPACITY) {\n        const ground = new THREE.Mesh(\n          new THREE.PlaneBufferGeometry(100, 100),\n          new THREE.ShadowMaterial({ opacity: opacity })\n        );\n        ground.position.y = -0.4;\n        ground.rotation.x = -Math.PI / 2;\n        ground.receiveShadow = true;\n        scene.add(ground);\n        return {\n          remove() {\n            scene.remove(ground);\n          },\n        };\n      },\n      transform: {\n        setRotation(x, y, z) {\n          if (!model) {\n            return;\n          }\n          // deg to rad\n          const radX = ((x ?? 0) * Math.PI) / 180;\n          const radY = ((y ?? 0) * Math.PI) / 180;\n          const radZ = ((z ?? 0) * Math.PI) / 180;\n          model.rotation.set(radX, radY, radZ);\n        },\n        setPosition(x, y, z) {\n          if (!x && !y && !z) {\n            return;\n          }\n          manualPosition = true;\n          camera.position.x = x ?? 0;\n          camera.position.y = y ?? 0;\n          camera.position.z = z ?? 0;\n          camera.lookAt(new THREE.Vector3());\n        },\n        setScale(x, y, z) {\n          if (!model) {\n            return;\n          }\n          model.scale.set(x ?? 1, y ?? 1, z ?? 1);\n        },\n      },\n    },\n    camera: {\n      get enableAutoRotate() {\n        return controls.autoRotate;\n      },\n      set enableAutoRotate(value) {\n        controls.autoRotate = value;\n      },\n      get enableZoom() {\n        return controls.enableZoom;\n      },\n      set enableZoom(value) {\n        controls.enableZoom = value;\n      },\n      get enablePan() {\n        return controls.enablePan;\n      },\n      set enablePan(value) {\n        controls.enablePan = value;\n      },\n      get enableRotate() {\n        return controls.enableRotate;\n      },\n      set enableRotate(value) {\n        controls.enableRotate = value;\n      },\n    },\n    dispose() {\n      renderer?.dispose();\n      controls.dispose();\n      renderer = undefined;\n    },\n  };\n  return api;\n}\n\nexport type SceneManager = ReturnType<typeof createSceneManager>;\n\nexport function useSceneManager() {\n  const [sceneManager, setSceneManager] = useState<SceneManager | null>(null);\n\n  const render = useCallback((container: HTMLElement, canvas: HTMLCanvasElement) => {\n    if (!sceneManager) {\n      const sceneManager = createSceneManager(container, canvas);\n      setSceneManager(sceneManager);\n      return sceneManager;\n    }\n    return sceneManager;\n  }, []);\n\n  return { sceneManager, render };\n}\n\n/**\n * from - https://github.com/donmccurdy/three-gltf-viewer/blob/main/src/viewer.js - MIT\n */\nfunction addModel(\n  scene: THREE.Scene,\n  object: THREE.Object3D,\n  animations: THREE.AnimationClip[],\n  camera: THREE.PerspectiveCamera,\n  controls: OrbitControls,\n  manualPosition: boolean\n) {\n  const box = new THREE.Box3().setFromObject(object);\n  const size = box.getSize(new THREE.Vector3()).length();\n  const center = box.getCenter(new THREE.Vector3());\n  object.position.x += object.position.x - center.x;\n  object.position.y += object.position.y - center.y;\n  object.position.z += object.position.z - center.z;\n  controls.reset();\n  controls.maxDistance = size * 10;\n  camera.near = size / 100;\n  camera.far = size * 100;\n  camera.updateProjectionMatrix();\n\n  if (!manualPosition) {\n    camera.position.copy(center);\n    camera.position.x += size / 2.0;\n    camera.position.y += size / 5.0;\n    camera.position.z += size / 2.0;\n    camera.lookAt(center);\n  }\n\n  controls.saveState();\n\n  scene.add(object);\n\n  let punctualLights = true;\n\n  object.traverse((node) => {\n    if (node instanceof THREE.Light) {\n      punctualLights = false;\n      return;\n    }\n    if (node instanceof THREE.Mesh) {\n      // TODO(https://github.com/mrdoob/three.js/pull/18235): Clean up.\n      node.material.depthWrite = !node.material.transparent;\n      if (node.material.emissiveMap) {\n        node.material.emissiveMap.encoding = THREE.sRGBEncoding;\n      }\n      if (node.material.map) {\n        node.material.map.encoding = THREE.sRGBEncoding;\n      }\n      node.material.needsUpdate = true;\n      return;\n    }\n  });\n\n  const mixer = new THREE.AnimationMixer(object);\n\n  playAllAnimations(mixer, animations);\n\n  return {\n    object,\n    animations,\n    mixer,\n    punctualLights,\n  };\n}\n\nfunction playAllAnimations(mixer: THREE.AnimationMixer, animations: THREE.AnimationClip[]) {\n  if (animations.length === 0) {\n    return;\n  }\n  // Play all animations after each other\n  mixer.addEventListener('finished', (e) => {\n    const action = e.action;\n    action.stop();\n    mixer.uncacheRoot(action._clip);\n    mixer.clipAction(animations[(action._clip.name || 0) + 1]).play();\n  });\n  mixer.clipAction(animations[0]).play();\n}\n"]}