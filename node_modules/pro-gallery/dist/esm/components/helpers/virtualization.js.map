{"version":3,"file":"virtualization.js","sourceRoot":"","sources":["../../../../src/components/helpers/virtualization.ts"],"names":[],"mappings":"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","sourcesContent":["import { GALLERY_CONSTS, VirtualizationSettings, Options, optionsMap } from 'pro-gallery-lib';\n\nexport function getItemsInViewportOrMarginByActiveGroup({\n  groups,\n  options,\n  virtualizationSettings,\n  galleryWidth,\n  galleryHeight,\n  activeIndex,\n}: {\n  groups: any[];\n  options: Options;\n  virtualizationSettings?: VirtualizationSettings;\n  galleryWidth: number;\n  galleryHeight: number;\n  activeIndex: number;\n}): { group: any; shouldRender: boolean }[] {\n  const {\n    enabled = false,\n    forwardItemMargin = 3,\n    backwardItemMargin = 3,\n    forwardItemScrollMargin = 10,\n    backwardItemScrollMargin = 10,\n  } = virtualizationSettings || {};\n\n  const isHorizontal =\n    options[optionsMap.layoutParams.structure.scrollDirection] ===\n    GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL;\n  const isScrollable =\n    !isHorizontal ||\n    options[optionsMap.behaviourParams.gallery.horizontal.slideAnimation] ===\n      GALLERY_CONSTS[optionsMap.behaviourParams.gallery.horizontal.slideAnimation].SCROLL;\n  if (!enabled) {\n    return groups.map((group) => ({\n      group,\n      shouldRender: true,\n    }));\n  }\n  const size = isHorizontal ? galleryWidth : galleryHeight;\n  const unit = isHorizontal ? 'width' : 'height';\n  const rightRenderBuffer = isScrollable ? forwardItemScrollMargin : forwardItemMargin;\n  const leftRenderBuffer = isScrollable ? backwardItemScrollMargin : backwardItemMargin;\n\n  const activeGroupIndex = groups.findIndex((group) => {\n    const { items } = group;\n    const first = items[0];\n    const last = items[items.length - 1];\n    const firstIndex = first.idx ?? first.fullscreenIdx;\n    const lastIndex = last.idx ?? last.fullscreenIdx;\n    return firstIndex <= activeIndex && lastIndex >= activeIndex;\n  });\n\n  const activeGroup = groups[activeGroupIndex];\n  const activeGroupPrecOfScreen = activeGroup[unit] / size;\n  let accoumilatedRightMargin = activeGroupPrecOfScreen;\n  let accoumilatedLeftMargin = activeGroupPrecOfScreen;\n  const groupsToRender: any[] = [activeGroup];\n  for (\n    let index = 1;\n    accoumilatedRightMargin < rightRenderBuffer || accoumilatedLeftMargin < leftRenderBuffer;\n    index++\n  ) {\n    const groupToRight = groups[activeGroupIndex + index];\n    const groupToLeft = groups[activeGroupIndex - index];\n    if (groupToRight && accoumilatedRightMargin < rightRenderBuffer) {\n      const groupPrecOfScreen = groupToRight[unit] / size;\n      accoumilatedRightMargin += groupPrecOfScreen;\n      groupsToRender.push(groupToRight);\n    }\n    if (groupToLeft && accoumilatedLeftMargin < leftRenderBuffer) {\n      const groupPrecOfScreen = groupToLeft[unit] / size;\n      accoumilatedLeftMargin += groupPrecOfScreen;\n      groupsToRender.push(groupToLeft);\n    }\n    if (!groupToLeft && !groupToRight) {\n      break;\n    }\n  }\n  return groups.map((group) => {\n    return { group, shouldRender: groupsToRender.includes(group) };\n  });\n}\n\nexport function getItemsInViewportOrMarginByScrollLocation({\n  items,\n  options,\n  virtualizationSettings,\n  galleryWidth,\n  galleryHeight,\n  scrollPosition,\n}: {\n  items: any[];\n  options: Options;\n  virtualizationSettings?: VirtualizationSettings;\n  galleryWidth: number;\n  galleryHeight: number;\n  scrollPosition: number;\n}): { item: any; shouldRender: boolean }[] {\n  const { enabled = false, forwardItemScrollMargin = 10, backwardItemScrollMargin = 10 } = virtualizationSettings || {};\n\n  if (!enabled) {\n    return items.map((item) => ({\n      item,\n      shouldRender: true,\n    }));\n  }\n  const isHorizontal =\n    options[optionsMap.layoutParams.structure.scrollDirection] ===\n    GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL;\n  const size = isHorizontal ? galleryWidth : galleryHeight;\n  const unit = isHorizontal ? 'width' : 'height';\n\n  function shouldRenderItem(item) {\n    const group = item.group;\n    const locationUnit = unit === 'height' ? 'top' : 'left';\n    const location = group[locationUnit];\n    const locationEnd = location + group[unit];\n    const viewportStart = scrollPosition - size * backwardItemScrollMargin;\n    const viewportEnd = scrollPosition + size * forwardItemScrollMargin;\n    return location > viewportStart && locationEnd < viewportEnd;\n  }\n  return items.map((item) => ({\n    item,\n    shouldRender: shouldRenderItem(item),\n  }));\n}\n"]}