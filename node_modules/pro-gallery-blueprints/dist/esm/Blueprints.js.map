{"version":3,"file":"Blueprints.js","sourceRoot":"","sources":["../../src/Blueprints.js"],"names":[],"mappings":"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","sourcesContent":["import { Layouter, ItemsHelper } from 'pro-layouts';\nimport { populateWithDefaultOptions, addPresetOptions, dimensionsHelper, processLayouts, utils } from 'pro-gallery-lib';\n\nclass Blueprints {\n  createBlueprint({ params, lastParams, existingBlueprint, blueprintManagerId, isUsingCustomInfoElements }) {\n    // cacheBlocker\n    // if (this.cache[params]) return this.cache[params];\n\n    this.reasons = {\n      items: '',\n      itemsAdded: '',\n      options: '',\n      container: '',\n    };\n\n    let changedParams = {};\n    try {\n      const { container: newContainerParams, items: newItemsParams, options: newOptions } = params;\n      const { container: oldContainerParams, items: oldItemsParams, options: oldOptions } = lastParams;\n      // getItems,options and dimesions if not supplied in params;\n\n      const { formattedItems, changed: itemsChanged } = this.formatItemsIfNeeded(newItemsParams, oldItemsParams);\n      const { formattedOptions, changed: optionsChanged } = this.formatOptionsIfNeeded(\n        newOptions,\n        oldOptions,\n        isUsingCustomInfoElements\n      );\n      const { formattedContainer, changed: containerChanged } = this.formatContainerIfNeeded(\n        newContainerParams,\n        oldContainerParams,\n        oldOptions,\n        formattedOptions || existingBlueprint.options,\n        optionsChanged\n      );\n\n      const changed = itemsChanged || optionsChanged || containerChanged;\n      changedParams = { itemsChanged, optionsChanged, containerChanged };\n\n      if (changed || !existingBlueprint) {\n        if (!existingBlueprint) {\n          existingBlueprint = {};\n        }\n\n        const structure = this.createStructure(\n          {\n            formattedContainer: formattedContainer || existingBlueprint.container,\n            formattedItems: formattedItems || existingBlueprint.items,\n            formattedOptions: formattedOptions || existingBlueprint.options,\n          },\n          changed\n        );\n\n        // assign changed values w/o replacing the original object;\n        if (formattedOptions) {\n          existingBlueprint.options = formattedOptions;\n        }\n        if (formattedItems) {\n          existingBlueprint.items = formattedItems;\n        }\n        if (formattedContainer) {\n          existingBlueprint.container = formattedContainer;\n        }\n        existingBlueprint.structure = structure;\n\n        // if its an infinite gallery - let the container loose\n        const isInfinite = utils.isHeightSetByGallery(existingBlueprint.options);\n        if (isInfinite) {\n          existingBlueprint.container.height = existingBlueprint.container.galleryHeight = structure.height;\n        }\n      }\n    } catch (error) {\n      console.error('Could not create blueprint, error:', error);\n    }\n\n    const reasons = Object.entries(this.reasons)\n      .reduce((reasons, [param, reason]) => [...reasons, `${param}: ${reason}`], [])\n      .join(', ');\n\n    // return the existing or the modified existing object\n    return {\n      blueprint: existingBlueprint,\n      changedParams,\n      blueprintManagerId,\n      reasons,\n    };\n  }\n\n  // ------------------ Raw data to Formated data (if needed) ---------------------------- //\n\n  formatItemsIfNeeded(items, lastItems) {\n    const itemsWereAdded = (newItemsParams, oldItemsParams) => {\n      if (newItemsParams === oldItemsParams) {\n        this.reasons.itemsAdded = 'items are the same object.';\n        return false; // it is the exact same object\n      }\n      if (!newItemsParams) {\n        this.reasons.itemsAdded = 'new items do not exist.';\n        return false; // new items do not exist (use old items)\n      }\n      if (!oldItemsParams || (oldItemsParams && oldItemsParams.length === 0)) {\n        this.reasons.itemsAdded = 'old items do not exist.';\n        return false; // old items do not exist (it is not items addition)\n      }\n      if (oldItemsParams.length >= newItemsParams.length) {\n        this.reasons.itemsAdded = 'more old items than new items.';\n        return false; // more old items than new items\n      }\n      const idsNotChanged = oldItemsParams.reduce((is, _item, idx) => {\n        // check that all the existing items exist in the new array\n        return is && _item.id === newItemsParams[idx].itemId;\n      }, true);\n\n      if (!idsNotChanged) {\n        this.reasons.itemsAdded = 'items ids were changed. ';\n      }\n      return idsNotChanged;\n    };\n\n    const itemsHaveChanged = (newItemsParams, oldItemsParams) => {\n      if (newItemsParams === oldItemsParams) {\n        this.reasons.items = 'items are the same object.';\n        return false; // it is the exact same object\n      }\n      if (!newItemsParams) {\n        this.reasons.items = 'new items do not exist.';\n        return false; // new items do not exist (use old items)\n      }\n      if (!oldItemsParams || (oldItemsParams && oldItemsParams.length === 0)) {\n        this.reasons.items = 'old items do not exist.';\n        return true; // old items do not exist\n      }\n      if (oldItemsParams.length !== newItemsParams.length) {\n        this.reasons.items = 'more new items than old items (or vice versa).';\n        return true; // more new items than old items (or vice versa)\n      }\n      return newItemsParams.some((newItem, idx) => {\n        // check that all the items are identical\n        const existingItem = oldItemsParams[idx];\n        try {\n          const itemsChanged =\n            !newItem ||\n            !existingItem ||\n            newItem.itemId !== existingItem.itemId ||\n            newItem.mediaUrl !== existingItem.mediaUrl ||\n            newItem.measured !== existingItem.measured ||\n            (newItem.metaData &&\n              existingItem.metaData &&\n              (newItem.metaData.type !== existingItem.metaData.type ||\n                newItem.metaData.title !== existingItem.metaData.title ||\n                newItem.metaData.description !== existingItem.metaData.description)) ||\n            (newItem.metaData &&\n              newItem.metaData.type === 'text' &&\n              existingItem.metaData &&\n              existingItem.metaData.type === 'text' &&\n              (newItem.metaData.width !== existingItem.metaData.width ||\n                newItem.metaData.height !== existingItem.metaData.height ||\n                newItem.metaData.html !== existingItem.metaData.html ||\n                newItem.metaData.textStyle !== existingItem.metaData.textStyle ||\n                newItem.metaData.editorHtml !== existingItem.metaData.editorHtml));\n          if (itemsChanged) {\n            this.reasons.items = `items #${idx} id was changed.`;\n          }\n          return itemsChanged;\n        } catch (e) {\n          this.reasons.items = 'an error occured';\n          return true;\n        }\n      }, false);\n    };\n\n    const oldItemsParams = lastItems;\n    let changed = false;\n    let formattedItems;\n    if (itemsWereAdded(items, oldItemsParams)) {\n      formattedItems = oldItemsParams.concat(\n        items.slice(oldItemsParams.length).map((item) => {\n          return ItemsHelper.convertDtoToLayoutItem(item);\n        })\n      );\n      this.gettingMoreItems = false; // probably finished getting more items       //TODO - what is this and how we keep it alive if needed?\n      changed = true;\n    } else if (itemsHaveChanged(items, oldItemsParams)) {\n      formattedItems = items.map((item) => Object.assign(ItemsHelper.convertDtoToLayoutItem(item)));\n      this.gettingMoreItems = false; // probably finished getting more items\n      changed = true;\n    }\n    return { formattedItems, changed };\n  }\n\n  formatOptionsIfNeeded(options, lastOptions, isUsingCustomInfoElements) {\n    const optionsHaveChanged = (newOptions, oldOptions) => {\n      if (!newOptions) {\n        this.reasons.options = 'no new options.';\n        return false; // no new options - use old options\n      }\n      if (!oldOptions) {\n        this.reasons.options = 'no old options.';\n        return true; // no old options\n      }\n      try {\n        const oldOptionsSorted = {};\n        Object.keys(oldOptions)\n          .sort() // sort by keys alphabetically\n          .forEach((key) => (oldOptionsSorted[key] = oldOptions[key]));\n        const newOptionsSorted = {};\n        Object.keys(newOptions)\n          .sort() // sort by keys alphabetically\n          .forEach((key) => (newOptionsSorted[key] = newOptions[key]));\n        const wasChanged = JSON.stringify(newOptionsSorted) !== JSON.stringify(oldOptionsSorted);\n        if (wasChanged) {\n          this.reasons.options = 'options were changed.';\n        }\n        return wasChanged;\n      } catch (e) {\n        console.error('Could not compare options', e);\n        return false;\n      }\n    };\n\n    const oldOptions = lastOptions;\n    let changed = false;\n    let formattedOptions;\n    if (optionsHaveChanged(options, oldOptions)) {\n      const optionsOverDefaults = populateWithDefaultOptions(options); //add default for any undefined option\n      formattedOptions = processLayouts(addPresetOptions(optionsOverDefaults), isUsingCustomInfoElements);\n      changed = true;\n    }\n\n    return { formattedOptions, changed };\n  }\n\n  formatContainerIfNeeded(container, lastContainer, lastOptions, formattedOptions, optionsChanged) {\n    const containerHasChanged = ({ newContainerParams, oldContainerParams, oldOptions }) => {\n      if (!oldOptions || !oldContainerParams) {\n        this.reasons.container = 'no old container or options. ';\n        return true; // no old container or options (style may change container)\n      }\n      if (!newContainerParams) {\n        this.reasons.container = 'no new container.';\n        return false; // no new continainer\n      }\n      const containerHasChanged = {\n        height: utils.isHeightSetByGallery(formattedOptions) // height doesnt matter if the new gallery is going to be vertical\n          ? false\n          : !!newContainerParams.height && newContainerParams.height !== oldContainerParams.height,\n        width:\n          !oldContainerParams || (!!newContainerParams.width && newContainerParams.width !== oldContainerParams.width),\n        scrollBase: newContainerParams?.scrollBase !== oldContainerParams?.scrollBase,\n      };\n      return Object.keys(containerHasChanged).reduce((is, key) => {\n        if (containerHasChanged[key]) {\n          this.reasons.container += `container.${key} has changed. `;\n        }\n        return is || containerHasChanged[key];\n      }, false);\n    };\n\n    const oldContainerParams = lastContainer;\n    let changed = false;\n    const oldOptions = lastOptions;\n    let formattedContainer;\n    if (\n      optionsChanged || // If options changed they could affect the container and a new container must be created (slideshow,thumbs,shadow,borders...etc)\n      containerHasChanged({\n        newContainerParams: container,\n        oldContainerParams,\n        oldOptions,\n      })\n    ) {\n      dimensionsHelper.updateParams({\n        options: formattedOptions,\n        container,\n      });\n      changed = true;\n      formattedContainer = Object.assign({}, container, dimensionsHelper.getGalleryDimensions());\n    }\n    return { formattedContainer, changed };\n  }\n\n  createStructure({ formattedContainer, formattedOptions, formattedItems }) {\n    const layoutParams = {\n      items: formattedItems,\n      container: formattedContainer,\n      styleParams: formattedOptions,\n      options: {\n        showAllItems: true,\n        skipVisibilitiesCalc: true,\n        useLayoutStore: false,\n      },\n    };\n\n    // if (this.layouter && addingItems) {\n    //   layoutParams.options.useExistingLayout = true;\n    // } else {\n    layoutParams.options.createLayoutOnInit = false; // TODO - what does this do?\n    this.layouter = new Layouter(layoutParams); // TODO - no need for \"this.\"\n    // }\n\n    return this.layouter.createLayout(layoutParams);\n  }\n}\nconst blueprints = new Blueprints();\nexport default blueprints;\n"]}