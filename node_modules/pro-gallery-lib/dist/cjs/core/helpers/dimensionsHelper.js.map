{"version":3,"file":"dimensionsHelper.js","sourceRoot":"","sources":["../../../../src/core/helpers/dimensionsHelper.js"],"names":[],"mappings":";;;AAAA,uFAA4E;AAC5E,2LAAmI;AACnI,4EAAyC;AAEzC,MAAM,gBAAgB;IACpB;QACE,IAAI,CAAC,OAAO,GAAG,EAAE,CAAC;QAClB,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;QACpB,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC;QACb,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;IACnB,CAAC;IAED,eAAe,CAAC,KAAK,EAAE,WAAW;QAChC,IAAI,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC;YAAE,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;QAClD,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,WAAW,EAAE,CAAC;QACnC,OAAO,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;IAC5B,CAAC;IAED,SAAS;QACP,IAAI,CAAC,MAAM,GAAG,EAAE,CAAC;IACnB,CAAC;IAED,YAAY,CAAC,EAAE,OAAO,EAAE,SAAS,EAAE,EAAE,EAAE;QACrC,IAAI,CAAC,SAAS,EAAE,CAAC;QACjB,IAAI,CAAC,EAAE,GAAG,EAAE,IAAI,IAAI,CAAC,EAAE,CAAC;QACxB,IAAI,CAAC,OAAO,GAAG,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC;QACvC,IAAI,CAAC,SAAS,GAAG,SAAS,IAAI,IAAI,CAAC,SAAS,CAAC;QAC7C,IAAI,CAAC,qCAAqC,EAAE,CAAC;IAC/C,CAAC;IAED,oBAAoB;QAClB,OAAO,IAAI,CAAC,eAAe,CAAC,mBAAmB,EAAE,GAAG,EAAE;YACpD,MAAM,GAAG,GAAG;gBACV,YAAY,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,eAAe,EAAE,CAAC;gBAC/C,aAAa,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC;gBACjD,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;gBAChF,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBACxC,KAAK,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC;aACvC,CAAC;YAEF,IAAI,IAAI,CAAC,SAAS,CAAC,kBAAkB,EAAE;gBACrC,kCAAkC;gBAClC,GAAG,CAAC,UAAU,IAAI,IAAI,CAAC,SAAS,CAAC,kBAAkB,CAAC;aACrD;YACD,IACE,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,CAAC;gBACvD,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC;oBACvD,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,eAAe,EAC7E;gBACA,GAAG,CAAC,aAAa,IAAI,IAAI,CAAC,uBAAuB,EAAE,CAAC;gBACpD,GAAG,CAAC,YAAY,IAAI,IAAI,CAAC,sBAAsB,EAAE,CAAC;aACnD;YACD,IAAI,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE;gBAC3D,GAAG,CAAC,mBAAmB,GAAG,IAAI,CAAC,uBAAuB,EAAE,IAAI,GAAG,CAAC,aAAa,CAAC;gBAC9E,GAAG,CAAC,kBAAkB,GAAG,IAAI,CAAC,sBAAsB,EAAE,IAAI,GAAG,CAAC,YAAY,CAAC;aAC5E;YACD,OAAO,GAAG,CAAC;QACb,CAAC,CAAC,CAAC;IACL,CAAC;IAED,eAAe;QACb,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,GAAG,EAAE;YAC/C,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,eAAe,EAAE,GAAG,CAAC,CAAC,CAAC,mEAAmE;YAC9I,IACE,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,gBAAgB,CAAC,QAAQ,CAAC;gBAC7D,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,gBAAgB,CAAC,QAAQ,CAAC,CAAC,eAAe;gBACnF,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAAC;oBAC7D,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,UAAU,EAC9E;gBACA,KAAK;oBACH,CAAC;wBACD,CAAC,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,gBAAgB,CAAC,IAAI,CAAC;4BAC1D,EAAE;4BACF,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC,CAAC;aACtE;YACD,OAAO,KAAK,CAAC;QACf,CAAC,CAAC,CAAC;IACL,CAAC;IAED,gBAAgB;QACd,OAAO,IAAI,CAAC,eAAe,CAAC,eAAe,EAAE,GAAG,EAAE;YAChD,iKAAiK;YACjK,MAAM,YAAY,GAAG,GAAG,EAAE,CACxB,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAAC;gBAC/D,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,UAAU;gBAC1E,CAAC,CAAC,IAAI,CAAC,eAAe,EAAE;gBACxB,CAAC,CAAC,CAAC,CAAC;YACR,MAAM,GAAG,GAAG,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,GAAG,YAAY,EAAE,CAAC,CAAC;YACjG,OAAO,GAAG,CAAC;QACb,CAAC,CAAC,CAAC;IACL,CAAC;IAED,eAAe;QACb,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,GAAG,EAAE;YAC/C,OAAO,CACL,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;gBACvE,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,CACvE,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC;IAED,eAAe;QACb,OAAO,IAAI,CAAC,eAAe,CAAC,cAAc,EAAE,GAAG,EAAE;YAC/C,MAAM,GAAG,GAAG,IAAI,CAAC,oBAAoB,EAAE,CAAC;YACxC,OAAO,GAAG,CAAC,YAAY,GAAG,GAAG,CAAC,aAAa,CAAC;QAC9C,CAAC,CAAC,CAAC;IACL,CAAC;IAED,gBAAgB;QACd,MAAM,kBAAkB,GACtB,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,IAAI,CAAC;YACrD,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,cAAc,CAAC;YAC9D,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,eAAe,CAAC,CAAC;QACnE,OAAO,kBAAkB,CAAC;IAC5B,CAAC;IAED,uBAAuB;QACrB,QAAQ,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;YAClE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC;YACtE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,MAAM;gBACtE,OAAO,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACjC,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC;YACxE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI;gBACpE,OAAO,CAAC,CAAC;YACX;gBACE,MAAM;SACT;IACH,CAAC;IACD,sBAAsB;QACpB,QAAQ,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;YAClE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC;YACtE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,MAAM;gBACtE,OAAO,CAAC,CAAC;YACX,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC;YACxE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI;gBACpE,OAAO,IAAI,CAAC,gBAAgB,EAAE,CAAC;YACjC;gBACE,MAAM;SACT;IACH,CAAC;IAED,qCAAqC;QACnC,IACE,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAAC;YAC7D,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,eAAe,CAAC,CAAC,UAAU;YAC9E,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,EACtE;YACA,IACE,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,MAAM,CAAC;gBACvD,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC;oBACvD,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,QAAQ,CAAC,CAAC,eAAe,EAC7E;gBACA,QAAQ,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,EAAE;oBAClE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC;oBACtE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,MAAM;wBACtE,IAAI,CAAC,SAAS,CAAC,MAAM;4BACnB,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,YAAY,CAAC,KAAK,CAAC;gCACzF,IAAI,CAAC,uBAAuB,EAAE,CAAC;wBACjC,MAAM;oBACR,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,KAAK,CAAC;oBACxE,KAAK,kBAAc,CAAC,uBAAU,CAAC,YAAY,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI;wBACpE,IAAI,CAAC,SAAS,CAAC,MAAM;4BACnB,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC,sBAAsB,EAAE,CAAC;gCACtD,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;wBACrE,MAAM;oBACR;wBACE,MAAM;iBACT;aACF;iBAAM;gBACL,IAAI,CAAC,SAAS,CAAC,MAAM;oBACnB,IAAI,CAAC,SAAS,CAAC,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,YAAY,CAAC,KAAK,CAAC,CAAC;gBAC5F,IACE,CAAC,IAAI,CAAC,OAAO,CAAC,uBAAU,CAAC,YAAY,CAAC,SAAS,CAAC,YAAY,CAAC,mBAAmB,CAAC;oBACjF,oEAAmB,CAAC,UAAU,CAAC,IAAI,CAAC,OAAO,CAAC,EAC5C;oBACA,IAAI,CAAC,SAAS,CAAC,MAAM,IAAI,IAAI,CAAC,OAAO,CAAC,kBAAkB,CAAC;iBAC1D;aACF;SACF;IACH,CAAC;CACF;AAED,kBAAe,IAAI,gBAAgB,EAAE,CAAC","sourcesContent":["import { default as GALLERY_CONSTS } from '../../common/constants/index.js';\nimport { default as includeExternalInfo } from '../../settings/options/layoutParams_structure_galleryRatio_includeExternalInfo.js';\nimport optionsMap from './optionsMap.js';\n\nclass DimensionsHelper {\n  constructor() {\n    this.options = {};\n    this.container = {};\n    this.id = '';\n    this._cache = {};\n  }\n\n  getOrPutInCache(field, createValue) {\n    if (this._cache[field]) return this._cache[field];\n    this._cache[field] = createValue();\n    return this._cache[field];\n  }\n\n  dumpCache() {\n    this._cache = {};\n  }\n\n  updateParams({ options, container, id }) {\n    this.dumpCache();\n    this.id = id || this.id;\n    this.options = options || this.options;\n    this.container = container || this.container;\n    this.fixHeightForHorizontalGalleryIfNeeded();\n  }\n\n  getGalleryDimensions() {\n    return this.getOrPutInCache('galleryDimensions', () => {\n      const res = {\n        galleryWidth: Math.ceil(this.getGalleryWidth()),\n        galleryHeight: Math.ceil(this.getGalleryHeight()),\n        scrollBase: this.container.scrollBase ? Math.ceil(this.container.scrollBase) : 0,\n        height: Math.ceil(this.container.height),\n        width: Math.ceil(this.container.width),\n      };\n\n      if (this.container.externalScrollBase) {\n        //if was provided from the wrapper\n        res.scrollBase += this.container.externalScrollBase;\n      }\n      if (\n        this.options[optionsMap.layoutParams.thumbnails.enable] &&\n        this.options[optionsMap.layoutParams.thumbnails.position] ===\n          GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.position].OUTSIDE_GALLERY\n      ) {\n        res.galleryHeight -= this.getThumbnailHeightDelta();\n        res.galleryWidth -= this.getThumbnailWidthDelta();\n      }\n      if (this.options[optionsMap.layoutParams.thumbnails.enable]) {\n        res.navigationBarHeight = this.getThumbnailHeightDelta() || res.galleryHeight;\n        res.navigationBarWidth = this.getThumbnailWidthDelta() || res.galleryWidth;\n      }\n      return res;\n    });\n  }\n\n  getGalleryWidth() {\n    return this.getOrPutInCache('galleryWidth', () => {\n      let width = Math.floor(this.container.width) + this.getDimensionFix() * 2; //add margins to width and then remove them in css negative margins\n      if (\n        this.options[optionsMap.layoutParams.navigationArrows.position] ===\n          GALLERY_CONSTS[optionsMap.layoutParams.navigationArrows.position].OUTSIDE_GALLERY &&\n        this.options[optionsMap.layoutParams.structure.scrollDirection] ===\n          GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL\n      ) {\n        width -=\n          2 *\n          (this.options[optionsMap.layoutParams.navigationArrows.size] +\n            40 +\n            this.options[optionsMap.layoutParams.structure.itemSpacing] / 2);\n      }\n      return width;\n    });\n  }\n\n  getGalleryHeight() {\n    return this.getOrPutInCache('galleryHeight', () => {\n      //const offsetTop = this.options.scrollDirection === GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL ? this.container.offsetTop : 0;\n      const dimensionFix = () =>\n        this.options[optionsMap.layoutParams.structure.scrollDirection] ===\n        GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL\n          ? this.getDimensionFix()\n          : 0;\n      const res = Math.floor((this.container.height > 0 ? this.container.height : 0) + dimensionFix());\n      return res;\n    });\n  }\n\n  getDimensionFix() {\n    return this.getOrPutInCache('dimensionFix', () => {\n      return (\n        Number(this.options[optionsMap.layoutParams.structure.itemSpacing] / 2) -\n        Number(this.options[optionsMap.layoutParams.structure.gallerySpacing])\n      );\n    });\n  }\n\n  getGalleryRatio() {\n    return this.getOrPutInCache('galleryRatio', () => {\n      const res = this.getGalleryDimensions();\n      return res.galleryWidth / res.galleryHeight;\n    });\n  }\n\n  getThumbnailSize() {\n    const fixedThumbnailSize =\n      this.options[optionsMap.layoutParams.thumbnails.size] +\n      this.options[optionsMap.layoutParams.structure.gallerySpacing] +\n      this.options[optionsMap.layoutParams.thumbnails.marginToGallery];\n    return fixedThumbnailSize;\n  }\n\n  getThumbnailHeightDelta() {\n    switch (this.options[optionsMap.layoutParams.thumbnails.alignment]) {\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].TOP:\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].BOTTOM:\n        return this.getThumbnailSize();\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].RIGHT:\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].LEFT:\n        return 0;\n      default:\n        break;\n    }\n  }\n  getThumbnailWidthDelta() {\n    switch (this.options[optionsMap.layoutParams.thumbnails.alignment]) {\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].TOP:\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].BOTTOM:\n        return 0;\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].RIGHT:\n      case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].LEFT:\n        return this.getThumbnailSize();\n      default:\n        break;\n    }\n  }\n\n  fixHeightForHorizontalGalleryIfNeeded() {\n    if (\n      this.options[optionsMap.layoutParams.structure.scrollDirection] ===\n        GALLERY_CONSTS[optionsMap.layoutParams.structure.scrollDirection].HORIZONTAL &&\n      this.options[optionsMap.layoutParams.structure.galleryRatio.value] > 0\n    ) {\n      if (\n        this.options[optionsMap.layoutParams.thumbnails.enable] &&\n        this.options[optionsMap.layoutParams.thumbnails.position] ===\n          GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.position].OUTSIDE_GALLERY\n      ) {\n        switch (this.options[optionsMap.layoutParams.thumbnails.alignment]) {\n          case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].TOP:\n          case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].BOTTOM:\n            this.container.height =\n              this.container.width * this.options[optionsMap.layoutParams.structure.galleryRatio.value] +\n              this.getThumbnailHeightDelta();\n            break;\n          case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].RIGHT:\n          case GALLERY_CONSTS[optionsMap.layoutParams.thumbnails.alignment].LEFT:\n            this.container.height =\n              (this.container.width - this.getThumbnailWidthDelta()) *\n              this.options[optionsMap.layoutParams.structure.galleryRatio.value];\n            break;\n          default:\n            break;\n        }\n      } else {\n        this.container.height =\n          this.container.width * this.options[optionsMap.layoutParams.structure.galleryRatio.value];\n        if (\n          !this.options[optionsMap.layoutParams.structure.galleryRatio.includeExternalInfo] &&\n          includeExternalInfo.isRelevant(this.options)\n        ) {\n          this.container.height += this.options.externalInfoHeight;\n        }\n      }\n    }\n  }\n}\n\nexport default new DimensionsHelper();\n"]}