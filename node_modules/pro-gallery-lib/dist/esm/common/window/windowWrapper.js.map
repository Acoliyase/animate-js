{"version":3,"file":"windowWrapper.js","sourceRoot":"","sources":["../../../../src/common/window/windowWrapper.js"],"names":[],"mappings":"AAAA,OAAO,UAAU,EAAE,EAAE,cAAc,EAAE,MAAM,kBAAkB,CAAC;AAE9D,MAAM,aAAa;IACjB;QACE,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC;QAC1B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvD,IAAI,IAAI,CAAC,iBAAiB,EAAE,EAAE;YAC5B,sEAAsE;YACtE,2FAA2F;YAC3F,IAAI,CAAC,eAAe,EAAE,CAAC;SACxB;aAAM;YACL,IAAI,CAAC,cAAc,EAAE,CAAC;SACvB;IACH,CAAC;IAED,iBAAiB;QACf,IAAI;YACF,OAAO,OAAO,MAAM,KAAK,WAAW,CAAC;SACtC;QAAC,OAAO,CAAC,EAAE;YACV,OAAO,KAAK,CAAC;SACd;IACH,CAAC;IAED,eAAe;QACb,MAAM,OAAO,GAAG;YACd,oDAAoD;YACpD,GAAG,EAAE,UAAU,MAAM,EAAE,QAAQ;gBAC7B,IAAI,cAAc,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,IAAI,CAAC,aAAa,EAAE;oBACtD,OAAO,cAAc,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;iBACrC;gBACD,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC;YAC1B,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;YACZ,iFAAiF;YACjF,qFAAqF;YACrF,GAAG,EAAE,UAAU,MAAM,EAAE,QAAQ,EAAE,KAAK;gBACpC,OAAO,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;YAC9C,CAAC;SACF,CAAC;QACF,oCAAoC;QACpC,MAAM,WAAW,GAAG,IAAI,KAAK,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;QAC/C,MAAM,iBAAiB,GAAG;YACxB,GAAG,EAAE,UAAU,MAAM,EAAE,QAAQ;gBAC7B,IAAI,CAAC,WAAW,CAAC,qBAAqB,CAAC,GAAG,CAAC,QAAQ,CAAC,IAAI,OAAO,WAAW,CAAC,QAAQ,CAAC,KAAK,UAAU,EAAE;oBACnG,OAAO,WAAW,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;iBAC3C;gBACD,OAAO,WAAW,CAAC,QAAQ,CAAC,CAAC;YAC/B,CAAC;YACD,GAAG,EAAE,UAAU,MAAM,EAAE,QAAQ,EAAE,KAAK;gBACpC,WAAW,CAAC,qBAAqB,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;gBAChD,OAAO,OAAO,CAAC,GAAG,CAAC,WAAW,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;YACnD,CAAC;SACF,CAAC;QACF,IAAI,CAAC,WAAW,CAAC,qBAAqB,EAAE;YACtC,WAAW,CAAC,qBAAqB,GAAG,IAAI,GAAG,EAAE,CAAC;SAC/C;QACD,mGAAmG;QACnG,oCAAoC;QACpC,IAAI,CAAC,MAAM,GAAG,IAAI,KAAK,CAAC,EAAE,EAAE,iBAAiB,CAAC,CAAC;IACjD,CAAC;IACD,cAAc;QACZ,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC;QACzB,IAAI,CAAC,MAAM,CAAC,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,MAAM,CAAC,CAAC;IAClE,CAAC;IACD,aAAa;QACX,IAAI,CAAC,aAAa,GAAG,KAAK,CAAC;IAC7B,CAAC;IACD,IAAI,aAAa;QACf,OAAO,IAAI,CAAC,cAAc,CAAC;IAC7B,CAAC;IACD,IAAI,aAAa,CAAC,aAAa;QAC7B,IAAI,CAAC,cAAc,GAAG,aAAa,CAAC;IACtC,CAAC;CACF;AAED,MAAM,aAAa,GAAG,IAAI,aAAa,EAAE,CAAC;AAC1C,MAAM,OAAO,GAAG,aAAa,CAAC,MAAM,CAAC;AAErC,eAAe,OAAO,CAAC;AACvB,OAAO,EAAE,aAAa,EAAE,CAAC","sourcesContent":["import WindowMock, { hydrateMockMap } from './window.mock.js';\n\nclass WindowWrapper {\n  constructor() {\n    this.shouldUseMock = true;\n    this.initProxyWindow = this.initProxyWindow.bind(this);\n    if (this.windowIsAvailable()) {\n      // this will wrap the real window with partial mock for the dimensions\n      // once the gallery is mounted we will switch from the mocked properties to the real values\n      this.initProxyWindow();\n    } else {\n      this.initMockWindow();\n    }\n  }\n\n  windowIsAvailable() {\n    try {\n      return typeof window !== 'undefined';\n    } catch (e) {\n      return false;\n    }\n  }\n\n  initProxyWindow() {\n    const handler = {\n      // here the proxy target is the global window object\n      get: function (target, property) {\n        if (hydrateMockMap.has(property) && this.shouldUseMock) {\n          return hydrateMockMap.get(property);\n        }\n        return target[property];\n      }.bind(this),\n      // here we push to the custom props Set to know later if we want to bind the prop\n      // reflect just assigns the proprty and returns boolean if the assign was successfull\n      set: function (target, property, value) {\n        return Reflect.set(target, property, value);\n      },\n    };\n    // eslint-disable-next-line no-undef\n    const windowProxy = new Proxy(window, handler);\n    const windowFuncHandler = {\n      get: function (target, property) {\n        if (!windowProxy.proGalleryCustomProps.has(property) && typeof windowProxy[property] === 'function') {\n          return windowProxy[property].bind(window);\n        }\n        return windowProxy[property];\n      },\n      set: function (target, property, value) {\n        windowProxy.proGalleryCustomProps.add(property);\n        return Reflect.set(windowProxy, property, value);\n      },\n    };\n    if (!windowProxy.proGalleryCustomProps) {\n      windowProxy.proGalleryCustomProps = new Set();\n    }\n    // this second proxy that returnes binded functions to avoid issues with non configurable proprties\n    // eslint-disable-next-line no-undef\n    this.window = new Proxy({}, windowFuncHandler);\n  }\n  initMockWindow() {\n    this.window = WindowMock;\n    this.window.mockInstanceId = Math.floor(Math.random() * 100000);\n  }\n  stopUsingMock() {\n    this.shouldUseMock = false;\n  }\n  get shouldUseMock() {\n    return this._shouldUseMock;\n  }\n  set shouldUseMock(shouldUseMock) {\n    this._shouldUseMock = shouldUseMock;\n  }\n}\n\nconst windowWrapper = new WindowWrapper();\nconst _window = windowWrapper.window;\n\nexport default _window;\nexport { windowWrapper };\n"]}